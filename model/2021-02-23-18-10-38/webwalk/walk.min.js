/*


  Shapespark 3D visualization viewer

  Copyright (C) 2014-present Shapespark

  The viewer uses the following open source libraries:

    Three.js: https://github.com/mrdoob/three.js,
    Copyright 2010-2015 three.js authors, MIT License

    PlayCanvas (GLSL shaders code): https://github.com/playcanvas/engine
    Copyright (C) 2011-2015 PlayCanvas Ltd., MIT License

    WebXR Polyfill: https://github.com/immersive-web/webxr-polyfill,
    Copyright (C) 2017 Google Inc, Apache 2.0 License

    Web Font Loader: https://github.com/typekit/webfontloader
    Copyright (C) 2010-2017 Adobe Systems Incorporated, Google Incorporated, Apache 2.0 License

    Basis Universal GPU Texture Codec: https://github.com/BinomialLLC/basis_universal
    Copyright (C) 2019 Binomial LLC., Apache License

  and the following open fonts:

    Noto Sans: https://fonts.google.com/specimen/Noto+Sans?query=noto+sans
    Copyright (C) Google Inc., Apache 2.0 License

    Font Awesome: https://fontawesome.com/
    Copyright (C) 2017 Fonticons Inc, SIL Open Font License
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){a=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,a];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}return globalThis};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(a,b){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function a(c){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(c||"")+"_"+b++,c)}var b=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b};
$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;
$jscomp.inherits=function(a,b){a.prototype=$jscomp.objectCreate(b.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var c=$jscomp.setPrototypeOf;c(a,b)}else for(c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.superClass_=b.prototype};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(a){return a instanceof e?a:new e(function(b,c){b(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){if(null==this.batch_){this.batch_=[];var b=this;this.asyncExecuteFunction(function(){b.executeBatch_()})}this.batch_.push(a)};var d=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){d(a,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];a[b]=null;try{c()}catch(n){this.asyncThrow_(n)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var e=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(k){b.reject(k)}};e.prototype.createResolveAndReject_=function(){function a(a){return function(d){c||(c=!0,a.call(b,d))}}var b=this,c=!1;
return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};e.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof e)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};e.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(k){this.reject_(k);return}"function"==typeof b?
this.settleSameAsThenable_(b,a):this.fulfill_(a)};e.prototype.reject_=function(a){this.settle_(2,a)};e.prototype.fulfill_=function(a){this.settle_(1,a)};e.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=0;a<this.onSettledCallbacks_.length;++a)g.asyncExecute(this.onSettledCallbacks_[a]);
this.onSettledCallbacks_=null}};var g=new b;e.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};e.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(n){c.reject(n)}};e.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{d(a(b))}catch(u){f(u)}}:b}var d,f,g=new e(function(a,b){d=a;f=b});this.callWhenSettled_(c(a,d),c(b,f));return g};
e.prototype.catch=function(a){return this.then(void 0,a)};e.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?g.asyncExecute(c):this.onSettledCallbacks_.push(c)};e.resolve=c;e.reject=function(a){return new e(function(b,c){c(a)})};e.race=function(a){return new e(function(b,d){for(var e=$jscomp.makeIterator(a),f=e.next();!f.done;f=e.next())c(f.value).callWhenSettled_(b,
d)})};e.all=function(a){var b=$jscomp.makeIterator(a),d=b.next();return d.done?c([]):new e(function(a,e){function f(b){return function(c){g[b]=c;k--;0==k&&a(g)}}var g=[],k=0;do g.push(void 0),k++,c(d.value).callWhenSettled_(f(g.length-1),e),d=b.next();while(!d.done)})};return e},"es6","es3");$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var c=a.next();$jscomp.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};
$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(a){return{value:a,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(d);if(!d.done)return this.context_.stop_(),d;var e=d.value}catch(g){return this.context_.yieldAllIterator_=null,this.context_.throw_(g),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,e);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};$jscomp.initSymbolIterator();this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){b=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&$jscomp.setPrototypeOf(b,a.prototype);return b};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(b){return a.next(b)}function c(b){return a.throw(b)}return new Promise(function(d,e){function g(a){a.done?d(a.value):Promise.resolve(a.value).then(b,c).then(g,e)}g(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
$jscomp.polyfill("globalThis",function(a){return a||$jscomp.global},"es_next","es3");$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={},b=Object.create(new $jscomp.global.Proxy(a,{get:function(c,d,e){return c==a&&"q"==d&&e==b}}));return!0===b.q}catch(c){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();
$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.polyfill("WeakMap",function(a){function b(){if(!a||!Object.seal)return!1;try{var b=Object.seal({}),c=Object.seal({}),d=new a([[b,2],[c,3]]);if(2!=d.get(b)||3!=d.get(c))return!1;d.delete(b);d.set(c,4);return!d.has(b)&&4==d.get(c)}catch(q){return!1}}function c(){}function d(a){var b=typeof a;return"object"===b&&null!==a||"function"===b}function e(a){if(!$jscomp.owns(a,f)){var b=new c;$jscomp.defineProperty(a,f,{value:b})}}function g(a){var b=Object[a];b&&(Object[a]=function(a){if(a instanceof
c)return a;e(a);return b(a)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var f="$jscomp_hidden_"+Math.random();g("freeze");g("preventExtensions");g("seal");var h=0,k=function(a){this.id_=(h+=Math.random()+1).toString();if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};k.prototype.set=function(a,b){if(!d(a))throw Error("Invalid WeakMap key");e(a);if(!$jscomp.owns(a,f))throw Error("WeakMap key fail: "+
a);a[f][this.id_]=b;return this};k.prototype.get=function(a){return d(a)&&$jscomp.owns(a,f)?a[f][this.id_]:void 0};k.prototype.has=function(a){return d(a)&&$jscomp.owns(a,f)&&$jscomp.owns(a[f],this.id_)};k.prototype.delete=function(a){return d(a)&&$jscomp.owns(a,f)&&$jscomp.owns(a[f],this.id_)?delete a[f][this.id_]:!1};return k},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_MAP||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a($jscomp.makeIterator([[b,"s"]]));if("s"!=c.get(b)||1!=c.size||c.get({x:4})||c.set({x:4},"t")!=c||2!=c.size)return!1;var d=c.entries(),e=d.next();if(e.done||e.value[0]!=b||"s"!=e.value[1])return!1;e=d.next();return e.done||4!=e.value[0].x||"t"!=e.value[1]||!d.next().done?!1:!0}catch(q){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;$jscomp.initSymbolIterator();var c=new WeakMap,d=function(a){this.data_={};this.head_=f();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};d.prototype.set=function(a,b){a=0===a?0:a;var c=e(this,a);c.list||(c.list=this.data_[c.id]=[]);c.entry?c.entry.value=b:(c.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,
value:b},c.list.push(c.entry),this.head_.previous.next=c.entry,this.head_.previous=c.entry,this.size++);return this};d.prototype.delete=function(a){a=e(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};d.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=f();this.size=0};d.prototype.has=function(a){return!!e(this,a).entry};
d.prototype.get=function(a){return(a=e(this,a).entry)&&a.value};d.prototype.entries=function(){return g(this,function(a){return[a.key,a.value]})};d.prototype.keys=function(){return g(this,function(a){return a.key})};d.prototype.values=function(){return g(this,function(a){return a.value})};d.prototype.forEach=function(a,b){for(var c=this.entries(),d;!(d=c.next()).done;)d=d.value,a.call(b,d[1],d[0],this)};d.prototype[Symbol.iterator]=d.prototype.entries;var e=function(a,b){var d=b&&typeof b;"object"==
d||"function"==d?c.has(b)?d=c.get(b):(d=""+ ++h,c.set(b,d)):d="p_"+b;var e=a.data_[d];if(e&&$jscomp.owns(a.data_,d))for(a=0;a<e.length;a++){var f=e[a];if(b!==b&&f.key!==f.key||b===f.key)return{id:d,list:e,index:a,entry:f}}return{id:d,list:e,index:-1,entry:void 0}},g=function(a,b){var c=a.head_;return $jscomp.iteratorPrototype(function(){if(c){for(;c.head!=a.head_;)c=c.previous;for(;c.next!=c.head;)return c=c.next,{done:!1,value:b(c)};c=null}return{done:!0,value:void 0}})},f=function(){var a={};return a.previous=
a.next=a.head=a},h=0;return d},"es6","es3");$jscomp.polyfill("Object.is",function(a){return a?a:function(a,c){return a===c?0!==a||1/a===1/c:a!==a&&c!==c}},"es6","es3");$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,c){var b=this;b instanceof String&&(b=String(b));var e=b.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var g=b[c];if(g===a||Object.is(g,a))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,c||0)}},"es6","es3");
$jscomp.polyfill("Set",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_SET||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a($jscomp.makeIterator([b]));if(!c.has(b)||1!=c.size||c.add(b)!=c||1!=c.size||c.add({x:4})!=c||2!=c.size)return!1;var g=c.entries(),f=g.next();if(f.done||f.value[0]!=b||f.value[1]!=b)return!1;f=g.next();return f.done||f.value[0]==b||4!=f.value[0].x||f.value[1]!=f.value[0]?!1:g.next().done}catch(h){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;$jscomp.initSymbolIterator();var c=function(a){this.map_=new Map;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)this.add(b.value)}this.size=this.map_.size};c.prototype.add=function(a){a=0===a?0:a;this.map_.set(a,a);this.size=this.map_.size;return this};c.prototype.delete=function(a){a=this.map_.delete(a);this.size=this.map_.size;return a};c.prototype.clear=function(){this.map_.clear();
this.size=0};c.prototype.has=function(a){return this.map_.has(a)};c.prototype.entries=function(){return this.map_.entries()};c.prototype.values=function(){return this.map_.values()};c.prototype.keys=c.prototype.values;c.prototype[Symbol.iterator]=c.prototype.values;c.prototype.forEach=function(a,b){var c=this;this.map_.forEach(function(d){return a.call(b,d,d,c)})};return c},"es6","es3");
$jscomp.assign="function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)$jscomp.owns(d,e)&&(a[e]=d[e])}return a};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");$jscomp.polyfill("Object.setPrototypeOf",function(a){return a||$jscomp.setPrototypeOf},"es6","es5");
$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var g=a[e];if(b.call(c,g,e,a))return{i:e,v:g}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).i}},"es6","es3");$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");
$jscomp.polyfill("Math.sign",function(a){return a?a:function(a){a=Number(a);return 0===a||isNaN(a)?a:0<a?1:-1}},"es6","es3");$jscomp.polyfill("Math.log2",function(a){return a?a:function(a){return Math.log(a)/Math.LN2}},"es6","es3");$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,c,d){var b=this.length||0;0>c&&(c=Math.max(0,b+c));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(c=Number(c||0);c<d;c++)this[c]=a;return this}},"es6","es3");
$jscomp.polyfill("Object.values",function(a){return a?a:function(a){var b=[],d;for(d in a)$jscomp.owns(a,d)&&b.push(a[d]);return b}},"es8","es3");$jscomp.polyfill("Object.entries",function(a){return a?a:function(a){var b=[],d;for(d in a)$jscomp.owns(a,d)&&b.push([d,a[d]]);return b}},"es8","es3");
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"endsWith");a+="";void 0===c&&(c=b.length);c=Math.max(0,Math.min(c|0,b.length));for(var e=a.length;0<e&&0<c;)if(b[--c]!=a[--e])return!1;return 0>=e}},"es6","es3");$jscomp.polyfill("Array.prototype.entries",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,c){return[a,c]})}},"es6","es3");(function(){function a(a,b,c){return a.call.apply(a.bind,arguments)}function b(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function c(d,e,f){c=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:b;return c.apply(null,arguments)}function d(a,b){this.a=
a;this.m=b||a;this.c=this.m.document}function e(a,b,c,d){b=a.c.createElement(b);if(c)for(var e in c)c.hasOwnProperty(e)&&("style"==e?b.style.cssText=c[e]:b.setAttribute(e,c[e]));d&&b.appendChild(a.c.createTextNode(d));return b}function g(a,b,c){(a=a.c.getElementsByTagName(b)[0])||(a=document.documentElement);a.insertBefore(c,a.lastChild)}function f(a){a.parentNode&&a.parentNode.removeChild(a)}function h(a,b,c){b=b||[];c=c||[];for(var d=a.className.split(/\s+/),e=0;e<b.length;e+=1){for(var f=!1,g=
0;g<d.length;g+=1)if(b[e]===d[g]){f=!0;break}f||d.push(b[e])}b=[];for(e=0;e<d.length;e+=1){f=!1;for(g=0;g<c.length;g+=1)if(d[e]===c[g]){f=!0;break}f||b.push(d[e])}a.className=b.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function k(a,b){a=a.className.split(/\s+/);for(var c=0,d=a.length;c<d;c++)if(a[c]==b)return!0;return!1}function n(a){if("string"===typeof a.f)return a.f;var b=a.m.location.protocol;"about:"==b&&(b=a.a.location.protocol);return"https:"==b?"https:":"http:"}function p(a){return a.m.location.hostname||
a.a.location.hostname}function l(a,b,c){function d(){m&&f&&k&&(m(h),m=null)}b=e(a,"link",{rel:"stylesheet",href:b,media:"all"});var f=!1,k=!0,h=null,m=c||null;qa?(b.onload=function(){f=!0;d()},b.onerror=function(){f=!0;h=Error("Stylesheet failed to load");d()}):setTimeout(function(){f=!0;d()},0);g(a,"head",b)}function q(a,b,c,d){var f=a.c.getElementsByTagName("head")[0];if(f){var g=e(a,"script",{src:b}),k=!1;g.onload=g.onreadystatechange=function(){k||this.readyState&&"loaded"!=this.readyState&&"complete"!=
this.readyState||(k=!0,c&&c(null),g.onload=g.onreadystatechange=null,"HEAD"==g.parentNode.tagName&&f.removeChild(g))};f.appendChild(g);setTimeout(function(){k||(k=!0,c&&c(Error("Script load timeout")))},d||5E3);return g}return null}function r(){this.a=0;this.c=null}function m(a){a.a++;return function(){a.a--;x(a)}}function u(a,b){a.c=b;x(a)}function x(a){0==a.a&&a.c&&(a.c(),a.c=null)}function t(a){this.a=a||"-"}function v(a,b){this.c=a;this.f=4;this.a="n";(a=(b||"n4").match(/^([nio])([1-9])$/i))&&
(this.a=a[1],this.f=parseInt(a[2],10))}function w(a){return y(a)+" "+(a.f+"00 300px ")+z(a.c)}function z(a){var b=[];a=a.split(/,\s*/);for(var c=0;c<a.length;c++){var d=a[c].replace(/['"]/g,"");-1!=d.indexOf(" ")||/^\d/.test(d)?b.push("'"+d+"'"):b.push(d)}return b.join(",")}function A(a){return a.a+a.f}function y(a){var b="normal";"o"===a.a?b="oblique":"i"===a.a&&(b="italic");return b}function E(a){var b=4,c="n",d=null;a&&((d=a.match(/(normal|oblique|italic)/i))&&d[1]&&(c=d[1].substr(0,1).toLowerCase()),
(d=a.match(/([1-9]00|normal|bold)/i))&&d[1]&&(/bold/i.test(d[1])?b=7:/[1-9]00/.test(d[1])&&(b=parseInt(d[1].substr(0,1),10))));return c+b}function I(a,b){this.c=a;this.f=a.m.document.documentElement;this.h=b;this.a=new t("-");this.j=!1!==b.events;this.g=!1!==b.classes}function O(a){a.g&&h(a.f,[a.a.c("wf","loading")]);T(a,"loading")}function K(a){if(a.g){var b=k(a.f,a.a.c("wf","active")),c=[],d=[a.a.c("wf","loading")];b||c.push(a.a.c("wf","inactive"));h(a.f,c,d)}T(a,"inactive")}function T(a,b,c){if(a.j&&
a.h[b])if(c)a.h[b](c.c,A(c));else a.h[b]()}function Y(){this.c={}}function Q(a,b,c){var d=[],e;for(e in b)if(b.hasOwnProperty(e)){var f=a.c[e];f&&d.push(f(b[e],c))}return d}function C(a,b){this.c=a;this.f=b;this.a=e(this.c,"span",{"aria-hidden":"true"},this.f)}function B(a){g(a.c,"body",a.a)}function H(a){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+
z(a.c)+";font-style:"+(y(a)+";font-weight:"+(a.f+"00;"))}function N(a,b,c,d,e,f){this.g=a;this.j=b;this.a=d;this.c=c;this.f=e||3E3;this.h=f||void 0}function D(a,b,c,d,e,f,g){this.v=a;this.B=b;this.c=c;this.a=d;this.s=g||"BESbswy";this.f={};this.w=e||3E3;this.u=f||null;this.o=this.j=this.h=this.g=null;this.g=new C(this.c,this.s);this.h=new C(this.c,this.s);this.j=new C(this.c,this.s);this.o=new C(this.c,this.s);a=new v(this.a.c+",serif",A(this.a));a=H(a);this.g.a.style.cssText=a;a=new v(this.a.c+",sans-serif",
A(this.a));a=H(a);this.h.a.style.cssText=a;a=new v("serif",A(this.a));a=H(a);this.j.a.style.cssText=a;a=new v("sans-serif",A(this.a));a=H(a);this.o.a.style.cssText=a;B(this.g);B(this.h);B(this.j);B(this.o)}function J(){if(null===pa){var a=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);pa=!!a&&(536>parseInt(a[1],10)||536===parseInt(a[1],10)&&11>=parseInt(a[2],10))}return pa}function L(a,b,c){for(var d in xa)if(xa.hasOwnProperty(d)&&b===a.f[xa[d]]&&c===a.f[xa[d]])return!0;return!1}
function W(a){var b=a.g.a.offsetWidth,c=a.h.a.offsetWidth,d;(d=b===a.f.serif&&c===a.f["sans-serif"])||(d=J()&&L(a,b,c));d?ua()-a.A>=a.w?J()&&L(a,b,c)&&(null===a.u||a.u.hasOwnProperty(a.a.c))?R(a,a.v):R(a,a.B):M(a):R(a,a.v)}function M(a){setTimeout(c(function(){W(this)},a),50)}function R(a,b){setTimeout(c(function(){f(this.g.a);f(this.h.a);f(this.j.a);f(this.o.a);b(this.a)},a),0)}function F(a,b,c){this.c=a;this.a=b;this.f=0;this.o=this.j=!1;this.s=c}function P(a){0==--a.f&&a.j&&(a.o?(a=a.a,a.g&&h(a.f,
[a.a.c("wf","active")],[a.a.c("wf","loading"),a.a.c("wf","inactive")]),T(a,"active")):K(a.a))}function V(a){this.j=a;this.a=new Y;this.h=0;this.f=this.g=!0}function aa(a,b,d,e,f){var g=0==--a.h;(a.f||a.g)&&setTimeout(function(){var a=f||null,k=e||{};if(0===d.length&&g)K(b.a);else{b.f+=d.length;g&&(b.j=g);var m,l=[];for(m=0;m<d.length;m++){var q=d[m],n=k[q.c],r=b.a,p=q;r.g&&h(r.f,[r.a.c("wf",p.c,A(p).toString(),"loading")]);T(r,"fontloading",p);r=null;null===wa&&(wa=window.FontFace?(p=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent))?
42<parseInt(p[1],10):!0:!1);wa?r=new N(c(b.g,b),c(b.h,b),b.c,q,b.s,n):r=new D(c(b.g,b),c(b.h,b),b.c,q,b.s,a,n);l.push(r)}for(m=0;m<l.length;m++)l[m].start()}},0)}function U(a,b,c){var d=[],e=c.timeout;O(b);d=Q(a.a,c,a.c);var f=new F(a.c,b,e);a.h=d.length;b=0;for(c=d.length;b<c;b++)d[b].load(function(b,c,d){aa(a,f,b,c,d)})}function X(a,b){this.c=a;this.a=b}function S(a,b,c){var d=n(a.c);a=(a.a.api||"fast.fonts.net/jsapi").replace(/^.*http(s?):(\/\/)?/,"");return d+"//"+a+"/"+b+".js"+(c?"?v="+c:"")}
function da(a,b){this.c=a;this.a=b}function ba(a,b,c){a?this.c=a:this.c=b+ka;this.a=[];this.f=[];this.g=c||""}function ea(a,b){for(var c=b.length,d=0;d<c;d++){var e=b[d].split(":");3==e.length&&a.f.push(e.pop());var f="";2==e.length&&""!=e[1]&&(f=":");a.a.push(e.join(f))}}function ia(a){if(0==a.a.length)throw Error("No fonts to load!");if(-1!=a.c.indexOf("kit="))return a.c;for(var b=a.a.length,c=[],d=0;d<b;d++)c.push(a.a[d].replace(/ /g,"+"));b=a.c+"?family="+c.join("%7C");0<a.f.length&&(b+="&subset="+
a.f.join(","));0<a.g.length&&(b+="&text="+encodeURIComponent(a.g));return b}function la(a){this.f=a;this.a=[];this.c={}}function fa(a){for(var b=a.f.length,c=0;c<b;c++){var d=a.f[c].split(":"),e=d[0].replace(/\+/g," "),f=["n4"];if(2<=d.length){var g=d[1];var k=[];if(g){g=g.split(",");for(var h=g.length,m=0;m<h;m++){var l=g[m];if(l.match(/^[\w-]+$/)){var q=ta.exec(l.toLowerCase());if(null==q)l="";else{l=q[2];l=null==l||""==l?"n":Aa[l];q=q[1];if(null==q||""==q)q="4";else{var n=Ba[q];q=n?n:isNaN(q)?
"4":q.substr(0,1)}l=[l,q].join("")}}else l="";l&&k.push(l)}}0<k.length&&(f=k);3==d.length&&(d=d[2],k=[],d=d?d.split(","):k,0<d.length&&(d=Ha[d[0]])&&(a.c[e]=d))}a.c[e]||(d=Ha[e])&&(a.c[e]=d);for(d=0;d<f.length;d+=1)a.a.push(new v(e,f[d]))}}function ha(a,b){this.c=a;this.a=b}function ya(a,b){this.c=a;this.a=b}function Z(a,b){this.c=a;this.f=b;this.a=[]}var ua=Date.now||function(){return+new Date},qa=!!window.FontFace;t.prototype.c=function(a){for(var b=[],c=0;c<arguments.length;c++)b.push(arguments[c].replace(/[\W_]+/g,
"").toLowerCase());return b.join(this.a)};N.prototype.start=function(){var a=this.c.m.document,b=this,c=ua(),d=new Promise(function(d,e){function f(){ua()-c>=b.f?e():a.fonts.load(w(b.a),b.h).then(function(a){1<=a.length?d():setTimeout(f,25)},function(){e()})}f()}),e=new Promise(function(a,c){setTimeout(c,b.f)});Promise.race([e,d]).then(function(){b.g(b.a)},function(){b.j(b.a)})};var xa={D:"serif",C:"sans-serif"},pa=null;D.prototype.start=function(){this.f.serif=this.j.a.offsetWidth;this.f["sans-serif"]=
this.o.a.offsetWidth;this.A=ua();W(this)};var wa=null;F.prototype.g=function(a){var b=this.a;b.g&&h(b.f,[b.a.c("wf",a.c,A(a).toString(),"active")],[b.a.c("wf",a.c,A(a).toString(),"loading"),b.a.c("wf",a.c,A(a).toString(),"inactive")]);T(b,"fontactive",a);this.o=!0;P(this)};F.prototype.h=function(a){var b=this.a;if(b.g){var c=k(b.f,b.a.c("wf",a.c,A(a).toString(),"active")),d=[],e=[b.a.c("wf",a.c,A(a).toString(),"loading")];c||d.push(b.a.c("wf",a.c,A(a).toString(),"inactive"));h(b.f,d,e)}T(b,"fontinactive",
a);P(this)};V.prototype.load=function(a){this.c=new d(this.j,a.context||this.j);this.g=!1!==a.events;this.f=!1!==a.classes;U(this,new I(this.c,a),a)};X.prototype.load=function(a){function b(){if(f["__mti_fntLst"+d]){var c=f["__mti_fntLst"+d](),e=[],g;if(c)for(var k=0;k<c.length;k++){var h=c[k].fontfamily;void 0!=c[k].fontStyle&&void 0!=c[k].fontWeight?(g=c[k].fontStyle+c[k].fontWeight,e.push(new v(h,g))):e.push(new v(h))}a(e)}else setTimeout(function(){b()},50)}var c=this,d=c.a.projectId,e=c.a.version;
if(d){var f=c.c.m;q(this.c,S(c,d,e),function(e){e?a([]):(f["__MonotypeConfiguration__"+d]=function(){return c.a},b())}).id="__MonotypeAPIScript__"+d}else a([])};da.prototype.load=function(a){var b,c=this.a.urls||[],d=this.a.families||[],e=this.a.testStrings||{},f=new r;var g=0;for(b=c.length;g<b;g++)l(this.c,c[g],m(f));var k=[];g=0;for(b=d.length;g<b;g++)if(c=d[g].split(":"),c[1])for(var h=c[1].split(","),q=0;q<h.length;q+=1)k.push(new v(c[0],h[q]));else k.push(new v(c[0]));u(f,function(){a(k,e)})};
var ka="//fonts.googleapis.com/css",Ha={latin:"BESbswy","latin-ext":"\u00e7\u00f6\u00fc\u011f\u015f",cyrillic:"\u0439\u044f\u0416",greek:"\u03b1\u03b2\u03a3",khmer:"\u1780\u1781\u1782",Hanuman:"\u1780\u1781\u1782"},Ba={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},
Aa={i:"i",italic:"i",n:"n",normal:"n"},ta=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/,za={Arimo:!0,Cousine:!0,Tinos:!0};ha.prototype.load=function(a){var b=new r,c=this.c,d=new ba(this.a.api,n(c),this.a.text),e=this.a.families;ea(d,e);var f=new la(e);fa(f);l(c,ia(d),m(b));u(b,function(){a(f.a,f.c,za)})};ya.prototype.load=function(a){var b=this.a.id,c=this.c.m;b?q(this.c,(this.a.api||"https://use.typekit.net")+
"/"+b+".js",function(b){if(b)a([]);else if(c.Typekit&&c.Typekit.config&&c.Typekit.config.fn){b=c.Typekit.config.fn;for(var d=[],e=0;e<b.length;e+=2)for(var f=b[e],g=b[e+1],k=0;k<g.length;k++)d.push(new v(f,g[k]));try{c.Typekit.load({events:!1,classes:!1,async:!0})}catch(Ga){}a(d)}},2E3):a([])};Z.prototype.load=function(a){var b=this.f.id,c=this.c.m,d=this;b?(c.__webfontfontdeckmodule__||(c.__webfontfontdeckmodule__={}),c.__webfontfontdeckmodule__[b]=function(b,c){b=0;for(var e=c.fonts.length;b<e;++b){var f=
c.fonts[b];d.a.push(new v(f.name,E("font-weight:"+f.weight+";font-style:"+f.style)))}a(d.a)},q(this.c,n(this.c)+(this.f.api||"//f.fontdeck.com/s/css/js/")+p(this.c)+"/"+b+".js",function(b){b&&a([])})):a([])};var ca=new V(window);ca.a.c.custom=function(a,b){return new da(b,a)};ca.a.c.fontdeck=function(a,b){return new Z(b,a)};ca.a.c.monotype=function(a,b){return new X(b,a)};ca.a.c.typekit=function(a,b){return new ya(b,a)};ca.a.c.google=function(a,b){return new ha(b,a)};var Ca={load:c(ca.load,ca)};"function"===
typeof define&&define.amd?define(function(){return Ca}):"undefined"!==typeof module&&module.exports?module.exports=Ca:(window.WebFont=Ca,window.WebFontConfig&&ca.load(window.WebFontConfig))})();var THREE={REVISION:"71"};"object"===typeof module&&(module.exports=THREE);void 0===Math.sign&&(Math.sign=function(a){return 0>a?-1:0<a?1:+a});THREE.log=function(){console.log.apply(console,arguments)};THREE.warn=function(){console.warn.apply(console,arguments)};THREE.error=function(){console.error.apply(console,arguments)};THREE.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};THREE.CullFaceNone=0;THREE.CullFaceBack=1;THREE.CullFaceFront=2;THREE.CullFaceFrontBack=3;THREE.FrontFaceDirectionCW=0;
THREE.FrontFaceDirectionCCW=1;THREE.BasicShadowMap=0;THREE.PCFShadowMap=1;THREE.PCFSoftShadowMap=2;THREE.FrontSide=0;THREE.BackSide=1;THREE.DoubleSide=2;THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NoBlending=0;THREE.NormalBlending=1;THREE.AdditiveBlending=2;THREE.SubtractiveBlending=3;THREE.MultiplyBlending=4;THREE.CustomBlending=5;THREE.AddEquation=100;THREE.SubtractEquation=101;THREE.ReverseSubtractEquation=102;
THREE.MinEquation=103;THREE.MaxEquation=104;THREE.ZeroFactor=200;THREE.OneFactor=201;THREE.SrcColorFactor=202;THREE.OneMinusSrcColorFactor=203;THREE.SrcAlphaFactor=204;THREE.OneMinusSrcAlphaFactor=205;THREE.DstAlphaFactor=206;THREE.OneMinusDstAlphaFactor=207;THREE.DstColorFactor=208;THREE.OneMinusDstColorFactor=209;THREE.SrcAlphaSaturateFactor=210;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.AddOperation=2;THREE.UVMapping=300;THREE.CubeReflectionMapping=301;THREE.CubeRefractionMapping=302;
THREE.EquirectangularReflectionMapping=303;THREE.EquirectangularRefractionMapping=304;THREE.SphericalReflectionMapping=305;THREE.Color=function(a){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(a)};
THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(a){a instanceof THREE.Color?this.copy(a):"number"===typeof a?this.setHex(a):"string"===typeof a&&this.setStyle(a);return this},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(a,b,c){this.r=a;this.g=b;this.b=c;return this},setHSL:function(a,b,c){if(0===b)this.r=this.g=this.b=c;else{var d=function(a,b,c){0>c&&(c+=1);1<c&&--c;return c<1/6?a+6*(b-a)*c:
.5>c?b:c<2/3?a+6*(b-a)*(2/3-c):a};b=.5>=c?c*(1+b):c+b-c*b;c=2*c-b;this.r=d(c,b,a+1/3);this.g=d(c,b,a);this.b=d(c,b,a-1/3)}return this},setStyle:function(a){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(a))return a=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(a),this.r=Math.min(255,parseInt(a[1],10))/255,this.g=Math.min(255,parseInt(a[2],10))/255,this.b=Math.min(255,parseInt(a[3],10))/255,this;if(/^rgb\((\d+)%, ?(\d+)%, ?(\d+)%\)$/i.test(a))return a=/^rgb\((\d+)%, ?(\d+)%, ?(\d+)%\)$/i.exec(a),this.r=Math.min(100,
parseInt(a[1],10))/100,this.g=Math.min(100,parseInt(a[2],10))/100,this.b=Math.min(100,parseInt(a[3],10))/100,this;if(/^#([0-9a-f]{6})$/i.test(a))return a=/^#([0-9a-f]{6})$/i.exec(a),this.setHex(parseInt(a[1],16)),this;if(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(a))return a=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(a),this.setHex(parseInt(a[1]+a[1]+a[2]+a[2]+a[3]+a[3],16)),this;if(/^(\w+)$/i.test(a))return this.setHex(THREE.ColorKeywords[a]),this},copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;
return this},copyGammaToLinear:function(a,b){void 0===b&&(b=2);this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},copyLinearToGamma:function(a,b){void 0===b&&(b=2);b=0<b?1/b:1;this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},convertGammaToLinear:function(){var a=this.r,b=this.g,c=this.b;this.r=a*a;this.g=b*b;this.b=c*c;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);
return this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){a=a||{h:0,s:0,l:0};var b=this.r,c=this.g,d=this.b,e=Math.max(b,c,d),g=Math.min(b,c,d),f,h=(g+e)/2;if(g===e)g=f=0;else{var k=e-g;g=.5>=h?k/(e+g):k/(2-e-g);switch(e){case b:f=(c-d)/k+(c<d?6:0);break;case c:f=(d-b)/k+2;break;case d:f=(b-c)/k+4}f/=6}a.h=f;a.s=g;a.l=h;return a},getStyle:function(){return"rgb("+(255*this.r|0)+
","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(a,b,c){var d=this.getHSL();d.h+=a;d.s+=b;d.l+=c;this.setHSL(d.h,d.s,d.l);return this},add:function(a){this.r+=a.r;this.g+=a.g;this.b+=a.b;return this},addColors:function(a,b){this.r=a.r+b.r;this.g=a.g+b.g;this.b=a.b+b.b;return this},addScalar:function(a){this.r+=a;this.g+=a;this.b+=a;return this},multiply:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this},multiplyScalar:function(a){this.r*=a;this.g*=a;this.b*=a;return this},lerp:function(a,
b){this.r+=(a.r-this.r)*b;this.g+=(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return this},equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a){this.r=a[0];this.g=a[1];this.b=a[2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.r;a[b+1]=this.g;a[b+2]=this.b;return a},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}};
THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,
darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,
grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,
lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,
palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,
tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};THREE.Quaternion=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._w=void 0!==d?d:1};
THREE.Quaternion.prototype={constructor:THREE.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get w(){return this._w},set w(a){this._w=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._w=d;this.onChangeCallback();return this},copy:function(a){this._x=a.x;this._y=a.y;this._z=a.z;
this._w=a.w;this.onChangeCallback();return this},setFromEuler:function(a,b){if(!1===a instanceof THREE.Euler)throw Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var c=Math.cos(a._x/2),d=Math.cos(a._y/2),e=Math.cos(a._z/2),g=Math.sin(a._x/2),f=Math.sin(a._y/2),h=Math.sin(a._z/2);"XYZ"===a.order?(this._x=g*d*e+c*f*h,this._y=c*f*e-g*d*h,this._z=c*d*h+g*f*e,this._w=c*d*e-g*f*h):"YXZ"===a.order?(this._x=g*d*e+c*f*h,this._y=c*f*e-g*d*h,this._z=
c*d*h-g*f*e,this._w=c*d*e+g*f*h):"ZXY"===a.order?(this._x=g*d*e-c*f*h,this._y=c*f*e+g*d*h,this._z=c*d*h+g*f*e,this._w=c*d*e-g*f*h):"ZYX"===a.order?(this._x=g*d*e-c*f*h,this._y=c*f*e+g*d*h,this._z=c*d*h-g*f*e,this._w=c*d*e+g*f*h):"YZX"===a.order?(this._x=g*d*e+c*f*h,this._y=c*f*e+g*d*h,this._z=c*d*h-g*f*e,this._w=c*d*e-g*f*h):"XZY"===a.order&&(this._x=g*d*e-c*f*h,this._y=c*f*e-g*d*h,this._z=c*d*h+g*f*e,this._w=c*d*e+g*f*h);if(!1!==b)this.onChangeCallback();return this},setFromAxisAngle:function(a,
b){b/=2;var c=Math.sin(b);this._x=a.x*c;this._y=a.y*c;this._z=a.z*c;this._w=Math.cos(b);this.onChangeCallback();return this},setFromRotationMatrix:function(a){var b=a.elements,c=b[0];a=b[4];var d=b[8],e=b[1],g=b[5],f=b[9],h=b[2],k=b[6];b=b[10];var n=c+g+b;0<n?(c=.5/Math.sqrt(n+1),this._w=.25/c,this._x=(k-f)*c,this._y=(d-h)*c,this._z=(e-a)*c):c>g&&c>b?(c=2*Math.sqrt(1+c-g-b),this._w=(k-f)/c,this._x=.25*c,this._y=(a+e)/c,this._z=(d+h)/c):g>b?(c=2*Math.sqrt(1+g-c-b),this._w=(d-h)/c,this._x=(a+e)/c,this._y=
.25*c,this._z=(f+k)/c):(c=2*Math.sqrt(1+b-c-g),this._w=(e-a)/c,this._x=(d+h)/c,this._y=(f+k)/c,this._z=.25*c);this.onChangeCallback();return this},setFromUnitVectors:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector3);b=c.dot(d)+1;1E-6>b?(b=0,Math.abs(c.x)>Math.abs(c.z)?a.set(-c.y,c.x,0):a.set(0,-c.z,c.y)):a.crossVectors(c,d);this._x=a.x;this._y=a.y;this._z=a.z;this._w=b;this.normalize();return this}}(),inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this._x*=
-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();0===a?(this._z=this._y=this._x=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a);this.onChangeCallback();return this},
multiply:function(a,b){return void 0!==b?(THREE.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},multiplyQuaternions:function(a,b){var c=a._x,d=a._y,e=a._z;a=a._w;var g=b._x,f=b._y,h=b._z;b=b._w;this._x=c*b+a*g+d*h-e*f;this._y=d*b+a*f+e*g-c*h;this._z=e*b+a*h+c*f-d*g;this._w=a*b-c*g-d*f-e*h;this.onChangeCallback();return this},multiplyVector3:function(a){THREE.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");
return a.applyQuaternion(this)},slerp:function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this._x,d=this._y,e=this._z,g=this._w,f=g*a._w+c*a._x+d*a._y+e*a._z;0>f?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,f=-f):this.copy(a);if(1<=f)return this._w=g,this._x=c,this._y=d,this._z=e,this;a=Math.acos(f);var h=Math.sqrt(1-f*f);if(.001>Math.abs(h))return this._w=.5*(g+this._w),this._x=.5*(c+this._x),this._y=.5*(d+this._y),this._z=.5*(e+this._z),this;f=Math.sin((1-b)*a)/h;b=
Math.sin(b*a)/h;this._w=g*f+this._w*b;this._x=c*f+this._x*b;this._y=d*f+this._y*b;this._z=e*f+this._z*b;this.onChangeCallback();return this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,b){void 0===b&&(b=0);this._x=a[b];this._y=a[b+1];this._z=a[b+2];this._w=a[b+3];this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._w;return a},onChange:function(a){this.onChangeCallback=
a;return this},onChangeCallback:function(){},clone:function(){return new THREE.Quaternion(this._x,this._y,this._z,this._w)}};THREE.Quaternion.slerp=function(a,b,c,d){return c.copy(a).slerp(b,d)};THREE.Vector2=function(a,b){this.x=a||0;this.y=b||0};
THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(a,b){this.x=a;this.y=b;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+a);}},copy:function(a){this.x=a.x;this.y=a.y;return this},add:function(a,
b){if(void 0!==b)return THREE.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},sub:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;return this},
subScalar:function(a){this.x-=a;this.y-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},divide:function(a){this.x/=a.x;this.y/=a.y;return this},divideScalar:function(a){0!==a?(a=1/a,this.x*=a,this.y*=a):this.y=this.x=0;return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);return this},max:function(a){this.x<a.x&&(this.x=a.x);
this.y<a.y&&(this.y=a.y);return this},clamp:function(a,b){this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x);this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y);return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector2,b=new THREE.Vector2);a.set(c,c);b.set(d,d);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=
Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},
distanceToSquared:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},setLength:function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];return this},toArray:function(a,b){void 0===
a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];return this},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};
THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+
a);}},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},sub:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),
this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},multiply:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b);this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=
a;return this},multiplyVectors:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var a;return function(b){!1===b instanceof THREE.Euler&&THREE.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.");void 0===a&&(a=new THREE.Quaternion);this.applyQuaternion(a.setFromEuler(b));return this}}(),applyAxisAngle:function(){var a;return function(b,c){void 0===a&&(a=new THREE.Quaternion);this.applyQuaternion(a.setFromAxisAngle(b,
c));return this}}(),applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[3]*c+a[6]*d;this.y=a[1]*b+a[4]*c+a[7]*d;this.z=a[2]*b+a[5]*c+a[8]*d;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12];this.y=a[1]*b+a[5]*c+a[9]*d+a[13];this.z=a[2]*b+a[6]*c+a[10]*d+a[14];return this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;var e=1/(a[3]*b+a[7]*c+a[11]*d+a[15]);this.x=(a[0]*b+a[4]*
c+a[8]*d+a[12])*e;this.y=(a[1]*b+a[5]*c+a[9]*d+a[13])*e;this.z=(a[2]*b+a[6]*c+a[10]*d+a[14])*e;return this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,g=a.y,f=a.z;a=a.w;var h=a*b+g*d-f*c,k=a*c+f*b-e*d,n=a*d+e*c-g*b;b=-e*b-g*c-f*d;this.x=h*a+b*-e+k*-f-n*-g;this.y=k*a+b*-g+n*-e-h*-f;this.z=n*a+b*-f+h*-g-k*-e;return this},project:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.projectionMatrix,a.getInverse(b.matrixWorld));return this.applyProjection(a)}}(),
unproject:function(){var a;return function(b){void 0===a&&(a=new THREE.Matrix4);a.multiplyMatrices(b.matrixWorld,a.getInverse(b.projectionMatrix));return this.applyProjection(a)}}(),transformDirection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d;this.y=a[1]*b+a[5]*c+a[9]*d;this.z=a[2]*b+a[6]*c+a[10]*d;this.normalize();return this},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){0!==a?(a=1/a,this.x*=a,this.y*=a,this.z*=
a):this.z=this.y=this.x=0;return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);this.z>a.z&&(this.z=a.z);return this},max:function(a){this.x<a.x&&(this.x=a.x);this.y<a.y&&(this.y=a.y);this.z<a.z&&(this.z=a.z);return this},clamp:function(a,b){this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x);this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y);this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z);return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector3,
b=new THREE.Vector3);a.set(c,c,c);b.set(d,d,d);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):
Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},
setLength:function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},cross:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);b=this.x;var c=this.y,d=this.z;this.x=c*a.z-d*a.y;this.y=
d*a.x-b*a.z;this.z=b*a.y-c*a.x;return this},crossVectors:function(a,b){var c=a.x,d=a.y;a=a.z;var e=b.x,g=b.y;b=b.z;this.x=d*b-a*g;this.y=a*e-c*b;this.z=c*g-d*e;return this},projectOnVector:function(){var a,b;return function(c){void 0===a&&(a=new THREE.Vector3);a.copy(c).normalize();b=this.dot(a);return this.copy(a).multiplyScalar(b)}}(),projectOnPlane:function(){var a;return function(b){void 0===a&&(a=new THREE.Vector3);a.copy(this).projectOnVector(b);return this.sub(a)}}(),reflect:function(){var a;
return function(b){void 0===a&&(a=new THREE.Vector3);return this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){a=this.dot(a)/(this.length()*a.length());return Math.acos(THREE.Math.clamp(a,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a},setEulerFromRotationMatrix:function(a,b){THREE.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},
setEulerFromQuaternion:function(a,b){THREE.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(a){THREE.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){THREE.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,
b){THREE.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(a,b)},setFromMatrixPosition:function(a){this.x=a.elements[12];this.y=a.elements[13];this.z=a.elements[14];return this},setFromMatrixScale:function(a){var b=this.set(a.elements[0],a.elements[1],a.elements[2]).length(),c=this.set(a.elements[4],a.elements[5],a.elements[6]).length();a=this.set(a.elements[8],a.elements[9],a.elements[10]).length();this.x=b;this.y=c;this.z=a;
return this},setFromMatrixColumn:function(a,b){a*=4;b=b.elements;this.x=b[a];this.y=b[a+1];this.z=b[a+2];return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+
2];return this},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.Vector4=function(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=void 0!==d?d:1};
THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setW:function(a){this.w=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;
case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+a);}},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=void 0!==a.w?a.w:1;return this},add:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},addVectors:function(a,
b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},sub:function(a,b){if(void 0!==b)return THREE.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;this.w-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(a){this.x*=
a;this.y*=a;this.z*=a;this.w*=a;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=this.w;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12]*e;this.y=a[1]*b+a[5]*c+a[9]*d+a[13]*e;this.z=a[2]*b+a[6]*c+a[10]*d+a[14]*e;this.w=a[3]*b+a[7]*c+a[11]*d+a[15]*e;return this},divideScalar:function(a){0!==a?(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a):(this.z=this.y=this.x=0,this.w=1);return this},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);1E-4>
b?(this.x=1,this.z=this.y=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b);return this},setAxisAngleFromRotationMatrix:function(a){a=a.elements;var b=a[0];var c=a[4];var d=a[8],e=a[1],g=a[5],f=a[9];var h=a[2];var k=a[6];var n=a[10];if(.01>Math.abs(c-e)&&.01>Math.abs(d-h)&&.01>Math.abs(f-k)){if(.1>Math.abs(c+e)&&.1>Math.abs(d+h)&&.1>Math.abs(f+k)&&.1>Math.abs(b+g+n-3))return this.set(1,0,0,0),this;a=Math.PI;b=(b+1)/2;g=(g+1)/2;n=(n+1)/2;c=(c+e)/4;d=(d+h)/4;f=(f+k)/4;b>g&&b>n?.01>b?(k=0,c=h=.707106781):
(k=Math.sqrt(b),h=c/k,c=d/k):g>n?.01>g?(k=.707106781,h=0,c=.707106781):(h=Math.sqrt(g),k=c/h,c=f/h):.01>n?(h=k=.707106781,c=0):(c=Math.sqrt(n),k=d/c,h=f/c);this.set(k,h,c,a);return this}a=Math.sqrt((k-f)*(k-f)+(d-h)*(d-h)+(e-c)*(e-c));.001>Math.abs(a)&&(a=1);this.x=(k-f)/a;this.y=(d-h)/a;this.z=(e-c)/a;this.w=Math.acos((b+g+n-1)/2);return this},min:function(a){this.x>a.x&&(this.x=a.x);this.y>a.y&&(this.y=a.y);this.z>a.z&&(this.z=a.z);this.w>a.w&&(this.w=a.w);return this},max:function(a){this.x<a.x&&
(this.x=a.x);this.y<a.y&&(this.y=a.y);this.z<a.z&&(this.z=a.z);this.w<a.w&&(this.w=a.w);return this},clamp:function(a,b){this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x);this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y);this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z);this.w<a.w?this.w=a.w:this.w>b.w&&(this.w=b.w);return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new THREE.Vector4,b=new THREE.Vector4);a.set(c,c,c,c);b.set(d,d,d,d);return this.clamp(a,b)}}(),floor:function(){this.x=
Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);
this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+
Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();0!==b&&a!==b&&this.multiplyScalar(a/b);return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b;return this},lerpVectors:function(a,b,c){this.subVectors(b,a).multiplyScalar(c).add(a);return this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},
fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];this.w=a.array[b+3];return this},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};
THREE.Euler=function(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._order=d||THREE.Euler.DefaultOrder};THREE.Euler.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" ");THREE.Euler.DefaultOrder="XYZ";
THREE.Euler.prototype={constructor:THREE.Euler,_x:0,_y:0,_z:0,_order:THREE.Euler.DefaultOrder,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get order(){return this._order},set order(a){this._order=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._order=d||this._order;this.onChangeCallback();return this},copy:function(a){this._x=
a._x;this._y=a._y;this._z=a._z;this._order=a._order;this.onChangeCallback();return this},setFromRotationMatrix:function(a,b,c){var d=THREE.Math.clamp,e=a.elements;a=e[0];var g=e[4],f=e[8],h=e[1],k=e[5],n=e[9],p=e[2],l=e[6];e=e[10];b=b||this._order;"XYZ"===b?(this._y=Math.asin(d(f,-1,1)),.99999>Math.abs(f)?(this._x=Math.atan2(-n,e),this._z=Math.atan2(-g,a)):(this._x=Math.atan2(l,k),this._z=0)):"YXZ"===b?(this._x=Math.asin(-d(n,-1,1)),.99999>Math.abs(n)?(this._y=Math.atan2(f,e),this._z=Math.atan2(h,
k)):(this._y=Math.atan2(-p,a),this._z=0)):"ZXY"===b?(this._x=Math.asin(d(l,-1,1)),.99999>Math.abs(l)?(this._y=Math.atan2(-p,e),this._z=Math.atan2(-g,k)):(this._y=0,this._z=Math.atan2(h,a))):"ZYX"===b?(this._y=Math.asin(-d(p,-1,1)),.99999>Math.abs(p)?(this._x=Math.atan2(l,e),this._z=Math.atan2(h,a)):(this._x=0,this._z=Math.atan2(-g,k))):"YZX"===b?(this._z=Math.asin(d(h,-1,1)),.99999>Math.abs(h)?(this._x=Math.atan2(-n,k),this._y=Math.atan2(-p,a)):(this._x=0,this._y=Math.atan2(f,e))):"XZY"===b?(this._z=
Math.asin(-d(g,-1,1)),.99999>Math.abs(g)?(this._x=Math.atan2(l,k),this._y=Math.atan2(f,a)):(this._x=Math.atan2(-n,e),this._y=0)):THREE.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+b);this._order=b;if(!1!==c)this.onChangeCallback();return this},setFromQuaternion:function(){var a;return function(b,c,d){void 0===a&&(a=new THREE.Matrix4);a.makeRotationFromQuaternion(b);this.setFromRotationMatrix(a,c,d);return this}}(),setFromVector3:function(a,b){return this.set(a.x,a.y,a.z,
b||this._order)},reorder:function(){var a=new THREE.Quaternion;return function(b){a.setFromEuler(this);this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];void 0!==a[3]&&(this._order=a[3]);this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._order;return a},toVector3:function(a){return a?
a.set(this._x,this._y,this._z):new THREE.Vector3(this._x,this._y,this._z)},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){},clone:function(){return new THREE.Euler(this._x,this._y,this._z,this._order)}};THREE.Line3=function(a,b){this.start=void 0!==a?a:new THREE.Vector3;this.end=void 0!==b?b:new THREE.Vector3};
THREE.Line3.prototype={constructor:THREE.Line3,set:function(a,b){this.start.copy(a);this.end.copy(b);return this},copy:function(a){this.start.copy(a.start);this.end.copy(a.end);return this},center:function(a){return(a||new THREE.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){return(a||new THREE.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(a,
b){b=b||new THREE.Vector3;return this.delta(b).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d){a.subVectors(c,this.start);b.subVectors(this.end,this.start);c=b.dot(b);c=b.dot(a)/c;d&&(c=THREE.Math.clamp(c,0,1));return c}}(),closestPointToPoint:function(a,b,c){a=this.closestPointToPointParameter(a,b);c=c||new THREE.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},applyMatrix4:function(a){this.start.applyMatrix4(a);
this.end.applyMatrix4(a);return this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}};THREE.Box2=function(a,b){this.min=void 0!==a?a:new THREE.Vector2(Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector2(-Infinity,-Infinity)};
THREE.Box2.prototype={constructor:THREE.Box2,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(a){return(a||new THREE.Vector2).addVectors(this.min,
this.max).multiplyScalar(.5)},size:function(a){return(a||new THREE.Vector2).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&
this.min.y<=a.min.y&&a.max.y<=this.max.y?!0:!1},getParameter:function(a,b){return(b||new THREE.Vector2).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y?!1:!0},clampPoint:function(a,b){return(b||new THREE.Vector2).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector2;return function(b){return a.copy(b).clamp(this.min,
this.max).sub(b).length()}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}};
THREE.Box3=function(a,b){this.min=void 0!==a?a:new THREE.Vector3(Infinity,Infinity,Infinity);this.max=void 0!==b?b:new THREE.Vector3(-Infinity,-Infinity,-Infinity)};
THREE.Box3.prototype={constructor:THREE.Box3,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},
center:function(a){return(a||new THREE.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new THREE.Vector3).subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<
this.min.z||a.z>this.max.z?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z?!0:!1},getParameter:function(a,b){return(b||new THREE.Vector3).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<
this.min.z||a.min.z>this.max.z?!1:!0},clampPoint:function(a,b){return(b||new THREE.Vector3).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector3;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),getBoundingSphere:function(){var a=new THREE.Vector3;return function(b){b=b||new THREE.Sphere;b.center=this.center();b.radius=.5*this.size(a).length();return b}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);
this.max.max(a.max);return this},applyMatrix4:function(){var a=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(b){a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b);a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b);a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b);
a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b);a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b);this.makeEmpty();this.setFromPoints(a);return this}}(),translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}};
THREE.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&THREE.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")};
THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(a,b,c,d,e,g,f,h,k){var n=this.elements;n[0]=a;n[3]=b;n[6]=c;n[1]=d;n[4]=e;n[7]=g;n[2]=f;n[5]=h;n[8]=k;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},copy:function(a){a=a.elements;this.set(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]);return this},multiplyVector3:function(a){THREE.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return a.applyMatrix3(this)},
multiplyVector3Array:function(a){THREE.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)},applyToVector3Array:function(){var a=new THREE.Vector3;return function(b,c,d){void 0===c&&(c=0);void 0===d&&(d=b.length);for(var e=0;e<d;e+=3,c+=3)a.x=b[c],a.y=b[c+1],a.z=b[c+2],a.applyMatrix3(this),b[c]=a.x,b[c+1]=a.y,b[c+2]=a.z;return b}}(),multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[3]*=a;b[6]*=
a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this},determinant:function(){var a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],g=a[4],f=a[5],h=a[6],k=a[7];a=a[8];return b*g*a-b*f*k-c*e*a+c*f*h+d*e*k-d*g*h},getInverse:function(a,b){a=a.elements;var c=this.elements;c[0]=a[10]*a[5]-a[6]*a[9];c[1]=-a[10]*a[1]+a[2]*a[9];c[2]=a[6]*a[1]-a[2]*a[5];c[3]=-a[10]*a[4]+a[6]*a[8];c[4]=a[10]*a[0]-a[2]*a[8];c[5]=-a[6]*a[0]+a[2]*a[4];c[6]=a[9]*a[4]-a[5]*a[8];c[7]=-a[9]*a[0]+a[1]*a[8];c[8]=a[5]*a[0]-a[1]*a[4];
a=a[0]*c[0]+a[1]*c[3]+a[2]*c[6];if(0===a){if(b)throw Error("Matrix3.getInverse(): can't invert matrix, determinant is 0");THREE.warn("Matrix3.getInverse(): can't invert matrix, determinant is 0");this.identity();return this}this.multiplyScalar(1/a);return this},transpose:function(){var a=this.elements;var b=a[1];a[1]=a[3];a[3]=b;b=a[2];a[2]=a[6];a[6]=b;b=a[5];a[5]=a[7];a[7]=b;return this},flattenToArrayOffset:function(a,b){var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];
a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];return a},getNormalMatrix:function(a){this.getInverse(a).transpose();return this},transposeIntoArray:function(a){var b=this.elements;a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8];return this},fromArray:function(a){this.elements.set(a);return this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8]]},clone:function(){return(new THREE.Matrix3).fromArray(this.elements)}};
THREE.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&THREE.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")};
THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(a,b,c,d,e,g,f,h,k,n,p,l,q,r,m,u){var x=this.elements;x[0]=a;x[4]=b;x[8]=c;x[12]=d;x[1]=e;x[5]=g;x[9]=f;x[13]=h;x[2]=k;x[6]=n;x[10]=p;x[14]=l;x[3]=q;x[7]=r;x[11]=m;x[15]=u;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(a){this.elements.set(a.elements);return this},extractPosition:function(a){THREE.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(a)},
copyPosition:function(a){var b=this.elements;a=a.elements;b[12]=a[12];b[13]=a[13];b[14]=a[14];return this},extractBasis:function(a,b,c){var d=this.elements;a.set(d[0],d[1],d[2]);b.set(d[4],d[5],d[6]);c.set(d[8],d[9],d[10]);return this},makeBasis:function(a,b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return this},extractRotation:function(){var a=new THREE.Vector3;return function(b){var c=this.elements;b=b.elements;var d=1/a.set(b[0],b[1],b[2]).length(),e=1/a.set(b[4],b[5],b[6]).length(),
g=1/a.set(b[8],b[9],b[10]).length();c[0]=b[0]*d;c[1]=b[1]*d;c[2]=b[2]*d;c[4]=b[4]*e;c[5]=b[5]*e;c[6]=b[6]*e;c[8]=b[8]*g;c[9]=b[9]*g;c[10]=b[10]*g;return this}}(),makeRotationFromEuler:function(a){!1===a instanceof THREE.Euler&&THREE.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var b=this.elements,c=a.x,d=a.y,e=a.z,g=Math.cos(c);c=Math.sin(c);var f=Math.cos(d);d=Math.sin(d);var h=Math.cos(e);e=Math.sin(e);if("XYZ"===a.order){a=g*h;var k=
g*e,n=c*h,p=c*e;b[0]=f*h;b[4]=-f*e;b[8]=d;b[1]=k+n*d;b[5]=a-p*d;b[9]=-c*f;b[2]=p-a*d;b[6]=n+k*d;b[10]=g*f}else"YXZ"===a.order?(a=f*h,k=f*e,n=d*h,p=d*e,b[0]=a+p*c,b[4]=n*c-k,b[8]=g*d,b[1]=g*e,b[5]=g*h,b[9]=-c,b[2]=k*c-n,b[6]=p+a*c,b[10]=g*f):"ZXY"===a.order?(a=f*h,k=f*e,n=d*h,p=d*e,b[0]=a-p*c,b[4]=-g*e,b[8]=n+k*c,b[1]=k+n*c,b[5]=g*h,b[9]=p-a*c,b[2]=-g*d,b[6]=c,b[10]=g*f):"ZYX"===a.order?(a=g*h,k=g*e,n=c*h,p=c*e,b[0]=f*h,b[4]=n*d-k,b[8]=a*d+p,b[1]=f*e,b[5]=p*d+a,b[9]=k*d-n,b[2]=-d,b[6]=c*f,b[10]=g*
f):"YZX"===a.order?(a=g*f,k=g*d,n=c*f,p=c*d,b[0]=f*h,b[4]=p-a*e,b[8]=n*e+k,b[1]=e,b[5]=g*h,b[9]=-c*h,b[2]=-d*h,b[6]=k*e+n,b[10]=a-p*e):"XZY"===a.order&&(a=g*f,k=g*d,n=c*f,p=c*d,b[0]=f*h,b[4]=-e,b[8]=d*h,b[1]=a*e+p,b[5]=g*h,b[9]=k*e-n,b[2]=n*e-k,b[6]=c*h,b[10]=p*e+a);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},setRotationFromQuaternion:function(a){THREE.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(a)},
makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,g=a.w,f=c+c,h=d+d,k=e+e;a=c*f;var n=c*h;c*=k;var p=d*h;d*=k;e*=k;f*=g;h*=g;g*=k;b[0]=1-(p+e);b[4]=n-g;b[8]=c+h;b[1]=n+g;b[5]=1-(a+e);b[9]=d-f;b[2]=c-h;b[6]=d+f;b[10]=1-(a+p);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},lookAt:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,g){var f=this.elements;c.subVectors(d,e).normalize();0===c.length()&&(c.z=1);a.crossVectors(g,
c).normalize();0===a.length()&&(c.x+=1E-4,a.crossVectors(g,c).normalize());b.crossVectors(c,a);f[0]=a.x;f[4]=b.x;f[8]=c.x;f[1]=a.y;f[5]=b.y;f[9]=c.y;f[2]=a.z;f[6]=b.z;f[10]=c.z;return this}}(),multiply:function(a,b){return void 0!==b?(THREE.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements;b=this.elements;a=c[0];var e=c[4],g=
c[8],f=c[12],h=c[1],k=c[5],n=c[9],p=c[13],l=c[2],q=c[6],r=c[10],m=c[14],u=c[3],x=c[7],t=c[11];c=c[15];var v=d[0],w=d[4],z=d[8],A=d[12],y=d[1],E=d[5],I=d[9],O=d[13],K=d[2],T=d[6],Y=d[10],Q=d[14],C=d[3],B=d[7],H=d[11];d=d[15];b[0]=a*v+e*y+g*K+f*C;b[4]=a*w+e*E+g*T+f*B;b[8]=a*z+e*I+g*Y+f*H;b[12]=a*A+e*O+g*Q+f*d;b[1]=h*v+k*y+n*K+p*C;b[5]=h*w+k*E+n*T+p*B;b[9]=h*z+k*I+n*Y+p*H;b[13]=h*A+k*O+n*Q+p*d;b[2]=l*v+q*y+r*K+m*C;b[6]=l*w+q*E+r*T+m*B;b[10]=l*z+q*I+r*Y+m*H;b[14]=l*A+q*O+r*Q+m*d;b[3]=u*v+x*y+t*K+c*C;
b[7]=u*w+x*E+t*T+c*B;b[11]=u*z+x*I+t*Y+c*H;b[15]=u*A+x*O+t*Q+c*d;return this},multiplyToArray:function(a,b,c){var d=this.elements;this.multiplyMatrices(a,b);c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];c[4]=d[4];c[5]=d[5];c[6]=d[6];c[7]=d[7];c[8]=d[8];c[9]=d[9];c[10]=d[10];c[11]=d[11];c[12]=d[12];c[13]=d[13];c[14]=d[14];c[15]=d[15];return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=
a;b[11]*=a;b[15]*=a;return this},multiplyVector3:function(a){THREE.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return a.applyProjection(this)},multiplyVector4:function(a){THREE.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},multiplyVector3Array:function(a){THREE.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");
return this.applyToVector3Array(a)},applyToVector3Array:function(){var a=new THREE.Vector3;return function(b,c,d){void 0===c&&(c=0);void 0===d&&(d=b.length);for(var e=0;e<d;e+=3,c+=3)a.x=b[c],a.y=b[c+1],a.z=b[c+2],a.applyMatrix4(this),b[c]=a.x,b[c+1]=a.y,b[c+2]=a.z;return b}}(),rotateAxis:function(a){THREE.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");a.transformDirection(this)},crossVector:function(a){THREE.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");
return a.applyMatrix4(this)},determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],g=a[1],f=a[5],h=a[9],k=a[13],n=a[2],p=a[6],l=a[10],q=a[14];return a[3]*(+e*h*p-d*k*p-e*f*l+c*k*l+d*f*q-c*h*q)+a[7]*(+b*h*q-b*k*l+e*g*l-d*g*q+d*k*n-e*h*n)+a[11]*(+b*k*p-b*f*q-e*g*p+c*g*q+e*f*n-c*k*n)+a[15]*(-d*f*n-b*h*p+b*f*l+d*g*p-c*g*l+c*h*n)},transpose:function(){var a=this.elements;var b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=
a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this},flattenToArrayOffset:function(a,b){var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a},getPosition:function(){var a=new THREE.Vector3;return function(){THREE.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");
var b=this.elements;return a.set(b[12],b[13],b[14])}}(),setPosition:function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this},getInverse:function(a,b){var c=this.elements,d=a.elements;a=d[0];var e=d[4],g=d[8],f=d[12],h=d[1],k=d[5],n=d[9],p=d[13],l=d[2],q=d[6],r=d[10],m=d[14],u=d[3],x=d[7],t=d[11];d=d[15];c[0]=n*m*x-p*r*x+p*q*t-k*m*t-n*q*d+k*r*d;c[4]=f*r*x-g*m*x-f*q*t+e*m*t+g*q*d-e*r*d;c[8]=g*p*x-f*n*x+f*k*t-e*p*t-g*k*d+e*n*d;c[12]=f*n*q-g*p*q-f*k*r+e*p*r+g*k*m-e*n*m;c[1]=p*r*u-n*
m*u-p*l*t+h*m*t+n*l*d-h*r*d;c[5]=g*m*u-f*r*u+f*l*t-a*m*t-g*l*d+a*r*d;c[9]=f*n*u-g*p*u-f*h*t+a*p*t+g*h*d-a*n*d;c[13]=g*p*l-f*n*l+f*h*r-a*p*r-g*h*m+a*n*m;c[2]=k*m*u-p*q*u+p*l*x-h*m*x-k*l*d+h*q*d;c[6]=f*q*u-e*m*u-f*l*x+a*m*x+e*l*d-a*q*d;c[10]=e*p*u-f*k*u+f*h*x-a*p*x-e*h*d+a*k*d;c[14]=f*k*l-e*p*l-f*h*q+a*p*q+e*h*m-a*k*m;c[3]=n*q*u-k*r*u-n*l*x+h*r*x+k*l*t-h*q*t;c[7]=e*r*u-g*q*u+g*l*x-a*r*x-e*l*t+a*q*t;c[11]=g*k*u-e*n*u-g*h*x+a*n*x+e*h*t-a*k*t;c[15]=e*n*l-g*k*l+g*h*q-a*n*q-e*h*r+a*k*r;c=a*c[0]+h*c[4]+l*
c[8]+u*c[12];if(0==c){if(b)throw Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");THREE.warn("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");this.identity();return this}this.multiplyScalar(1/c);return this},translate:function(a){THREE.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(a){THREE.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(a){THREE.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(a){THREE.error("THREE.Matrix4: .rotateZ() has been removed.")},
rotateByAxis:function(a,b){THREE.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(a){var b=this.elements,c=a.x,d=a.y;a=a.z;b[0]*=c;b[4]*=d;b[8]*=a;b[1]*=c;b[5]*=d;b[9]*=a;b[2]*=c;b[6]*=d;b[10]*=a;b[3]*=c;b[7]*=d;b[11]*=a;return this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],Math.max(a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10])))},makeTranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,
c,0,0,0,1);return this},makeRotationX:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);return this},makeRotationY:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this},makeRotationZ:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var c=Math.cos(b);b=Math.sin(b);var d=1-c,e=a.x,g=a.y;a=a.z;var f=d*e,h=d*g;this.set(f*e+c,f*g-b*a,f*a+b*
g,0,f*g+b*a,h*g+c,h*a-b*e,0,f*a-b*g,h*a+b*e,d*a*a+c,0,0,0,0,1);return this},makeScale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1);return this},compose:function(a,b,c){this.makeRotationFromQuaternion(b);this.scale(c);this.setPosition(a);return this},decompose:function(){var a=new THREE.Vector3,b=new THREE.Matrix4;return function(c,d,e){var g=this.elements,f=a.set(g[0],g[1],g[2]).length(),h=a.set(g[4],g[5],g[6]).length(),k=a.set(g[8],g[9],g[10]).length();0>this.determinant()&&(f=-f);c.x=
g[12];c.y=g[13];c.z=g[14];b.elements.set(this.elements);c=1/f;g=1/h;var n=1/k;b.elements[0]*=c;b.elements[1]*=c;b.elements[2]*=c;b.elements[4]*=g;b.elements[5]*=g;b.elements[6]*=g;b.elements[8]*=n;b.elements[9]*=n;b.elements[10]*=n;d.setFromRotationMatrix(b);e.x=f;e.y=h;e.z=k;return this}}(),makeFrustum:function(a,b,c,d,e,g){var f=this.elements;f[0]=2*e/(b-a);f[4]=0;f[8]=(b+a)/(b-a);f[12]=0;f[1]=0;f[5]=2*e/(d-c);f[9]=(d+c)/(d-c);f[13]=0;f[2]=0;f[6]=0;f[10]=-(g+e)/(g-e);f[14]=-2*g*e/(g-e);f[3]=0;f[7]=
0;f[11]=-1;f[15]=0;return this},makePerspective:function(a,b,c,d){a=c*Math.tan(THREE.Math.degToRad(.5*a));var e=-a;return this.makeFrustum(e*b,a*b,e,a,c,d)},makeOrthographic:function(a,b,c,d,e,g){var f=this.elements,h=b-a,k=c-d,n=g-e;f[0]=2/h;f[4]=0;f[8]=0;f[12]=-((b+a)/h);f[1]=0;f[5]=2/k;f[9]=0;f[13]=-((c+d)/k);f[2]=0;f[6]=0;f[10]=-2/n;f[14]=-((g+e)/n);f[3]=0;f[7]=0;f[11]=0;f[15]=1;return this},fromArray:function(a){this.elements.set(a);return this},toArray:function(){var a=this.elements;return[a[0],
a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)}};THREE.Triangle=function(a,b,c){this.a=void 0!==a?a:new THREE.Vector3;this.b=void 0!==b?b:new THREE.Vector3;this.c=void 0!==c?c:new THREE.Vector3};
THREE.Triangle.normal=function(){var a=new THREE.Vector3;return function(b,c,d,e){e=e||new THREE.Vector3;e.subVectors(d,c);a.subVectors(b,c);e.cross(a);b=e.lengthSq();return 0<b?e.multiplyScalar(1/Math.sqrt(b)):e.set(0,0,0)}}();
THREE.Triangle.barycoordFromPoint=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,g,f,h){a.subVectors(f,e);b.subVectors(g,e);c.subVectors(d,e);d=a.dot(a);e=a.dot(b);g=a.dot(c);var k=b.dot(b);f=b.dot(c);var n=d*k-e*e;h=h||new THREE.Vector3;if(0==n)return h.set(-2,-1,-1);n=1/n;k=(k*g-e*f)*n;d=(d*f-e*g)*n;return h.set(1-k-d,d,k)}}();
THREE.Triangle.containsPoint=function(){var a=new THREE.Vector3;return function(b,c,d,e){b=THREE.Triangle.barycoordFromPoint(b,c,d,e,a);return 0<=b.x&&0<=b.y&&1>=b.x+b.y}}();
THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function(a,b,c,d){this.a.copy(a[b]);this.b.copy(a[c]);this.c.copy(a[d]);return this},copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},area:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(){a.subVectors(this.c,this.b);b.subVectors(this.a,this.b);return.5*a.cross(b).length()}}(),midpoint:function(a){return(a||
new THREE.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return THREE.Triangle.normal(this.a,this.b,this.c,a)},plane:function(a){return(a||new THREE.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,b){return THREE.Triangle.barycoordFromPoint(a,this.a,this.b,this.c,b)},containsPoint:function(a){return THREE.Triangle.containsPoint(a,this.a,this.b,this.c)},equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)},
clone:function(){return(new THREE.Triangle).copy(this)}};THREE.Ray=function(a,b){this.origin=void 0!==a?a:new THREE.Vector3;this.direction=void 0!==b?b:new THREE.Vector3};
THREE.Ray.prototype={constructor:THREE.Ray,set:function(a,b){this.origin.copy(a);this.direction.copy(b);return this},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this},at:function(a,b){return(b||new THREE.Vector3).copy(this.direction).multiplyScalar(a).add(this.origin)},recast:function(){var a=new THREE.Vector3;return function(b){this.origin.copy(this.at(b,a));return this}}(),closestPointToPoint:function(a,b){b=b||new THREE.Vector3;b.subVectors(a,this.origin);
a=b.dot(this.direction);return 0>a?b.copy(this.origin):b.copy(this.direction).multiplyScalar(a).add(this.origin)},distanceToPoint:function(){var a=new THREE.Vector3;return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);if(0>c)return this.origin.distanceTo(b);a.copy(this.direction).multiplyScalar(c).add(this.origin);return a.distanceTo(b)}}(),distanceSqToSegment:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,g,f){a.copy(d).add(e).multiplyScalar(.5);
b.copy(e).sub(d).normalize();c.copy(this.origin).sub(a);var h=.5*d.distanceTo(e),k=-this.direction.dot(b),n=c.dot(this.direction),p=-c.dot(b),l=c.lengthSq(),q=Math.abs(1-k*k);if(0<q){d=k*p-n;e=k*n-p;var r=h*q;0<=d?e>=-r?e<=r?(h=1/q,d*=h,e*=h,k=d*(d+k*e+2*n)+e*(k*d+e+2*p)+l):(e=h,d=Math.max(0,-(k*e+n)),k=-d*d+e*(e+2*p)+l):(e=-h,d=Math.max(0,-(k*e+n)),k=-d*d+e*(e+2*p)+l):e<=-r?(d=Math.max(0,-(-k*h+n)),e=0<d?-h:Math.min(Math.max(-h,-p),h),k=-d*d+e*(e+2*p)+l):e<=r?(d=0,e=Math.min(Math.max(-h,-p),h),k=
e*(e+2*p)+l):(d=Math.max(0,-(k*h+n)),e=0<d?h:Math.min(Math.max(-h,-p),h),k=-d*d+e*(e+2*p)+l)}else e=0<k?-h:h,d=Math.max(0,-(k*e+n)),k=-d*d+e*(e+2*p)+l;g&&g.copy(this.direction).multiplyScalar(d).add(this.origin);f&&f.copy(b).multiplyScalar(e).add(a);return k}}(),isIntersectionSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},intersectSphere:function(){var a=new THREE.Vector3;return function(b,c){a.subVectors(b.center,this.origin);var d=a.dot(this.direction),e=a.dot(a)-d*d;b=b.radius*
b.radius;if(e>b)return null;b=Math.sqrt(b-e);e=d-b;d+=b;return 0>e&&0>d?null:0>e?this.at(d,c):this.at(e,c)}}(),isIntersectionPlane:function(a){var b=a.distanceToPoint(this.origin);return 0===b||0>a.normal.dot(this.direction)*b?!0:!1},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(0==b)return 0==a.distanceToPoint(this.origin)?0:null;a=-(this.origin.dot(a.normal)+a.constant)/b;return 0<=a?a:null},intersectPlane:function(a,b){a=this.distanceToPlane(a);return null===a?null:this.at(a,
b)},isIntersectionBox:function(){var a=new THREE.Vector3;return function(b){return null!==this.intersectBox(b,a)}}(),intersectBox:function(a,b){var c=1/this.direction.x;var d=1/this.direction.y;var e=1/this.direction.z,g=this.origin;if(0<=c){var f=(a.min.x-g.x)*c;c*=a.max.x-g.x}else f=(a.max.x-g.x)*c,c*=a.min.x-g.x;if(0<=d){var h=(a.min.y-g.y)*d;d*=a.max.y-g.y}else h=(a.max.y-g.y)*d,d*=a.min.y-g.y;if(f>d||h>c)return null;if(h>f||f!==f)f=h;if(d<c||c!==c)c=d;0<=e?(h=(a.min.z-g.z)*e,a=(a.max.z-g.z)*
e):(h=(a.max.z-g.z)*e,a=(a.min.z-g.z)*e);if(f>a||h>c)return null;if(h>f||f!==f)f=h;if(a<c||c!==c)c=a;return 0>c?null:this.at(0<=f?f:c,b)},intersectTriangle:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector3;return function(e,g,f,h,k){b.subVectors(g,e);c.subVectors(f,e);d.crossVectors(b,c);g=this.direction.dot(d);if(0<g){if(h)return null;h=1}else if(0>g)h=-1,g=-g;else return null;a.subVectors(this.origin,e);e=h*this.direction.dot(c.crossVectors(a,c));if(0>
e)return null;f=h*this.direction.dot(b.cross(a));if(0>f||e+f>g)return null;e=-h*a.dot(d);return 0>e?null:this.at(e/g,k)}}(),applyMatrix4:function(a){this.direction.add(this.origin).applyMatrix4(a);this.origin.applyMatrix4(a);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)},clone:function(){return(new THREE.Ray).copy(this)}};
THREE.Sphere=function(a,b){this.center=void 0!==a?a:new THREE.Vector3;this.radius=void 0!==b?b:0};
THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(a,b){this.center.copy(a);this.radius=b;return this},setFromPoints:function(){var a=new THREE.Box3;return function(b,c){var d=this.center;void 0!==c?d.copy(c):a.setFromPoints(b).center(d);for(var e=c=0,g=b.length;e<g;e++)c=Math.max(c,d.distanceToSquared(b[e]));this.radius=Math.sqrt(c);return this}}(),copy:function(a){this.center.copy(a.center);this.radius=a.radius;return this},empty:function(){return 0>=this.radius},containsPoint:function(a){return a.distanceToSquared(this.center)<=
this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},clampPoint:function(a,b){var c=this.center.distanceToSquared(a);b=b||new THREE.Vector3;b.copy(a);c>this.radius*this.radius&&(b.sub(this.center).normalize(),b.multiplyScalar(this.radius).add(this.center));return b},getBoundingBox:function(a){a=a||new THREE.Box3;a.set(this.center,this.center);a.expandByScalar(this.radius);
return a},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScaleOnAxis();return this},translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&a.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}};THREE.Plane=function(a,b){this.normal=void 0!==a?a:new THREE.Vector3(1,0,0);this.constant=void 0!==b?b:0};
THREE.Plane.prototype={constructor:THREE.Plane,set:function(a,b){this.normal.copy(a);this.constant=b;return this},setComponents:function(a,b,c,d){this.normal.set(a,b,c);this.constant=d;return this},setFromNormalAndCoplanarPoint:function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this},setFromCoplanarPoints:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c,d,e){d=a.subVectors(e,d).cross(b.subVectors(c,d)).normalize();this.setFromNormalAndCoplanarPoint(d,
c);return this}}(),copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,b){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(a,
b){a=this.distanceToPoint(a);return(b||new THREE.Vector3).copy(this.normal).multiplyScalar(a)},isIntersectionLine:function(a){var b=this.distanceToPoint(a.start);a=this.distanceToPoint(a.end);return 0>b&&0<a||0>a&&0<b},intersectLine:function(){var a=new THREE.Vector3;return function(b,c){c=c||new THREE.Vector3;var d=b.delta(a),e=this.normal.dot(d);if(0==e){if(0==this.distanceToPoint(b.start))return c.copy(b.start)}else if(e=-(b.start.dot(this.normal)+this.constant)/e,!(0>e||1<e))return c.copy(d).multiplyScalar(e).add(b.start)}}(),
coplanarPoint:function(a){return(a||new THREE.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Matrix3;return function(d,e){e=e||c.getNormalMatrix(d);e=a.copy(this.normal).applyMatrix3(e);var g=this.coplanarPoint(b);g.applyMatrix4(d);this.setFromNormalAndCoplanarPoint(e,g);return this}}(),translate:function(a){this.constant-=a.dot(this.normal);return this},equals:function(a){return a.normal.equals(this.normal)&&
a.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}};
THREE.Math={generateUUID:function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),b=Array(36),c=0,d;return function(){for(var e=0;36>e;e++)8==e||13==e||18==e||23==e?b[e]="-":14==e?b[e]="4":(2>=c&&(c=33554432+16777216*Math.random()|0),d=c&15,c>>=4,b[e]=a[19==e?d&3|8:d]);return b.join("")}}(),clamp:function(a,b,c){return a<b?b:a>c?c:a},clampBottom:function(a,b){return a<b?b:a},mapLinear:function(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b)},smoothstep:function(a,b,c){if(a<=
b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*(3-2*a)},smootherstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*a*(a*(6*a-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(a,b){return Math.floor(this.randFloat(a,b))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},degToRad:function(){var a=Math.PI/180;return function(b){return b*a}}(),radToDeg:function(){var a=
180/Math.PI;return function(b){return b*a}}(),isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a},nextPowerOfTwo:function(a){a--;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;a++;return a}};THREE.Clock=function(a){this.autoStart=void 0!==a?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1};
THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.oldTime=this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var a=0;this.autoStart&&!this.running&&this.start();if(this.running){var b=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();
a=.001*(b-this.oldTime);this.oldTime=b;this.elapsedTime+=a}return a}};THREE.EventDispatcher=function(){};
THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(a){a.addEventListener=THREE.EventDispatcher.prototype.addEventListener;a.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener;a.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener;a.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]);-1===c[a].indexOf(b)&&
c[a].push(b)},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)?!0:!1},removeEventListener:function(a,b){void 0!==this._listeners&&(a=this._listeners[a],void 0!==a&&(b=a.indexOf(b),-1!==b&&a.splice(b,1)))},dispatchEvent:function(a){if(void 0!==this._listeners){var b=this._listeners[a.type];if(void 0!==b){a.target=this;for(var c=[],d=b.length,e=0;e<d;e++)c[e]=b[e];for(e=0;e<d;e++)c[e].call(this,a)}}}};
THREE.Object3D=function(){Object.defineProperty(this,"id",{value:THREE.Object3DIdCount++});this.name="";this.parent=void 0;this.children=[];this.up=THREE.Object3D.DefaultUp.clone();var a=new THREE.Vector3,b=new THREE.Euler,c=new THREE.Quaternion,d=new THREE.Vector3(1,1,1);b.onChange(function(){c.setFromEuler(b,!1)});c.onChange(function(){b.setFromQuaternion(c,void 0,!1)});Object.defineProperties(this,{position:{enumerable:!0,value:a},rotation:{enumerable:!0,value:b},quaternion:{enumerable:!0,value:c},
scale:{enumerable:!0,value:d}});this.rotationAutoUpdate=!0;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixAutoUpdate=!0;this.matrixWorldNeedsUpdate=!1;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.userData={}};THREE.Object3D.DefaultUp=new THREE.Vector3(0,1,0);
THREE.Object3D.prototype={constructor:THREE.Object3D,applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},setRotationFromQuaternion:function(a){this.quaternion.copy(a)},rotateOnAxis:function(){var a=
new THREE.Quaternion;return function(b,c){a.setFromAxisAngle(b,c);this.quaternion.multiply(a);return this}}(),rotateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.rotateOnAxis(a,b)}}(),translateOnAxis:function(){var a=new THREE.Vector3;return function(b,c){a.copy(b).applyQuaternion(this.quaternion);
this.position.add(a.multiplyScalar(c));return this}}(),translate:function(a,b){THREE.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(b,a)},translateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.translateOnAxis(a,b)}}(),translateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.translateOnAxis(a,b)}}(),translateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.translateOnAxis(a,
b)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var a=new THREE.Matrix4;return function(b){return b.applyMatrix4(a.getInverse(this.matrixWorld))}}(),lookAt:function(){var a=new THREE.Matrix4;return function(b){a.lookAt(b,this.position,this.up);this.quaternion.setFromRotationMatrix(a)}}(),add:function(a){if(1<arguments.length){for(var b=0;b<arguments.length;b++)this.add(arguments[b]);return this}if(a===this)return THREE.error("THREE.Object3D.add: object can't be added as a child of itself.",
a),this;a instanceof THREE.Object3D?(void 0!==a.parent&&a.parent.remove(a),a.parent=this,a.dispatchEvent({type:"added"}),this.children.push(a)):THREE.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",a);return this},remove:function(a){if(1<arguments.length)for(var b=0;b<arguments.length;b++)this.remove(arguments[b]);b=this.children.indexOf(a);-1!==b&&(a.parent=void 0,a.dispatchEvent({type:"removed"}),this.children.splice(b,1))},getChildByName:function(a){THREE.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");
return this.getObjectByName(a)},getObjectById:function(a){return this.getObjectByProperty("id",a)},getObjectByName:function(a){return this.getObjectByProperty("name",a)},getObjectByProperty:function(a,b){if(this[a]===b)return this;for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c].getObjectByProperty(a,b);if(void 0!==e)return e}},getWorldPosition:function(a){a=a||new THREE.Vector3;this.updateMatrixWorld(!0);return a.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var a=
new THREE.Vector3,b=new THREE.Vector3;return function(c){c=c||new THREE.Quaternion;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,c,b);return c}}(),getWorldRotation:function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Euler;this.getWorldQuaternion(a);return b.setFromQuaternion(a,this.rotation.order,!1)}}(),getWorldScale:function(){var a=new THREE.Vector3,b=new THREE.Quaternion;return function(c){c=c||new THREE.Vector3;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,
b,c);return c}}(),getWorldDirection:function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Vector3;this.getWorldQuaternion(a);return b.set(0,0,1).applyQuaternion(a)}}(),raycast:function(){},traverse:function(a){a(this);for(var b=0,c=this.children.length;b<c;b++)this.children[b].traverse(a)},traverseVisible:function(a){if(!1!==this.visible){a(this);for(var b=0,c=this.children.length;b<c;b++)this.children[b].traverseVisible(a)}},traverseAncestors:function(a){this.parent&&(a(this.parent),
this.parent.traverseAncestors(a))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a)},
clone:function(a,b){void 0===a&&(a=new THREE.Object3D);void 0===b&&(b=!0);a.name=this.name;a.up.copy(this.up);a.position.copy(this.position);a.quaternion.copy(this.quaternion);a.scale.copy(this.scale);a.rotationAutoUpdate=this.rotationAutoUpdate;a.matrix.copy(this.matrix);a.matrixWorld.copy(this.matrixWorld);a.matrixAutoUpdate=this.matrixAutoUpdate;a.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate;a.visible=this.visible;a.castShadow=this.castShadow;a.receiveShadow=this.receiveShadow;a.frustumCulled=
this.frustumCulled;a.userData=JSON.parse(JSON.stringify(this.userData));if(!0===b)for(b=0;b<this.children.length;b++)a.add(this.children[b].clone());return a}};THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype);THREE.Object3DIdCount=0;
THREE.Face3=function(a,b,c,d,e,g){this.a=a;this.b=b;this.c=c;this.normal=d instanceof THREE.Vector3?d:new THREE.Vector3;this.vertexNormals=d instanceof Array?d:[];this.color=e instanceof THREE.Color?e:new THREE.Color;this.vertexColors=e instanceof Array?e:[];this.vertexTangents=[];this.materialIndex=void 0!==g?g:0};
THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var a=new THREE.Face3(this.a,this.b,this.c);a.normal.copy(this.normal);a.color.copy(this.color);a.materialIndex=this.materialIndex;for(var b=0,c=this.vertexNormals.length;b<c;b++)a.vertexNormals[b]=this.vertexNormals[b].clone();b=0;for(c=this.vertexColors.length;b<c;b++)a.vertexColors[b]=this.vertexColors[b].clone();b=0;for(c=this.vertexTangents.length;b<c;b++)a.vertexTangents[b]=this.vertexTangents[b].clone();return a}};
THREE.BufferAttribute=function(a,b){this.array=a;this.itemSize=b;this.needsUpdate=!1};
THREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get length(){return this.array.length},copyAt:function(a,b,c){a*=this.itemSize;c*=b.itemSize;for(var d=0,e=this.itemSize;d<e;d++)this.array[a+d]=b.array[c+d];return this},set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},setX:function(a,b){this.array[a*this.itemSize]=b;return this},setY:function(a,b){this.array[a*this.itemSize+1]=b;return this},setZ:function(a,b){this.array[a*this.itemSize+2]=b;return this},setXY:function(a,
b,c){a*=this.itemSize;this.array[a]=b;this.array[a+1]=c;return this},setXYZ:function(a,b,c,d){a*=this.itemSize;this.array[a]=b;this.array[a+1]=c;this.array[a+2]=d;return this},setXYZW:function(a,b,c,d,e){a*=this.itemSize;this.array[a]=b;this.array[a+1]=c;this.array[a+2]=d;this.array[a+3]=e;return this},clone:function(){return new THREE.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}};
THREE.BufferGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.name="";this.attributes={};this.attributesKeys=[];this.offsets=this.drawcalls=[];this.boundingSphere=this.boundingBox=null};
THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addAttribute:function(a,b){this.attributes[a]=b;this.attributesKeys=Object.keys(this.attributes)},getAttribute:function(a){return this.attributes[a]},addDrawCall:function(a,b,c){this.drawcalls.push({start:a,count:b,index:void 0!==c?c:0})},applyMatrix:function(a){var b=this.attributes.position;void 0!==b&&(a.applyToVector3Array(b.array),b.needsUpdate=!0);b=this.attributes.normal;void 0!==b&&((new THREE.Matrix3).getNormalMatrix(a).applyToVector3Array(b.array),
b.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere()},center:function(){this.computeBoundingBox();var a=this.boundingBox.center().negate();this.applyMatrix((new THREE.Matrix4).setPosition(a));return a},computeBoundingBox:function(){var a=new THREE.Vector3;return function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var b=this.attributes.position.array;if(b){var c=this.boundingBox;c.makeEmpty();for(var d=0,e=b.length;d<
e;d+=3)a.set(b[d],b[d+1],b[d+2]),c.expandByPoint(a)}if(void 0===b||0===b.length)this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0);(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&THREE.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}}(),computeBoundingSphere:function(){var a=new THREE.Box3,b=new THREE.Vector3;return function(){null===this.boundingSphere&&
(this.boundingSphere=new THREE.Sphere);var c=this.attributes.position.array;if(c){a.makeEmpty();for(var d=this.boundingSphere.center,e=0,g=c.length;e<g;e+=3)b.set(c[e],c[e+1],c[e+2]),a.expandByPoint(b);a.center(d);var f=0;e=0;for(g=c.length;e<g;e+=3)b.set(c[e],c[e+1],c[e+2]),f=Math.max(f,d.distanceToSquared(b));this.boundingSphere.radius=Math.sqrt(f);isNaN(this.boundingSphere.radius)&&THREE.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}(),
computeVertexNormals:function(){var a=this.attributes;if(a.position){var b=a.position.array;if(void 0===a.normal)this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(b.length),3));else for(var c=a.normal.array,d=0,e=c.length;d<e;d++)c[d]=0;c=a.normal.array;var g=new THREE.Vector3,f=new THREE.Vector3,h=new THREE.Vector3,k=new THREE.Vector3,n=new THREE.Vector3;if(a.index)for(var p=a.index.array,l=0<this.offsets.length?this.offsets:[{start:0,count:p.length,index:0}],q=0,r=l.length;q<
r;++q){e=l[q].start;var m=l[q].count;var u=l[q].index;d=e;for(e+=m;d<e;d+=3){m=3*(u+p[d]);var x=3*(u+p[d+1]);var t=3*(u+p[d+2]);g.fromArray(b,m);f.fromArray(b,x);h.fromArray(b,t);k.subVectors(h,f);n.subVectors(g,f);k.cross(n);c[m]+=k.x;c[m+1]+=k.y;c[m+2]+=k.z;c[x]+=k.x;c[x+1]+=k.y;c[x+2]+=k.z;c[t]+=k.x;c[t+1]+=k.y;c[t+2]+=k.z}}else for(d=0,e=b.length;d<e;d+=9)g.fromArray(b,d),f.fromArray(b,d+3),h.fromArray(b,d+6),k.subVectors(h,f),n.subVectors(g,f),k.cross(n),c[d]=k.x,c[d+1]=k.y,c[d+2]=k.z,c[d+3]=
k.x,c[d+4]=k.y,c[d+5]=k.z,c[d+6]=k.x,c[d+7]=k.y,c[d+8]=k.z;this.normalizeNormals();a.normal.needsUpdate=!0}},computeTangents:function(){function a(a,b,c){l.fromArray(d,3*a);q.fromArray(d,3*b);r.fromArray(d,3*c);m.fromArray(g,2*a);u.fromArray(g,2*b);x.fromArray(g,2*c);t=q.x-l.x;v=r.x-l.x;w=q.y-l.y;z=r.y-l.y;A=q.z-l.z;y=r.z-l.z;E=u.x-m.x;I=x.x-m.x;O=u.y-m.y;K=x.y-m.y;T=1/(E*K-I*O);Y.set((K*t-O*v)*T,(K*w-O*z)*T,(K*A-O*y)*T);Q.set((E*v-I*t)*T,(E*z-I*w)*T,(E*y-I*A)*T);k[a].add(Y);k[b].add(Y);k[c].add(Y);
n[a].add(Q);n[b].add(Q);n[c].add(Q)}function b(a){R.fromArray(e,3*a);F.copy(R);V=k[a];W.copy(V);W.sub(R.multiplyScalar(R.dot(V))).normalize();M.crossVectors(F,V);aa=M.dot(n[a]);P=0>aa?-1:1;h[4*a]=W.x;h[4*a+1]=W.y;h[4*a+2]=W.z;h[4*a+3]=P}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)THREE.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");else{var c=
this.attributes.index.array,d=this.attributes.position.array,e=this.attributes.normal.array,g=this.attributes.uv.array,f=d.length/3;void 0===this.attributes.tangent&&this.addAttribute("tangent",new THREE.BufferAttribute(new Float32Array(4*f),4));for(var h=this.attributes.tangent.array,k=[],n=[],p=0;p<f;p++)k[p]=new THREE.Vector3,n[p]=new THREE.Vector3;var l=new THREE.Vector3,q=new THREE.Vector3,r=new THREE.Vector3,m=new THREE.Vector2,u=new THREE.Vector2,x=new THREE.Vector2,t,v,w,z,A,y,E,I,O,K,T,Y=
new THREE.Vector3,Q=new THREE.Vector3,C;0===this.drawcalls.length&&this.addDrawCall(0,c.length,0);var B=this.drawcalls;p=0;for(C=B.length;p<C;++p){var H=B[p].start;var N=B[p].count;var D=B[p].index;f=H;for(H+=N;f<H;f+=3){N=D+c[f];var J=D+c[f+1];var L=D+c[f+2];a(N,J,L)}}var W=new THREE.Vector3,M=new THREE.Vector3,R=new THREE.Vector3,F=new THREE.Vector3,P,V,aa;p=0;for(C=B.length;p<C;++p)for(H=B[p].start,N=B[p].count,D=B[p].index,f=H,H+=N;f<H;f+=3)N=D+c[f],J=D+c[f+1],L=D+c[f+2],b(N),b(J),b(L)}},normalizeNormals:function(){for(var a=
this.attributes.normal.array,b,c,d,e=0,g=a.length;e<g;e+=3)b=a[e],c=a[e+1],d=a[e+2],b=1/Math.sqrt(b*b+c*c+d*d),a[e]*=b,a[e+1]*=b,a[e+2]*=b},clone:function(){var a=new THREE.BufferGeometry;for(b in this.attributes)a.addAttribute(b,this.attributes[b].clone());var b=0;for(var c=this.offsets.length;b<c;b++){var d=this.offsets[b];a.offsets.push({start:d.start,index:d.index,count:d.count})}return a},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype);
THREE.Camera=function(){THREE.Object3D.call(this);this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4};THREE.Camera.prototype=Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.constructor=THREE.Camera;THREE.Camera.prototype.getWorldDirection=function(){var a=new THREE.Quaternion;return function(b){b=b||new THREE.Vector3;this.getWorldQuaternion(a);return b.set(0,0,-1).applyQuaternion(a)}}();
THREE.Camera.prototype.lookAt=function(){var a=new THREE.Matrix4;return function(b){a.lookAt(this.position,b,this.up);this.quaternion.setFromRotationMatrix(a)}}();THREE.Camera.prototype.clone=function(a){void 0===a&&(a=new THREE.Camera);THREE.Object3D.prototype.clone.call(this,a);a.matrixWorldInverse.copy(this.matrixWorldInverse);a.projectionMatrix.copy(this.projectionMatrix);return a};
THREE.PerspectiveCamera=function(a,b,c,d){THREE.Camera.call(this);this.zoom=1;this.fov=void 0!==a?a:50;this.aspect=void 0!==b?b:1;this.near=void 0!==c?c:.1;this.far=void 0!==d?d:2E3;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype);THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera;THREE.PerspectiveCamera.prototype.setLens=function(a,b){void 0===b&&(b=24);this.fov=2*THREE.Math.radToDeg(Math.atan(b/(2*a)));this.updateProjectionMatrix()};
THREE.PerspectiveCamera.prototype.setViewOffset=function(a,b,c,d,e,g){this.fullWidth=a;this.fullHeight=b;this.x=c;this.y=d;this.width=e;this.height=g;this.updateProjectionMatrix()};
THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var a=THREE.Math.radToDeg(2*Math.atan(Math.tan(.5*THREE.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var b=this.fullWidth/this.fullHeight;a=Math.tan(THREE.Math.degToRad(.5*a))*this.near;var c=-a,d=b*c;b=Math.abs(b*a-d);c=Math.abs(a-c);this.projectionMatrix.makeFrustum(d+this.x*b/this.fullWidth,d+(this.x+this.width)*b/this.fullWidth,a-(this.y+this.height)*c/this.fullHeight,a-this.y*c/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(a,
this.aspect,this.near,this.far)};THREE.PerspectiveCamera.prototype.clone=function(){var a=new THREE.PerspectiveCamera;THREE.Camera.prototype.clone.call(this,a);a.zoom=this.zoom;a.fov=this.fov;a.aspect=this.aspect;a.near=this.near;a.far=this.far;a.projectionMatrix.copy(this.projectionMatrix);return a};THREE.OrthographicCamera=function(a,b,c,d,e,g){THREE.Camera.call(this);this.zoom=1;this.left=a;this.right=b;this.top=c;this.bottom=d;this.near=void 0!==e?e:.1;this.far=void 0!==g?g:2E3;this.updateProjectionMatrix()};
THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype);THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera;THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){var a=(this.right-this.left)/(2*this.zoom),b=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,d=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(c-a,c+a,d+b,d-b,this.near,this.far)};
THREE.OrthographicCamera.prototype.clone=function(){var a=new THREE.OrthographicCamera;THREE.Camera.prototype.clone.call(this,a);a.zoom=this.zoom;a.left=this.left;a.right=this.right;a.top=this.top;a.bottom=this.bottom;a.near=this.near;a.far=this.far;a.projectionMatrix.copy(this.projectionMatrix);return a};THREE.Mesh=function(a,b){THREE.Object3D.call(this);this.geometry=void 0!==a?a:new THREE.Geometry;this.material=void 0!==b?b:new THREE.MeshBasicMaterial({color:16777215*Math.random()});this.updateMorphTargets()};
THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype);THREE.Mesh.prototype.constructor=THREE.Mesh;
THREE.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var a=0,b=this.geometry.morphTargets.length;a<b;a++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[a].name]=a}};
THREE.Mesh.prototype.getMorphTargetIndexByName=function(a){if(void 0!==this.morphTargetDictionary[a])return this.morphTargetDictionary[a];THREE.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0.");return 0};THREE.Mesh.prototype.clone=function(a,b){void 0===a&&(a=new THREE.Mesh(this.geometry,this.material));THREE.Object3D.prototype.clone.call(this,a,b);return a};THREE.Scene=function(){THREE.Object3D.call(this);this.overrideMaterial=null;this.autoUpdate=!0};
THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.clone=function(a){void 0===a&&(a=new THREE.Scene);THREE.Object3D.prototype.clone.call(this,a);null!==this.overrideMaterial&&(a.overrideMaterial=this.overrideMaterial.clone());a.autoUpdate=this.autoUpdate;a.matrixAutoUpdate=this.matrixAutoUpdate;return a};
THREE.UniformsUtils={merge:function(a){for(var b={},c=0;c<a.length;c++){var d=this.clone(a[c]),e;for(e in d)b[e]=d[e]}return b},clone:function(a){var b={},c;for(c in a){b[c]={};for(var d in a[c]){var e=a[c][d];b[c][d]=e&&void 0!==e.clone?e.clone():e instanceof Array?e.slice():e}}return b}};
THREE.BoxBufferGeometry=function(a,b,c,d,e,g){function f(a,b,c,d,e,f,g,w,z,A){var m=f/z,q=g/A,r=f/2,u=g/2,t=w/2;g=z+1;var x=A+1;f=0;var v,Q,C=new THREE.Vector3;for(Q=0;Q<x;Q++){var B=Q*q-u;for(v=0;v<g;v++)C[a]=(v*m-r)*d,C[b]=B*e,C[c]=t,k.push(C.x,C.y,C.z),C[a]=0,C[b]=0,C[c]=0<w?1:-1,n.push(C.x,C.y,C.z),p.push(v/z),p.push(1-Q/A),f+=1}for(Q=0;Q<A;Q++)for(v=0;v<z;v++)a=l+v+g*(Q+1),b=l+(v+1)+g*(Q+1),c=l+(v+1)+g*Q,h.push(l+v+g*Q,a,c),h.push(a,b,c);l+=f}THREE.BufferGeometry.call(this);this.parameters={width:a,
height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:g};d=Math.floor(d)||1;e=Math.floor(e)||1;g=Math.floor(g)||1;var h=[],k=[],n=[],p=[],l=0;f("z","y","x",-1,-1,c,b,a,g,e);f("z","y","x",1,-1,c,b,-a,g,e);f("x","z","y",1,1,a,c,b,d,g);f("x","z","y",1,-1,a,c,-b,d,g);f("x","y","z",1,-1,a,b,c,d,e);f("x","y","z",-1,-1,a,b,-c,d,e);console.assert(65536>=k.length);this.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(h),1));this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(k),
3));this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(n),3));this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(p),2))};THREE.BoxBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.BoxBufferGeometry.prototype.constructor=THREE.BoxBufferGeometry;
THREE.SphereBufferGeometry=function(a,b,c,d,e,g,f){THREE.BufferGeometry.call(this);this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:g,thetaLength:f};a=a||50;b=Math.max(3,Math.floor(b)||8);c=Math.max(2,Math.floor(c)||6);d=void 0!==d?d:0;e=void 0!==e?e:2*Math.PI;g=void 0!==g?g:0;f=void 0!==f?f:Math.PI;var h=g+f,k,n,p=0,l=[],q=new THREE.Vector3,r=new THREE.Vector3,m=[],u=[],x=[],t=[];for(n=0;n<=c;n++){var v=[],w=n/c;for(k=0;k<=b;k++){var z=k/b;q.x=-a*Math.cos(d+
z*e)*Math.sin(g+w*f);q.y=a*Math.cos(g+w*f);q.z=a*Math.sin(d+z*e)*Math.sin(g+w*f);u.push(q.x,q.y,q.z);r.set(q.x,q.y,q.z).normalize();x.push(r.x,r.y,r.z);t.push(z,1-w);v.push(p++)}l.push(v)}for(n=0;n<c;n++)for(k=0;k<b;k++)a=l[n][k+1],d=l[n][k],e=l[n+1][k],f=l[n+1][k+1],(0!==n||0<g)&&m.push(a,d,f),(n!==c-1||h<Math.PI)&&m.push(d,e,f);console.assert(65536>=u.length);this.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(m),1));this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(u),
3));this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(x),3));this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(t),2))};THREE.SphereBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.SphereBufferGeometry.prototype.constructor=THREE.SphereBufferGeometry;
THREE.PlaneBufferGeometry=function(a,b,c,d){THREE.BufferGeometry.call(this);this.type="PlaneBufferGeometry";this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};var e=a/2,g=b/2;c=c||1;d=d||1;var f=c+1,h=d+1,k=a/c,n=b/d;b=new Float32Array(f*h*3);a=new Float32Array(f*h*3);for(var p=new Float32Array(f*h*2),l=0,q=0,r=0;r<h;r++)for(var m=r*n-g,u=0;u<f;u++)b[l]=u*k-e,b[l+1]=-m,a[l+2]=1,p[q]=u/c,p[q+1]=1-r/d,l+=3,q+=2;l=0;e=new (65535<b.length/3?Uint32Array:Uint16Array)(c*d*6);for(r=0;r<d;r++)for(u=
0;u<c;u++)g=u+f*(r+1),h=u+1+f*(r+1),k=u+1+f*r,e[l]=u+f*r,e[l+1]=g,e[l+2]=k,e[l+3]=g,e[l+4]=h,e[l+5]=k,l+=6;this.addAttribute("index",new THREE.BufferAttribute(e,1));this.addAttribute("position",new THREE.BufferAttribute(b,3));this.addAttribute("normal",new THREE.BufferAttribute(a,3));this.addAttribute("uv",new THREE.BufferAttribute(p,2))};THREE.PlaneBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.PlaneBufferGeometry.prototype.constructor=THREE.PlaneBufferGeometry;
THREE.CylinderBufferGeometry=function(a,b,c,d,e,g,f,h){function k(c){var e,g=new THREE.Vector2,k=new THREE.Vector3,m=!0===c?a:b,x=!0===c?1:-1;var y=r;for(e=1;e<=d;e++)p.push(0,u*x,0),l.push(0,x,0),q.push(.5,.5),r++;var E=r;for(e=0;e<=d;e++){var I=e/d*h+f,O=Math.cos(I);I=Math.sin(I);k.x=m*I;k.y=u*x;k.z=m*O;p.push(k.x,k.y,k.z);l.push(0,x,0);g.x=.5*O+.5;g.y=.5*I*x+.5;q.push(g.x,g.y);r++}for(e=0;e<d;e++)g=y+e,k=E+e,!0===c?n.push(k,k+1,g):n.push(k+1,k,g)}THREE.BufferGeometry.call(this);this.parameters=
{radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:g,thetaStart:f,thetaLength:h};a=void 0!==a?a:20;b=void 0!==b?b:20;c=void 0!==c?c:100;d=Math.floor(d)||8;e=Math.floor(e)||1;g=void 0!==g?g:!1;f=void 0!==f?f:0;h=void 0!==h?h:2*Math.PI;var n=[],p=[],l=[],q=[],r=0,m=[],u=c/2;(function(){var g,k,v=new THREE.Vector3,w=new THREE.Vector3,z=(b-a)/c;for(k=0;k<=e;k++){var A=[],y=k/e,E=y*(b-a)+a;for(g=0;g<=d;g++){var I=g/d,O=I*h+f,K=Math.sin(O);O=Math.cos(O);w.x=E*K;w.y=-y*c+u;
w.z=E*O;p.push(w.x,w.y,w.z);v.set(K,z,O).normalize();l.push(v.x,v.y,v.z);q.push(I,1-y);A.push(r++)}m.push(A)}for(g=0;g<d;g++)for(k=0;k<e;k++)v=m[k+1][g],w=m[k+1][g+1],z=m[k][g+1],n.push(m[k][g],v,z),n.push(v,w,z)})();!1===g&&(0<a&&k(!0),0<b&&k(!1));console.assert(65536>=p.length);this.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(n),1));this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(p),3));this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(l),
3));this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(q),2))};THREE.CylinderBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.CylinderBufferGeometry.prototype.constructor=THREE.CylinderBufferGeometry;
THREE.TorusBufferGeometry=function(a,b,c,d,e){THREE.BufferGeometry.call(this);this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};a=a||1;b=b||.4;c=Math.floor(c)||8;d=Math.floor(d)||6;e=e||2*Math.PI;var g=[],f=[],h=[],k=[],n=new THREE.Vector3,p=new THREE.Vector3,l=new THREE.Vector3,q,r;for(q=0;q<=c;q++)for(r=0;r<=d;r++){var m=r/d*e,u=q/c*Math.PI*2;p.x=(a+b*Math.cos(u))*Math.cos(m);p.y=(a+b*Math.cos(u))*Math.sin(m);p.z=b*Math.sin(u);f.push(p.x,p.y,p.z);n.x=a*Math.cos(m);n.y=a*
Math.sin(m);l.subVectors(p,n).normalize();h.push(l.x,l.y,l.z);k.push(r/d);k.push(q/c)}for(q=1;q<=c;q++)for(r=1;r<=d;r++)a=(d+1)*(q-1)+r-1,b=(d+1)*(q-1)+r,e=(d+1)*q+r,g.push((d+1)*q+r-1,a,e),g.push(a,b,e);console.assert(65536>=f.length);this.addAttribute("index",new THREE.BufferAttribute(new Uint16Array(g),1));this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(f),3));this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(h),3));this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(k),
2))};THREE.TorusBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.TorusBufferGeometry.prototype.constructor=THREE.TorusBufferGeometry;(function(){function a(){var a={},b=window.location.hash;b&&b.substring(1).split("&").forEach(function(b){var c=b.indexOf("=");0<=c?a[b.substring(0,c)]=b.substring(c+1):a[b]=void 0});return a}function b(b){return b in a()}window.WALK={EDIT_MODE:b("editor"),DEBUG:b("debug"),DEBUG_SHARED_BUFFERS:b("debugbuffers"),ALWAYS_RENDER:!1,LOG_INFO:b("log"),LOG_TO_SERVER:!1,LOG_TIME:!1,PROGRESSIVE_LOADER_AFTER_SEC:30,CONTEXT_LOST_RESTORE_LIMIT:4,DYNAMIC_LIGHTS:!1,HEAD_LIGHT:!1,RETRIES_ON_LOAD_ERROR:3,DEFAULT_ANISOTROPY:4,
NO_ANISOTROPY:1,FORCE_FXAA:!1,FONT_FAMILIES_TO_LOAD:[],CAMERA_WALK_NEAR:.01,CAMERA_ORBIT_NEAR:.05,CAMERA_MIN_FAR:100,SKY_DISTANCE_TO_SCENE:100,CAMERA_DEFAULT_FOV:70,CAMERA_DEFAULT_MOVE_MAX_SPEED:1.11,CAMERA_LOOK_SPEED:Math.PI/1500,CAMERA_ARROWS_TURN_SPEED:Math.PI/2,CAMERA_SCROLL_SPEED:.5,CAMERA_FULL_ACCELERATION_TIME:.5,CAMERA_FULL_DECELERATION_TIME:.166,MAX_GROUND_SEARCH_DEPTH:5.5,COVER_JSON_URL:"./cover.json",AUTO_TOUR_IN_VIEW_STILL_TIME_MS:3E3,CLICK_MOVE_MIN_DISTANCE_TO_OBSTACLE:.7,KEY_MOVE_MIN_DISTANCE_TO_OBSTACLE:.1,
MIN_DISTANCE_TO_CEILING:.1,LIGHT_PROBE_MIRROR_SIZE:512,LIGHT_PROBE_MAX_MIP_SIZE:128,LIGHT_PROBE_MIN_MIP_SIZE:4,LIGHT_PROBE_GLOSS_FOR_MIP:[.99,.9,.85,.7,.4,.25],LIGHT_VISIBILITY_MAP_DOWNSAMPLE:2,LIGHT_DISTANCE_PROBE_SIZE:512,DEBUG_LIGHT_PROBE_MIPS:!1,ENABLE_AUTO_EXPOSURE_CONTROLS:!1,EDITOR_COVER_WIDTH:1920,EDITOR_COVER_HEIGHT:1080,MAX_PANORAMA_SIZE:8192,OBJECT_VISIBILITY_PROBE_SIZE:128,DEFAULT_SKY_NAME:"default",EDITOR_CONTROLLED_SKY_NAME:"sky0",EDITOR_SELECTION_COLOR:(new THREE.Color(5021401)).convertGammaToLinear(),
ALLOW_MOBILE_VR:!0,VR_FALLBACK_CAMERA_HEIGHT:1.6,LOAD_PRIORITY:{CORE_RESOURCE:0,COLORMAP:1,UV0:1,DIFFUSE:2,LIGHTMAP:3,SKY:4,SPECULARITY:5,VIDEO:6},MERGE_TRANSPARENT_DISABLED:b("nomergetransparent"),urlHashContains:b,urlHashGetArgument:function(b){var c=a();return b in c&&void 0!==c[b]?decodeURI(c[b]):null},urlHashRemoveArgument:function(b){var c=a();return Object.keys(c).filter(function(a){return a!==b}).map(function(a){var b=c[a];return a+(void 0===b?"":"="+b)}).join("&")},isLocalhost:function(){return"localhost"===
window.location.hostname||"127.0.0.1"===window.location.hostname},TELEPORT_TO_VIEW_MAX_TIME:3,TELEPORT_TO_POINT_MAX_TIME:4.5,TELEPORT_TO_VIEW_ACCELERATION:4,GAZE_POINTER_SHOW_LOADING_AFTER_S:2.5,GAZE_POINTER_ACTIVATE_AFTER_S:4.5,SPRITE_ANCHOR_FONT_SIZE:128,POINTER_PRIORITY:{TRANSFORM_CONTROLS:1,EDITOR_SELECTOR:2,INTERACTION_DISPATCHER:3},BASIS_DECODE_WORKERS:Math.min(4,navigator.hardwareConcurrency||4),HIDE_MEETING_EXTENSIONS_FROM_EDITOR:!0};window.WebXRConfig={cardboardConfig:{ADDITIONAL_VIEWERS:[],
DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:null,CARDBOARD_UI_DISABLED:!1,K_FILTER:.98,ROTATE_INSTRUCTIONS_DISABLED:!1,PREDICTION_TIME_S:.04,YAW_ONLY:!1,BUFFER_SCALE:1,DIRTY_SUBMIT_FRAME_BINDINGS:!1}};window.GLC={REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,
UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,FUNC_ADD:32774,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,
HALF_FLOAT_OES:36193,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4x4_KHR:37808};window.$=function(a){return document.getElementById(a)}})();/*
 Copyright (C) 2014-present Shapespark
*/
(function(){function a(b,d,e){return function(){b!==d.length&&(e(d[b]),WALK.defer(a(b+1,d,e)))}}var b=2*Math.PI;WALK.defer=function(a){setTimeout(a,0)};WALK.iterateAsync=function(b,d){WALK.defer(a(0,b,d))};WALK.find=function(a,b){for(var c=0;c<a.length;c+=1){var d=a[c];if(b(d))return d}};WALK.filter=function(a,b){for(var c=a.length,d=[],f=0;f<c;f+=1)b(a[f])&&d.push(a[f]);return d};WALK.indexOfMax=function(a,b){if(0===a.length)return null;for(var c=0,d=b?b(a[0]):a[0],f=1;f<a.length;f+=1){var h=b?b(a[f]):
a[f];h>d&&(c=f,d=h)}return c};WALK.any=function(a,b){for(var c=a.length,d=0;d<c;d+=1)if(b(a[d]))return!0;return!1};WALK.removeFromArray=function(a,b){a=b.indexOf(a);console.assert(-1!==a);return b.splice(a,1)};WALK.copyProperties=function(a,b,e){for(var c=0;c<b.length;c+=1){var d=b[c],h=a[d];void 0!==h&&(e[d]=h)}};WALK.normalizeRotation=function(a){a%=b;return a>Math.PI?-b+a:a<-Math.PI?b+a:a};WALK.setTextContent=function(a,b){void 0!==a.textContent?a.textContent=b:void 0!==a.innerText?a.innerText=
b:console.warn("textContent and innerText properties are missing")};WALK.getOriginFromUrl=function(a){var b=document.createElement("a");b.href=a;return b.protocol+"//"+b.host};WALK.log2=function(a){return Math.log(a)/Math.log(2)};WALK.mipsCount=function(a,b){return WALK.log2(b)-WALK.log2(a)+1};WALK.LIGHT_PROBE_MIPS_COUNT=WALK.mipsCount(WALK.LIGHT_PROBE_MIN_MIP_SIZE,WALK.LIGHT_PROBE_MAX_MIP_SIZE);WALK.isModifierPressed=function(a){return a.ctrlKey||a.altKey||a.metaKey};WALK.round=function(a,b){void 0===
b&&(b=3);return+(Math.round(a+"e+"+b)+"e-"+b)};WALK.preloadImage=function(a){var b=new Image;b.src=a;return b};WALK.onVideoDataReady=function(a,b){function c(){a.readyState>=a.HAVE_CURRENT_DATA&&(a.removeEventListener("playing",c),a.removeEventListener("timeupdate",c),b(a))}a.readyState>=a.HAVE_CURRENT_DATA?b(a):(a.addEventListener("playing",c),a.addEventListener("timeupdate",c))};WALK.cloneObject=function(a){return JSON.parse(JSON.stringify(a))};WALK.readOnlyCopy=function(a){return Object.freeze(WALK.cloneObject(a))};
WALK.deepEqual=function(a,b){if(a===b)return!0;if("object"!==typeof a||null===a||"object"!==typeof b||null===b||Object.keys(a).length!==Object.keys(b).length)return!1;for(var c=$jscomp.makeIterator(Object.keys(a)),d=c.next();!d.done;d=c.next())if(d=d.value,!b.hasOwnProperty(d)||!WALK.deepEqual(a[d],b[d]))return!1;return!0}})();(function(){function a(a,b,c){WALK.ICONS[a]={name:a,value:b,fontFamily:c}}function b(b,c){a(b,c,"FontAwesomeSolid")}function c(b,c){a(b,c,"FontAwesomeRegular")}function d(b,c){a(b,c,"FontAwesomeBrands")}WALK.ICONS={};b("address-book","\uf2b9");b("address-card","\uf2bb");b("area-chart","\uf1fe");b("arrows","\uf0b2");b("arrow-up","\uf062");b("arrow-down","\uf063");b("assistive-listening-systems","\uf2a2");b("asterisk","\uf069");b("audio-description","\uf29e");b("at","\uf1fa");b("bars","\uf0c9");b("bell",
"\uf0f3");b("book","\uf02d");b("bookmark","\uf02e");b("bullhorn","\uf0a1");b("calculator","\uf1ec");b("camera","\uf030");b("chart-bar","\uf080");b("chart-pie","\uf200");b("chevron-up","\uf077");b("chevron-down","\uf078");b("cloud","\uf0c2");b("cog","\uf013");b("comment","\uf075");c("compass","\uf14e");c("credit-card","\uf09d");b("crosshairs","\uf05b");b("desktop","\uf108");b("download","\uf019");b("envelope","\uf0e0");b("external-link","\uf35d");c("eye","\uf06e");b("eye-dropper","\uf1fb");b("film",
"\uf008");b("flag","\uf024");b("folder","\uf07b");b("gift","\uf06b");b("headphones","\uf025");b("highlighter","\uf591");b("home","\uf015");c("image","\uf03e");b("sign-in","\uf2f6");b("info","\uf129");c("lightbulb","\uf0eb");b("magic","\uf0d0");b("magnet","\uf076");b("map-marker","\uf3c5");b("map-pin","\uf276");b("map-signs","\uf277");b("paint-brush","\uf1fc");b("pencil","\uf303");b("pen","\uf304");b("phone","\uf095");b("question","\uf128");b("share","\uf064");b("share-alt","\uf1e0");b("shopping-cart",
"\uf07a");b("sliders","\uf1de");b("star","\uf005");c("sticky-note","\uf249");c("edit","\uf044");b("tachometer","\uf3fd");b("tag","\uf02b");b("video","\uf03d");b("wrench","\uf0ad");b("palette","\uf53f");b("paint-roller","\uf5aa");b("play","\uf04b");b("plus","\uf067");d("youtube","\uf167");d("vimeo","\uf40a");d("facebook","\uf09a");d("twitter","\uf099");d("instagram","\uf16d");d("linkedin","\uf08c");d("skype","\uf17e");d("whatsapp","\uf232");d("facebook-messenger","\uf39f");d("telegram","\uf2c6");d("slack",
"\uf198")})();(function(){function a(a,b){return function(c){h.finished(a);b(c)}}function b(a){this.method=a;this.binaryResult=!1;this.dataContentType=this.data=null;"GET"===a?(this.retriesLeft=WALK.RETRIES_ON_LOAD_ERROR,this.retryDelay=.5+Math.random()):this.retryDelay=this.retriesLeft=0}function c(a,b,c,e,f){setTimeout(function(){d(a,b,c,e,f)},b.retryDelay);b.retryScheduled()}function d(a,b,d,e,f){function g(){var g=k.status||0;g="GET"===b.method&&(500<=g||0===g)?0!==b.retriesLeft:!1;console.warn("Failed to "+
b.method+": "+a+" ("+k.status+")"+(g?", retrying in "+b.retryDelay+"s":""));if(g)c(a,b,d,e,f);else if(void 0!==e){try{var h=JSON.parse(k.responseText).message}catch(t){h=void 0}e(k.status,h)}b=k=null}var k=new XMLHttpRequest;void 0!==f&&k.addEventListener("progress",f,!1);k.addEventListener("load",function(){200<=k.status&&300>k.status||0===k.status?(void 0!==d&&(b.binaryResult?d(k.response):k.responseText?d(JSON.parse(k.responseText)):d()),b=k=null):g()},!1);k.addEventListener("error",g,!1);k.addEventListener("abort",
g,!1);k.open(b.method,a,!0);b.binaryResult&&(k.responseType="arraybuffer");b.dataContentType&&k.setRequestHeader("Content-Type",b.dataContentType);"POST"===b.method&&k.setRequestHeader("X-Requested-By","Shapespark");k.send(b.data)}function e(a,b,c,d,e){function f(){a(b,c,d,e)}return function(){console.warn("Failed to get: "+b+(f?", retrying in "+c.retryDelay+"s":""));0<c.retriesLeft?(setTimeout(f,c.retryDelay),c.retryScheduled()):e()}}function g(a,b,c,d){var f=new Image;f.onload=function(){c(f);f=
null};f.onerror=e(g,a,b,c,d);f.crossOrigin="anonymous";f.src=a}function f(a,b,c,d){var g=document.createElement("video");g.autoplay=!0;g.muted=!0;g.loop=!0;g.setAttribute("playsinline","");g.setAttribute("webkit-playsinline","");g.crossOrigin="anonymous";g.onerror=e(f,a,b,c,d);WALK.onVideoDataReady(g,function(){c(g);g=null});g.src=a;g.play().catch(function(){})}var h=new function(){function a(){for(d+=1;d<b.length;d+=1){var a=b[d];if(0<a.length){for(var e=0;e<a.length;e+=1)c[d]+=1,WALK.defer(a[e]);
a.length=0;break}}}var b=[],c=[],d=Infinity;(function(){var a=0,d;for(d in WALK.LOAD_PRIORITY)WALK.LOAD_PRIORITY.hasOwnProperty(d)&&(a=Math.max(a,WALK.LOAD_PRIORITY[d]));for(d=0;d<=a;d+=1)b[d]=[],c[d]=0})();this.add=function(e,f){e<=d?(c[e]+=1,d=e,WALK.defer(f)):(b[e].push(f),0===c[d]&&a())};this.finished=function(b){--c[b];var e=c[b];console.assert(0<=e);b===d&&0===e&&a()}};b.prototype={constructor:b,retryScheduled:function(){console.assert(0<this.retriesLeft);--this.retriesLeft;this.retryDelay*=
2}};WALK.ajaxGet=function(a,c,e,f,g){var k=new b("GET");k.binaryResult=c;d(a,k,e,f,g)};WALK.queueAjaxGet=function(b,c,d,e,f,g){h.add(b,function(){WALK.ajaxGet(c,d,a(b,e),a(b,f),g)})};WALK.ajaxPost=function(a,c,e,f,g,h){var k=new b("POST");k.data=e;k.dataContentType=c;d(a,k,f,g,h)};WALK.queueImageGet=function(c,d,e,f){h.add(c,function(){var k=new b("GET");g(d,k,a(c,e),a(c,f))})};WALK.queueVideoGet=function(c,d,e,g){h.add(c,function(){var k=new b("GET");f(d,k,a(c,e),a(c,g))})}})();(function(){function a(a,b){for(a=a.toString();a.length<b;)a="0"+a;return a}function b(b){var c=console[b].bind(console);console[b]=function(){for(var d="",g="",f=0;f<arguments.length;++f)g+=(0===f?"":" ")+arguments[f];WALK.LOG_TIME&&(d=new Date,d=a(d.getHours(),2)+":"+a(d.getMinutes(),2)+":"+a(d.getSeconds(),2)+","+a(d.getMilliseconds(),3)+" ");f=d+b.toUpperCase()+" "+g;WALK.LOG_TO_SERVER&&WALK.ajaxPost("/log","application/json",JSON.stringify({message:f}));c(d+g)}}WALK.log=WALK.LOG_INFO?function(a){for(var b=
[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];console.log.apply(console,$jscomp.arrayFromIterable(b))}:function(){};if(WALK.LOG_TO_SERVER||WALK.LOG_TIME)b("log"),b("info"),b("warn"),b("error")})();/*

 nosleep.js
 Copyright (c) 2017, Rich Tibbett

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.

 webxr-polyfill
 Copyright (c) 2017 Google
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 cardboard-vr-display
 Copyright (c) 2015-2017 Google
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 webvr-polyfill-dpdb 
 Copyright (c) 2017 Google
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 wglu-preserve-state
 Copyright (c) 2016, Brandon Jones.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
*/
(function(a,b){"object"===typeof exports&&"undefined"!==typeof module?module.exports=b():"function"===typeof define&&define.amd?define(b):a.WebXRPolyfill=b()})(this,function(){function a(){var a=new H(16);H!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0);a[0]=1;a[5]=1;a[10]=1;a[15]=1;return a}function b(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a}function c(a,
b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],k=b[5],h=b[6],m=b[7],ma=b[8],l=b[9],n=b[10],q=b[11],r=b[12],p=b[13],u=b[14];b=b[15];var t=c*k-d*g,ja=c*h-e*g,x=c*m-f*g,w=d*h-e*k,v=d*m-f*k,A=e*m-f*h,y=ma*p-l*r,z=ma*u-n*r,B=ma*b-q*r,C=l*u-n*p,H=l*b-q*p,F=n*b-q*u,Z=t*F-ja*H+x*C+w*B-v*z+A*y;if(!Z)return null;Z=1/Z;a[0]=(k*F-h*H+m*C)*Z;a[1]=(e*H-d*F-f*C)*Z;a[2]=(p*A-u*v+b*w)*Z;a[3]=(n*v-l*A-q*w)*Z;a[4]=(h*B-g*F-m*z)*Z;a[5]=(c*F-e*B+f*z)*Z;a[6]=(u*x-r*A-b*ja)*Z;a[7]=(ma*A-n*x+q*ja)*Z;a[8]=(g*H-k*B+m*y)*Z;a[9]=
(d*B-c*H-f*y)*Z;a[10]=(r*v-p*x+b*t)*Z;a[11]=(l*x-ma*v-q*t)*Z;a[12]=(k*z-g*C-h*y)*Z;a[13]=(c*C-d*z+e*y)*Z;a[14]=(p*ja-r*w-u*t)*Z;a[15]=(ma*w-l*ja+n*t)*Z;return a}function d(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],k=b[4],h=b[5],m=b[6],ma=b[7],l=b[8],n=b[9],q=b[10],r=b[11],p=b[12],u=b[13],t=b[14];b=b[15];var ja=c[0],x=c[1],w=c[2],v=c[3];a[0]=ja*d+x*k+w*l+v*p;a[1]=ja*e+x*h+w*n+v*u;a[2]=ja*f+x*m+w*q+v*t;a[3]=ja*g+x*ma+w*r+v*b;ja=c[4];x=c[5];w=c[6];v=c[7];a[4]=ja*d+x*k+w*l+v*p;a[5]=ja*e+x*h+w*n+v*u;a[6]=
ja*f+x*m+w*q+v*t;a[7]=ja*g+x*ma+w*r+v*b;ja=c[8];x=c[9];w=c[10];v=c[11];a[8]=ja*d+x*k+w*l+v*p;a[9]=ja*e+x*h+w*n+v*u;a[10]=ja*f+x*m+w*q+v*t;a[11]=ja*g+x*ma+w*r+v*b;ja=c[12];x=c[13];w=c[14];v=c[15];a[12]=ja*d+x*k+w*l+v*p;a[13]=ja*e+x*h+w*n+v*u;a[14]=ja*f+x*m+w*q+v*t;a[15]=ja*g+x*ma+w*r+v*b;return a}function e(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],k=d+d,h=e+e,m=f+f;b=d*k;var l=d*h;d*=m;var ma=e*h;e*=m;f*=m;k*=g;h*=g;g*=m;a[0]=1-(ma+f);a[1]=l+g;a[2]=d-h;a[3]=0;a[4]=l-g;a[5]=1-(b+f);a[6]=e+k;a[7]=0;a[8]=
d+h;a[9]=e-k;a[10]=1-(b+ma);a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a}function g(a,b){a[0]=b[12];a[1]=b[13];a[2]=b[14];return a}function f(a,b){var c=b[0]+b[5]+b[10];0<c?(c=2*Math.sqrt(c+1),a[3]=.25*c,a[0]=(b[6]-b[9])/c,a[1]=(b[8]-b[2])/c,a[2]=(b[1]-b[4])/c):b[0]>b[5]&&b[0]>b[10]?(c=2*Math.sqrt(1+b[0]-b[5]-b[10]),a[3]=(b[6]-b[9])/c,a[0]=.25*c,a[1]=(b[1]+b[4])/c,a[2]=(b[8]+b[2])/c):b[5]>b[10]?(c=2*Math.sqrt(1+b[5]-b[0]-b[10]),a[3]=(b[8]-b[2])/c,a[0]=(b[1]+b[4])/c,a[1]=.25*c,a[2]=(b[6]+
b[9])/c):(c=2*Math.sqrt(1+b[10]-b[0]-b[5]),a[3]=(b[1]-b[4])/c,a[0]=(b[8]+b[2])/c,a[1]=(b[6]+b[9])/c,a[2]=.25*c);return a}function h(a,b,c,d,e){b=1/Math.tan(b/2);a[0]=b/c;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[11]=-1;a[12]=0;a[13]=0;a[15]=0;null!=e&&Infinity!==e?(c=1/(d-e),a[10]=(e+d)*c,a[14]=2*e*d*c):(a[10]=-1,a[14]=-2*d);return a}function k(){var a=new H(3);H!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0);return a}function n(a){var b=new H(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b}
function p(a,b,c){var d=new H(3);d[0]=a;d[1]=b;d[2]=c;return d}function l(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a}function q(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];return a}function r(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;return a}function m(a,b){var c=b[0],d=b[1],e=b[2];c=c*c+d*d+e*e;0<c&&(c=1/Math.sqrt(c),a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c);return a}function u(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function x(a,b,c){var d=b[0],e=b[1];b=b[2];var f=c[0],g=c[1];c=c[2];a[0]=
e*c-b*g;a[1]=b*f-d*c;a[2]=d*g-e*f;return a}function t(a,b,c){var d=c[0],e=c[1],f=c[2],g=b[0],k=b[1];b=b[2];var h=e*b-f*k,m=f*g-d*b,l=d*k-e*g;c=2*c[3];a[0]=g+h*c+2*(e*l-f*m);a[1]=k+m*c+2*(f*h-d*l);a[2]=b+l*c+2*(d*m-e*h);return a}function v(){var a=new H(9);H!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0);a[0]=1;a[4]=1;a[8]=1;return a}function w(){var a=new H(4);H!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0);return a}function z(){var a=new H(4);H!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0);a[3]=
1;return a}function A(a,b,c){var d=b[0],e=b[1],f=b[2];b=b[3];var g=c[0],k=c[1],h=c[2];c=c[3];a[0]=d*c+b*g+e*h-f*k;a[1]=e*c+b*k+f*g-d*h;a[2]=f*c+b*h+d*k-e*g;a[3]=b*c-d*g-e*k-f*h;return a}function y(a,b,c,d){var e=b[0],f=b[1],g=b[2];b=b[3];var k=c[0],h=c[1],m=c[2];c=c[3];var l=e*k+f*h+g*m+b*c;0>l&&(l=-l,k=-k,h=-h,m=-m,c=-c);if(1E-6<1-l){var n=Math.acos(l);var q=Math.sin(n);l=Math.sin((1-d)*n)/q;d=Math.sin(d*n)/q}else l=1-d;a[0]=l*e+d*k;a[1]=l*f+d*h;a[2]=l*g+d*m;a[3]=l*b+d*c;return a}function E(a,b){var c=
b[0],d=b[1],e=b[2];b=b[3];var f=c*c+d*d+e*e+b*b;f=f?1/f:0;a[0]=-c*f;a[1]=-d*f;a[2]=-e*f;a[3]=b*f;return a}function I(a,b){a=new Event(a,b);a[Oa]={frame:b.frame,inputSource:b.inputSource};Object.setPrototypeOf(a,I.prototype);Object.defineProperty(a,"frame",{get:function(){return this[Oa].frame}});Object.defineProperty(a,"inputSource",{get:function(){return this[Oa].inputSource}});return a}function O(a,b){a=new Event(a,b);a[Ya]={session:b.session};Object.setPrototypeOf(a,O.prototype);Object.defineProperty(a,
"session",{get:function(){return this[Ya].session}});return a}function K(a,b){a=new Event(a,b);a[Pa]={session:b.session,added:b.added,removed:b.removed};Object.setPrototypeOf(a,K.prototype);Object.defineProperty(a,"session",{get:function(){return this[Pa].session}});Object.defineProperty(a,"added",{get:function(){return this[Pa].added}});Object.defineProperty(a,"removed",{get:function(){return this[Pa].removed}});return a}function T(a,b){a=new Event(a,b);a[Ta]={referenceSpace:b.referenceSpace,transform:b.transform||
null};Object.setPrototypeOf(a,T.prototype);Object.defineProperty(a,"referenceSpace",{get:function(){return this[Ta].referenceSpace}});Object.defineProperty(a,"transform",{get:function(){return this[Ta].transform}});return a}function Y(a,b,c){function d(a,b,c){return a<b?b:a>c?c:a}var e=b[0]*b[0],f=b[1]*b[1],g=b[2]*b[2],k=b[3]*b[3];"XYZ"===c?(a[0]=Math.atan2(2*(b[0]*b[3]-b[1]*b[2]),k-e-f+g),a[1]=Math.asin(d(2*(b[0]*b[2]+b[1]*b[3]),-1,1)),a[2]=Math.atan2(2*(b[2]*b[3]-b[0]*b[1]),k+e-f-g)):"YXZ"===c?
(a[0]=Math.asin(d(2*(b[0]*b[3]-b[1]*b[2]),-1,1)),a[1]=Math.atan2(2*(b[0]*b[2]+b[1]*b[3]),k-e-f+g),a[2]=Math.atan2(2*(b[0]*b[1]+b[2]*b[3]),k-e+f-g)):"ZXY"===c?(a[0]=Math.asin(d(2*(b[0]*b[3]+b[1]*b[2]),-1,1)),a[1]=Math.atan2(2*(b[1]*b[3]-b[2]*b[0]),k-e-f+g),a[2]=Math.atan2(2*(b[2]*b[3]-b[0]*b[1]),k-e+f-g)):"ZYX"===c?(a[0]=Math.atan2(2*(b[0]*b[3]+b[2]*b[1]),k-e-f+g),a[1]=Math.asin(d(2*(b[1]*b[3]-b[0]*b[2]),-1,1)),a[2]=Math.atan2(2*(b[0]*b[1]+b[2]*b[3]),k+e-f-g)):"YZX"===c?(a[0]=Math.atan2(2*(b[0]*b[3]-
b[2]*b[1]),k-e+f-g),a[1]=Math.atan2(2*(b[1]*b[3]-b[0]*b[2]),k+e-f-g),a[2]=Math.asin(d(2*(b[0]*b[1]+b[2]*b[3]),-1,1))):"XZY"===c?(a[0]=Math.atan2(2*(b[0]*b[3]+b[1]*b[2]),k-e+f-g),a[1]=Math.atan2(2*(b[0]*b[2]+b[1]*b[3]),k+e-f-g),a[2]=Math.asin(d(2*(b[2]*b[3]-b[0]*b[1]),-1,1))):console.log("No order given for quaternion to euler conversion.")}var Q="undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{};$jscomp.initSymbol();var C=Symbol("@@webxr-polyfill/EventTarget"),
B=function(){this[C]={listeners:new Map}};B.prototype.addEventListener=function(a,b){if("string"!==typeof a)throw Error("`type` must be a string");if("function"!==typeof b)throw Error("`listener` must be a function");var c=this[C].listeners.get(a)||[];c.push(b);this[C].listeners.set(a,c)};B.prototype.removeEventListener=function(a,b){if("string"!==typeof a)throw Error("`type` must be a string");if("function"!==typeof b)throw Error("`listener` must be a function");a=this[C].listeners.get(a)||[];for(var c=
a.length;0<=c;c--)a[c]===b&&a.pop()};B.prototype.dispatchEvent=function(a,b){for(var c=this[C].listeners.get(a)||[],d=[],e=0;e<c.length;e++)d[e]=c[e];c=$jscomp.makeIterator(d);for(d=c.next();!d.done;d=c.next())d=d.value,d(b);if("function"===typeof this["on"+a])this["on"+a](b)};var H="undefined"!==typeof Float32Array?Float32Array:Array;(function(){var a=k();return function(b,c,d,e,f,g){c||(c=3);d||(d=0);for(e=e?Math.min(e*c+d,b.length):b.length;d<e;d+=c)a[0]=b[d],a[1]=b[d+1],a[2]=b[d+2],f(a,a,g),b[d]=
a[0],b[d+1]=a[1],b[d+2]=a[2];return b}})();(function(){var a=w();return function(b,c,d,e,f,g){c||(c=4);d||(d=0);for(e=e?Math.min(e*c+d,b.length):b.length;d<e;d+=c)a[0]=b[d],a[1]=b[d+1],a[2]=b[d+2],a[3]=b[d+3],f(a,a,g),b[d]=a[0],b[d+1]=a[1],b[d+2]=a[2],b[d+3]=a[3];return b}})();var N=function(a){var b=new H(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},D=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},J=function(a,b){var c=b[0],d=b[1],e=b[2];b=b[3];var f=c*c+d*d+e*e+b*b;0<f&&
(f=1/Math.sqrt(f),a[0]=c*f,a[1]=d*f,a[2]=e*f,a[3]=b*f);return a};(function(){var a=k(),b=p(1,0,0),c=p(0,1,0);return function(d,e,f){var g=u(e,f);if(-.999999>g){x(a,b,e);f=a[0];g=a[1];var k=a[2];1E-6>Math.sqrt(f*f+g*g+k*k)&&x(a,c,e);m(a,a);e=Math.PI;e*=.5;f=Math.sin(e);d[0]=f*a[0];d[1]=f*a[1];d[2]=f*a[2];d[3]=Math.cos(e);return d}if(.999999<g)return d[0]=0,d[1]=0,d[2]=0,d[3]=1,d;x(a,e,f);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=1+g;return J(d,d)}})();(function(){var a=z(),b=z();return function(c,d,e,f,g,
k){y(a,d,g,k);y(b,e,f,k);y(c,a,b,2*k*(1-k));return c}})();(function(){var a=v();return function(b,c,d,e){a[0]=d[0];a[3]=d[1];a[6]=d[2];a[1]=e[0];a[4]=e[1];a[7]=e[2];a[2]=-c[0];a[5]=-c[1];a[8]=-c[2];c=a[0]+a[4]+a[8];if(0<c)c=Math.sqrt(c+1),b[3]=.5*c,c=.5/c,b[0]=(a[5]-a[7])*c,b[1]=(a[6]-a[2])*c,b[2]=(a[1]-a[3])*c;else{d=0;a[4]>a[0]&&(d=1);a[8]>a[3*d+d]&&(d=2);e=(d+1)%3;var f=(d+2)%3;c=Math.sqrt(a[3*d+d]-a[3*e+e]-a[3*f+f]+1);b[d]=.5*c;c=.5/c;b[3]=(a[3*e+f]-a[3*f+e])*c;b[e]=(a[3*e+d]+a[3*d+e])*c;b[f]=
(a[3*f+d]+a[3*d+f])*c}return J(b,b)}})();if(!("DOMPointReadOnly"in window)){$jscomp.initSymbol();var L=Symbol("@@webxr-polyfill/DOMPointReadOnly"),W=function(a,b,c,d){if(1===arguments.length)this[L]={x:a.x,y:a.y,z:a.z,w:a.w};else if(4===arguments.length)this[L]={x:a,y:b,z:c,w:d};else throw new TypeError("Must supply either 1 or 4 arguments");};W.fromPoint=function(a){return new W(a.x,a.y,a.z,a.w)};$jscomp.global.Object.defineProperties(W.prototype,{x:{configurable:!0,enumerable:!0,get:function(){return this[L].x}},
y:{configurable:!0,enumerable:!0,get:function(){return this[L].y}},z:{configurable:!0,enumerable:!0,get:function(){return this[L].z}},w:{configurable:!0,enumerable:!0,get:function(){return this[L].w}}});window.DOMPointReadOnly=W}$jscomp.initSymbol();var M=Symbol("@@webxr-polyfill/XRRigidTransform"),R=function(){this[M]={matrix:null,position:null,orientation:null,inverse:null};if(0===arguments.length)this[M].matrix=b(new Float32Array(16));else if(1===arguments.length)arguments[0]instanceof Float32Array?
this[M].matrix=arguments[0]:(this[M].position=this._getPoint(arguments[0]),this[M].orientation=DOMPointReadOnly.fromPoint({x:0,y:0,z:0,w:1}));else if(2===arguments.length)this[M].position=this._getPoint(arguments[0]),this[M].orientation=this._getPoint(arguments[1]);else throw Error("Too many arguments!");if(this[M].matrix){var a=k();g(a,this[M].matrix);this[M].position=DOMPointReadOnly.fromPoint({x:a[0],y:a[1],z:a[2]});a=z();f(a,this[M].matrix);this[M].orientation=DOMPointReadOnly.fromPoint({x:a[0],
y:a[1],z:a[2],w:a[3]})}else{this[M].matrix=b(new Float32Array(16));a=this[M].matrix;var c=this[M].orientation.x,d=this[M].orientation.y,h=this[M].orientation.z,m=this[M].orientation.w,l=new H(4);l[0]=c;l[1]=d;l[2]=h;l[3]=m;e(a,l,p(this[M].position.x,this[M].position.y,this[M].position.z))}};R.prototype._getPoint=function(a){return a instanceof DOMPointReadOnly?a:DOMPointReadOnly.fromPoint(a)};$jscomp.global.Object.defineProperties(R.prototype,{matrix:{configurable:!0,enumerable:!0,get:function(){return this[M].matrix}},
position:{configurable:!0,enumerable:!0,get:function(){return this[M].position}},orientation:{configurable:!0,enumerable:!0,get:function(){return this[M].orientation}},inverse:{configurable:!0,enumerable:!0,get:function(){if(null===this[M].inverse){var a=b(new Float32Array(16));c(a,this[M].matrix);this[M].inverse=new R(a);this[M].inverse[M].inverse=this}return this[M].inverse}}});$jscomp.initSymbol();var F=Symbol("@@webxr-polyfill/XRSpace"),P=function(a,b){this[F]={specialType:void 0===a?null:a,inputSource:void 0===
b?null:b,baseMatrix:null,inverseBaseMatrix:null,lastFrameId:-1}};P.prototype._ensurePoseUpdated=function(a,b){b!=this[F].lastFrameId&&(this[F].lastFrameId=b,this._onPoseUpdate(a))};P.prototype._onPoseUpdate=function(a){"viewer"==this[F].specialType&&(this._baseMatrix=a.getBasePoseMatrix())};P.prototype._getSpaceRelativeTransform=function(a){if(!this._inverseBaseMatrix||!a._baseMatrix)return null;var b=new Float32Array(16);d(b,this._inverseBaseMatrix,a._baseMatrix);return new R(b)};$jscomp.global.Object.defineProperties(P.prototype,
{_specialType:{configurable:!0,enumerable:!0,get:function(){return this[F].specialType}},_inputSource:{configurable:!0,enumerable:!0,get:function(){return this[F].inputSource}},_baseMatrix:{configurable:!0,enumerable:!0,set:function(a){this[F].baseMatrix=a;this[F].inverseBaseMatrix=null},get:function(){!this[F].baseMatrix&&this[F].inverseBaseMatrix&&(this[F].baseMatrix=new Float32Array(16),c(this[F].baseMatrix,this[F].inverseBaseMatrix));return this[F].baseMatrix}},_inverseBaseMatrix:{configurable:!0,
enumerable:!0,set:function(a){this[F].inverseBaseMatrix=a;this[F].baseMatrix=null},get:function(){!this[F].inverseBaseMatrix&&this[F].baseMatrix&&(this[F].inverseBaseMatrix=new Float32Array(16),c(this[F].inverseBaseMatrix,this[F].baseMatrix));return this[F].inverseBaseMatrix}}});$jscomp.initSymbol();var V=Symbol("@@webxr-polyfill/XRReferenceSpace"),aa=["viewer","local","local-floor","bounded-floor","unbounded"],U=function(a,c){c=void 0===c?null:c;if(!aa.includes(a))throw Error("XRReferenceSpaceType must be one of "+
aa);var d=P.call(this,a)||this;if("bounded-floor"===a&&!c)throw Error("XRReferenceSpace cannot use 'bounded-floor' type if the platform does not provide the floor level");"bounded-floor"!==a&&"local-floor"!==a||c||(c=b(new Float32Array(16)),c[13]=1.6);d._inverseBaseMatrix=c||b(new Float32Array(16));d[V]={type:a,transform:c,originOffset:b(new Float32Array(16))};return d};$jscomp.inherits(U,P);U.prototype._transformBasePoseMatrix=function(a,b){d(a,this._inverseBaseMatrix,b)};U.prototype._originOffsetMatrix=
function(){return this[V].originOffset};U.prototype._adjustForOriginOffset=function(a){var b=new Float32Array(16);c(b,this[V].originOffset);d(a,b,a)};U.prototype._getSpaceRelativeTransform=function(a){a=P.prototype._getSpaceRelativeTransform.call(this,a);this._adjustForOriginOffset(a.matrix);return new XRRigidTransform(a.matrix)};U.prototype.getOffsetReferenceSpace=function(a){var b=new U(this[V].type,this[V].transform,this[V].bounds);d(b[V].originOffset,this[V].originOffset,a.matrix);return b};$jscomp.initSymbol();
var X=Symbol("@@webxr-polyfill/XR"),S=["inline","immersive-vr","immersive-ar"],da={inline:{requiredFeatures:["viewer"],optionalFeatures:[]},"immersive-vr":{requiredFeatures:["viewer","local"],optionalFeatures:[]},"immersive-ar":{requiredFeatures:["viewer","local"],optionalFeatures:[]}},ba=function(a){var b=B.call(this)||this;b[X]={device:null,devicePromise:a,immersiveSession:null,inlineSessions:new Set};a.then(function(a){b[X].device=a});return b};$jscomp.inherits(ba,B);ba.prototype.isSessionSupported=
function(a){var b=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){return 1==c.nextAddress?b[X].device?c.jumpTo(2):c.yield(b[X].devicePromise,2):"inline"!=a?c.return(Promise.resolve(b[X].device.isSessionSupported(a))):c.return(Promise.resolve(!0))})};ba.prototype.requestSession=function(a,b){var c=this,d,e,f,g,k,h,m,l,n,q,r,p,u;return $jscomp.asyncExecutePromiseGeneratorProgram(function(t){if(1==t.nextAddress){if(c[X].device)return t.jumpTo(2);if("inline"!=a)throw Error("Polyfill Error: Must call navigator.xr.isSessionSupported() with any XRSessionMode\nor navigator.xr.requestSession('inline') prior to requesting an immersive\nsession. This is a limitation specific to the WebXR Polyfill and does not apply\nto native implementations of the API.");
return t.yield(c[X].devicePromise,2)}if(5!=t.nextAddress){if(!S.includes(a))throw new TypeError("The provided value '"+a+"' is not a valid enum value of type XRSessionMode");d=da[a];e=d.requiredFeatures.concat(b&&b.requiredFeatures?b.requiredFeatures:[]);f=d.optionalFeatures.concat(b&&b.optionalFeatures?b.optionalFeatures:[]);g=new Set;k=!1;h=$jscomp.makeIterator(e);for(m=h.next();!m.done;m=h.next())l=m.value,c[X].device.isFeatureSupported(l)?g.add(l):(console.error("The required feature '"+l+"' is not supported"),
k=!0);if(k)throw new DOMException("Session does not support some required features","NotSupportedError");n=$jscomp.makeIterator(f);for(m=n.next();!m.done;m=n.next())q=m.value,c[X].device.isFeatureSupported(q)?g.add(q):console.log("The optional feature '"+q+"' is not supported");return t.yield(c[X].device.requestSession(a,g),5)}r=t.yieldResult;p=new XRSession(c[X].device,a,r);"inline"==a?c[X].inlineSessions.add(p):c[X].immersiveSession=p;u=function(){"inline"==a?c[X].inlineSessions.delete(p):c[X].immersiveSession=
null;p.removeEventListener("end",u)};p.addEventListener("end",u);return t.return(p)})};if(!1==="performance"in Q){var ea=Date.now();var ia=function(){return Date.now()-ea}}else ia=function(){return performance.now()};var la=ia;$jscomp.initSymbol();var fa=Symbol("@@webxr-polyfill/XRPose"),ha=function(a,b){this[fa]={transform:a,emulatedPosition:b}};$jscomp.global.Object.defineProperties(ha.prototype,{transform:{configurable:!0,enumerable:!0,get:function(){return this[fa].transform}},emulatedPosition:{configurable:!0,
enumerable:!0,get:function(){return this[fa].emulatedPosition}}});$jscomp.initSymbol();var ya=Symbol("@@webxr-polyfill/XRViewerPose"),Z=function(a,b,c){a=ha.call(this,a,void 0===c?!1:c)||this;a[ya]={views:b};return a};$jscomp.inherits(Z,ha);$jscomp.global.Object.defineProperties(Z.prototype,{views:{configurable:!0,enumerable:!0,get:function(){return this[ya].views}}});$jscomp.initSymbol();var ua=Symbol("@@webxr-polyfill/XRViewport"),qa=function(a){this[ua]={target:a}};$jscomp.global.Object.defineProperties(qa.prototype,
{x:{configurable:!0,enumerable:!0,get:function(){return this[ua].target.x}},y:{configurable:!0,enumerable:!0,get:function(){return this[ua].target.y}},width:{configurable:!0,enumerable:!0,get:function(){return this[ua].target.width}},height:{configurable:!0,enumerable:!0,get:function(){return this[ua].target.height}}});var xa=["left","right","none"];$jscomp.initSymbol();var pa=Symbol("@@webxr-polyfill/XRView"),wa=function(a,b,c,d){if(!xa.includes(c))throw Error("XREye must be one of: "+xa);var e=
Object.create(null),f=new qa(e);this[pa]={device:a,eye:c,viewport:f,temp:e,sessionId:d,transform:b}};wa.prototype._getViewport=function(a){if(this[pa].device.getViewport(this[pa].sessionId,this.eye,a,this[pa].temp))return this[pa].viewport};$jscomp.global.Object.defineProperties(wa.prototype,{eye:{configurable:!0,enumerable:!0,get:function(){return this[pa].eye}},projectionMatrix:{configurable:!0,enumerable:!0,get:function(){return this[pa].device.getProjectionMatrix(this.eye)}},transform:{configurable:!0,
enumerable:!0,get:function(){return this[pa].transform}}});$jscomp.initSymbol();var ka=Symbol("@@webxr-polyfill/XRFrame"),Ha=0,Ba=function(a,b,c){this[ka]={id:++Ha,active:!1,animationFrame:!1,device:a,session:b,sessionId:c}};Ba.prototype.getViewerPose=function(a){if(!this[ka].animationFrame)throw new DOMException("getViewerPose can only be called on XRFrame objects passed to XRSession.requestAnimationFrame callbacks.","InvalidStateError");if(!this[ka].active)throw new DOMException("XRFrame access outside the callback that produced it is invalid.",
"InvalidStateError");var b=this[ka].device,c=this[ka].session;c[G].viewerSpace._ensurePoseUpdated(b,this[ka].id);a._ensurePoseUpdated(b,this[ka].id);var d=a._getSpaceRelativeTransform(c[G].viewerSpace),e=[];c=$jscomp.makeIterator(c[G].viewSpaces);for(var f=c.next();!f.done;f=c.next()){f=f.value;f._ensurePoseUpdated(b,this[ka].id);var g=a._getSpaceRelativeTransform(f);f=new wa(b,g,f.eye,this[ka].sessionId);e.push(f)}return new Z(d,e,!1)};Ba.prototype.getPose=function(a,b){if(!this[ka].active)throw new DOMException("XRFrame access outside the callback that produced it is invalid.",
"InvalidStateError");var c=this[ka].device;if("target-ray"===a._specialType||"grip"===a._specialType)return c.getInputPose(a._inputSource,b,a._specialType);a._ensurePoseUpdated(c,this[ka].id);b._ensurePoseUpdated(c,this[ka].id);return(a=b._getSpaceRelativeTransform(a))?new XRPose(a,!1):null};$jscomp.global.Object.defineProperties(Ba.prototype,{session:{configurable:!0,enumerable:!0,get:function(){return this[ka].session}}});$jscomp.initSymbol();var Aa=Symbol("@@webxr-polyfill/XRRenderState"),ta=Object.freeze({depthNear:.1,
depthFar:1E3,inlineVerticalFieldOfView:null,baseLayer:null}),za=function(a){a=void 0===a?{}:a;a=Object.assign({},ta,a);this[Aa]={config:a}};$jscomp.global.Object.defineProperties(za.prototype,{depthNear:{configurable:!0,enumerable:!0,get:function(){return this[Aa].config.depthNear}},depthFar:{configurable:!0,enumerable:!0,get:function(){return this[Aa].config.depthFar}},inlineVerticalFieldOfView:{configurable:!0,enumerable:!0,get:function(){return this[Aa].config.inlineVerticalFieldOfView}},baseLayer:{configurable:!0,
enumerable:!0,get:function(){return this[Aa].config.baseLayer}}});$jscomp.initSymbol();var ca=Symbol("@@webxr-polyfill/polyfilled-xr-compatible");$jscomp.initSymbol();var Ca=Symbol("@@webxr-polyfill/xr-compatible");$jscomp.initSymbol();var sa=Symbol("@@webxr-polyfill/XRWebGLLayer"),Ma=Object.freeze({antialias:!0,depth:!1,stencil:!1,alpha:!0,multiview:!1,ignoreDepthValues:!1,framebufferScaleFactor:1}),Ka=function(a,b,c){c=void 0===c?{}:c;c=Object.assign({},Ma,c);if(!(a instanceof Ea))throw Error("session must be a XRSession");
if(a.ended)throw Error("InvalidStateError");if(b[ca]&&!0!==b[Ca])throw Error("InvalidStateError");var d=b.getParameter(b.FRAMEBUFFER_BINDING);this[sa]={context:b,config:c,framebuffer:d,session:a}};Ka.prototype.getViewport=function(a){return a._getViewport(this)};Ka.getNativeFramebufferScaleFactor=function(a){if(!a)throw new TypeError("getNativeFramebufferScaleFactor must be passed a session.");return a[G].ended?0:1};$jscomp.global.Object.defineProperties(Ka.prototype,{context:{configurable:!0,enumerable:!0,
get:function(){return this[sa].context}},antialias:{configurable:!0,enumerable:!0,get:function(){return this[sa].config.antialias}},ignoreDepthValues:{configurable:!0,enumerable:!0,get:function(){return!0}},framebuffer:{configurable:!0,enumerable:!0,get:function(){return this[sa].framebuffer}},framebufferWidth:{configurable:!0,enumerable:!0,get:function(){return this[sa].context.drawingBufferWidth}},framebufferHeight:{configurable:!0,enumerable:!0,get:function(){return this[sa].context.drawingBufferHeight}},
_session:{configurable:!0,enumerable:!0,get:function(){return this[sa].session}}});$jscomp.initSymbol();var Oa=Symbol("@@webxr-polyfill/XRInputSourceEvent");$jscomp.initSymbol();var Ya=Symbol("@@webxr-polyfill/XRSessionEvent");$jscomp.initSymbol();var Pa=Symbol("@@webxr-polyfill/XRInputSourcesChangeEvent");$jscomp.initSymbol();var G=Symbol("@@webxr-polyfill/XRSession"),La=function(a){return P.call(this,a)||this};$jscomp.inherits(La,P);La.prototype._onPoseUpdate=function(a){this._inverseBaseMatrix=
a.getBaseViewMatrix(this._specialType)};$jscomp.global.Object.defineProperties(La.prototype,{eye:{configurable:!0,enumerable:!0,get:function(){return this._specialType}}});var Ea=function(a,b,c){var d=B.call(this)||this;var e="inline"!=b,f=new za({inlineVerticalFieldOfView:e?null:.5*Math.PI});d[G]={device:a,mode:b,immersive:e,ended:!1,suspended:!1,frameCallbacks:[],currentFrameCallbacks:null,frameHandle:0,deviceFrameHandle:null,id:c,activeRenderState:f,pendingRenderState:null,viewerSpace:new U("viewer"),
viewSpaces:[],currentInputSources:[]};e?d[G].viewSpaces.push(new La("left"),new La("right")):d[G].viewSpaces.push(new La("none"));d[G].onDeviceFrame=function(){if(!d[G].ended&&!d[G].suspended){d[G].deviceFrameHandle=null;d[G].startDeviceFrameLoop();if(null!==d[G].pendingRenderState&&(d[G].activeRenderState=new za(d[G].pendingRenderState),d[G].pendingRenderState=null,d[G].activeRenderState.baseLayer))d[G].device.onBaseLayerSet(d[G].id,d[G].activeRenderState.baseLayer);if(null!==d[G].activeRenderState.baseLayer){var b=
new Ba(a,d,d[G].id),c=d[G].currentFrameCallbacks=d[G].frameCallbacks;d[G].frameCallbacks=[];b[ka].active=!0;b[ka].animationFrame=!0;d[G].device.onFrameStart(d[G].id,d[G].activeRenderState);d._checkInputSourcesChange();for(var e=la(),f=0;f<c.length;f++)try{c[f].cancelled||"function"!==typeof c[f].callback||c[f].callback(e,b)}catch(ib){console.error(ib)}d[G].currentFrameCallbacks=null;b[ka].active=!1;d[G].device.onFrameEnd(d[G].id)}}};d[G].startDeviceFrameLoop=function(){null===d[G].deviceFrameHandle&&
(d[G].deviceFrameHandle=d[G].device.requestAnimationFrame(d[G].onDeviceFrame))};d[G].stopDeviceFrameLoop=function(){var a=d[G].deviceFrameHandle;null!==a&&(d[G].device.cancelAnimationFrame(a),d[G].deviceFrameHandle=null)};d[G].onPresentationEnd=function(b){b!==d[G].id?(d[G].suspended=!1,d[G].startDeviceFrameLoop(),d.dispatchEvent("focus",{session:d})):(d[G].ended=!0,d[G].stopDeviceFrameLoop(),a.removeEventListener("@@webxr-polyfill/vr-present-end",d[G].onPresentationEnd),a.removeEventListener("@@webxr-polyfill/vr-present-start",
d[G].onPresentationStart),a.removeEventListener("@@webxr-polyfill/input-select-start",d[G].onSelectStart),a.removeEventListener("@@webxr-polyfill/input-select-end",d[G].onSelectEnd),d.dispatchEvent("end",O("end",{session:d})))};a.addEventListener("@@webxr-polyfill/vr-present-end",d[G].onPresentationEnd);d[G].onPresentationStart=function(a){a!==d[G].id&&(d[G].suspended=!0,d[G].stopDeviceFrameLoop(),d.dispatchEvent("blur",{session:d}))};a.addEventListener("@@webxr-polyfill/vr-present-start",d[G].onPresentationStart);
d[G].onSelectStart=function(a){a.sessionId===d[G].id&&d[G].dispatchInputSourceEvent("selectstart",a.inputSource)};a.addEventListener("@@webxr-polyfill/input-select-start",d[G].onSelectStart);d[G].onSelectEnd=function(a){a.sessionId===d[G].id&&(d[G].dispatchInputSourceEvent("selectend",a.inputSource),d[G].dispatchInputSourceEvent("select",a.inputSource))};a.addEventListener("@@webxr-polyfill/input-select-end",d[G].onSelectEnd);d[G].onSqueezeStart=function(a){a.sessionId===d[G].id&&d[G].dispatchInputSourceEvent("squeezestart",
a.inputSource)};a.addEventListener("@@webxr-polyfill/input-squeeze-start",d[G].onSqueezeStart);d[G].onSqueezeEnd=function(a){a.sessionId===d[G].id&&(d[G].dispatchInputSourceEvent("squeezeend",a.inputSource),d[G].dispatchInputSourceEvent("squeeze",a.inputSource))};a.addEventListener("@@webxr-polyfill/input-squeeze-end",d[G].onSqueezeEnd);d[G].dispatchInputSourceEvent=function(b,c){var e=new Ba(a,d,d[G].id);c=I(b,{frame:e,inputSource:c});e[ka].active=!0;d.dispatchEvent(b,c);e[ka].active=!1};d[G].startDeviceFrameLoop();
d.onblur=void 0;d.onfocus=void 0;d.onresetpose=void 0;d.onend=void 0;d.onselect=void 0;d.onselectstart=void 0;d.onselectend=void 0;return d};$jscomp.inherits(Ea,B);Ea.prototype.requestReferenceSpace=function(a){var b=this,c,d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(e){if(1==e.nextAddress){if(b[G].ended)return e.return();if(!aa.includes(a))throw new TypeError("XRReferenceSpaceType must be one of "+aa);if(!b[G].device.doesSessionSupportReferenceSpace(b[G].id,a))throw new DOMException("The "+
a+" reference space is not supported by this session.","NotSupportedError");return"viewer"===a?e.return(b[G].viewerSpace):e.yield(b[G].device.requestFrameOfReferenceTransform(a),2)}c=e.yieldResult;if("bounded-floor"===a){if(!c)throw new DOMException(a+" XRReferenceSpace not supported by this device.","NotSupportedError");d=b[G].device.requestStageBounds();if(!d)throw new DOMException(a+" XRReferenceSpace not supported by this device.","NotSupportedError");throw new DOMException("The WebXR polyfill does not support the "+
a+" reference space yet.","NotSupportedError");}return e.return(new U(a,c))})};Ea.prototype.requestAnimationFrame=function(a){if(!this[G].ended){var b=++this[G].frameHandle;this[G].frameCallbacks.push({handle:b,callback:a,cancelled:!1});return b}};Ea.prototype.cancelAnimationFrame=function(a){var b=this[G].frameCallbacks,c=b.findIndex(function(b){return b&&b.handle===a});-1<c&&(b[c].cancelled=!0,b.splice(c,1));if(b=this[G].currentFrameCallbacks)c=b.findIndex(function(b){return b&&b.handle===a}),-1<
c&&(b[c].cancelled=!0)};Ea.prototype.end=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(b){if(a[G].ended)return b.return();a[G].immersive&&(a[G].ended=!0,a[G].device.removeEventListener("@@webxr-polyfill/vr-present-start",a[G].onPresentationStart),a[G].device.removeEventListener("@@webxr-polyfill/vr-present-end",a[G].onPresentationEnd),a[G].device.removeEventListener("@@webxr-polyfill/input-select-start",a[G].onSelectStart),a[G].device.removeEventListener("@@webxr-polyfill/input-select-end",
a[G].onSelectEnd),a.dispatchEvent("end",O("end",{session:a})));a[G].stopDeviceFrameLoop();return b.return(a[G].device.endSession(a[G].id))})};Ea.prototype.updateRenderState=function(a){if(this[G].ended)throw Error("Can't call updateRenderState on an XRSession that has already ended.");if(a.baseLayer&&a.baseLayer._session!==this)throw Error("Called updateRenderState with a base layer that was created by a different session.");if(null!==a.inlineVerticalFieldOfView&&void 0!==a.inlineVerticalFieldOfView){if(this[G].immersive)throw Error("inlineVerticalFieldOfView must not be set for an XRRenderState passed to updateRenderState for an immersive session.");
a.inlineVerticalFieldOfView=Math.min(3.13,Math.max(.01,a.inlineVerticalFieldOfView))}if(null===this[G].pendingRenderState){var b=this[G].activeRenderState;this[G].pendingRenderState={depthNear:b.depthNear,depthFar:b.depthFar,inlineVerticalFieldOfView:b.inlineVerticalFieldOfView,baseLayer:b.baseLayer}}Object.assign(this[G].pendingRenderState,a)};Ea.prototype._checkInputSourcesChange=function(){for(var a=[],b=[],c=this.inputSources,d=this[G].currentInputSources,e=$jscomp.makeIterator(c),f=e.next();!f.done;f=
e.next())f=f.value,d.includes(f)||a.push(f);d=$jscomp.makeIterator(d);for(e=d.next();!e.done;e=d.next())e=e.value,c.includes(e)||b.push(e);(0<a.length||0<b.length)&&this.dispatchEvent("inputsourceschange",K("inputsourceschange",{session:this,added:a,removed:b}));this[G].currentInputSources.length=0;a=$jscomp.makeIterator(c);for(f=a.next();!f.done;f=a.next())this[G].currentInputSources.push(f.value)};$jscomp.global.Object.defineProperties(Ea.prototype,{renderState:{configurable:!0,enumerable:!0,get:function(){return this[G].activeRenderState}},
environmentBlendMode:{configurable:!0,enumerable:!0,get:function(){return this[G].device.environmentBlendMode||"opaque"}},inputSources:{configurable:!0,enumerable:!0,get:function(){return this[G].device.getInputSources()}}});$jscomp.initSymbol();var Ga=Symbol("@@webxr-polyfill/XRInputSource"),Sa=function(a){this[Ga]={impl:a,gripSpace:new P("grip",this),targetRaySpace:new P("target-ray",this)}};$jscomp.global.Object.defineProperties(Sa.prototype,{handedness:{configurable:!0,enumerable:!0,get:function(){return this[Ga].impl.handedness}},
targetRayMode:{configurable:!0,enumerable:!0,get:function(){return this[Ga].impl.targetRayMode}},gripSpace:{configurable:!0,enumerable:!0,get:function(){var a=this[Ga].impl.targetRayMode;return"gaze"===a||"screen"===a?null:this[Ga].gripSpace}},targetRaySpace:{configurable:!0,enumerable:!0,get:function(){return this[Ga].targetRaySpace}},profiles:{configurable:!0,enumerable:!0,get:function(){return this[Ga].impl.profiles}},gamepad:{configurable:!0,enumerable:!0,get:function(){return this[Ga].impl.gamepad}}});
$jscomp.initSymbol();var Ta=Symbol("@@webxr-polyfill/XRReferenceSpaceEvent"),Ua={XRSystem:ba,XRSession:Ea,XRSessionEvent:O,XRFrame:Ba,XRView:wa,XRViewport:qa,XRViewerPose:Z,XRWebGLLayer:Ka,XRSpace:P,XRReferenceSpace:U,XRReferenceSpaceEvent:T,XRInputSource:Sa,XRInputSourceEvent:I,XRInputSourcesChangeEvent:K,XRRenderState:za,XRRigidTransform:R,XRPose:ha},Za=function(a){if("function"===typeof a.prototype.makeXRCompatible)return!1;a.prototype.makeXRCompatible=function(){this[Ca]=!0;return Promise.resolve()};
return!0},$a=function(a){var b=a.prototype.getContext;a.prototype.getContext=function(a,c){if(a=b.call(this,a,c))a[ca]=!0,c&&"xrCompatible"in c&&(a[Ca]=c.xrCompatible);return a}},jb=function(a){var b=!1;a=a.navigator.userAgent||a.navigator.vendor||a.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||
/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,
4)))b=!0;return b},Va="undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},lb=function(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a["default"]:a}(function(a,b){return b={exports:{}},a(b,b.exports),b.exports}(function(a,b){(function(b,c){a.exports=c()})(Va,function(){function a(a,b,c,d){this.gl=a;this.cardboardUI=b;this.bufferScale=c;this.dirtySubmitFrameBindings=d;this.ctxAttribs=a.getContextAttributes();this.instanceExt=
a.getExtension("ANGLE_instanced_arrays");this.meshHeight=this.meshWidth=20;this.bufferWidth=a.drawingBufferWidth;this.bufferHeight=a.drawingBufferHeight;this.realBindFramebuffer=a.bindFramebuffer;this.realEnable=a.enable;this.realDisable=a.disable;this.realColorMask=a.colorMask;this.realClearColor=a.clearColor;this.realViewport=a.viewport;v()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(a.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(a.canvas.__proto__,
"height"));this.isPatched=!1;this.lastBoundFramebuffer=null;this.stencilTest=this.scissorTest=this.blend=this.depthTest=this.cullFace=!1;this.viewport=[0,0,0,0];this.colorMask=[!0,!0,!0,!0];this.clearColor=[0,0,0,0];this.attribs={position:0,texCoord:1};this.program=W(a,"attribute vec2 position;\nattribute vec3 texCoord;\nvarying vec2 vTexCoord;\nuniform vec4 viewportOffsetScale[2];\nvoid main() {\n  vec4 viewport = viewportOffsetScale[int(texCoord.z)];\n  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;\n  gl_Position = vec4( position, 1.0, 1.0 );\n}",
"precision mediump float;\nuniform sampler2D diffuse;\nvarying vec2 vTexCoord;\nvoid main() {\n  gl_FragColor = texture2D(diffuse, vTexCoord);\n}",this.attribs);this.uniforms=aa(a,this.program);this.viewportOffsetScale=new Float32Array(8);this.setTextureBounds();this.vertexBuffer=a.createBuffer();this.indexBuffer=a.createBuffer();this.indexCount=0;this.renderTarget=a.createTexture();this.framebuffer=a.createFramebuffer();this.stencilBuffer=this.depthBuffer=this.depthStencilBuffer=null;this.ctxAttribs.depth&&
this.ctxAttribs.stencil?this.depthStencilBuffer=a.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=a.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=a.createRenderbuffer());this.patch();this.onResize()}function b(a){this.gl=a;this.attribs={position:0};this.program=W(a,"attribute vec2 position;\nuniform mat4 projectionMat;\nvoid main() {\n  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );\n}","precision mediump float;\nuniform vec4 color;\nvoid main() {\n  gl_FragColor = color;\n}",
this.attribs);this.uniforms=aa(a,this.program);this.vertexBuffer=a.createBuffer();this.arrowVertexCount=this.arrowOffset=this.gearVertexCount=this.gearOffset=0;this.projMat=new Float32Array(16);this.listener=null;this.onResize()}function c(a){this.coefficients=a}function d(a){this.width=a.width||ma();this.height=a.height||E();this.widthMeters=a.widthMeters;this.heightMeters=a.heightMeters;this.bevelMeters=a.bevelMeters}function e(a,b){this.viewer=T.CardboardV2;this.updateDeviceParams(a);this.distortion=
new c(this.viewer.distortionCoefficients);for(a=0;a<b.length;a++){var d=b[a];T[d.id]=new f(d)}}function f(a){this.id=a.id;this.label=a.label;this.fov=a.fov;this.interLensDistance=a.interLensDistance;this.baselineLensDistance=a.baselineLensDistance;this.screenLensDistance=a.screenLensDistance;this.distortionCoefficients=a.distortionCoefficients;this.inverseCoefficients=a.inverseCoefficients}function g(a,b){this.dpdb=Q;this.recalculateDeviceParams_();if(a){this.onDeviceParamsUpdated=b;var c=new XMLHttpRequest,
d=this;c.open("GET",a,!0);c.addEventListener("load",function(){d.loading=!1;200<=c.status&&299>=c.status?(d.dpdb=JSON.parse(c.response),d.recalculateDeviceParams_()):console.error("Error loading online DPDB!")});c.send()}}function k(a){this.xdpi=a.xdpi;this.ydpi=a.ydpi;this.bevelMm=a.bevelMm}function h(a,b){this.set(a,b)}function m(a,b){this.kFilter=a;this.isDebug=b;this.currentAccelMeasurement=new h;this.currentGyroMeasurement=new h;this.previousGyroMeasurement=new h;v()?this.filterQ=new J(-1,0,
0,1):this.filterQ=new J(1,0,0,1);this.previousFilterQ=new J;this.previousFilterQ.copy(this.filterQ);this.accelQ=new J;this.isOrientationInitialized=!1;this.estimatedGravity=new U;this.measuredGravity=new U;this.gyroIntegralQ=new J}function l(a,b){this.predictionTimeS=a;this.isDebug=b;this.previousQ=new J;this.previousTimestampS=null;this.deltaQ=new J;this.outQ=new J}function n(a,b,c,d){this.yawOnly=c;this.accelerometer=new U;this.gyroscope=new U;this.filter=new m(a,d);this.posePredictor=new l(b,d);
this.isFirefoxAndroid=z();this.isIOS=v();a=B();this.isDeviceMotionInRadians=!this.isIOS&&a&&66>a;this.isWithoutDeviceMotion=H()||C();this.filterToWorldQ=new J;v()?this.filterToWorldQ.setFromAxisAngle(new U(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new U(1,0,0),-Math.PI/2);this.inverseWorldToScreenQ=new J;this.worldToScreenQ=new J;this.originalPoseAdjustQ=new J;this.originalPoseAdjustQ.setFromAxisAngle(new U(0,0,1),-window.orientation*Math.PI/180);this.setScreenTransform_();F()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ);
this.resetQ=new J;this.orientationOut_=new Float32Array(4);this.start()}function q(){this.loadIcon_();var a=document.createElement("div"),b=a.style;b.position="fixed";b.top=0;b.right=0;b.bottom=0;b.left=0;b.backgroundColor="gray";b.fontFamily="sans-serif";b.zIndex=1E6;var c=document.createElement("img");c.src=this.icon;b=c.style;b.marginLeft="25%";b.marginTop="25%";b.width="50%";a.appendChild(c);c=document.createElement("div");b=c.style;b.textAlign="center";b.fontSize="16px";b.lineHeight="24px";b.margin=
"24px 25%";b.width="50%";c.innerHTML="Place your phone into your Cardboard viewer.";a.appendChild(c);var d=document.createElement("div");b=d.style;b.backgroundColor="#CFD8DC";b.position="fixed";b.bottom=0;b.width="100%";b.height="48px";b.padding="14px 24px";b.boxSizing="border-box";b.color="#656A6B";a.appendChild(d);var e=document.createElement("div");e.style.float="left";e.innerHTML="No Cardboard viewer?";var f=document.createElement("a");f.href="https://www.google.com/get/cardboard/get-cardboard/";
f.innerHTML="get one";f.target="_blank";b=f.style;b.float="right";b.fontWeight=600;b.textTransform="uppercase";b.borderLeft="1px solid gray";b.paddingLeft="24px";b.textDecoration="none";b.color="#656A6B";d.appendChild(e);d.appendChild(f);this.overlay=a;this.text=c;this.hide()}function r(a){try{this.selectedKey=localStorage.getItem("WEBVR_CARDBOARD_VIEWER")}catch(Ia){console.error("Failed to load viewer profile: %s",Ia)}this.selectedKey||(this.selectedKey=a||"CardboardV1");this.dialog=this.createDialog_(e.Viewers);
this.root=null;this.onChangeCallbacks_=[]}function p(a){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:a.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:a.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:a.canPresent},maxLayers:{writable:!1,enumerable:!0,value:a.maxLayers},hasOrientation:{enumerable:!0,get:function(){ea("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData");return a.hasOrientation}}})}function u(a){a=
a||{};a="wakelock"in a?a.wakelock:!0;this.isPolyfilled=!0;this.displayId=da++;this.displayName="";this.depthNear=.01;this.depthFar=1E4;this.isPresenting=!1;Object.defineProperty(this,"isConnected",{get:function(){ea("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay");return!1}});this.capabilities=new p({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1});this.stageParameters=null;this.waitingForPresent_=!1;this.fullscreenErrorHandler_=
this.fullscreenChangeHandler_=this.fullscreenEventTarget_=this.fullscreenElementCachedStyle_=this.fullscreenWrapper_=this.fullscreenElement_=this.originalParent_=this.layer_=null;a&&P()&&(this.wakelock_=new xa)}function t(a){var b=K({},ba);a=K(b,a||{});u.call(this,{wakelock:a.MOBILE_WAKE_LOCK});this.config=a;this.displayName="Cardboard VRDisplay";this.capabilities=new p({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1});this.stageParameters=null;this.bufferScale_=
this.config.BUFFER_SCALE;this.poseSensor_=new G(this.config);this.cardboardUI_=this.distorter_=null;this.dpdb_=new g(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this));this.deviceInfo_=new e(this.dpdb_.getDeviceParams(),a.ADDITIONAL_VIEWERS);this.viewerSelector_=new r(a.DEFAULT_VIEWER);this.viewerSelector_.onChange(this.onViewerChanged_.bind(this));this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer());this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new q);
v()&&window.addEventListener("resize",this.onResize_.bind(this))}var x=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),w=function(){return function(a,b){if(Array.isArray(a))return a;$jscomp.initSymbol();$jscomp.initSymbolIterator();if(Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{$jscomp.initSymbol();
$jscomp.initSymbolIterator();for(var g=a[Symbol.iterator](),k;!(d=(k=g.next()).done)&&(c.push(k.value),!b||c.length!==b);d=!0);}catch(kb){e=!0,f=kb}finally{try{if(!d&&g["return"])g["return"]()}finally{if(e)throw f;}}return c}throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),v=function(){var a=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return a}}(),A=function(){var a=-1!==navigator.userAgent.indexOf("Version")&&-1!==navigator.userAgent.indexOf("Android")&&
-1!==navigator.userAgent.indexOf("Chrome");return function(){return a}}(),y=function(){var a=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return a}}(),z=function(){var a=-1!==navigator.userAgent.indexOf("Firefox")&&-1!==navigator.userAgent.indexOf("Android");return function(){return a}}(),B=function(){var a=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),b=a?parseInt(a[1],10):null;return function(){return b}}(),C=function(){var a=!1;a=v()&&y()&&-1!==navigator.userAgent.indexOf("13_4");
return function(){return a}}(),H=function(){var a=!1;if(65===B()){var b=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(b){b=b[1].split(".");b=w(b,4);var c=b[3];a=3325===parseInt(b[2],10)&&148>parseInt(c,10)}}return function(){return a}}(),Z=function(){var a=-1!==navigator.userAgent.indexOf("R7 Build");return function(){return a}}(),F=function(){var a=90==window.orientation||-90==window.orientation;return Z()?!a:a},ma=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},
E=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},D=function(a){if(A())return!1;if(a.requestFullscreen)a.requestFullscreen();else if(a.webkitRequestFullscreen)a.webkitRequestFullscreen();else if(a.mozRequestFullScreen)a.mozRequestFullScreen();else if(a.msRequestFullscreen)a.msRequestFullscreen();else return!1;return!0},I=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();
else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else if(document.msExitFullscreen)document.msExitFullscreen();else return!1;return!0},W=function(a,b,c,d){var e=a.createShader(a.VERTEX_SHADER);a.shaderSource(e,b);a.compileShader(e);b=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(b,c);a.compileShader(b);c=a.createProgram();a.attachShader(c,e);a.attachShader(c,b);for(var f in d)a.bindAttribLocation(c,d[f],f);a.linkProgram(c);a.deleteShader(e);a.deleteShader(b);return c},aa=function(a,
b){for(var c={},d=a.getProgramParameter(b,a.ACTIVE_UNIFORMS),e,f=0;f<d;f++)e=a.getActiveUniform(b,f).name.replace("[0]",""),c[e]=a.getUniformLocation(b,e);return c},P=function(){var a=!1,b=navigator.userAgent||navigator.vendor||window.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(b)||
/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,
4)))a=!0;return a},K=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},ia=function(a){if(v()){var b=a.style.width,c=a.style.height;a.style.width=parseInt(b)+1+"px";a.style.height=parseInt(c)+"px";setTimeout(function(){a.style.width=b;a.style.height=c},100)}window.canvas=a},M=function(){function a(a,f,g,k,h,m){var l=k||null;k=m.depthNear;m=m.depthFar;var n=Math.tan(l?l.upDegrees*b:c),q=Math.tan(l?l.downDegrees*b:c),r=Math.tan(l?l.leftDegrees*b:c);l=Math.tan(l?l.rightDegrees*b:
c);var p=2/(r+l),u=2/(n+q);a[0]=p;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=u;a[6]=0;a[7]=0;a[8]=-((r-l)*p*.5);a[9]=(n-q)*u*.5;a[10]=m/(k-m);a[11]=-1;a[12]=0;a[13]=0;a[14]=m*k/(k-m);a[15]=0;a=g.orientation||d;g=g.position||e;q=a[0];p=a[1];u=a[2];m=a[3];var t=q+q;l=p+p;n=u+u;a=q*t;k=q*l;q*=n;r=p*l;p*=n;u*=n;t*=m;l*=m;m*=n;f[0]=1-(r+u);f[1]=k+m;f[2]=q-l;f[3]=0;f[4]=k-m;f[5]=1-(a+u);f[6]=p+t;f[7]=0;f[8]=q+l;f[9]=p-t;f[10]=1-(a+r);f[11]=0;f[12]=g[0];f[13]=g[1];f[14]=g[2];f[15]=1;if(h)if(g=h[0],a=h[1],h=h[2],f===
f)f[12]=f[0]*g+f[4]*a+f[8]*h+f[12],f[13]=f[1]*g+f[5]*a+f[9]*h+f[13],f[14]=f[2]*g+f[6]*a+f[10]*h+f[14],f[15]=f[3]*g+f[7]*a+f[11]*h+f[15];else{k=f[0];m=f[1];n=f[2];q=f[3];r=f[4];l=f[5];p=f[6];u=f[7];t=f[8];var Da=f[9];var x=f[10];var w=f[11];f[0]=k;f[1]=m;f[2]=n;f[3]=q;f[4]=r;f[5]=l;f[6]=p;f[7]=u;f[8]=t;f[9]=Da;f[10]=x;f[11]=w;f[12]=k*g+r*a+t*h+f[12];f[13]=m*g+l*a+Da*h+f[13];f[14]=n*g+p*a+x*h+f[14];f[15]=q*g+u*a+w*h+f[15]}h=f[0];g=f[1];a=f[2];k=f[3];m=f[4];n=f[5];q=f[6];r=f[7];l=f[8];p=f[9];u=f[10];
t=f[11];Da=f[12];x=f[13];w=f[14];var v=f[15],Ia=h*n-g*m,A=h*q-a*m,Fa=h*r-k*m,y=g*q-a*n,z=g*r-k*n,B=a*r-k*q,C=l*x-p*Da,H=l*w-u*Da,Z=l*v-t*Da,F=p*w-u*x,ma=p*v-t*x,E=u*v-t*w,D=Ia*E-A*ma+Fa*F+y*Z-z*H+B*C;D&&(D=1/D,f[0]=(n*E-q*ma+r*F)*D,f[1]=(a*ma-g*E-k*F)*D,f[2]=(x*B-w*z+v*y)*D,f[3]=(u*z-p*B-t*y)*D,f[4]=(q*Z-m*E-r*H)*D,f[5]=(h*E-a*Z+k*H)*D,f[6]=(w*Fa-Da*B-v*A)*D,f[7]=(l*B-u*Fa+t*A)*D,f[8]=(m*ma-n*Z+r*C)*D,f[9]=(g*Z-h*ma-k*C)*D,f[10]=(Da*z-x*Fa+v*Ia)*D,f[11]=(p*Fa-l*z-t*Ia)*D,f[12]=(n*H-m*F-q*C)*D,f[13]=
(h*F-g*H+a*C)*D,f[14]=(x*A-Da*y-w*Ia)*D,f[15]=(l*y-p*A+u*Ia)*D)}var b=Math.PI/180,c=.25*Math.PI,d=new Float32Array([0,0,0,1]),e=new Float32Array([0,0,0]);return function(b,c,d){if(!b||!c)return!1;b.pose=c;b.timestamp=c.timestamp;a(b.leftProjectionMatrix,b.leftViewMatrix,c,d._getFieldOfView("left"),d._getEyeOffset("left"),d);a(b.rightProjectionMatrix,b.rightViewMatrix,c,d._getFieldOfView("right"),d._getEyeOffset("right"),d);return!0}}(),O=function(a){var b=a.indexOf("://");b=a.indexOf("/",-1!==b?b+
3:0);-1===b&&(b=a.length);return a.substring(0,b)},N=function(a){return 1<a.w?(console.warn("getQuaternionAngle: w > 1"),0):2*Math.acos(a.w)},ja=function(){var a={};return function(b,c){void 0===a[b]&&(console.warn("webvr-polyfill: "+c),a[b]=!0)}}(),ea=function(a,b){ja(a,a+" has been deprecated. This may not work on native WebVR displays. "+(b?"Please use "+b+" instead.":""))},R=function(a,b,c){if(b){for(var d=[],f=null,e=0;e<b.length;++e){var g=b[e];switch(g){case a.TEXTURE_BINDING_2D:case a.TEXTURE_BINDING_CUBE_MAP:var k=
b[++e];if(k<a.TEXTURE0||k>a.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit");d.push(null,null);break}f||(f=a.getParameter(a.ACTIVE_TEXTURE));a.activeTexture(k);d.push(a.getParameter(g),null);break;case a.ACTIVE_TEXTURE:f=a.getParameter(a.ACTIVE_TEXTURE);d.push(null);break;default:d.push(a.getParameter(g))}}c(a);for(e=0;e<b.length;++e){g=b[e];c=d[e];switch(g){case a.ACTIVE_TEXTURE:break;case a.ARRAY_BUFFER_BINDING:a.bindBuffer(a.ARRAY_BUFFER,
c);break;case a.COLOR_CLEAR_VALUE:a.clearColor(c[0],c[1],c[2],c[3]);break;case a.COLOR_WRITEMASK:a.colorMask(c[0],c[1],c[2],c[3]);break;case a.CURRENT_PROGRAM:a.useProgram(c);break;case a.ELEMENT_ARRAY_BUFFER_BINDING:a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,c);break;case a.FRAMEBUFFER_BINDING:a.bindFramebuffer(a.FRAMEBUFFER,c);break;case a.RENDERBUFFER_BINDING:a.bindRenderbuffer(a.RENDERBUFFER,c);break;case a.TEXTURE_BINDING_2D:k=b[++e];if(k<a.TEXTURE0||k>a.TEXTURE31)break;a.activeTexture(k);a.bindTexture(a.TEXTURE_2D,
c);break;case a.TEXTURE_BINDING_CUBE_MAP:k=b[++e];if(k<a.TEXTURE0||k>a.TEXTURE31)break;a.activeTexture(k);a.bindTexture(a.TEXTURE_CUBE_MAP,c);break;case a.VIEWPORT:a.viewport(c[0],c[1],c[2],c[3]);break;case a.BLEND:case a.CULL_FACE:case a.DEPTH_TEST:case a.SCISSOR_TEST:case a.STENCIL_TEST:c?a.enable(g):a.disable(g);break;default:console.log("No GL restore behavior for 0x"+g.toString(16))}f&&a.activeTexture(f)}}else c(a)};a.prototype.destroy=function(){var a=this.gl;this.unpatch();a.deleteProgram(this.program);
a.deleteBuffer(this.vertexBuffer);a.deleteBuffer(this.indexBuffer);a.deleteTexture(this.renderTarget);a.deleteFramebuffer(this.framebuffer);this.depthStencilBuffer&&a.deleteRenderbuffer(this.depthStencilBuffer);this.depthBuffer&&a.deleteRenderbuffer(this.depthBuffer);this.stencilBuffer&&a.deleteRenderbuffer(this.stencilBuffer);this.cardboardUI&&this.cardboardUI.destroy()};a.prototype.onResize=function(){var a=this.gl,b=this;R(a,[a.RENDERBUFFER_BINDING,a.TEXTURE_BINDING_2D,a.TEXTURE0],function(a){b.realBindFramebuffer.call(a,
a.FRAMEBUFFER,null);b.scissorTest&&b.realDisable.call(a,a.SCISSOR_TEST);b.realColorMask.call(a,!0,!0,!0,!0);b.realViewport.call(a,0,0,a.drawingBufferWidth,a.drawingBufferHeight);b.realClearColor.call(a,0,0,0,1);a.clear(a.COLOR_BUFFER_BIT);b.realBindFramebuffer.call(a,a.FRAMEBUFFER,b.framebuffer);a.bindTexture(a.TEXTURE_2D,b.renderTarget);a.texImage2D(a.TEXTURE_2D,0,b.ctxAttribs.alpha?a.RGBA:a.RGB,b.bufferWidth,b.bufferHeight,0,b.ctxAttribs.alpha?a.RGBA:a.RGB,a.UNSIGNED_BYTE,null);a.texParameteri(a.TEXTURE_2D,
a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,b.renderTarget,0);b.ctxAttribs.depth&&b.ctxAttribs.stencil?(a.bindRenderbuffer(a.RENDERBUFFER,b.depthStencilBuffer),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_STENCIL,b.bufferWidth,b.bufferHeight),a.framebufferRenderbuffer(a.FRAMEBUFFER,
a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,b.depthStencilBuffer)):b.ctxAttribs.depth?(a.bindRenderbuffer(a.RENDERBUFFER,b.depthBuffer),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,b.bufferWidth,b.bufferHeight),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,b.depthBuffer)):b.ctxAttribs.stencil&&(a.bindRenderbuffer(a.RENDERBUFFER,b.stencilBuffer),a.renderbufferStorage(a.RENDERBUFFER,a.STENCIL_INDEX8,b.bufferWidth,b.bufferHeight),a.framebufferRenderbuffer(a.FRAMEBUFFER,
a.STENCIL_ATTACHMENT,a.RENDERBUFFER,b.stencilBuffer));!a.checkFramebufferStatus(a.FRAMEBUFFER)===a.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!");b.realBindFramebuffer.call(a,a.FRAMEBUFFER,b.lastBoundFramebuffer);b.scissorTest&&b.realEnable.call(a,a.SCISSOR_TEST);b.realColorMask.apply(a,b.colorMask);b.realViewport.apply(a,b.viewport);b.realClearColor.apply(a,b.clearColor)});if(this.cardboardUI)this.cardboardUI.onResize()};a.prototype.patch=function(){if(!this.isPatched){var a=this,
b=this.gl.canvas,c=this.gl;v()||(b.width=ma()*this.bufferScale,b.height=E()*this.bufferScale,Object.defineProperty(b,"width",{configurable:!0,enumerable:!0,get:function(){return a.bufferWidth},set:function(c){a.bufferWidth=c;a.realCanvasWidth.set.call(b,c);a.onResize()}}),Object.defineProperty(b,"height",{configurable:!0,enumerable:!0,get:function(){return a.bufferHeight},set:function(c){a.bufferHeight=c;a.realCanvasHeight.set.call(b,c);a.onResize()}}));this.lastBoundFramebuffer=c.getParameter(c.FRAMEBUFFER_BINDING);
null==this.lastBoundFramebuffer&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(c.FRAMEBUFFER,this.framebuffer));this.gl.bindFramebuffer=function(b,d){a.lastBoundFramebuffer=d?d:a.framebuffer;a.realBindFramebuffer.call(c,b,a.lastBoundFramebuffer)};this.cullFace=c.getParameter(c.CULL_FACE);this.depthTest=c.getParameter(c.DEPTH_TEST);this.blend=c.getParameter(c.BLEND);this.scissorTest=c.getParameter(c.SCISSOR_TEST);this.stencilTest=c.getParameter(c.STENCIL_TEST);c.enable=function(b){switch(b){case c.CULL_FACE:a.cullFace=
!0;break;case c.DEPTH_TEST:a.depthTest=!0;break;case c.BLEND:a.blend=!0;break;case c.SCISSOR_TEST:a.scissorTest=!0;break;case c.STENCIL_TEST:a.stencilTest=!0}a.realEnable.call(c,b)};c.disable=function(b){switch(b){case c.CULL_FACE:a.cullFace=!1;break;case c.DEPTH_TEST:a.depthTest=!1;break;case c.BLEND:a.blend=!1;break;case c.SCISSOR_TEST:a.scissorTest=!1;break;case c.STENCIL_TEST:a.stencilTest=!1}a.realDisable.call(c,b)};this.colorMask=c.getParameter(c.COLOR_WRITEMASK);c.colorMask=function(b,d,f,
e){a.colorMask[0]=b;a.colorMask[1]=d;a.colorMask[2]=f;a.colorMask[3]=e;a.realColorMask.call(c,b,d,f,e)};this.clearColor=c.getParameter(c.COLOR_CLEAR_VALUE);c.clearColor=function(b,d,f,e){a.clearColor[0]=b;a.clearColor[1]=d;a.clearColor[2]=f;a.clearColor[3]=e;a.realClearColor.call(c,b,d,f,e)};this.viewport=c.getParameter(c.VIEWPORT);c.viewport=function(b,d,f,e){a.viewport[0]=b;a.viewport[1]=d;a.viewport[2]=f;a.viewport[3]=e;a.realViewport.call(c,b,d,f,e)};this.isPatched=!0;ia(b)}};a.prototype.unpatch=
function(){if(this.isPatched){var a=this.gl,b=this.gl.canvas;v()||(Object.defineProperty(b,"width",this.realCanvasWidth),Object.defineProperty(b,"height",this.realCanvasHeight));b.width=this.bufferWidth;b.height=this.bufferHeight;a.bindFramebuffer=this.realBindFramebuffer;a.enable=this.realEnable;a.disable=this.realDisable;a.colorMask=this.realColorMask;a.clearColor=this.realClearColor;a.viewport=this.realViewport;this.lastBoundFramebuffer==this.framebuffer&&a.bindFramebuffer(a.FRAMEBUFFER,null);
this.isPatched=!1;setTimeout(function(){ia(b)},1)}};a.prototype.setTextureBounds=function(a,b){a||(a=[0,0,.5,1]);b||(b=[.5,0,.5,1]);this.viewportOffsetScale[0]=a[0];this.viewportOffsetScale[1]=a[1];this.viewportOffsetScale[2]=a[2];this.viewportOffsetScale[3]=a[3];this.viewportOffsetScale[4]=b[0];this.viewportOffsetScale[5]=b[1];this.viewportOffsetScale[6]=b[2];this.viewportOffsetScale[7]=b[3]};a.prototype.submitFrame=function(){var a=this.gl,b=this,c=[];this.dirtySubmitFrameBindings||c.push(a.CURRENT_PROGRAM,
a.ARRAY_BUFFER_BINDING,a.ELEMENT_ARRAY_BUFFER_BINDING,a.TEXTURE_BINDING_2D,a.TEXTURE0);R(a,c,function(a){b.realBindFramebuffer.call(a,a.FRAMEBUFFER,null);var c=0,d=0;b.instanceExt&&(c=a.getVertexAttrib(b.attribs.position,b.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),d=a.getVertexAttrib(b.attribs.texCoord,b.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE));b.cullFace&&b.realDisable.call(a,a.CULL_FACE);b.depthTest&&b.realDisable.call(a,a.DEPTH_TEST);b.blend&&b.realDisable.call(a,a.BLEND);b.scissorTest&&
b.realDisable.call(a,a.SCISSOR_TEST);b.stencilTest&&b.realDisable.call(a,a.STENCIL_TEST);b.realColorMask.call(a,!0,!0,!0,!0);b.realViewport.call(a,0,0,a.drawingBufferWidth,a.drawingBufferHeight);if(b.ctxAttribs.alpha||v())b.realClearColor.call(a,0,0,0,1),a.clear(a.COLOR_BUFFER_BIT);a.useProgram(b.program);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,b.indexBuffer);a.bindBuffer(a.ARRAY_BUFFER,b.vertexBuffer);a.enableVertexAttribArray(b.attribs.position);a.enableVertexAttribArray(b.attribs.texCoord);a.vertexAttribPointer(b.attribs.position,
2,a.FLOAT,!1,20,0);a.vertexAttribPointer(b.attribs.texCoord,3,a.FLOAT,!1,20,8);b.instanceExt&&(0!=c&&b.instanceExt.vertexAttribDivisorANGLE(b.attribs.position,0),0!=d&&b.instanceExt.vertexAttribDivisorANGLE(b.attribs.texCoord,0));a.activeTexture(a.TEXTURE0);a.uniform1i(b.uniforms.diffuse,0);a.bindTexture(a.TEXTURE_2D,b.renderTarget);a.uniform4fv(b.uniforms.viewportOffsetScale,b.viewportOffsetScale);a.drawElements(a.TRIANGLES,b.indexCount,a.UNSIGNED_SHORT,0);b.cardboardUI&&b.cardboardUI.renderNoState();
b.realBindFramebuffer.call(b.gl,a.FRAMEBUFFER,b.framebuffer);b.ctxAttribs.preserveDrawingBuffer||(b.realClearColor.call(a,0,0,0,0),a.clear(a.COLOR_BUFFER_BIT));b.dirtySubmitFrameBindings||b.realBindFramebuffer.call(a,a.FRAMEBUFFER,b.lastBoundFramebuffer);b.cullFace&&b.realEnable.call(a,a.CULL_FACE);b.depthTest&&b.realEnable.call(a,a.DEPTH_TEST);b.blend&&b.realEnable.call(a,a.BLEND);b.scissorTest&&b.realEnable.call(a,a.SCISSOR_TEST);b.stencilTest&&b.realEnable.call(a,a.STENCIL_TEST);b.realColorMask.apply(a,
b.colorMask);b.realViewport.apply(a,b.viewport);!b.ctxAttribs.alpha&&b.ctxAttribs.preserveDrawingBuffer||b.realClearColor.apply(a,b.clearColor);b.instanceExt&&(0!=c&&b.instanceExt.vertexAttribDivisorANGLE(b.attribs.position,c),0!=d&&b.instanceExt.vertexAttribDivisorANGLE(b.attribs.texCoord,d))});v()&&(a=a.canvas,a.width!=b.bufferWidth||a.height!=b.bufferHeight)&&(b.bufferWidth=a.width,b.bufferHeight=a.height,b.onResize())};a.prototype.updateDeviceInfo=function(a){var b=this.gl,c=this;R(b,[b.ARRAY_BUFFER_BINDING,
b.ELEMENT_ARRAY_BUFFER_BINDING],function(b){var d=c.computeMeshVertices_(c.meshWidth,c.meshHeight,a);b.bindBuffer(b.ARRAY_BUFFER,c.vertexBuffer);b.bufferData(b.ARRAY_BUFFER,d,b.STATIC_DRAW);c.indexCount||(d=c.computeMeshIndices_(c.meshWidth,c.meshHeight),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,c.indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,d,b.STATIC_DRAW),c.indexCount=d.length)})};a.prototype.computeMeshVertices_=function(a,b,c){for(var d=new Float32Array(2*a*b*5),f=c.getLeftEyeVisibleTanAngles(),
e=c.getLeftEyeNoLensTanAngles(),g=c.getLeftEyeVisibleScreenRect(e),k=0,h=0;2>h;h++){for(var m=0;m<b;m++)for(var l=0;l<a;l++,k++){var n=l/(a-1),q=m/(b-1),r=n,p=q,u=f[0];n=u+(f[2]-u)*n;u=f[3];var t=u+(f[1]-u)*q;q=Math.sqrt(n*n+t*t);u=c.distortion.distortInverse(q);t=t*u/q;n=(n*u/q-e[0])/(e[2]-e[0]);q=(t-e[3])/(e[1]-e[3]);n=2*(g.x+n*g.width-.5);q=2*(g.y+q*g.height-.5);d[5*k]=n;d[5*k+1]=q;d[5*k+2]=r;d[5*k+3]=p;d[5*k+4]=h}m=f[2]-f[0];f[0]=-(m+f[0]);f[2]=m-f[2];m=e[2]-e[0];e[0]=-(m+e[0]);e[2]=m-e[2];g.x=
1-(g.x+g.width)}return d};a.prototype.computeMeshIndices_=function(a,b){for(var c=new Uint16Array(2*(a-1)*(b-1)*6),d=a/2,f=b/2,e=0,g=0,k=0;2>k;k++)for(var h=0;h<b;h++)for(var m=0;m<a;m++,e++)0!=m&&0!=h&&(m<=d==h<=f?(c[g++]=e,c[g++]=e-a-1,c[g++]=e-a,c[g++]=e-a-1,c[g++]=e,c[g++]=e-1):(c[g++]=e-1,c[g++]=e-a,c[g++]=e,c[g++]=e-a,c[g++]=e-1,c[g++]=e-a-1));return c};a.prototype.getOwnPropertyDescriptor_=function(a,b){a=Object.getOwnPropertyDescriptor(a,b);if(void 0===a.get||void 0===a.set)a.configurable=
!0,a.enumerable=!0,a.get=function(){return this.getAttribute(b)},a.set=function(a){this.setAttribute(b,a)};return a};var V=Math.PI/180;b.prototype.destroy=function(){var a=this.gl;this.listener&&a.canvas.removeEventListener("click",this.listener,!1);a.deleteProgram(this.program);a.deleteBuffer(this.vertexBuffer)};b.prototype.listen=function(a,b){var c=this.gl.canvas;this.listener=function(d){var f=c.clientWidth/2,e=d.touches?d.touches[0].clientX:d.clientX,g=d.touches?d.touches[0].clientY:d.clientY;
e>f-42&&e<f+42&&g>c.clientHeight-42?a(d):42>e&&42>g&&b(d)};c.addEventListener("click",this.listener,!1);c.addEventListener("touchstart",this.listener,!1)};b.prototype.onResize=function(){var a=this.gl,b=this;R(a,[a.ARRAY_BUFFER_BINDING],function(a){function c(a,b){var c=(90-a)*V;a=Math.cos(c);c=Math.sin(c);f.push(.3125*a*m+e,.3125*c*m+m);f.push(b*a*m+e,b*c*m+m)}function d(b,c){f.push(l+b,a.drawingBufferHeight-l-c)}var f=[],e=a.drawingBufferWidth/2,g=a.drawingBufferWidth/(Math.max(screen.width,screen.height)*
window.devicePixelRatio)*window.devicePixelRatio,k=4*g/2,h=42*g,m=28*g/2,l=14*g;f.push(e-k,h);f.push(e-k,a.drawingBufferHeight);f.push(e+k,h);f.push(e+k,a.drawingBufferHeight);b.gearOffset=f.length/2;for(h=0;6>=h;h++){var n=60*h;c(n,1);c(n+12,1);c(n+20,.75);c(n+40,.75);c(n+48,1)}b.gearVertexCount=f.length/2-b.gearOffset;b.arrowOffset=f.length/2;h=k/Math.sin(45*V);d(0,m);d(m,0);d(m+h,h);d(h,m+h);d(h,m-h);d(0,m);d(m,2*m);d(m+h,2*m-h);d(h,m-h);d(0,m);d(h,m-k);d(28*g,m-k);d(h,m+k);d(28*g,m+k);b.arrowVertexCount=
f.length/2-b.arrowOffset;a.bindBuffer(a.ARRAY_BUFFER,b.vertexBuffer);a.bufferData(a.ARRAY_BUFFER,new Float32Array(f),a.STATIC_DRAW)})};b.prototype.render=function(){var a=this.gl,b=this;R(a,[a.CULL_FACE,a.DEPTH_TEST,a.BLEND,a.SCISSOR_TEST,a.STENCIL_TEST,a.COLOR_WRITEMASK,a.VIEWPORT,a.CURRENT_PROGRAM,a.ARRAY_BUFFER_BINDING],function(a){a.disable(a.CULL_FACE);a.disable(a.DEPTH_TEST);a.disable(a.BLEND);a.disable(a.SCISSOR_TEST);a.disable(a.STENCIL_TEST);a.colorMask(!0,!0,!0,!0);a.viewport(0,0,a.drawingBufferWidth,
a.drawingBufferHeight);b.renderNoState()})};b.prototype.renderNoState=function(){var a=this.gl;a.useProgram(this.program);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.enableVertexAttribArray(this.attribs.position);a.vertexAttribPointer(this.attribs.position,2,a.FLOAT,!1,8,0);a.uniform4f(this.uniforms.color,1,1,1,1);var b=this.projMat,c=a.drawingBufferWidth,d=a.drawingBufferHeight,f=1/(0-c),e=1/(0-d),g=1/-1023.9;b[0]=-2*f;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=-2*e;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=
2*g;b[11]=0;b[12]=(0+c)*f;b[13]=(d+0)*e;b[14]=1024.1*g;b[15]=1;a.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat);a.drawArrays(a.TRIANGLE_STRIP,0,4);a.drawArrays(a.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount);a.drawArrays(a.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)};c.prototype.distortInverse=function(a){for(var b=0,c=1,d=a-this.distort(b);1E-4<Math.abs(c-b);){var f=a-this.distort(c);d=c-(c-b)/(f-d)*f;b=c;c=d;d=f}return c};c.prototype.distort=function(a){for(var b=
a*a,c=0,d=0;d<this.coefficients.length;d++)c=b*(c+this.coefficients[d]);return(c+1)*a};var S=Math.PI/180,L=180/Math.PI,U=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};U.prototype={constructor:U,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var a=this.length();0!==a?this.multiplyScalar(1/a):this.z=this.y=this.x=0;return this},
multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,f=a.x,e=a.y,g=a.z;a=a.w;var k=a*b+e*d-g*c,h=a*c+g*b-f*d,m=a*d+f*c-e*b;b=-f*b-e*c-g*d;this.x=k*a+b*-f+h*-g-m*-e;this.y=h*a+b*-e+m*-f-k*-g;this.z=m*a+b*-g+k*-e-h*-f;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},crossVectors:function(a,b){var c=a.x,d=a.y;a=a.z;var f=b.x,e=b.y;b=b.z;this.x=d*b-a*e;this.y=a*f-c*b;this.z=c*e-d*f;return this}};var J=function(a,b,c,
d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=void 0!==d?d:1};J.prototype={constructor:J,set:function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this},setFromEulerXYZ:function(a,b,c){var d=Math.cos(a/2),f=Math.cos(b/2),e=Math.cos(c/2);a=Math.sin(a/2);b=Math.sin(b/2);c=Math.sin(c/2);this.x=a*f*e+d*b*c;this.y=d*b*e-a*f*c;this.z=d*f*c+a*b*e;this.w=d*f*e-a*b*c;return this},setFromEulerYXZ:function(a,b,c){var d=Math.cos(a/
2),f=Math.cos(b/2),e=Math.cos(c/2);a=Math.sin(a/2);b=Math.sin(b/2);c=Math.sin(c/2);this.x=a*f*e+d*b*c;this.y=d*b*e-a*f*c;this.z=d*f*c-a*b*e;this.w=d*f*e+a*b*c;return this},setFromAxisAngle:function(a,b){b/=2;var c=Math.sin(b);this.x=a.x*c;this.y=a.y*c;this.z=a.z*c;this.w=Math.cos(b);return this},multiply:function(a){return this.multiplyQuaternions(this,a)},multiplyQuaternions:function(a,b){var c=a.x,d=a.y,f=a.z;a=a.w;var e=b.x,g=b.y,k=b.z;b=b.w;this.x=c*b+a*e+d*k-f*g;this.y=d*b+a*g+f*e-c*k;this.z=
f*b+a*k+c*g-d*e;this.w=a*b-c*e-d*g-f*k;return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;this.normalize();return this},normalize:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===a?(this.z=this.y=this.x=0,this.w=1):(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a);return this},slerp:function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this.x,d=this.y,f=this.z,e=this.w,g=e*a.w+c*a.x+d*a.y+f*a.z;0>g?(this.w=-a.w,this.x=-a.x,this.y=
-a.y,this.z=-a.z,g=-g):this.copy(a);if(1<=g)return this.w=e,this.x=c,this.y=d,this.z=f,this;a=Math.acos(g);var k=Math.sqrt(1-g*g);if(.001>Math.abs(k))return this.w=.5*(e+this.w),this.x=.5*(c+this.x),this.y=.5*(d+this.y),this.z=.5*(f+this.z),this;g=Math.sin((1-b)*a)/k;b=Math.sin(b*a)/k;this.w=e*g+this.w*b;this.x=c*g+this.x*b;this.y=d*g+this.y*b;this.z=f*g+this.z*b;return this},setFromUnitVectors:function(){var a,b;return function(c,d){void 0===a&&(a=new U);b=c.dot(d)+1;1E-6>b?(b=0,Math.abs(c.x)>Math.abs(c.z)?
a.set(-c.y,c.x,0):a.set(0,-c.z,c.y)):a.crossVectors(c,d);this.x=a.x;this.y=a.y;this.z=a.z;this.w=b;this.normalize();return this}}()};var qa=new d({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),ua=new d({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),T={CardboardV1:new f({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,
-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new f({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-9.904169E-4,6.183535E-5,-1.6981803E-6]})};e.prototype.updateDeviceParams=function(a){this.device=this.determineDevice_(a)||
this.device};e.prototype.getDevice=function(){return this.device};e.prototype.setViewer=function(a){this.viewer=a;this.distortion=new c(this.viewer.distortionCoefficients)};e.prototype.determineDevice_=function(a){if(!a){if(v())return console.warn("Using fallback iOS device measurements."),ua;console.warn("Using fallback Android device measurements.");return qa}var b=.0254/a.xdpi,c=.0254/a.ydpi,f=ma(),e=E();return new d({widthMeters:b*f,heightMeters:c*e,bevelMeters:.001*a.bevelMm})};e.prototype.getDistortedFieldOfViewLeftEye=
function(){var a=this.viewer,b=this.device,c=this.distortion,d=a.screenLensDistance,f=a.interLensDistance/2,e=a.baselineLensDistance-b.bevelMeters,g=b.heightMeters-e;b=L*Math.atan(c.distort((b.widthMeters-a.interLensDistance)/2/d));f=L*Math.atan(c.distort(f/d));e=L*Math.atan(c.distort(e/d));c=L*Math.atan(c.distort(g/d));return{leftDegrees:Math.min(b,a.fov),rightDegrees:Math.min(f,a.fov),downDegrees:Math.min(e,a.fov),upDegrees:Math.min(c,a.fov)}};e.prototype.getLeftEyeVisibleTanAngles=function(){var a=
this.viewer,b=this.device,c=this.distortion,d=Math.tan(-S*a.fov),f=Math.tan(S*a.fov),e=Math.tan(S*a.fov),g=Math.tan(-S*a.fov),k=b.widthMeters/4,h=b.heightMeters/2,m=a.interLensDistance/2-k,l=-(a.baselineLensDistance-b.bevelMeters-h),n=a.screenLensDistance;a=c.distort((m-k)/n);b=c.distort((l+h)/n);k=c.distort((m+k)/n);c=c.distort((l-h)/n);h=new Float32Array(4);h[0]=Math.max(d,a);h[1]=Math.min(f,b);h[2]=Math.min(e,k);h[3]=Math.max(g,c);return h};e.prototype.getLeftEyeNoLensTanAngles=function(){var a=
this.viewer,b=this.device,c=this.distortion,d=new Float32Array(4),f=c.distortInverse(Math.tan(-S*a.fov)),e=c.distortInverse(Math.tan(S*a.fov)),g=c.distortInverse(Math.tan(S*a.fov));c=c.distortInverse(Math.tan(-S*a.fov));var k=b.widthMeters/4,h=b.heightMeters/2,m=a.interLensDistance/2-k;b=-(a.baselineLensDistance-b.bevelMeters-h);a=a.screenLensDistance;d[0]=Math.max(f,(m-k)/a);d[1]=Math.min(e,(b+h)/a);d[2]=Math.min(g,(m+k)/a);d[3]=Math.max(c,(b-h)/a);return d};e.prototype.getLeftEyeVisibleScreenRect=
function(a){var b=this.viewer,c=this.device,d=b.screenLensDistance,f=(c.widthMeters-b.interLensDistance)/2;b=b.baselineLensDistance-c.bevelMeters;var e=(a[0]*d+f)/c.widthMeters,g=(a[3]*d+b)/c.heightMeters;return{x:e,y:g,width:(a[2]*d+f)/c.widthMeters-e,height:(a[1]*d+b)/c.heightMeters-g}};e.prototype.getFieldOfViewLeftEye=function(a){return a?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()};e.prototype.getFieldOfViewRightEye=function(a){a=this.getFieldOfViewLeftEye(a);
return{leftDegrees:a.rightDegrees,rightDegrees:a.leftDegrees,upDegrees:a.upDegrees,downDegrees:a.downDegrees}};e.prototype.getUndistortedFieldOfViewLeftEye=function(){var a=this.getUndistortedParams_();return{leftDegrees:L*Math.atan(a.outerDist),rightDegrees:L*Math.atan(a.innerDist),downDegrees:L*Math.atan(a.bottomDist),upDegrees:L*Math.atan(a.topDist)}};e.prototype.getUndistortedViewportLeftEye=function(){var a=this.getUndistortedParams_(),b=this.device,c=this.viewer.screenLensDistance,d=b.width/
(b.widthMeters/c);b=b.height/(b.heightMeters/c);c=Math.round((a.eyePosX-a.outerDist)*d);var f=Math.round((a.eyePosY-a.bottomDist)*b);return{x:c,y:f,width:Math.round((a.eyePosX+a.innerDist)*d)-c,height:Math.round((a.eyePosY+a.topDist)*b)-f}};e.prototype.getUndistortedParams_=function(){var a=this.viewer,b=this.device,c=a.screenLensDistance,d=a.interLensDistance/2/c,f=b.heightMeters/c,e=b.widthMeters/c/2-d;b=(a.baselineLensDistance-b.bevelMeters)/c;a=this.distortion.distortInverse(Math.tan(S*a.fov));
return{outerDist:Math.min(e,a),innerDist:Math.min(d,a),topDist:Math.min(f-b,a),bottomDist:Math.min(b,a),eyePosX:e,eyePosY:b}};e.Viewers=T;var Q={format:1,last_updated:"2019-11-09T17:36:14Z",devices:[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},
{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],
dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},
{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},
{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],
dpi:[537.9,535.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1E3},
{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,
ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",
rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},
{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,
441.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],
dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1E3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],
dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],
bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1E3},
{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,
ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1E3},
{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,
ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,
ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,
ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1E3},{type:"android",
rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},
{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},
{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],
dpi:[428.6,427.6],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],
dpi:[480,443.3],bw:3,ac:1E3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1E3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1E3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1E3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1E3},{type:"ios",rules:[{res:[1242,
2208]}],dpi:[453.6,458.4],bw:4,ac:1E3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1E3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,
ac:1E3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}]};g.prototype.getDeviceParams=function(){return this.deviceParams};
g.prototype.recalculateDeviceParams_=function(){var a=this.calcDeviceParams_();if(a){if(this.deviceParams=a,this.onDeviceParamsUpdated)this.onDeviceParamsUpdated(this.deviceParams)}else console.error("Failed to recalculate device parameters.")};g.prototype.calcDeviceParams_=function(){var a=this.dpdb;if(!a)return console.error("DPDB not available."),null;if(1!=a.format)return console.error("DPDB has unexpected format version."),null;if(!a.devices||!a.devices.length)return console.error("DPDB does not have a devices section."),
null;var b=navigator.userAgent||navigator.vendor||window.opera,c=ma(),d=E();if(!a.devices)return console.error("DPDB has no devices section."),null;for(var f=0;f<a.devices.length;f++){var e=a.devices[f];if(!e.rules)console.warn("Device["+f+"] has no rules section.");else if("ios"!=e.type&&"android"!=e.type)console.warn("Device["+f+"] has invalid type.");else if(v()==("ios"==e.type)){for(var g=!1,h=0;h<e.rules.length;h++)if(this.ruleMatches_(e.rules[h],b,c,d)){g=!0;break}if(g)return new k({xdpi:e.dpi[0]||
e.dpi,ydpi:e.dpi[1]||e.dpi,bevelMm:e.bw})}}console.warn("No DPDB device match.");return null};g.prototype.ruleMatches_=function(a,b,c,d){if(!a.ua&&!a.res)return!1;a.ua&&"SM"===a.ua.substring(0,2)&&(a.ua=a.ua.substring(0,7));if(a.ua&&0>b.indexOf(a.ua))return!1;if(a.res){if(!a.res[0]||!a.res[1])return!1;b=a.res[0];a=a.res[1];if(Math.min(c,d)!=Math.min(b,a)||Math.max(c,d)!=Math.max(b,a))return!1}return!0};h.prototype.set=function(a,b){this.sample=a;this.timestampS=b};h.prototype.copy=function(a){this.set(a.sample,
a.timestampS)};m.prototype.addAccelMeasurement=function(a,b){this.currentAccelMeasurement.set(a,b)};m.prototype.addGyroMeasurement=function(a,b){this.currentGyroMeasurement.set(a,b);a=b-this.previousGyroMeasurement.timestampS;isNaN(a)||.001>=a||1<a||this.run_();this.previousGyroMeasurement.copy(this.currentGyroMeasurement)};m.prototype.run_=function(){if(this.isOrientationInitialized){var a=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS);
this.gyroIntegralQ.multiply(a);this.filterQ.copy(this.previousFilterQ);this.filterQ.multiply(a);a=new J;a.copy(this.filterQ);a.inverse();this.estimatedGravity.set(0,0,-1);this.estimatedGravity.applyQuaternion(a);this.estimatedGravity.normalize();this.measuredGravity.copy(this.currentAccelMeasurement.sample);this.measuredGravity.normalize();a=new J;a.setFromUnitVectors(this.estimatedGravity,this.measuredGravity);a.inverse();this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",
L*N(a),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var b=new J;b.copy(this.filterQ);b.multiply(a);this.filterQ.slerp(b,1-this.kFilter);this.previousFilterQ.copy(this.filterQ)}else this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0};m.prototype.getOrientation=
function(){return this.filterQ};m.prototype.accelToQuaternion_=function(a){var b=new U;b.copy(a);b.normalize();a=new J;a.setFromUnitVectors(new U(0,0,-1),b);a.inverse();return a};m.prototype.gyroToQuaternionDelta_=function(a,b){var c=new J,d=new U;d.copy(a);d.normalize();c.setFromAxisAngle(d,a.length()*b);return c};l.prototype.getPrediction=function(a,b,c){if(!this.previousTimestampS)return this.previousQ.copy(a),this.previousTimestampS=c,a;var d=new U;d.copy(b);d.normalize();b=b.length();if(b<20*
S)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(L*b).toFixed(1)),this.outQ.copy(a),this.previousQ.copy(a),this.outQ;this.deltaQ.setFromAxisAngle(d,b*this.predictionTimeS);this.outQ.copy(this.previousQ);this.outQ.multiply(this.deltaQ);this.previousQ.copy(a);this.previousTimestampS=c;return this.outQ};n.prototype.getPosition=function(){return null};n.prototype.getOrientation=function(){var a=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=
this.deviceOrientationFixQ||function(){var a=(new J).setFromAxisAngle(new U(0,0,-1),0),b=new J;-90===window.orientation?b.setFromAxisAngle(new U(0,1,0),Math.PI/-2):b.setFromAxisAngle(new U(0,1,0),Math.PI/2);return a.multiply(b)}();this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var a=new J;a.setFromAxisAngle(new U(1,0,0),-Math.PI/2);return a}();a=this._deviceOrientationQ;var b=new J;b.copy(a);b.multiply(this.deviceOrientationFilterToWorldQ);b.multiply(this.resetQ);
b.multiply(this.worldToScreenQ);b.multiplyQuaternions(this.deviceOrientationFixQ,b);this.yawOnly&&(b.x=0,b.z=0,b.normalize());this.orientationOut_[0]=b.x;this.orientationOut_[1]=b.y;this.orientationOut_[2]=b.z;this.orientationOut_[3]=b.w;return this.orientationOut_}a=this.filter.getOrientation();a=this.posePredictor.getPrediction(a,this.gyroscope,this.previousTimestampS);b=new J;b.copy(this.filterToWorldQ);b.multiply(this.resetQ);b.multiply(a);b.multiply(this.worldToScreenQ);this.yawOnly&&(b.x=0,
b.z=0,b.normalize());this.orientationOut_[0]=b.x;this.orientationOut_[1]=b.y;this.orientationOut_[2]=b.z;this.orientationOut_[3]=b.w;return this.orientationOut_};n.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation());this.resetQ.x=0;this.resetQ.y=0;this.resetQ.z*=-1;this.resetQ.normalize();F()&&this.resetQ.multiply(this.inverseWorldToScreenQ);this.resetQ.multiply(this.originalPoseAdjustQ)};n.prototype.onDeviceOrientation_=function(a){this._deviceOrientationQ=this._deviceOrientationQ||
new J;var b=a.alpha,c=a.beta;a=a.gamma;b=(b||0)*Math.PI/180;c=(c||0)*Math.PI/180;a=(a||0)*Math.PI/180;this._deviceOrientationQ.setFromEulerYXZ(c,b,-a)};n.prototype.onDeviceMotion_=function(a){this.updateDeviceMotion_(a)};n.prototype.updateDeviceMotion_=function(a){var b=a.accelerationIncludingGravity,c=a.rotationRate;a=a.timeStamp/1E3;var d=a-this.previousTimestampS;0>d?ja("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"):.001>=d||
1<d?ja("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."):(this.accelerometer.set(-b.x,-b.y,-b.z),c&&(Z()?this.gyroscope.set(-c.beta,c.alpha,c.gamma):this.gyroscope.set(c.alpha,c.beta,c.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,a)),this.filter.addAccelMeasurement(this.accelerometer,a));this.previousTimestampS=a};n.prototype.onOrientationChange_=
function(a){this.setScreenTransform_()};n.prototype.onMessage_=function(a){(a=a.data)&&a.type&&"devicemotion"===a.type.toLowerCase()&&this.updateDeviceMotion_(a.deviceMotionEvent)};n.prototype.setScreenTransform_=function(){this.worldToScreenQ.set(0,0,0,1);switch(window.orientation){case 90:this.worldToScreenQ.setFromAxisAngle(new U(0,0,1),-Math.PI/2);break;case -90:this.worldToScreenQ.setFromAxisAngle(new U(0,0,1),Math.PI/2)}this.inverseWorldToScreenQ.copy(this.worldToScreenQ);this.inverseWorldToScreenQ.inverse()};
n.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this);this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this);this.onMessageCallback_=this.onMessage_.bind(this);this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this);var a;if(a=v()){a=window.self!==window.top;var b=O(document.referrer),c=O(window.location.href);a=a&&b!==c}a&&window.addEventListener("message",this.onMessageCallback_);window.addEventListener("orientationchange",this.onOrientationChangeCallback_);
this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)};n.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_);window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_);window.removeEventListener("orientationchange",this.onOrientationChangeCallback_);window.removeEventListener("message",this.onMessageCallback_)};
var Ka=new U(1,0,0),X=new U(0,0,1),la=new J;la.setFromAxisAngle(Ka,-Math.PI/2);la.multiply((new J).setFromAxisAngle(X,Math.PI/2));var G=function(){function a(b){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.config=b;this.fusionSensor=this.sensor=null;this._out=new Float32Array(4);this.api=null;this.errors=[];this._sensorQ=new J;this._outQ=new J;this._onSensorRead=this._onSensorRead.bind(this);this._onSensorError=this._onSensorError.bind(this);this.init()}x(a,
[{key:"init",value:function(){var a=null;try{a=new RelativeOrientationSensor({frequency:60,referenceFrame:"screen"}),a.addEventListener("error",this._onSensorError)}catch(Fa){this.errors.push(Fa),"SecurityError"===Fa.name?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):"ReferenceError"===Fa.name?this.useDeviceMotion():console.error(Fa)}a&&
(this.api="sensor",this.sensor=a,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion";this.fusionSensor=new n(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG);this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();
if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var a=this.sensor.quaternion;this._sensorQ.set(a[0],a[1],a[2],a[3]);a=this._outQ;a.copy(la);a.multiply(this._sensorQ);this.config.YAW_ONLY&&(a.x=a.z=0,a.normalize());this._out[0]=a.x;this._out[1]=a.y;this._out[2]=a.z;this._out[3]=a.w;return this._out}},{key:"_onSensorError",value:function(a){this.errors.push(a.error);"NotAllowedError"===a.error.name?console.error("Permission to access sensor was denied"):
"NotReadableError"===a.error.name?console.error("Sensor could not be read"):console.error(a.error);this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]);return a}();q.prototype.show=function(a){a||this.overlay.parentElement?a&&(this.overlay.parentElement&&this.overlay.parentElement!=a&&this.overlay.parentElement.removeChild(this.overlay),a.appendChild(this.overlay)):document.body.appendChild(this.overlay);this.overlay.style.display="block";a=this.overlay.querySelector("img").style;F()?
(a.width="20%",a.marginLeft="40%",a.marginTop="3%"):(a.width="50%",a.marginLeft="25%",a.marginTop="25%")};q.prototype.hide=function(){this.overlay.style.display="none"};q.prototype.showTemporarily=function(a,b){this.show(b);this.timer=setTimeout(this.hide.bind(this),a)};q.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)};q.prototype.update=function(){this.disableShowTemporarily();!F()&&P()?this.show():this.hide()};q.prototype.loadIcon_=function(){this.icon="data:image/svg+xml,"+
encodeURIComponent("<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>")};
r.prototype.show=function(a){this.root=a;a.appendChild(this.dialog);this.dialog.querySelector("#"+this.selectedKey).checked=!0;this.dialog.style.display="block"};r.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog);this.dialog.style.display="none"};r.prototype.getCurrentViewer=function(){return e.Viewers[this.selectedKey]};r.prototype.getSelectedKey_=function(){var a=this.dialog.querySelector("input[name=field]:checked");return a?a.id:null};r.prototype.onChange=
function(a){this.onChangeCallbacks_.push(a)};r.prototype.fireOnChange_=function(a){for(var b=0;b<this.onChangeCallbacks_.length;b++)this.onChangeCallbacks_[b](a)};r.prototype.onSave_=function(){if((this.selectedKey=this.getSelectedKey_())&&e.Viewers[this.selectedKey]){this.fireOnChange_(e.Viewers[this.selectedKey]);try{localStorage.setItem("WEBVR_CARDBOARD_VIEWER",this.selectedKey)}catch(Da){console.error("Failed to save viewer profile: %s",Da)}this.hide()}else console.error("ViewerSelector.onSave_: this should never happen!")};
r.prototype.createDialog_=function(a){var b=document.createElement("div");b.classList.add("webvr-polyfill-viewer-selector");b.style.display="none";var c=document.createElement("div"),d=c.style;d.position="fixed";d.left=0;d.top=0;d.width="100%";d.height="100%";d.background="rgba(0, 0, 0, 0.3)";c.addEventListener("click",this.hide.bind(this));var f=document.createElement("div");d=f.style;d.boxSizing="border-box";d.position="fixed";d.top="24px";d.left="50%";d.marginLeft="-140px";d.width="280px";d.padding=
"24px";d.overflow="hidden";d.background="#fafafa";d.fontFamily="'Roboto', sans-serif";d.boxShadow="0px 5px 20px #666";f.appendChild(this.createH1_("Select your viewer"));for(var e in a)f.appendChild(this.createChoice_(e,a[e].label));f.appendChild(this.createButton_("Save",this.onSave_.bind(this)));b.appendChild(c);b.appendChild(f);return b};r.prototype.createH1_=function(a){var b=document.createElement("h1"),c=b.style;c.color="black";c.fontSize="20px";c.fontWeight="bold";c.marginTop=0;c.marginBottom=
"24px";b.innerHTML=a;return b};r.prototype.createChoice_=function(a,b){var c=document.createElement("div");c.style.marginTop="8px";c.style.color="black";var d=document.createElement("input");d.style.fontSize="30px";d.setAttribute("id",a);d.setAttribute("type","radio");d.setAttribute("value",a);d.setAttribute("name","field");var f=document.createElement("label");f.style.marginLeft="4px";f.setAttribute("for",a);f.innerHTML=b;c.appendChild(d);c.appendChild(f);return c};r.prototype.createButton_=function(a,
b){var c=document.createElement("button");c.innerHTML=a;a=c.style;a.float="right";a.textTransform="uppercase";a.color="#1094f7";a.fontSize="14px";a.letterSpacing=0;a.border=0;a.background="none";a.marginTop="16px";c.addEventListener("click",b);return c};var Y="undefined"!==typeof window?window:"undefined"!==typeof Va?Va:"undefined"!==typeof self?self:{},xa=function(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a["default"]:a}(function(a,b){return b={exports:{}},a(b,
b.exports),b.exports}(function(a,b){(function(b,c){a.exports=c()})(Y,function(){return function(a){function b(d){if(c[d])return c[d].exports;var f=c[d]={i:d,l:!1,exports:{}};a[d].call(f.exports,f,f.exports,b);f.l=!0;return f.exports}var c={};b.m=a;b.c=c;b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})};b.n=function(a){var c=a&&a.__esModule?function(){return a["default"]}:function(){return a};b.d(c,"a",c);return c};b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,
b)};b.p="";return b(b.s=0)}([function(a,b,c){var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),f=c(1),e="undefined"!==typeof navigator&&10>parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",
""))&&!window.MSStream;b=function(){function a(){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");e?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",f),this.noSleepVideo.addEventListener("timeupdate",function(a){.5<this.noSleepVideo.currentTime&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}d(a,[{key:"enable",value:function(){e?(this.disable(),
this.noSleepTimer=window.setInterval(function(){window.location.href="/";window.setTimeout(window.stop,0)},15E3)):this.noSleepVideo.play()}},{key:"disable",value:function(){e?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]);return a}();a.exports=b},function(a,b,c){a.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})})),
da=1E3,fa=[0,0,.5,1],pa=[.5,0,.5,1],ya=window.requestAnimationFrame,ha=window.cancelAnimationFrame;u.prototype.getFrameData=function(a){return M(a,this._getPose(),this)};u.prototype.getPose=function(){ea("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData");return this._getPose()};u.prototype.resetPose=function(){ea("VRDisplay.prototype.resetPose");return this._resetPose()};u.prototype.getImmediatePose=function(){ea("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData");
return this._getPose()};u.prototype.requestAnimationFrame=function(a){return ya(a)};u.prototype.cancelAnimationFrame=function(a){return ha(a)};u.prototype.wrapForFullscreen=function(a){if(v())return a;this.fullscreenWrapper_||(this.fullscreenWrapper_=document.createElement("div"),this.fullscreenWrapper_.setAttribute("style",["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important; left: 0 !important; right: 0 !important; border: 0; margin: 0; padding: 0; z-index: 999999 !important; position: fixed"].join("; ")+
";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper"));if(this.fullscreenElement_==a)return this.fullscreenWrapper_;this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_));this.fullscreenElement_=a;(this.originalParent_=a.parentElement)||document.body.appendChild(a);this.fullscreenWrapper_.parentElement||(a=this.fullscreenElement_.parentElement,a.insertBefore(this.fullscreenWrapper_,
this.fullscreenElement_),a.removeChild(this.fullscreenElement_));this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild);this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");this.fullscreenElement_&&this.fullscreenElement_.setAttribute("style",["position: absolute; top: 0; left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0; margin: 0; padding: 0"].join("; ")+
";");return this.fullscreenWrapper_};u.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var a=this.fullscreenElement_;this.fullscreenElementCachedStyle_?a.setAttribute("style",this.fullscreenElementCachedStyle_):a.removeAttribute("style");this.fullscreenElementCachedStyle_=this.fullscreenElement_=null;var b=this.fullscreenWrapper_.parentElement;this.fullscreenWrapper_.removeChild(a);this.originalParent_===b?b.insertBefore(a,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(a);
b.removeChild(this.fullscreenWrapper_);return a}};u.prototype.requestPresent=function(a){var b=this.isPresenting,c=this;a instanceof Array||(ea("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),a=[a]);return new Promise(function(d,f){if(c.capabilities.canPresent)if(0==a.length||a.length>c.capabilities.maxLayers)f(Error("Invalid number of layers."));else{var e=a[0];if(e.source){var g=e.leftBounds||fa,k=e.rightBounds||pa;if(b){var h=c.layer_;
h.source!==e.source&&(h.source=e.source);for(e=0;4>e;e++)h.leftBounds[e]=g[e],h.rightBounds[e]=k[e];c.wrapForFullscreen(c.layer_.source);c.updatePresent_();d()}else{c.layer_={predistorted:e.predistorted,source:e.source,leftBounds:g.slice(0),rightBounds:k.slice(0)};c.waitingForPresent_=!1;if(c.layer_&&c.layer_.source){var m=c.wrapForFullscreen(c.layer_.source);c.addFullscreenListeners_(m,function(){c.isPresenting=m===(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||
document.msFullscreenElement);c.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(a){console.error("screen.orientation.lock() failed due to",a.message)}),c.waitingForPresent_=!1,c.beginPresent_(),d()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),c.removeFullscreenWrapper(),c.disableWakeLock(),c.endPresent_(),c.removeFullscreenListeners_());c.fireVRDisplayPresentChange_()},function(){c.waitingForPresent_&&
(c.removeFullscreenWrapper(),c.removeFullscreenListeners_(),c.disableWakeLock(),c.waitingForPresent_=!1,c.isPresenting=!1,f(Error("Unable to present.")))});if(D(m))c.enableWakeLock(),c.waitingForPresent_=!0;else if(v()||A())c.enableWakeLock(),c.isPresenting=!0,c.beginPresent_(),c.fireVRDisplayPresentChange_(),d()}c.waitingForPresent_||v()||(I(),f(Error("Unable to present.")))}}else d()}else f(Error("VRDisplay is not capable of presenting."))})};u.prototype.exitPresent=function(){var a=this.isPresenting,
b=this;this.isPresenting=!1;this.layer_=null;this.disableWakeLock();return new Promise(function(c,d){a?(!I()&&v()&&(b.endPresent_(),b.fireVRDisplayPresentChange_()),A()&&(b.removeFullscreenWrapper(),b.removeFullscreenListeners_(),b.endPresent_(),b.fireVRDisplayPresentChange_()),c()):d(Error("Was not presenting to VRDisplay."))})};u.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]};u.prototype.fireVRDisplayPresentChange_=function(){var a=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});
window.dispatchEvent(a)};u.prototype.fireVRDisplayConnect_=function(){var a=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(a)};u.prototype.addFullscreenListeners_=function(a,b,c){this.removeFullscreenListeners_();this.fullscreenEventTarget_=a;this.fullscreenChangeHandler_=b;this.fullscreenErrorHandler_=c;b&&(document.fullscreenEnabled?a.addEventListener("fullscreenchange",b,!1):document.webkitFullscreenEnabled?a.addEventListener("webkitfullscreenchange",b,!1):document.mozFullScreenEnabled?
document.addEventListener("mozfullscreenchange",b,!1):document.msFullscreenEnabled&&a.addEventListener("msfullscreenchange",b,!1));c&&(document.fullscreenEnabled?a.addEventListener("fullscreenerror",c,!1):document.webkitFullscreenEnabled?a.addEventListener("webkitfullscreenerror",c,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",c,!1):document.msFullscreenEnabled&&a.addEventListener("msfullscreenerror",c,!1))};u.prototype.removeFullscreenListeners_=function(){if(this.fullscreenEventTarget_){var a=
this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var b=this.fullscreenChangeHandler_;a.removeEventListener("fullscreenchange",b,!1);a.removeEventListener("webkitfullscreenchange",b,!1);document.removeEventListener("mozfullscreenchange",b,!1);a.removeEventListener("msfullscreenchange",b,!1)}this.fullscreenErrorHandler_&&(b=this.fullscreenErrorHandler_,a.removeEventListener("fullscreenerror",b,!1),a.removeEventListener("webkitfullscreenerror",b,!1),document.removeEventListener("mozfullscreenerror",
b,!1),a.removeEventListener("msfullscreenerror",b,!1));this.fullscreenErrorHandler_=this.fullscreenChangeHandler_=this.fullscreenEventTarget_=null}};u.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()};u.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()};u.prototype.beginPresent_=function(){};u.prototype.endPresent_=function(){};u.prototype.submitFrame=function(a){};u.prototype.getEyeParameters=function(a){return null};var ba={ADDITIONAL_VIEWERS:[],
DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1};t.prototype=Object.create(u.prototype);t.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}};t.prototype._resetPose=function(){this.poseSensor_.resetPose&&
this.poseSensor_.resetPose()};t.prototype._getFieldOfView=function(a){if("left"==a)a=this.deviceInfo_.getFieldOfViewLeftEye();else if("right"==a)a=this.deviceInfo_.getFieldOfViewRightEye();else return console.error("Invalid eye provided: %s",a),null;return a};t.prototype._getEyeOffset=function(a){if("left"==a)a=[.5*-this.deviceInfo_.viewer.interLensDistance,0,0];else if("right"==a)a=[.5*this.deviceInfo_.viewer.interLensDistance,0,0];else return console.error("Invalid eye provided: %s",a),null;return a};
t.prototype.getEyeParameters=function(a){var b=this._getEyeOffset(a),c=this._getFieldOfView(a);a={offset:b,renderWidth:.5*this.deviceInfo_.device.width*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};Object.defineProperty(a,"fieldOfView",{enumerable:!0,get:function(){ea("VRFieldOfView","VRFrameData's projection matrices");return c}});return a};t.prototype.onDeviceParamsUpdated_=function(a){this.config.DEBUG&&console.log("DPDB reported that device params were updated.");
this.deviceInfo_.updateDeviceParams(a);this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)};t.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)};t.prototype.beginPresent_=function(){var c=this.layer_.source.getContext("webgl");c||(c=this.layer_.source.getContext("experimental-webgl"));c||(c=this.layer_.source.getContext("webgl2"));c&&(this.layer_.predistorted?
this.config.CARDBOARD_UI_DISABLED||(c.canvas.width=ma()*this.bufferScale_,c.canvas.height=E()*this.bufferScale_,this.cardboardUI_=new b(c)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new b(c)),this.distorter_=new a(c,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen(function(a){this.viewerSelector_.show(this.layer_.source.parentElement);a.stopPropagation();
a.preventDefault()}.bind(this),function(a){this.exitPresent();a.stopPropagation();a.preventDefault()}.bind(this)),this.rotateInstructions_&&(F()&&P()?this.rotateInstructions_.showTemporarily(3E3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",
this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())};t.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null);this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null);this.rotateInstructions_&&this.rotateInstructions_.hide();this.viewerSelector_.hide();window.removeEventListener("orientationchange",this.orientationHandler);window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)};t.prototype.updatePresent_=
function(){this.endPresent_();this.beginPresent_()};t.prototype.submitFrame=function(a){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){(a=this.layer_.source.getContext("webgl"))||(a=this.layer_.source.getContext("experimental-webgl"));a||(a=this.layer_.source.getContext("webgl2"));a=a.canvas;if(a.width!=this.lastWidth||a.height!=this.lastHeight)this.cardboardUI_.onResize();this.lastWidth=a.width;this.lastHeight=a.height;this.cardboardUI_.render()}};
t.prototype.onOrientationChange_=function(a){this.viewerSelector_.hide();this.rotateInstructions_&&this.rotateInstructions_.update();this.onResize_()};t.prototype.onResize_=function(a){this.layer_&&((a=this.layer_.source.getContext("webgl"))||(a=this.layer_.source.getContext("experimental-webgl")),a||(a=this.layer_.source.getContext("webgl2")),a.canvas.setAttribute("style","position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; border: 0; margin: 0; padding: 0px; box-sizing: content-box;"),
ia(a.canvas))};t.prototype.onViewerChanged_=function(a){this.deviceInfo_.setViewer(a);this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_);this.fireVRDisplayDeviceParamsChange_()};t.prototype.fireVRDisplayDeviceParamsChange_=function(){var a=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(a)};t.VRFrameData=function(){this.leftProjectionMatrix=new Float32Array(16);this.leftViewMatrix=new Float32Array(16);this.rightProjectionMatrix=
new Float32Array(16);this.rightViewMatrix=new Float32Array(16);this.pose=null};t.VRDisplay=u;return t})})),oa=function(a){var b=B.call(this)||this;b.global=a;b.onWindowResize=b.onWindowResize.bind(b);b.global.window.addEventListener("resize",b.onWindowResize);b.environmentBlendMode="opaque";return b};$jscomp.inherits(oa,B);oa.prototype.onBaseLayerSet=function(a,b){throw Error("Not implemented");};oa.prototype.isSessionSupported=function(a){throw Error("Not implemented");};oa.prototype.isFeatureSupported=
function(a){throw Error("Not implemented");};oa.prototype.requestSession=function(a,b){return $jscomp.asyncExecutePromiseGeneratorProgram(function(a){throw Error("Not implemented");})};oa.prototype.requestAnimationFrame=function(a){throw Error("Not implemented");};oa.prototype.onFrameStart=function(a){throw Error("Not implemented");};oa.prototype.onFrameEnd=function(a){throw Error("Not implemented");};oa.prototype.doesSessionSupportReferenceSpace=function(a,b){throw Error("Not implemented");};oa.prototype.requestStageBounds=
function(){throw Error("Not implemented");};oa.prototype.requestFrameOfReferenceTransform=function(a,b){return $jscomp.asyncExecutePromiseGeneratorProgram(function(a){return a.return(void 0)})};oa.prototype.cancelAnimationFrame=function(a){throw Error("Not implemented");};oa.prototype.endSession=function(a){throw Error("Not implemented");};oa.prototype.getViewport=function(a,b,c,d){throw Error("Not implemented");};oa.prototype.getProjectionMatrix=function(a){throw Error("Not implemented");};oa.prototype.getBasePoseMatrix=
function(){throw Error("Not implemented");};oa.prototype.getBaseViewMatrix=function(a){throw Error("Not implemented");};oa.prototype.getInputSources=function(){throw Error("Not implemented");};oa.prototype.getInputPose=function(a,b,c){throw Error("Not implemented");};oa.prototype.onWindowResize=function(){this.onWindowResize()};var ab={mapping:"xr-standard",displayProfiles:{"Oculus Quest":["oculus-touch-v2","oculus-touch","generic-trigger-squeeze-thumbstick"]},profiles:["oculus-touch","generic-trigger-squeeze-thumbstick"],
axes:{length:4,0:null,1:null,2:0,3:1},buttons:{length:7,0:1,1:2,2:null,3:0,4:3,5:4,6:null},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},Wa={mapping:"xr-standard",profiles:["microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},mb={"Daydream Controller":{mapping:"",profiles:["google-daydream","generic-trigger-touchpad"],buttons:{length:3,0:null,1:null,
2:0}},"Gear VR Controller":{mapping:"xr-standard",profiles:["samsung-gearvr","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[.11*Math.PI,0,0,1]}},"HTC Vive Focus Controller":{mapping:"xr-standard",profiles:["htc-vive-focus","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0}},"Oculus Go Controller":{mapping:"xr-standard",profiles:["oculus-go","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[.11*Math.PI,0,
0,1]}},"Oculus Touch (Right)":ab,"Oculus Touch (Left)":ab,"OpenVR Gamepad":{mapping:"xr-standard",profiles:["htc-vive","generic-trigger-squeeze-touchpad"],displayProfiles:{"HTC Vive":["htc-vive","generic-trigger-squeeze-touchpad"],"HTC Vive DVT":["htc-vive","generic-trigger-squeeze-touchpad"],"Valve Index":["valve-index","generic-trigger-squeeze-touchpad-thumbstick"]},buttons:{length:3,0:1,1:2,2:0},gripTransform:{position:[0,0,.05,1]},targetRayTransform:{orientation:[-.08*Math.PI,0,0,1]},userAgentOverrides:{Firefox:{axes:{invert:[1,
3]}}}},"Spatial Controller (Spatial Interaction Source) 045E-065A":Wa,"Spatial Controller (Spatial Interaction Source) 045E-065D":{mapping:"xr-standard",profiles:["samsung-odyssey","microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},"Windows Mixed Reality (Right)":Wa,"Windows Mixed Reality (Left)":Wa},bb=p(.155,-.465,-.15),nb=p(-.155,-.465,-.15),ob=p(0,0,-.25),pb=p(0,0,
.05),cb=p(-.08,.14,.08),db=180/Math.PI,Ja=function(){this.hand="right";this.headElbowOffset=bb;this.controllerQ=z();this.lastControllerQ=z();this.headQ=z();this.headPos=k();this.elbowPos=k();this.wristPos=k();this.lastTime=this.time=null;this.rootQ=z();this.position=k()};Ja.prototype.setHandedness=function(a){this.hand!=a&&(this.hand=a,this.headElbowOffset="left"==this.hand?nb:bb)};Ja.prototype.update=function(a,b){this.time=la();a&&(D(this.lastControllerQ,this.controllerQ),D(this.controllerQ,a));
b&&(g(this.headPos,b),f(this.headQ,b));a=this.getHeadYawOrientation_();b=this.quatAngle_(this.lastControllerQ,this.controllerQ);.61<b/((this.time-this.lastTime)/1E3)?y(this.rootQ,this.rootQ,a,Math.min(b/.175,1)):D(this.rootQ,a);a=p(0,0,-1);t(a,a,this.controllerQ);a=u(a,[0,1,0]);a=this.clamp_((a-.12)/.87,0,1);var c=N(this.rootQ);E(c,c);A(c,c,this.controllerQ);b=this.elbowPos;l(b,this.headPos);q(b,b,this.headElbowOffset);var d=n(cb);r(d,d,a);q(b,b,d);d=this.quatAngle_(c,z())*db;var e=(1-Math.pow(d/
180,4))*(.4+.24*a);d=z();y(d,d,c,e);e=E(z(),d);c=N(c);A(c,c,e);e=this.wristPos;l(e,pb);t(e,e,d);q(e,e,ob);t(e,e,c);q(e,e,b);b=n(cb);r(b,b,a);q(this.position,this.wristPos,b);t(this.position,this.position,this.rootQ);this.lastTime=this.time};Ja.prototype.getPosition=function(){return this.position};Ja.prototype.getHeadYawOrientation_=function(){var a=k();Y(a,this.headQ,"YXZ");var b=z(),c=a[1]*db;a=.5*Math.PI/180;var d=0*a;c*=a;var f=0*a;a=Math.sin(d);d=Math.cos(d);var e=Math.sin(c);c=Math.cos(c);var g=
Math.sin(f);f=Math.cos(f);b[0]=a*c*f-d*e*g;b[1]=d*e*f+a*c*g;b[2]=d*c*g-a*e*f;b[3]=d*c*f+a*e*g;return b};Ja.prototype.clamp_=function(a,b,c){return Math.min(Math.max(a,b),c)};Ja.prototype.quatAngle_=function(a,b){var c=[0,0,-1],d=[0,0,-1];t(c,c,a);t(d,d,b);a=p(c[0],c[1],c[2]);d=p(d[0],d[1],d[2]);m(a,a);m(d,d);d=u(a,d);d=1<d?0:-1>d?Math.PI:Math.acos(d);return d};$jscomp.initSymbol();var va=Symbol("@@webxr-polyfill/XRRemappedGamepad"),eb={pressed:!1,touched:!1,value:0};Object.freeze(eb);var Xa=function(b,
c,d){d||(d={});if(d.userAgentOverrides)for(var f in d.userAgentOverrides)if(navigator.userAgent.includes(f)){f=d.userAgentOverrides[f];for(var g in f)g in d?Object.assign(d[g],f[g]):d[g]=f[g];break}g=Array(d.axes&&d.axes.length?d.axes.length:b.axes.length);f=Array(d.buttons&&d.buttons.length?d.buttons.length:b.buttons.length);var k=null;if(d.gripTransform){var h=d.gripTransform.orientation||[0,0,0,1];k=a();e(k,J(h,h),d.gripTransform.position||[0,0,0])}h=null;if(d.targetRayTransform){var m=d.targetRayTransform.orientation||
[0,0,0,1];h=a();e(h,J(m,m),d.targetRayTransform.position||[0,0,0])}m=d.profiles;d.displayProfiles&&c.displayName in d.displayProfiles&&(m=d.displayProfiles[c.displayName]);this[va]={gamepad:b,map:d,profiles:m||[b.id],mapping:d.mapping||b.mapping,axes:g,buttons:f,gripTransform:k,targetRayTransform:h};this._update()};Xa.prototype._update=function(){for(var a=this[va].gamepad,b=this[va].map,c=this[va].axes,d=0;d<c.length;++d)c[d]=b.axes&&d in b.axes?null===b.axes[d]?0:a.axes[b.axes[d]]:a.axes[d];if(b.axes&&
b.axes.invert){d=$jscomp.makeIterator(b.axes.invert);for(var f=d.next();!f.done;f=d.next())f=f.value,f<c.length&&(c[f]*=-1)}c=this[va].buttons;for(d=0;d<c.length;++d)c[d]=b.buttons&&d in b.buttons?null===b.buttons[d]?eb:a.buttons[b.buttons[d]]:a.buttons[d]};$jscomp.global.Object.defineProperties(Xa.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return""}},_profiles:{configurable:!0,enumerable:!0,get:function(){return this[va].profiles}},index:{configurable:!0,enumerable:!0,get:function(){return-1}},
connected:{configurable:!0,enumerable:!0,get:function(){return this[va].gamepad.connected}},timestamp:{configurable:!0,enumerable:!0,get:function(){return this[va].gamepad.timestamp}},mapping:{configurable:!0,enumerable:!0,get:function(){return this[va].mapping}},axes:{configurable:!0,enumerable:!0,get:function(){return this[va].axes}},buttons:{configurable:!0,enumerable:!0,get:function(){return this[va].buttons}},hapticActuators:{configurable:!0,enumerable:!0,get:function(){return this[va].gamepad.hapticActuators}}});
var Na=function(b,c,d,f){d=void 0===d?0:d;f=void 0===f?-1:f;this.polyfill=b;this.display=c;this.gamepad=this.nativeGamepad=null;this.inputSource=new Sa(this);this.lastPosition=k();this.emulatedPosition=!1;this.basePoseMatrix=a();this.outputMatrix=a();this.primaryButtonIndex=d;this.primaryActionPressed=!1;this.primarySqueezeButtonIndex=f;this.primarySqueezeActionPressed=!1;this.handedness="";this.targetRayMode="gaze";this.armModel=null};Na.prototype.updateFromGamepad=function(a){this.nativeGamepad!==
a&&(this.gamepad=(this.nativeGamepad=a)?new Xa(a,this.display,mb[a.id]):null);this.handedness=""===a.hand?"none":a.hand;this.gamepad&&this.gamepad._update();a.pose?(this.targetRayMode="tracked-pointer",this.emulatedPosition=!a.pose.hasPosition):""===a.hand&&(this.targetRayMode="gaze",this.emulatedPosition=!1)};Na.prototype.updateBasePoseMatrix=function(){if(this.nativeGamepad&&this.nativeGamepad.pose){var a=this.nativeGamepad.pose,b=a.position,c=a.orientation;if(!b&&!c)return;b?(this.lastPosition[0]=
b[0],this.lastPosition[1]=b[1],this.lastPosition[2]=b[2]):a.hasPosition?b=this.lastPosition:(this.armModel||(this.armModel=new Ja),this.armModel.setHandedness(this.nativeGamepad.hand),this.armModel.update(c,this.polyfill.getBasePoseMatrix()),b=this.armModel.getPosition());e(this.basePoseMatrix,c,b)}else a=this.basePoseMatrix,b=this.polyfill.getBasePoseMatrix(),a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=
b[13],a[14]=b[14],a[15]=b[15];return this.basePoseMatrix};Na.prototype.getXRPose=function(a,b){this.updateBasePoseMatrix();switch(b){case "target-ray":a._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix);this.gamepad&&this.gamepad[va].targetRayTransform&&d(this.outputMatrix,this.outputMatrix,this.gamepad[va].targetRayTransform);break;case "grip":if(!this.nativeGamepad||!this.nativeGamepad.pose)return null;a._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix);this.gamepad&&
this.gamepad[va].gripTransform&&d(this.outputMatrix,this.outputMatrix,this.gamepad[va].gripTransform);break;default:return null}a._adjustForOriginOffset(this.outputMatrix);return new XRPose(new XRRigidTransform(this.outputMatrix),this.emulatedPosition)};$jscomp.global.Object.defineProperties(Na.prototype,{profiles:{configurable:!0,enumerable:!0,get:function(){return this.gamepad?this.gamepad._profiles:[]}}});var fb={highRefreshRate:!0},gb={oculus:1,openvr:1,"spatial controller (spatial interaction source)":1},
qb=0,rb=function(a,b,c){c=void 0===c?{}:c;this.mode=a;this.enabledFeatures=b;this.outputContext=null;this.immersive="immersive-vr"==a||"immersive-ar"==a;this.baseLayer=this.ended=null;this.id=++qb;this.modifiedCanvasLayer=!1;this.outputContext&&(this.renderContext=this.outputContext.canvas.getContext(c.renderContextType||"2d"))},na=function(b,c){var d=c.capabilities.canPresent;var f=oa.call(this,b)||this;f.display=c;f.frame=new b.VRFrameData;f.sessions=new Map;f.immersiveSession=null;f.canPresent=
d;f.baseModelMatrix=a();f.gamepadInputSources={};f.tempVec3=new Float32Array(3);f.onVRDisplayPresentChange=f.onVRDisplayPresentChange.bind(f);b.window.addEventListener("vrdisplaypresentchange",f.onVRDisplayPresentChange);f.CAN_USE_GAMEPAD=b.navigator&&"getGamepads"in b.navigator;f.HAS_BITMAP_SUPPORT=!(!b.ImageBitmapRenderingContext||!b.createImageBitmap);return f};$jscomp.inherits(na,oa);na.prototype.onBaseLayerSet=function(a,b){var c=this,d=this.sessions.get(a),f=b.context.canvas;if(d.immersive){a=
this.display.getEyeParameters("left");var e=this.display.getEyeParameters("right");f.width=2*Math.max(a.renderWidth,e.renderWidth);f.height=Math.max(a.renderHeight,e.renderHeight);this.display.requestPresent([{source:f,attributes:fb}]).then(function(){c.global.document.body.contains(f)||(d.modifiedCanvasLayer=!0,c.global.document.body.appendChild(f),f.style.display="block",f.style.position="absolute",f.style.width=f.style.height="1px",f.style.top=f.style.left="0px");d.baseLayer=b})}else d.baseLayer=
b};na.prototype.isSessionSupported=function(a){return"immersive-ar"==a||"immersive-vr"==a&&!1===this.canPresent?!1:!0};na.prototype.isFeatureSupported=function(a){switch(a){case "viewer":return!0;case "local":return!0;case "local-floor":return!0;case "bounded":return!1;case "unbounded":return!1;default:return!1}};na.prototype.requestSession=function(a,b){var c=this,d,f,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){if(1==g.nextAddress){if(!c.isSessionSupported(a))return g.return(Promise.reject());
d="immersive-vr"==a;if(!d)return g.jumpTo(2);f=c.global.document.createElement("canvas");f.getContext("webgl");return g.yield(c.display.requestPresent([{source:f,attributes:fb}]),2)}e=new rb(a,b,{renderContextType:c.HAS_BITMAP_SUPPORT?"bitmaprenderer":"2d"});c.sessions.set(e.id,e);d&&(c.immersiveSession=e,c.dispatchEvent("@@webxr-polyfill/vr-present-start",e.id));return g.return(Promise.resolve(e.id))})};na.prototype.requestAnimationFrame=function(a){return this.display.requestAnimationFrame(a)};
na.prototype.getPrimaryButtonIndex=function(a){var b=0,c=a.id.toLowerCase(),d;for(d in gb)if(c.includes(d)){b=gb[d];break}return Math.min(b,a.buttons.length-1)};na.prototype.onFrameStart=function(a,b){this.display.depthNear=b.depthNear;this.display.depthFar=b.depthFar;this.display.getFrameData(this.frame);a=this.sessions.get(a);if(a.immersive&&this.CAN_USE_GAMEPAD){var c=this.gamepadInputSources;this.gamepadInputSources={};for(var d=this.global.navigator.getGamepads(),f=0;f<d.length;++f){var e=d[f];
if(e&&0<e.displayId){var g=c[f];g||(g=new Na(this,this.display,this.getPrimaryButtonIndex(e)));g.updateFromGamepad(e);this.gamepadInputSources[f]=g;if(-1!=g.primaryButtonIndex){var k=e.buttons[g.primaryButtonIndex].pressed;k&&!g.primaryActionPressed?this.dispatchEvent("@@webxr-polyfill/input-select-start",{sessionId:a.id,inputSource:g.inputSource}):!k&&g.primaryActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-select-end",{sessionId:a.id,inputSource:g.inputSource});g.primaryActionPressed=
k}-1!=g.primarySqueezeButtonIndex&&((e=e.buttons[g.primarySqueezeButtonIndex].pressed)&&!g.primarySqueezeActionPressed?this.dispatchEvent("@@webxr-polyfill/input-squeeze-start",{sessionId:a.id,inputSource:g.inputSource}):!e&&g.primarySqueezeActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-squeeze-end",{sessionId:a.id,inputSource:g.inputSource}),g.primarySqueezeActionPressed=e)}}}!a.immersive&&a.baseLayer&&(a=a.baseLayer.context.canvas,h(this.frame.leftProjectionMatrix,b.inlineVerticalFieldOfView,
a.width/a.height,b.depthNear,b.depthFar))};na.prototype.onFrameEnd=function(a){a=this.sessions.get(a);if(!a.ended&&a.baseLayer){if(a.outputContext&&(!a.immersive||this.display.capabilities.hasExternalDisplay)){var b=a.baseLayer.context.canvas,c=a.immersive&&this.display.capabilities.hasExternalDisplay?b.width/2:b.width,d=b.height,f=a.outputContext.canvas,e=f.width;f=f.height;var g=a.renderContext;this.HAS_BITMAP_SUPPORT?b.transferToImageBitmap?g.transferFromImageBitmap(b.transferToImageBitmap()):
this.global.createImageBitmap(b,0,0,c,d,{resizeWidth:e,resizeHeight:f}).then(function(a){return g.transferFromImageBitmap(a)}):g.drawImage(b,0,0,c,d,0,0,e,f)}a.immersive&&a.baseLayer&&this.display.submitFrame()}};na.prototype.cancelAnimationFrame=function(a){this.display.cancelAnimationFrame(a)};na.prototype.endSession=function(a){var b=this,c;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){c=b.sessions.get(a);if(c.ended)return d.return();if(c.immersive)return d.return(b.display.exitPresent());
c.ended=!0;d.jumpToEnd()})};na.prototype.doesSessionSupportReferenceSpace=function(a,b){a=this.sessions.get(a);return a.ended?!1:a.enabledFeatures.has(b)};na.prototype.requestStageBounds=function(){if(this.display.stageParameters){var a=this.display.stageParameters.sizeX,b=this.display.stageParameters.sizeZ,c=[];c.push(-a/2);c.push(-b/2);c.push(a/2);c.push(-b/2);c.push(a/2);c.push(b/2);c.push(-a/2);c.push(b/2);return c}return null};na.prototype.requestFrameOfReferenceTransform=function(a,b){var c=
this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(b){return("local-floor"===a||"bounded-floor"===a)&&c.display.stageParameters&&c.display.stageParameters.sittingToStandingTransform?b.return(c.display.stageParameters.sittingToStandingTransform):b.return(null)})};na.prototype.getProjectionMatrix=function(a){if("left"===a)return this.frame.leftProjectionMatrix;if("right"===a)return this.frame.rightProjectionMatrix;if("none"===a)return this.frame.leftProjectionMatrix;throw Error("eye must be of type 'left' or 'right'");
};na.prototype.getViewport=function(a,b,c,d){a=this.sessions.get(a);var f=c.context.canvas;c=f.width;f=f.height;if(!a.immersive)return d.x=d.y=0,d.width=c,d.height=f,!0;if("left"===b||"none"===b)d.x=0;else if("right"===b)d.x=c/2;else return!1;d.y=0;d.width=c/2;d.height=f;return!0};na.prototype.getBasePoseMatrix=function(){var a=this.frame.pose,b=a.position;a=a.orientation;if(!b&&!a)return this.baseModelMatrix;b||(b=this.tempVec3,b[0]=b[1]=b[2]=0);e(this.baseModelMatrix,a,b);return this.baseModelMatrix};
na.prototype.getBaseViewMatrix=function(a){if("left"===a||"none"===a)return this.frame.leftViewMatrix;if("right"===a)return this.frame.rightViewMatrix;throw Error("eye must be of type 'left' or 'right'");};na.prototype.getInputSources=function(){var a=[],b;for(b in this.gamepadInputSources)a.push(this.gamepadInputSources[b].inputSource);return a};na.prototype.getInputPose=function(a,b,c){if(!b)return null;for(var d in this.gamepadInputSources){var f=this.gamepadInputSources[d];if(f.inputSource===
a)return f.getXRPose(b,c)}return null};na.prototype.onWindowResize=function(){};na.prototype.onVRDisplayPresentChange=function(a){var b=this;this.display.isPresenting||this.sessions.forEach(function(a){if(a.immersive&&!a.ended){if(a.modifiedCanvasLayer){var c=a.baseLayer.context.canvas;document.body.removeChild(c);c.setAttribute("style","")}b.immersiveSession===a&&(b.immersiveSession=null);b.dispatchEvent("@@webxr-polyfill/vr-present-end",a.id)}})};$jscomp.global.Object.defineProperties(na.prototype,
{depthNear:{configurable:!0,enumerable:!0,get:function(){return this.display.depthNear},set:function(a){this.display.depthNear=a}},depthFar:{configurable:!0,enumerable:!0,get:function(){return this.display.depthFar},set:function(a){this.display.depthFar=a}}});var hb=function(a,b){b=new lb(b||{});a=na.call(this,a,b)||this;a.display=b;a.frame={rightViewMatrix:new Float32Array(16),leftViewMatrix:new Float32Array(16),rightProjectionMatrix:new Float32Array(16),leftProjectionMatrix:new Float32Array(16),
pose:null,timestamp:null};return a};$jscomp.inherits(hb,na);var sb=0,tb=function(a,b){this.mode=a;this.enabledFeatures=b;this.baseLayer=this.ended=null;this.id=++sb},ra=function(b){b=oa.call(this,b)||this;b.sessions=new Map;b.projectionMatrix=a();b.identityMatrix=a();return b};$jscomp.inherits(ra,oa);ra.prototype.onBaseLayerSet=function(a,b){this.sessions.get(a).baseLayer=b};ra.prototype.isSessionSupported=function(a){return"inline"==a};ra.prototype.isFeatureSupported=function(a){switch(a){case "viewer":return!0;
default:return!1}};ra.prototype.requestSession=function(a,b){var c=this,d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(f){if(!c.isSessionSupported(a))return f.return(Promise.reject());d=new tb(a,b);c.sessions.set(d.id,d);return f.return(Promise.resolve(d.id))})};ra.prototype.requestAnimationFrame=function(a){return window.requestAnimationFrame(a)};ra.prototype.cancelAnimationFrame=function(a){window.cancelAnimationFrame(a)};ra.prototype.onFrameStart=function(a,b){a=this.sessions.get(a);
a.baseLayer&&(a=a.baseLayer.context.canvas,h(this.projectionMatrix,b.inlineVerticalFieldOfView,a.width/a.height,b.depthNear,b.depthFar))};ra.prototype.onFrameEnd=function(a){};ra.prototype.endSession=function(a){var b=this,c;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){c=b.sessions.get(a);c.ended=!0;d.jumpToEnd()})};ra.prototype.doesSessionSupportReferenceSpace=function(a,b){a=this.sessions.get(a);return a.ended?!1:a.enabledFeatures.has(b)};ra.prototype.requestStageBounds=function(){return null};
ra.prototype.requestFrameOfReferenceTransform=function(a,b){return $jscomp.asyncExecutePromiseGeneratorProgram(function(a){return a.return(null)})};ra.prototype.getProjectionMatrix=function(a){return this.projectionMatrix};ra.prototype.getViewport=function(a,b,c,d){this.sessions.get(a);b=c.context.canvas;a=b.width;b=b.height;d.x=d.y=0;d.width=a;d.height=b;return!0};ra.prototype.getBasePoseMatrix=function(){return this.identityMatrix};ra.prototype.getBaseViewMatrix=function(a){return this.identityMatrix};
ra.prototype.getInputSources=function(){return[]};ra.prototype.getInputPose=function(a,b,c){return null};ra.prototype.onWindowResize=function(){};var ub=function(a){var b,c;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){switch(d.nextAddress){case 1:b=null;if(!("getVRDisplays"in a.navigator)){d.jumpTo(2);break}d.setCatchFinallyBlocks(3);return d.yield(a.navigator.getVRDisplays(),5);case 5:(c=d.yieldResult)&&c.length&&(b=new na(a,c[0]));d.leaveTryBlock(2);break;case 3:d.enterCatchBlock();
case 2:return d.return(b)}})},vb=function(a,b){var c,d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(f){return 1==f.nextAddress?b.webvr?f.yield(ub(a),3):f.jumpTo(2):2!=f.nextAddress&&(c=f.yieldResult)?f.return(c):(d=jb(a))&&b.cardboard||!d&&b.allowCardboardOnDesktop?(a.VRFrameData||(a.VRFrameData=function(){this.rightViewMatrix=new Float32Array(16);this.leftViewMatrix=new Float32Array(16);this.rightProjectionMatrix=new Float32Array(16);this.leftProjectionMatrix=new Float32Array(16);
this.pose=null}),f.return(new hb(a,b.cardboardConfig))):f.return(new ra(a))})},wb={global:Q,webvr:!0,cardboard:!0,cardboardConfig:null,allowCardboardOnDesktop:!1},Qa=["navigator","HTMLCanvasElement","WebGLRenderingContext"],Ra=function(a){a=void 0===a?{}:a;this.config=Object.freeze(Object.assign({},wb,a));this.global=this.config.global;this.nativeWebXR="xr"in this.global.navigator;this.injected=!1;this.nativeWebXR?this._injectCompatibilityShims(this.global):this._injectPolyfill(this.global)};Ra.prototype._injectPolyfill=
function(a){if(!Qa.every(function(b){return!!a[b]}))throw Error("Global must have the following attributes : "+Qa);for(var b=$jscomp.makeIterator(Object.keys(Ua)),c=b.next();!c.done;c=b.next())c=c.value,void 0!==a[c]?console.warn(c+" already defined on global."):a[c]=Ua[c];Za(a.WebGLRenderingContext)&&($a(a.HTMLCanvasElement),a.OffscreenCanvas&&$a(a.OffscreenCanvas),a.WebGL2RenderingContext&&Za(a.WebGL2RenderingContext),window.isSecureContext||console.warn("WebXR Polyfill Warning:\nThis page is not running in a secure context (https:// or localhost)!\nThis means that although the page may be able to use the WebXR Polyfill it will\nnot be able to use native WebXR implementations, and as such will not be able to\naccess dedicated VR or AR hardware, and will not be able to take advantage of\nany performance improvements a native WebXR implementation may offer. Please\nhost this content on a secure origin for the best user experience.\n"));
this.injected=!0;this._patchNavigatorXR()};Ra.prototype._patchNavigatorXR=function(){var a=vb(this.global,this.config);this.xr=new Ua.XRSystem(a);Object.defineProperty(this.global.navigator,"xr",{value:this.xr,configurable:!0})};Ra.prototype._injectCompatibilityShims=function(a){if(!Qa.every(function(b){return!!a[b]}))throw Error("Global must have the following attributes : "+Qa);if(a.navigator.xr&&"supportsSession"in a.navigator.xr&&!("isSessionSupported"in a.navigator.xr)){var b=a.navigator.xr.supportsSession;
a.navigator.xr.isSessionSupported=function(a){return b.call(this,a).then(function(){return!0}).catch(function(){return!1})};a.navigator.xr.supportsSession=function(a){console.warn("navigator.xr.supportsSession() is deprecated. Please call navigator.xr.isSessionSupported() instead and check the boolean value returned when the promise resolves.");return b.call(this,a)}}};return Ra});(function(){var a=function(a,c,d,e,g,f){this.name=a;this.parentTexture=c;this.uvOffsetScale=new THREE.Vector4(d,e,g,f);this.isCutout=!1};a.prototype={addLoadedListener:function(a){this.parentTexture.addLoadedListener(a)},get hasAlpha(){return this.parentTexture.hasAlpha}};WALK.Texture=function(a,c,d,e,g,f,h,k){this.webFormats=this.stdExt=this.rawExt=this.name=this.id=null;this.isCube=!1;this.image=void 0!==a?a:WALK.Texture.DEFAULT_IMAGE;this.height=this.width=null;this.mipmaps=[];this.wrapS=void 0!==
c?c:GLC.CLAMP_TO_EDGE;this.wrapT=void 0!==d?d:GLC.CLAMP_TO_EDGE;this.magFilter=void 0!==e?e:GLC.LINEAR;this.minFilter=void 0!==g?g:GLC.LINEAR_MIPMAP_LINEAR;this.anisotropy=void 0!==k?k:1;this.isRgbm=this.isCutout=this.hasAlpha=this.isAnimated=!1;this.format=void 0!==f?f:GLC.RGBA;this.type=void 0!==h?h:GLC.UNSIGNED_BYTE;this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this._atlasEntries=null;this._needsUpdate=!1;this.releaseOnLoadedToGpu=!0;this.loaded=!1;this._loadedListeners=
[];this.fromEditor=!1;this.__webglSlot=this.__webglTexture=null};WALK.Texture.DEFAULT_IMAGE=void 0;WALK.Texture.prototype={constructor:WALK.Texture,sleepAnimation:function(){console.assert(!1)},wakeAnimation:function(){console.assert(!1)},get needsUpdate(){return this._needsUpdate},set needsUpdate(a){this._needsUpdate=a},isAtlas:function(){return null!==this._atlasEntries},enableAtlas:function(){console.assert(!this.isAtlas());this._atlasEntries={}},getAtlasEntry:function(b,c,d,e,g){var f=this._atlasEntries[b];
if(f)return f;console.assert(!this.loaded);f=new a(b,this,c,d,e,g);return this._atlasEntries[b]=f},forEachAtlasEntry:function(a){for(var b in this._atlasEntries)this._atlasEntries.hasOwnProperty(b)&&a(this._atlasEntries[b])},clone:function(a){void 0===a&&(a=new WALK.Texture);a.isCube=a.isCube;a.image=this.image;a.mipmaps=this.mipmaps.slice(0);a.wrapS=this.wrapS;a.wrapT=this.wrapT;a.magFilter=this.magFilter;a.minFilter=this.minFilter;a.anisotropy=this.anisotropy;a.isCutout=this.isCutout;a.isAnimated=
this.isAnimated;a.hasAlpha=this.hasAlpha;a.format=this.format;a.type=this.type;a.generateMipmaps=this.generateMipmaps;a.premultiplyAlpha=this.premultiplyAlpha;a.flipY=this.flipY;a.unpackAlignment=this.unpackAlignment;return a},serialize:function(){var a={id:this.id,name:this.name,stdExt:this.stdExt,webFormats:this.webFormats,alpha:this.hasAlpha};this.rawExt&&(a.rawExt=this.rawExt);this.isRgbm&&(a.rgbm=!0);this.video&&(a.video=!0);return a},dispose:function(){this._loadedListeners=[];this.dispatchEvent({type:"dispose"})},
addLoadedListener:function(a){this.loaded?a():this._loadedListeners.push(a)},notifyLoaded:function(){this.loaded=!0;for(var a=this._loadedListeners,c=0;c<a.length;c+=1)a[c]();a.length=0}};THREE.EventDispatcher.prototype.apply(WALK.Texture.prototype)})();(function(){WALK.CompressedTexture=function(a,b,c,d,e,g,f,h,k,n){WALK.Texture.call(this,null,g,f,h,k,d,e,n);this.image={width:b,height:c};this.mipmaps=a;this.generateMipmaps=this.flipY=!1};WALK.CompressedTexture.prototype=Object.create(WALK.Texture.prototype);WALK.CompressedTexture.prototype.constructor=WALK.CompressedTexture;WALK.CompressedTexture.prototype.clone=function(){var a=new WALK.CompressedTexture;WALK.Texture.prototype.clone.call(this,a);return a}})();(function(){WALK.DataTexture=function(a,b,c,d,e,g,f,h,k,n){WALK.Texture.call(this,null,g,f,h,k,d,e,n);this.image={data:a,width:b,height:c}};WALK.DataTexture.prototype=Object.create(WALK.Texture.prototype);WALK.DataTexture.prototype.constructor=WALK.DataTexture;WALK.DataTexture.prototype.clone=function(){var a=new WALK.DataTexture;WALK.Texture.prototype.clone.call(this,a);return a}})();(function(){WALK.VideoTexture=function(a,b,c,d,e,g,f,h,k){var n=this;WALK.Texture.call(this,a,b,c,d,e,g,f,h,k);this.generateMipmaps=!1;this.isAnimated=!0;this.releaseOnLoadedToGpu=!1;this._isPlaying=!0;this._pauseRequested=this._isSleeping=!1;this._handlePaused=function(){n._pauseRequested?(n._isPlaying=!1,n._pauseRequested=!1):n._isSleeping=!0};this._handleEnded=function(){n._isPlaying=!1;n._isSleeping=!1}};WALK.VideoTexture.prototype=Object.create(WALK.Texture.prototype);WALK.VideoTexture.prototype.constructor=
WALK.VideoTexture;Object.defineProperty(WALK.VideoTexture.prototype,"video",{get:function(){return this.image},set:function(a){this.image=a;this._isPlaying=!a.paused&&!a.ended;a.addEventListener("pause",this._handlePaused);a.addEventListener("ended",this._handleEnded);this._isSleeping&&this._isPlaying&&this.video.pause()}});Object.defineProperty(WALK.VideoTexture.prototype,"muted",{get:function(){return this.video.muted},set:function(a){this.video.muted=a}});Object.defineProperty(WALK.VideoTexture.prototype,
"loop",{get:function(){return this.video.loop},set:function(a){this.video.loop=a}});Object.defineProperty(WALK.VideoTexture.prototype,"isPlaying",{get:function(){return!this._isSleeping&&this._isPlaying}});WALK.VideoTexture.prototype.play=function(){var a=this;if(!this._isPlaying)if(this._isSleeping)this._isPlaying=!0;else{var b=this.video,c=b.play();c?(this._isPlaying=!0,c.catch(function(){a._isPlaying=!1})):this._isPlaying=!b.paused&&!b.ended}};WALK.VideoTexture.prototype.pause=function(){this._isPlaying&&
(this._isSleeping?this._isPlaying=!1:(this._pauseRequested=!0,this.video.pause()))};WALK.VideoTexture.prototype.sleepAnimation=function(){this._isSleeping||(this._isPlaying&&this.video&&this.video.pause(),this._isSleeping=!0)};WALK.VideoTexture.prototype.wakeAnimation=function(){this._isSleeping&&(this._isPlaying&&this.video&&this.video.play(),this._isSleeping=!1)};Object.defineProperty(WALK.VideoTexture.prototype,"needsUpdate",{get:function(){return this._needsUpdate||this.isPlaying&&this.video&&
this.video.readyState>=this.video.HAVE_CURRENT_DATA},set:function(a){this._needsUpdate=a}})})();(function(){WALK.WebGLRenderTarget=function(a,b,c){this.y=this.x=0;this.width=a;this.height=b;c=c||{};this.wrapS=void 0!==c.wrapS?c.wrapS:GLC.CLAMP_TO_EDGE;this.wrapT=void 0!==c.wrapT?c.wrapT:GLC.CLAMP_TO_EDGE;this.magFilter=void 0!==c.magFilter?c.magFilter:GLC.LINEAR;this.minFilter=void 0!==c.minFilter?c.minFilter:GLC.LINEAR_MIPMAP_LINEAR;this.anisotropy=void 0!==c.anisotropy?c.anisotropy:1;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.format=void 0!==c.format?c.format:
GLC.RGBA;this.type=void 0!==c.type?c.type:GLC.UNSIGNED_BYTE;this.depthBuffer=void 0!==c.depthBuffer?c.depthBuffer:!0;this.stencilBuffer=void 0!==c.stencilBuffer?c.stencilBuffer:!0;this.generateMipmaps=c.generateMipmaps||!1;this.shareDepthFrom=void 0!==c.shareDepthFrom?c.shareDepthFrom:null;this.isCube=!1;this.__webglSlot=this.__webglTexture=this.__webglRenderbuffer=this.__webglFramebuffer=null};WALK.WebGLRenderTarget.prototype={constructor:WALK.WebGLRenderTarget,dispose:function(){this.dispatchEvent({type:"dispose"})}};
THREE.EventDispatcher.prototype.apply(WALK.WebGLRenderTarget.prototype);WALK.WebGLRenderTargetVR=function(a){this.__webglFramebuffer=a;this.height=this.width=this.y=this.x=null;this.isCube=!1};WALK.WebGLRenderTargetVR.prototype={constructor:WALK.WebGLRenderTargetVR,dispose:function(){this.__webglFramebuffer=null;this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(WALK.WebGLRenderTargetVR.prototype)})();(function(){WALK.WebGLRenderTargetCube=function(a,b,c){WALK.WebGLRenderTarget.call(this,a,b,c);this.activeCubeFace=0;this.isCube=!0;this.__webglFramebuffer=[];this.__webglRenderbuffer=[]};WALK.WebGLRenderTargetCube.prototype=Object.create(WALK.WebGLRenderTarget.prototype);WALK.WebGLRenderTargetCube.prototype.constructor=WALK.WebGLRenderTargetCube})();(function(){var a=WALK.DEBUG;WALK.CutoutTextureDetector=function(b){var c={format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1},d=[b.createRenderTarget(1024,1024,c),b.createRenderTarget(512,512,c)];c={uniforms:{map:{type:"t",value:null},mapUvStep:{type:"v2",value:null},mapUvOffsetScale:{type:"v4",value:null}},vertexShader:WALK.getShader("alpha_stats_vertex.glsl"),fragmentShader:WALK.getShader("alpha_stats_fragment.glsl")};var e=new THREE.ShaderPass(c,
"map");e.material.depthTest=!1;e.material.depthWrite=!1;var g=new THREE.Vector2,f=new THREE.Vector4;e.uniforms.mapUvStep.value=g;e.uniforms.mapUvOffsetScale.value=f;c={uniforms:{map:{type:"t",value:null},mapUvStep:{type:"v2",value:null},mapUvScale:{type:"v2",value:null}},vertexShader:WALK.getShader("alpha_stats_vertex.glsl"),fragmentShader:WALK.getShader("alpha_stats_combine_fragment.glsl")};var h=new THREE.ShaderPass(c,"map");h.material.depthTest=!1;h.material.depthWrite=!1;var k=new THREE.Vector2;
h.uniforms.mapUvScale.value=k;h.uniforms.mapUvStep.value=g;var n=new Uint8Array(4096),p=null;a&&(p=new WALK.Timer);this.isCutoutTexture=function(c){var l=void 0!==c.parentTexture;if(l){var r=c.parentTexture;var m=c.uvOffsetScale.x;var u=c.uvOffsetScale.y;var x=c.uvOffsetScale.z;var t=c.uvOffsetScale.w}else r=c,m=u=0,x=t=1;if(!r.hasAlpha||r.video)c.isCutout=!1;else{a&&p.reset();b.enableScissorTest(!0);var v=r.width*x,w=r.height*t;g.set(1/v,1/w);f.set(m,u,x,t);v=Math.max(Math.floor(v/2),1);w=Math.max(Math.floor(w/
2),1);b.setRenderTarget(d[0]);b.setViewport(0,0,v,w);b.setScissor(0,0,v,w);e.render(b,d[0],r);for(var z=1,A=d[0];1!==v&&1!==w;){g.set(1/A.width,1/A.height);k.set(v/A.width,w/A.height);v=Math.floor(v/2);w=Math.floor(w/2);var y=d[z];b.setRenderTarget(y);b.setViewport(0,0,v,w);b.setScissor(0,0,v,w);h.render(b,y,A);A=y;z=(z+1)%2}b.readPixels(v,w,n);A=z=0;v=Math.max(v,w);for(w=0;w<v;++w)z+=n[4*w],A+=n[4*w+1];z=100*z/(255*v);A=100*A/(255*v);c.isCutout=20>z||50<A;a&&(v="",l&&(v+="From atlas: "+r.name+" ["+
m+", "+u+", "+x+", "+t+"]\n"),console.log(c.name+" "+r.width+"x"+r.height+"\n "+v+"Is cutout: "+c.isCutout+"\n Partialy transparent regions: "+z+"%\n Fully transparent pixels: "+A+"%\n Time: "+p.elapsedSec()));b.enableScissorTest(!1)}};this.dispose=function(){d[0].dispose();d[1].dispose();e.dispose();h.dispose()}}})();WALK.SHADERS={};WALK.SHADERS["aabb_query_fragment.glsl"]="//AUTO GENERATED\nvarying vec3 vPositionW;\nuniform int axis;\nvec4 encodeFloat(in float x) {\nfloat xabs = abs(x);\nfloat r = floor(xabs);\nfloat g = fract(xabs);\nreturn vec4(r / 255.0, g, 0.0, 0.0);\n}\nvoid main() {\nvec3 viewW = cameraPosition - vPositionW;\nif (axis == 0) {\ngl_FragColor = encodeFloat(viewW.x);\n} else if (axis == 1) {\ngl_FragColor = encodeFloat(viewW.y);\n} else if (axis == 2) {\ngl_FragColor = encodeFloat(viewW.z);\n}\n}\n";
WALK.SHADERS["aabb_query_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nvarying vec3 vPositionW;\nvoid main() {\nvec4 transformedPosition = transformPosition();\nvPositionW = (modelMatrix * transformedPosition).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n";
WALK.SHADERS["accumulate_fragment.glsl"]="//AUTO GENERATED\nuniform float weight;\nuniform sampler2D inputBuffer;\nvarying vec2 vUv;\nvoid main() {\nvec3 inputColor = texture2D(inputBuffer, vUv).rgb;\ngl_FragColor = vec4(inputColor, weight);\n}\n";WALK.SHADERS["accumulate_vertex.glsl"]="//AUTO GENERATED\nvarying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["alpha_stats_combine_fragment.glsl"]="//AUTO GENERATED\nuniform sampler2D map;\nuniform vec2 mapUvStep;\nuniform vec2 mapUvScale;\nvarying vec2 vUv;\nvoid main() {\nvec2 corner = vUv * mapUvScale- mapUvStep;\nvec2 uv = corner + 0.5 * mapUvStep;\nvec4 p0 = texture2D(map, uv);\nvec4 p1 = texture2D(map, uv + vec2(0.0, mapUvStep.y));\nvec4 p2 = texture2D(map, uv + vec2(mapUvStep.x, 0.0));\nvec4 p3 = texture2D(map, uv + vec2(mapUvStep.x, mapUvStep.y));\ngl_FragColor = vec4((p0.r + p1.r + p2.r + p3.r) / 4.0,\n(p0.g + p1.g + p2.g + p3.g) / 4.0, 0.0, 1.0);\nreturn;\n}\n";
WALK.SHADERS["alpha_stats_fragment.glsl"]="//AUTO GENERATED\nuniform sampler2D map;\nuniform vec2 mapUvStep;\nuniform vec4 mapUvOffsetScale;\nvarying vec2 vUv;\nvoid main() {\nvec2 corner = vUv * mapUvOffsetScale.zw + mapUvOffsetScale.xy - mapUvStep;\nvec2 uv = corner + 0.5 * mapUvStep;\nconst float bias = -1.0;\nfloat a0 = texture2D(map, uv, bias).a;\nfloat a1 = texture2D(map, uv + vec2(0.0, mapUvStep.y), bias).a;\nfloat a2 = texture2D(map, uv + vec2(mapUvStep.x, 0.0), bias).a;\nfloat a3 = texture2D(map, uv + vec2(mapUvStep.x, mapUvStep.y), bias).a;\nfloat fully_transparent_count = step(0.0, -a0) + step(0.0, -a1) +\nstep(0.0, -a2) + step(0.0, -a3);\nfloat partialy_transparent_count =\nstep(0.0, -abs(clamp(a0, 0.05, 0.95) - a0)) +\nstep(0.0, -abs(clamp(a1, 0.05, 0.95) - a1)) +\nstep(0.0, -abs(clamp(a2, 0.05, 0.95) - a2)) +\nstep(0.0, -abs(clamp(a3, 0.05, 0.95) - a3));\ngl_FragColor = vec4(step(4.0, partialy_transparent_count),\nfully_transparent_count / 4.0,\n0.0, 1.0);\nreturn;\n}\n";
WALK.SHADERS["alpha_stats_vertex.glsl"]="//AUTO GENERATED\nvarying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["anchor_sprite_vertex.glsl"]="//AUTO GENERATED\nvarying vec2 vUv;\nvoid main() {\nvUv = uv;\nvec4 mvPosition = modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0);\nvec2 scale;\nscale.x = length(modelMatrix[0].xyz);\nscale.y = length(modelMatrix[1].xyz);\nvec2 alignedPosition = position.xy * scale;\nmvPosition.xy += alignedPosition;\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["anchor_vertex.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvarying vec2 vUv;\n#endif\n#if defined(USE_BUMP_TEXTURE)\nvarying vec3 vNormalV;\nvarying vec3 vPositionV;\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvarying vec3 vNormalW;\nvarying vec3 vPositionW;\n#endif\nvoid main() {\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvec3 positionW = (modelMatrix * vec4(position, 1.0)).xyz;\nvec3 normal = sphericalDecode(sphericalNormal);\nvec3 normalW = mat3(modelMatrix[0].xyz,\nmodelMatrix[1].xyz,\nmodelMatrix[2].xyz) * normal;\nnormalW = normalize(normalW);\n#endif\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE)\nvec3 anchorCenterW = vec3(modelMatrix[3].xyz);\nvec3 cameraUpW = vec3(modelViewMatrix[0].y,\nmodelViewMatrix[1].y,\nmodelViewMatrix[2].y);\nvec3 forwardW = normalize(anchorCenterW - cameraPosition);\nvec3 rightW = cross(forwardW, cameraUpW);\nrightW.z = 0.0;\nrightW = normalize(rightW);\nvec3 upW = cross(rightW, forwardW);\nvUv = vec2(dot(normalW, rightW) * 0.5 + 0.5, dot(normalW, upW) * 0.5 + 0.5);\n#endif\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n#if defined(USE_BUMP_TEXTURE)\nvPositionV = -mvPosition.xyz;\nvNormalV = normalize(normalMatrix * normal);\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT)\nvNormalW = normalW;\nvPositionW = positionW;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["cubemap_filter_fragment.glsl"]="//AUTO GENERATED\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat rnd(vec2 uv) {\nreturn fract(sin(dot(uv, vec2(12.9898, 78.233) * 2.0)) * 43758.5453);\n}\nvec3 hemisphereSample_cos(vec2 uv, mat3 vecSpace, vec3 cubeDir, float gloss) {\nfloat phi = uv.y * 2.0 * PI;\nfloat cosTheta = sqrt(1.0 - uv.x);\nfloat sinTheta = sqrt(1.0 - cosTheta * cosTheta);\nvec3 sampleDir = vec3(cos(phi) * sinTheta, sin(phi) * sinTheta, cosTheta);\nreturn normalize(mix(vecSpace * sampleDir, cubeDir, gloss));\n}\nmat3 matrixFromVector(vec3 n) { // frisvad\nfloat a = 1.0 / (1.0 + n.z);\nfloat b = -n.x * n.y * a;\nvec3 b1 = vec3(1.0 - n.x * n.x * a, b, -n.x);\nvec3 b2 = vec3(b, 1.0 - n.y * n.y * a, -n.y);\nreturn mat3(b1, b2, n);\n}\nuniform samplerCube envMap;\nuniform float mipSize;\nuniform float face;\nuniform float gloss;\nvoid main(void) {\nvec2 st = 2.0 * floor(gl_FragCoord.xy) / (mipSize - 1.0) - 1.0;\nvec3 vec;\nif (face == 0.0) {\nvec = vec3(1, -st.y, -st.x);\n} else if (face == 1.0) {\nvec = vec3(-1, -st.y, st.x);\n} else if (face == 2.0) {\nvec = vec3(st.x, 1, st.y);\n} else if (face == 3.0) {\nvec = vec3(st.x, -1, -st.y);\n} else if (face == 4.0) {\nvec = vec3(st.x, -st.y, 1);\n} else {\nvec = vec3(-st.x, -st.y, -1);\n}\nmat3 vecSpace = matrixFromVector(normalize(vec));\nvec3 color = vec3(0.0);\nconst int samples = 200;\nvec3 vect;\nfor(int i = 0; i < samples; i++) {\nfloat sini = sin(float(i));\nfloat cosi = cos(float(i));\nfloat rand = rnd(vec2(sini, cosi));\nvect = hemisphereSample_cos(\nvec2(float(i) / float(samples), rand), vecSpace, vec, gloss);\ncolor += hdrDecode(textureCube(envMap, vect));\n}\ncolor /= float(samples);\ngl_FragColor = hdrEncode(color);\n}\n";
WALK.SHADERS["cubemap_filter_vertex.glsl"]="//AUTO GENERATED\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["cube_to_equirect_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nuniform samplerCube panoramaCube;\nvarying vec2 vUv;\nvoid main() {\nvec2 uv = vUv;\nfloat longitude = uv.x * 2. * PI;\nfloat latitude = uv.y * PI;\nvec3 dir = vec3(\nsin(longitude) * sin(latitude),\ncos(longitude) * sin(latitude),\ncos(latitude));\ngl_FragColor = textureCube(panoramaCube, normalize(dir));\n}\n";
WALK.SHADERS["cube_to_equirect_vertex.glsl"]="//AUTO GENERATED\nvarying vec2 vUv;\nvoid main()  {\nvUv = vec2(uv.x, uv.y - 1.0);\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["editor_light_fragment.glsl"]="//AUTO GENERATED\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 linearToGammaUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nuniform vec3 color;\nuniform vec3 highlight;\nuniform float highlightMix;\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 lVector = normalize(vViewPosition.xyz);\nfloat pointDiffuse = max(dot(normalize(vNormal), lVector), 0.0);\nvec3 lightColor = color * pointDiffuse;\nlightColor = mix(lightColor, highlight, highlightMix);\ngl_FragColor.xyz = min(linearToGamma(lightColor), 1.0);\n}\n";
WALK.SHADERS["editor_light_vertex.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 normal = sphericalDecode(sphericalNormal);\nvNormal = normalize(normalMatrix * normal);\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\nvViewPosition = -mvPosition.xyz;\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["equirect_sky_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat _g2l(in float x) {\nreturn (x <= 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, 2.4);\n}\nvec3 gammaToLinear(in vec3 rgb) {\nreturn vec3(_g2l(rgb.r), _g2l(rgb.g), _g2l(rgb.b));\n}\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 linearToGammaUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\nuniform sampler2D map;\nuniform float exposure;\nuniform float cameraGamma;\nvarying vec2 vUv;\n#ifdef USE_COLORMAP\nvec3 colormap(in sampler2D texture, in vec3 color) {\nconst float resolution = 16.0;\nconst float maxValueIndex = resolution - 1.0;\nconst float sliceWidth = 1.0 / resolution;\nconst float slicePixelWidth = sliceWidth / resolution;\nconst float sliceMarginWidth = 0.5 * slicePixelWidth;\nconst float sliceInnerWidth = sliceWidth - slicePixelWidth;\nconst float slicePixelHeight = 1.0 / resolution;\nconst float sliceMarginHeight = 0.5 * slicePixelHeight;\nconst float sliceInnerHeight = 1.0 - slicePixelHeight;\nfloat bSlice0 = min(floor(color.b * maxValueIndex), maxValueIndex - 1.0);\nfloat bSlice1 = bSlice0 + 1.0;\nfloat bOffset = color.b * maxValueIndex - bSlice0;\nfloat rSlicePos = sliceMarginWidth + color.r * sliceInnerWidth;\nfloat gSlicePos = sliceMarginHeight + color.g * sliceInnerHeight;\nfloat rPos0 = rSlicePos + (bSlice0 * sliceWidth);\nfloat rPos1 = rSlicePos + (bSlice1 * sliceWidth);\nvec3 color0 = texture2D(texture, vec2(rPos0, gSlicePos)).rgb;\nvec3 color1 = texture2D(texture, vec2(rPos1, gSlicePos)).rgb;\nreturn mix(color0, color1, bOffset);\n}\nuniform sampler2D colorMap;\n#endif\nvoid main() {\n#ifdef USE_RGBM_MAP\nvec4 colorRgbm = texture2D(map, vUv);\nvec3 colorLinear = hdrDecode(colorRgbm);\n#else\nvec3 colorLinear = gammaToLinear(texture2D(map, vUv).xyz);\n#endif\n#ifdef HDR_OUTPUT\n#ifdef USE_RGBM_MAP\ngl_FragColor = colorRgbm;\n#else\ngl_FragColor = hdrEncode(10.0 * colorLinear);\n#endif\n#else\nvec3 colorExposed = pow(exposure * colorLinear, vec3(cameraGamma));\nvec3 colorGamma =  linearToGammaUnreal(colorExposed);\n#ifdef USE_COLORMAP\ngl_FragColor.xyz = colormap(colorMap, colorGamma);\n#else\ngl_FragColor.xyz = colorGamma;\n#endif\n#endif\n}\n";
WALK.SHADERS["equirect_sky_vertex.glsl"]="//AUTO GENERATED\nvarying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["gaze_pointer_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nconst float pointRadius = 0.01;\nconst float pointBorder = 0.005;\nconst float timerRadius = 0.04;\nconst float timerBorder = 0.02;\nconst vec3 timerColor =  vec3(0.298, 0.619, 0.851);\nvarying vec2 coords;\nuniform float circleSpan;\nvoid main() {\nfloat dist =  sqrt(dot(coords, coords));\nif (dist < pointRadius) {\nfloat a = 1.0 - smoothstep(pointRadius - pointBorder, pointRadius, dist);\ngl_FragColor= vec4(1.0, 1.0, 1.0, a);\n} else if (-atan(coords.x, -coords.y) < circleSpan) {\nfloat a2 = smoothstep(timerRadius - timerBorder, timerRadius, dist) -\nsmoothstep(timerRadius, timerRadius + timerBorder, dist);\ngl_FragColor = vec4(timerColor, a2);\n} else {\ndiscard;\n}\n}\n";
WALK.SHADERS["gaze_pointer_vertex.glsl"]="//AUTO GENERATED\nvarying vec2 coords;\nvoid main() {\ncoords = vec2(position.x, position.y);\nvec4 outPosition = projectionMatrix *  modelViewMatrix * vec4(position, 1.0);\noutPosition.z = -0.1;\ngl_Position = outPosition;\n}\n";WALK.SHADERS["light_visibility_dilate_fragment.glsl"]="//AUTO GENERATED\nuniform sampler2D lightVisibilityMap;\nvarying vec2 vUv;\nuniform vec2 sizeInv;\nvoid main() {\nvec4 zero = vec4(0.0);\nvec4 visibility = texture2D(lightVisibilityMap, vUv);\nif (!all(equal(visibility, zero))) {\ngl_FragColor = visibility;\nreturn;\n}\nvisibility = texture2D(lightVisibilityMap, vUv - vec2(sizeInv.x, 0.0));\nif (!all(equal(visibility, zero))) {\ngl_FragColor = visibility;\nreturn;\n}\nvisibility = texture2D(lightVisibilityMap, vUv - vec2(0.0, sizeInv.y));\nif (!all(equal(visibility, zero))) {\ngl_FragColor = visibility;\nreturn;\n}\nvisibility = texture2D(lightVisibilityMap, vUv + vec2(sizeInv.x, 0.0));\nif (!all(equal(visibility, zero))) {\ngl_FragColor = visibility;\nreturn;\n}\nvisibility = texture2D(lightVisibilityMap, vUv + vec2(0.0, sizeInv.y));\nif (!all(equal(visibility, zero))) {\ngl_FragColor = visibility;\nreturn;\n}\nvisibility = texture2D(lightVisibilityMap, vUv + sizeInv);\nif (!all(equal(visibility, zero))) {\ngl_FragColor = visibility;\nreturn;\n}\nvisibility = texture2D(lightVisibilityMap, vUv - sizeInv);\nif (!all(equal(visibility, zero))) {\ngl_FragColor = visibility;\nreturn;\n}\nvisibility = texture2D(lightVisibilityMap, vUv + vec2(sizeInv.x, -sizeInv.y));\nif (!all(equal(visibility, zero))) {\ngl_FragColor = visibility;\nreturn;\n}\nvisibility = texture2D(lightVisibilityMap, vUv + vec2(-sizeInv.x, sizeInv.y));\ngl_FragColor = visibility;\n}\n";
WALK.SHADERS["light_visibility_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat rnd(vec2 uv) {\nreturn fract(sin(dot(uv, vec2(12.9898, 78.233) * 2.0)) * 43758.5453);\n}\nvec3 hemisphereSample_cos(vec2 uv, mat3 vecSpace, vec3 cubeDir, float gloss) {\nfloat phi = uv.y * 2.0 * PI;\nfloat cosTheta = sqrt(1.0 - uv.x);\nfloat sinTheta = sqrt(1.0 - cosTheta * cosTheta);\nvec3 sampleDir = vec3(cos(phi) * sinTheta, sin(phi) * sinTheta, cosTheta);\nreturn normalize(mix(vecSpace * sampleDir, cubeDir, gloss));\n}\nmat3 matrixFromVector(vec3 n) { // frisvad\nfloat a = 1.0 / (1.0 + n.z);\nfloat b = -n.x * n.y * a;\nvec3 b1 = vec3(1.0 - n.x * n.x * a, b, -n.x);\nvec3 b2 = vec3(b, 1.0 - n.y * n.y * a, -n.y);\nreturn mat3(b1, b2, n);\n}\n#define SPOT_PROPERTIES_NEEDED\n#define POINT_LIGHT_TYPE 0.0\n#define SPOT_LIGHT_TYPE 1.0\nuniform sampler2D lightAttrMap;\nuniform float lightsCount;\nstruct Light {\nvec3 positionW;\nfloat strength; // TODO: rename to intensity\nfloat size; // radius\nvec3 color;\n#ifdef SPOT_PROPERTIES_NEEDED\nfloat type; // POINT_LIGHT_TYPE or SPOT_LIGHT_TYPE\nvec3 spotDirectionW;\nfloat spotHalfAngle;\n#endif\n};\nconst float lightAttrFragments = 4.0;\nvoid readLightProperties(in float lightId, out Light light) {\nfloat lightAttrFragmentOffset = 1.0 / (lightAttrFragments * lightsCount);\nvec2 offset = vec2(lightId / lightsCount + 0.5 * lightAttrFragmentOffset,\n0.0);\nvec4 lightAttr = texture2D(lightAttrMap, offset);\nlight.positionW.xyz = lightAttr.xyz;\nlight.size = lightAttr.w;\noffset.x += lightAttrFragmentOffset;\nlightAttr = texture2D(lightAttrMap, offset);\nlight.color.xyz = lightAttr.xyz;\nlight.strength = lightAttr.w;\n#ifdef SPOT_PROPERTIES_NEEDED\noffset.x += lightAttrFragmentOffset;\nlightAttr = texture2D(lightAttrMap, offset);\nlight.type = lightAttr.x;\nlight.spotDirectionW.xyz = lightAttr.yzw;\noffset.x += lightAttrFragmentOffset;\nlightAttr = texture2D(lightAttrMap, offset);\nlight.spotHalfAngle = lightAttr.x;\n#endif\n}\n#define LENGTH_EPSILON 0.001\nuniform samplerCube objectDistanceMap;\nuniform sampler2D combineWithMap;\nuniform float objectId;\nuniform float lightId;\nvarying vec3 vNormalW;\nvarying vec3 vPositionW;\nvarying vec2 vUv2;\nvoid markAsReached(vec4 currentVisibility) {\nconst float fragmentReached = 0.01;\ngl_FragColor = max(currentVisibility, fragmentReached);\n}\nvoid main(void){\nvec4 currentVisibility = texture2D(combineWithMap, vUv2);\nLight light;\nreadLightProperties(lightId, light);\nvec3 normalW = normalize(vNormalW);\nvec3 toLightW = light.positionW - vPositionW;\nvec3 toLastVisiblePointW = toLightW + normalW * light.size;\nif (dot(normalW, toLastVisiblePointW) <= 0.0) {\nmarkAsReached(currentVisibility);\nreturn;\n}\nfloat lightDistance = length(toLightW);\nfloat spotStrengthFactor = 1.0;\nif (lightDistance >= LENGTH_EPSILON && light.type == SPOT_LIGHT_TYPE) {\nfloat spotHeight = dot(light.spotDirectionW, -toLightW);\nif (spotHeight < LENGTH_EPSILON) {\nmarkAsReached(currentVisibility);\nreturn;\n}\nfloat cosPointDir = spotHeight / lightDistance;\nfloat spotSlantHeight = spotHeight / cos(light.spotHalfAngle);\nfloat spotSinHalfFalloffRange = light.size / spotSlantHeight;\nfloat pointDirAngle = acos(cosPointDir);\nfloat spotHalfFalloffRange;\nif (spotSinHalfFalloffRange > 1.0) {\nspotHalfFalloffRange = light.spotHalfAngle / 6.0;\n} else {\nspotHalfFalloffRange =\nmin(asin(spotSinHalfFalloffRange), light.spotHalfAngle / 6.0);\n}\nfloat spotFalloffBegin = light.spotHalfAngle - spotHalfFalloffRange;\nif (pointDirAngle < spotFalloffBegin) {\nspotStrengthFactor = cos(pointDirAngle);\n} else {\nfloat linearFalloffWeight =\n(pointDirAngle - spotFalloffBegin) / (2.0 * spotHalfFalloffRange);\nspotStrengthFactor = mix(cos(spotFalloffBegin), 0.0, linearFalloffWeight);\n}\nif (spotStrengthFactor <= 0.0) {\nmarkAsReached(currentVisibility);\nreturn;\n}\n}\nvec3 cubeDir = -toLightW / lightDistance;\nfloat bias = 0.05;\nfloat visibility = 0.0;\nfloat diskRadius = 1.0 - light.size / (2.0 * lightDistance);\ndiskRadius = 0.97;\nmat3 cubeDirSpace = matrixFromVector(cubeDir);\nconst int samples = 50;\nvec3 newCubeDir;\nfor(int i = 0; i < samples; i++) {\nfloat sini = sin(float(i));\nfloat cosi = cos(float(i));\nfloat rand = rnd(vec2(sini, cosi));\nnewCubeDir = hemisphereSample_cos(vec2(float(i) / float(samples), rand),\ncubeDirSpace, cubeDir, diskRadius);\nvec4 objectDistance = textureCube(objectDistanceMap, newCubeDir);\nfloat collisionObjectId = objectDistance.x;\nfloat collisionDistance = objectDistance.y;\nif (objectId == collisionObjectId ||\ncollisionDistance > lightDistance - bias) {\nvisibility += 1.0;\n}\n}\nvisibility /= float(samples);\nvisibility *= spotStrengthFactor;\nif (visibility != 0.0) {\nconst float channelTaken = 1025.0;\nvec4 outputVisibility = min(channelTaken * currentVisibility, channelTaken);\nfloat visibilityChannel = float(lightId) + clamp(visibility, 0.001, 0.999);\ngl_FragColor = max(outputVisibility, visibilityChannel);\n} else {\nmarkAsReached(currentVisibility);\n}\n}\n";
WALK.SHADERS["light_visibility_free_channel_fragment.glsl"]="//AUTO GENERATED\nuniform sampler2D lightVisibilityMap;\nvarying vec2 vUv;\nuniform vec2 sizeInv;\nuniform float threshold;\nvoid main() {\nvec2 corner = vUv - sizeInv;\nvec2 uv = corner + 0.5 * sizeInv;\nvec4 visibility0 = texture2D(lightVisibilityMap, uv);\nvec4 visibility1 = texture2D(lightVisibilityMap, uv + vec2(0.0, sizeInv.y));\nvec4 visibility2 = texture2D(lightVisibilityMap, uv + vec2(sizeInv.x, 0.0));\nvec4 visibility3 = texture2D(lightVisibilityMap,\nuv + vec2(sizeInv.x, sizeInv.y));\ngl_FragColor = step(threshold, visibility0) + step(threshold, visibility1) +\nstep(threshold, visibility2) + step(threshold, visibility3);\n}\n";
WALK.SHADERS["light_visibility_vertex.glsl"]="//AUTO GENERATED\nvarying vec3 vNormalW;\nvarying vec3 vPositionW;\nvarying vec2 vUv2;\nvoid main() {\nvNormalW = mat3(modelMatrix[0].xyz,\nmodelMatrix[1].xyz,\nmodelMatrix[2].xyz) * normal;\nvNormalW = normalize(vNormalW);\nvPositionW = (modelMatrix * vec4(position, 1.0)).xyz;\nvUv2 = uv2;\ngl_Position = vec4(2.0 * uv2.x - 1.0, 2.0 * uv2.y - 1.0, 1.0, 1.0);\n}\n";WALK.SHADERS["luma_fragment.glsl"]="//AUTO GENERATED\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\n#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\nvec3 getLightIntensity() {\nreturn hdrDecode(texture2D(lightMap, vUv2));\n}\n#else // NOT USE_LIGHTMAP\nvec3 getLightIntensity() {\nreturn vec3(1.0);\n}\n#endif\nuniform vec3 color;\nvoid main() {\nvec3 receivedLight = getLightIntensity();\nvec3 diffuseLight = receivedLight * color;\nfloat luma = 0.299 * diffuseLight.r +\n0.587 * diffuseLight.g +\n0.114 * diffuseLight.b;\ngl_FragColor.r = fract(luma);\ngl_FragColor.g = floor(luma) / 255.0;\n}\n";
WALK.SHADERS["mirror_fragment.glsl"]="//AUTO GENERATED\nuniform vec3 mirrorColor;\nuniform sampler2D mirrorSampler;\nvarying vec4 mirrorCoord;\nfloat blendOverlay(float base, float blend) {\nreturn (base < 0.5 ? (2.0 * base * blend) :\n(1.0 - 2.0 * (1.0 - base) * (1.0 - blend)));\n}\nvoid main() {\nvec4 color = texture2DProj(mirrorSampler, mirrorCoord);\ncolor = vec4(blendOverlay(mirrorColor.r, color.r),\nblendOverlay(mirrorColor.g, color.g),\nblendOverlay(mirrorColor.b, color.b), 1.0);\ngl_FragColor = color;\n}\n";
WALK.SHADERS["mirror_vertex.glsl"]="//AUTO GENERATED\nuniform mat4 textureMatrix;\nvarying vec4 mirrorCoord;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\nvec4 worldPosition = modelMatrix * vec4(position, 1.0);\nmirrorCoord = textureMatrix * worldPosition;\ngl_Position = projectionMatrix * mvPosition;\n}\n";WALK.SHADERS["object_distance_byte_fragment.glsl"]="//AUTO GENERATED\nuniform int objectId;\nvarying vec3 vPositionW;\nvoid main(void) {\nfloat cameraDistance = min(distance(cameraPosition, vPositionW), 255.0);\nint x = objectId / 256;\nint y = objectId - 256 * x;\nfloat z = floor(cameraDistance);\nfloat a = fract(cameraDistance);\ngl_FragColor = vec4(float(x) / 255.0, float(y) / 255.0,\nz / 255.0, a);\n}\n";
WALK.SHADERS["object_distance_float_fragment.glsl"]="//AUTO GENERATED\nuniform int objectId;\nvarying vec3 vPositionW;\nvoid main(void){\nfloat cameraDistance = distance(cameraPosition, vPositionW);\ngl_FragColor = vec4(objectId, cameraDistance, 0.0, 1.0);\n}\n";WALK.SHADERS["object_distance_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nvarying vec3 vPositionW;\nvoid main() {\nvec4 transformedPosition = transformPosition();\nvPositionW = (modelMatrix * transformedPosition).xyz;\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n";
WALK.SHADERS["procedural_sky_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nuniform vec3 topColor;\nuniform vec3 bottomColor;\nuniform float sinBottomAngle;\nuniform float exponent;\nvarying vec3 vWorldDirection;\n#ifdef HDR_OUTPUT\nfloat _g2l(in float x) {\nreturn (x <= 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, 2.4);\n}\nvec3 gammaToLinear(in vec3 rgb) {\nreturn vec3(_g2l(rgb.r), _g2l(rgb.g), _g2l(rgb.b));\n}\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\n#endif\n#ifdef USE_COLORMAP\nvec3 colormap(in sampler2D texture, in vec3 color) {\nconst float resolution = 16.0;\nconst float maxValueIndex = resolution - 1.0;\nconst float sliceWidth = 1.0 / resolution;\nconst float slicePixelWidth = sliceWidth / resolution;\nconst float sliceMarginWidth = 0.5 * slicePixelWidth;\nconst float sliceInnerWidth = sliceWidth - slicePixelWidth;\nconst float slicePixelHeight = 1.0 / resolution;\nconst float sliceMarginHeight = 0.5 * slicePixelHeight;\nconst float sliceInnerHeight = 1.0 - slicePixelHeight;\nfloat bSlice0 = min(floor(color.b * maxValueIndex), maxValueIndex - 1.0);\nfloat bSlice1 = bSlice0 + 1.0;\nfloat bOffset = color.b * maxValueIndex - bSlice0;\nfloat rSlicePos = sliceMarginWidth + color.r * sliceInnerWidth;\nfloat gSlicePos = sliceMarginHeight + color.g * sliceInnerHeight;\nfloat rPos0 = rSlicePos + (bSlice0 * sliceWidth);\nfloat rPos1 = rSlicePos + (bSlice1 * sliceWidth);\nvec3 color0 = texture2D(texture, vec2(rPos0, gSlicePos)).rgb;\nvec3 color1 = texture2D(texture, vec2(rPos1, gSlicePos)).rgb;\nreturn mix(color0, color1, bOffset);\n}\nuniform sampler2D colorMap;\n#endif\nvoid main() {\nfloat sinDirection = normalize(vWorldDirection).z;\nfloat w = max(0.0, (sinDirection - sinBottomAngle) / (1.0 - sinBottomAngle));\nvec3 colorGamma = mix(bottomColor, topColor, pow(w, exponent));\n#ifdef HDR_OUTPUT\nvec3 colorLinear = gammaToLinear(colorGamma);\ngl_FragColor = hdrEncode(10.0 * colorLinear);\n#else\n#ifdef USE_COLORMAP\ngl_FragColor.xyz = colormap(colorMap, colorGamma);\n#else\ngl_FragColor.xyz = colorGamma;\n#endif\n#endif\n}\n";
WALK.SHADERS["procedural_sky_vertex.glsl"]="//AUTO GENERATED\nvarying vec3 vWorldDirection;\nvoid main() {\nvec3 positionW = (modelMatrix * vec4(position, 1.0)).xyz;\nvWorldDirection = positionW - cameraPosition;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["rotate_gizmo_material_fragment.glsl"]="//AUTO GENERATED\nuniform vec3 color;\nuniform float opacity;\nuniform vec3 gizmoPosition;\nuniform float sphereRadius;\nvarying vec4 mPosition;\nvoid discardIfRayIntersectsSphere(vec3 r0, vec3 rd, vec3 s0, float sr) {\nfloat a = dot(rd, rd);\nvec3 s0_r0 = r0 - s0;\nfloat b = 2.0 * dot(rd, s0_r0);\nfloat c = dot(s0_r0, s0_r0) - (sr * sr);\nfloat delta = b * b - 4.0 * a * c;\nif (delta >= 0.0 && -b - sqrt(delta) > 0.0) {\ndiscard;\n}\n}\nvoid main() {\nvec4 outColor;\noutColor.rgb = color;\noutColor.a = opacity;\nvec3 toCamera = normalize(cameraPosition - gizmoPosition);\ndiscardIfRayIntersectsSphere(mPosition.xyz, toCamera, gizmoPosition, sphereRadius);\ngl_FragColor = outColor;\n}\n";
WALK.SHADERS["rotate_gizmo_material_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nvarying vec4 mPosition;\nvoid main() {\nvec4 p = vec4(position, 1.0);\nmPosition = modelMatrix * p;\nvec4 mvPosition = modelViewMatrix * p;\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["standard_material_fragment.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nfloat _g2l(in float x) {\nreturn (x <= 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, 2.4);\n}\nvec3 gammaToLinear(in vec3 rgb) {\nreturn vec3(_g2l(rgb.r), _g2l(rgb.g), _g2l(rgb.b));\n}\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 linearToGammaUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nvec3 hdrDecode(in vec4 rgbm) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = rgbm.rgb * (rgbmScale * (1.0 - rgbm.a));\nreturn r * r;\n}\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT) || defined(USE_DYNAMIC_LIGHT)\nvarying vec3 vNormalW;\nvarying vec3 vPositionW;\n#endif\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvarying vec2 vUv;\n#endif\n#if defined(USE_BUMP_TEXTURE)\nvarying vec3 vPositionV;\nvarying vec3 vNormalV;\nuniform float bumpScale;\nuniform sampler2D bumpTexture;\nvec2 dBumpdxy() {\nvec2 texdx = dFdx(vUv);\nvec2 texdy = dFdy(vUv);\nfloat Hll = bumpScale * texture2D(bumpTexture, vUv).x;\nfloat dBx = bumpScale * texture2D(bumpTexture, vUv + texdx).x - Hll;\nfloat dBy = bumpScale * texture2D(bumpTexture, vUv + texdy).x - Hll;\nreturn vec2(dBx, dBy);\n}\nvec3 perturbNormal(in vec3 surfPos, in vec3 surfNorm) {\nvec2 dBdxy = dBumpdxy();\nvec3 vSigmaX = dFdx(surfPos);\nvec3 vSigmaY = dFdy(surfPos);\nvec3 R1 = cross(vSigmaY, surfNorm);\nvec3 R2 = cross(surfNorm, vSigmaX);\nfloat fDet = dot(vSigmaX, R1);\nvec3 vGrad = sign(fDet) * (dBdxy.x * R1 + dBdxy.y * R2);\nreturn normalize(abs(fDet) * surfNorm - vGrad);\n}\n#endif\n#ifdef USE_BASE_COLOR_TEXTURE\nuniform sampler2D baseColorTexture;\nuniform vec4 baseColorAtlasUvMod;\nuniform float alphaDiscardThreshold;\n#ifdef USE_PARALLAX_CORRECTION\n#endif\n#else\nuniform vec3 baseColor;\n#endif\nuniform float opacity;\nuniform vec4 baseColorCorrection;\nvec3 getBaseColor(out float alpha) {\n#ifdef USE_BASE_COLOR_TEXTURE\n#ifdef USE_PARALLAX_CORRECTION\n#else\nvec2 baseColorUv = vUv;\n#endif\nbaseColorUv = baseColorUv * baseColorAtlasUvMod.zw + baseColorAtlasUvMod.xy;\n#ifdef USE_ALPHA_IN_LOWER_HALF\nvec4 baseColorGamma = texture2D(baseColorTexture, vec2(baseColorUv.x, .5 + .5 * baseColorUv.y));\nfloat textureAlpha = texture2D(baseColorTexture, vec2(baseColorUv.x, .5 * baseColorUv.y)).r;\n#else\nvec4 baseColorGamma = texture2D(baseColorTexture, baseColorUv);\nfloat textureAlpha = baseColorGamma.a;\n#endif\nvec3 baseColor = gammaToLinear(baseColorGamma.rgb);\nalpha = opacity * textureAlpha;\n#else // NOT USE_BASE_COLOR_TEXTURE\nalpha = opacity;\n#endif\nvec3 baseColorCorrected = baseColorCorrection.a * baseColor +\nbaseColorCorrection.rgb;\nreturn clamp(baseColorCorrected, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));\n}\n#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\nvec3 getLightIntensity() {\nreturn hdrDecode(texture2D(lightMap, vUv2));\n}\n#else // NOT USE_LIGHTMAP\nvec3 getLightIntensity() {\nreturn vec3(1.0);\n}\n#endif\n#ifdef USE_ROUGHNESS_TEXTURE\nuniform sampler2D roughnessTexture;\n#else\nuniform float roughness;\n#endif\n#ifdef USE_METALLIC_TEXTURE\nuniform sampler2D metallicTexture;\n#else\nuniform float metallic;\n#endif\nvec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity);\n#if defined(USE_DYNAMIC_LIGHT) || defined(USE_ENVMAP)\nconst float DLT = 0.001;\n#ifdef USE_ENVMAP\nuniform samplerCube envMap;\nuniform float envMipsCount;\n#ifdef HAVE_TEXTURE_LOD\n#else\nuniform samplerCube envMap2;\n#endif\n#endif\nstruct Roughness {\n#ifdef USE_DYNAMIC_LIGHT\n#endif\n#ifdef USE_ENVMAP\nfloat envFresnel; // (1.0 - roughness)^2, used for Fresnel with env map\nfloat envMipLevel0;\nfloat envMipLevel1;\nfloat envMipMixFactor;\n#endif\n};\nRoughness getRoughnessFactors() {\nRoughness r;\n#ifdef USE_ROUGHNESS_TEXTURE\nfloat roughness = texture2D(roughnessTexture, vUv).x;\n#endif // else roughness is a uniform\nfloat roughness2 = roughness * roughness;\n#ifdef USE_DYNAMIC_LIGHT\n#endif\n#ifdef USE_ENVMAP\nfloat maxMipLevel = envMipsCount - 1.0;\nfloat mipSelector = roughness * maxMipLevel;\nr.envMipLevel0 = floor(mipSelector);\nr.envMipLevel1 = min(r.envMipLevel0 + 1.0, maxMipLevel);\nr.envMipMixFactor = fract(mipSelector);\nr.envFresnel = (roughness2 - 2.0 * roughness + 1.0);\n#endif\nreturn r;\n}\n#ifdef USE_ENVMAP\n#ifdef USE_ENVMAP_PROJECT\nuniform vec3 envBoxMin;\nuniform vec3 envBoxMax;\nuniform vec3 envMapPosW;\nconst vec3 infBox = vec3(1000.0);\nvec3 cubeMapProject(vec3 reflectionW) {\nvec3 firstPlaneIntersect = (envBoxMax - vPositionW) / reflectionW;\nvec3 secondPlaneIntersect = (envBoxMin - vPositionW) / reflectionW;\nvec3 furthestPlane = max(firstPlaneIntersect, secondPlaneIntersect);\nvec3 furthestPlaneNonNeg =\nstep(0.0, -furthestPlane) * infBox + abs(furthestPlane);\nfloat distance = min(min(furthestPlaneNonNeg.x, furthestPlaneNonNeg.y),\nfurthestPlaneNonNeg.z);\n/*if (furthestPlane.x > 0.0){\ndistance = furthestPlane.x;\n}\nif (furthestPlane.y > 0.0) {\ndistance = min(distance, furthestPlane.y);\n}\nif (furthestPlane.z > 0.0) {\ndistance = min(distance, furthestPlane.z);\n}*/\nvec3 intersectionPosW = vPositionW + reflectionW * distance;\nreturn intersectionPosW - envMapPosW;\n}\n#endif // USE_ENVMAP_PROJECT\nvec3 fixSeams(vec3 vec, float mipLevel) {\nfloat scale = 1.0 - exp2(mipLevel) / 128.0;\nfloat M = max(max(abs(vec.x), abs(vec.y)), abs(vec.z));\nif (abs(vec.x) != M) vec.x *= scale;\nif (abs(vec.y) != M) vec.y *= scale;\nif (abs(vec.z) != M) vec.z *= scale;\nreturn vec;\n}\nvec3 getEnvColor(in samplerCube envMap, in Roughness roughness,\nin vec3 reflectionW) {\nvec3 reflectionNormW = normalize(reflectionW);\n#ifdef USE_ENVMAP_PROJECT\nif (envBoxMin.x != envBoxMax.x) {\nreflectionNormW = cubeMapProject(reflectionNormW);\n}\n#endif\nvec3 reflectionNormFixedW = fixSeams(reflectionNormW,\nroughness.envMipLevel0);\n#ifdef HAVE_TEXTURE_LOD\nvec4 cubeColorRaw0 = textureCubeLodEXT(envMap, reflectionNormFixedW,\nroughness.envMipLevel0);\n#else\nvec4 cubeColorRaw0 = textureCube(envMap, reflectionNormFixedW);\n#endif\nvec3 cubeColor0 = hdrDecode(cubeColorRaw0);\n#ifdef HAVE_TEXTURE_LOD\nvec4 cubeColorRaw1 = textureCubeLodEXT(envMap, reflectionNormFixedW,\nroughness.envMipLevel1);\n#else\nvec4 cubeColorRaw1 = textureCube(envMap2, reflectionNormFixedW);\n#endif\nvec3 cubeColor1 = hdrDecode(cubeColorRaw1);\nreturn mix(cubeColor0, cubeColor1, roughness.envMipMixFactor);\n}\nvec3 fresnelSchlickEnv(in vec3 specularColor, in Roughness roughness,\nin float clampCosnv, inout float opacity) {\nfloat fresnel = 1.0 - clampCosnv;\nfloat fresnel2 = fresnel * fresnel;\nfresnel *= fresnel2 * fresnel2;\nfresnel *= roughness.envFresnel;\nopacity = opacity + (1.0 - opacity) * fresnel;\nreturn specularColor + (1.0 - specularColor) * fresnel;\n}\n#endif // USE_ENVMAP\n#ifdef USE_DYNAMIC_LIGHT\n#endif // USE_DYNAMIC_LIGHT\nvec3 getSpecularColor(in vec3 baseColor, float metalic) {\nconst float dielectricF0 = 0.04;\nreturn mix(vec3(dielectricF0), baseColor, metalic);\n}\nfloat getLuminance(in vec3 color) {\nreturn 0.2126 * color.r + 0.7152 * color.g + 0.0722 * color.b;\n}\nvec4 lerpLightVisibility(in sampler2D map, in vec2 uv, in vec2 size) {\nvec2 fragAddress = uv * size + 0.5;\nvec2 weight = fract(fragAddress);\nvec2 sizeInv = 1.0 / size;\nvec2 uvlb = floor(fragAddress) * sizeInv;\nvec4 lb = texture2D(map, uvlb);\nvec4 lt = texture2D(map, uvlb + vec2(0.0, sizeInv.y));\nvec4 rb = texture2D(map, uvlb + vec2(sizeInv.x, 0.0));\nvec4 rt = texture2D(map, uvlb + vec2(sizeInv.x, sizeInv.y));\nvec4 lb_idx = floor(lb);\nvec4 lt_idx = floor(lt);\nvec4 rb_idx = floor(rb);\nvec4 rt_idx = floor(rt);\nvec4 lt_idx_smaller_eq = step(lt_idx, lb_idx);\nvec4 rb_idx_smaller_eq = step(rb_idx, lb_idx);\nvec4 rt_idx_smaller_eq = step(rt_idx, lb_idx);\nlt = clamp(lt, lb_idx, lb_idx + 0.999 * lt_idx_smaller_eq);\nrb = clamp(rb, lb_idx, lb_idx + 0.999 * rb_idx_smaller_eq);\nrt = clamp(rt, lb_idx, lb_idx + 0.999 * rt_idx_smaller_eq);\nvec4 a = mix(lb, lt, weight.y);\nvec4 b = mix(rb, rt, weight.y);\nreturn mix(a, b, weight.x);\n}\nvec3 getNormalW() {\n#ifdef USE_BUMP_TEXTURE\nvec3 normalPerturbedV = perturbNormal(-vPositionV, normalize(vNormalV));\nreturn normalize(\ninverseTransformDirection(normalPerturbedV, viewMatrix));\n#else\nreturn normalize(vNormalW);\n#endif\n}\nvec3 addSpecular(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity) {\nvec3 totalSpec = vec3(0.0, 0.0, 0.0);\n#ifdef USE_METALLIC_TEXTURE\nfloat metallic = texture2D(metallicTexture, vUv).x;\n#endif // else metallic is a uniform\nvec3 diffuseIntensity = totalIntensity * (1.0 - mix(0.04, 1.0, metallic));\nvec3 viewW = normalize(cameraPosition - vPositionW);\nvec3 normalW = getNormalW();\nfloat clampCosnv = saturate(dot(normalW, viewW));\nvec3 reflectionW = reflect(-viewW, normalW);\nvec3 specularColor = getSpecularColor(baseColor, metallic);\nRoughness roughness = getRoughnessFactors();\n#ifdef USE_ENVMAP\nvec3 envColor = getEnvColor(envMap, roughness, reflectionW);\nvec3 fresnel = fresnelSchlickEnv(specularColor, roughness,\nclampCosnv, opacity);\ntotalSpec = envColor * fresnel;\n#endif\n#ifdef USE_DYNAMIC_LIGHT\n#endif\nfloat luminance = getLuminance(totalIntensity);\nreturn (baseColor * diffuseIntensity +\ntotalSpec * mix(0.4, 1.0, luminance));\n}\n#else // NOT (USE_DYNAMIC_LIGHT or USE_ENVMAP)\nvec3 addSpecular(vec3 baseColor, in vec3 lightIntensity, in float opacity) {\nreturn baseColor * lightIntensity;\n}\n#endif\n#ifdef USE_HIGHLIGTH\nuniform vec3 highlight;\nuniform float highlightMix;\n#endif\n#if defined(HDR_OUTPUT)\nvec4 hdrEncode(in vec3 rgb) {\nconst float rgbmScale = 2.82842712;  // sqrt(8)\nvec3 r = sqrt(rgb) / rgbmScale;\nfloat m = max(max(r.r, r.g), r.b);\nm = clamp(m, 1.0 / 255.0, 1.0);\nm = ceil(m * 255.0) / 255.0;\nr /= m;\nreturn vec4(r.r, r.g, r.b, (1.0 - m));\n}\n#endif\n#ifdef USE_COLORMAP\nvec3 colormap(in sampler2D texture, in vec3 color) {\nconst float resolution = 16.0;\nconst float maxValueIndex = resolution - 1.0;\nconst float sliceWidth = 1.0 / resolution;\nconst float slicePixelWidth = sliceWidth / resolution;\nconst float sliceMarginWidth = 0.5 * slicePixelWidth;\nconst float sliceInnerWidth = sliceWidth - slicePixelWidth;\nconst float slicePixelHeight = 1.0 / resolution;\nconst float sliceMarginHeight = 0.5 * slicePixelHeight;\nconst float sliceInnerHeight = 1.0 - slicePixelHeight;\nfloat bSlice0 = min(floor(color.b * maxValueIndex), maxValueIndex - 1.0);\nfloat bSlice1 = bSlice0 + 1.0;\nfloat bOffset = color.b * maxValueIndex - bSlice0;\nfloat rSlicePos = sliceMarginWidth + color.r * sliceInnerWidth;\nfloat gSlicePos = sliceMarginHeight + color.g * sliceInnerHeight;\nfloat rPos0 = rSlicePos + (bSlice0 * sliceWidth);\nfloat rPos1 = rSlicePos + (bSlice1 * sliceWidth);\nvec3 color0 = texture2D(texture, vec2(rPos0, gSlicePos)).rgb;\nvec3 color1 = texture2D(texture, vec2(rPos1, gSlicePos)).rgb;\nreturn mix(color0, color1, bOffset);\n}\nuniform sampler2D colorMap;\n#endif\n#ifdef USE_CHROMA_KEY\nuniform vec3 chromaKeyColor;\nuniform vec3 chromaKeyDeltaCoeff;\nconst float k32 = sqrt(3.0) / 2.0;\nvec3 rgb2abi(vec3 color) {\nfloat r = color.r;\nfloat g = color.g;\nfloat b = color.b;\nreturn vec3(\nr - 0.5 * g - 0.5 * b,\nk32 * (g - b),\n0.3333 * (r + g + b));\n}\nconst float IPI2 = 0.5 / 3.1415926538;\nvec3 rgb2hci(vec3 color) {\nvec3 abi = rgb2abi(color);\nreturn vec3(\natan(abi.y, abi.x) * IPI2,\nlength(abi.xy),\nabi.z);\n}\nfloat chromaKeyShapeFn(vec3 delta, vec3 color, vec3 key) {\nvec3 diff = color - key;\nvec3 v = delta * vec3(\n0.5 - abs(abs(diff.x) - 0.5),\nabs(diff.y),\nabs(diff.z));\nfloat x = max(v.r, max(v.g, v.b));\nreturn x * x;\n}\nfloat chromaKeyEdgeFn(float a) {\nreturn clamp(.2/.5 * (a - 1.0), 0.0, 1.0);\n}\n#endif\nuniform float emissionStrength;\nuniform float exposure;\nuniform float cameraGamma;\nvoid main() {\nfloat alpha;\nvec3 baseColor = getBaseColor(alpha);\n#ifdef USE_CHROMA_KEY\nfloat dist = chromaKeyShapeFn(chromaKeyDeltaCoeff, rgb2hci(baseColor), rgb2hci(chromaKeyColor));\nalpha *= chromaKeyEdgeFn(dist);\n#endif\n#ifdef USE_BASE_COLOR_TEXTURE\nif (alpha < alphaDiscardThreshold) {\ndiscard;\n}\n#endif\nvec3 lightIntensity = getLightIntensity();\n#ifdef USE_HIGHLIGTH\nbaseColor = mix(baseColor, highlight, highlightMix);\nalpha = mix(alpha, 1.0, highlightMix);\n#endif\nvec3 diffuseSpecular = addSpecularHook(baseColor, lightIntensity, alpha);\n#ifdef USE_HEADLIGHT\nvec3 lightW = normalize(cameraPosition - vPositionW.xyz);\nfloat pointDiffuse = max(dot(normalize(vNormalW), lightW), 0.0);\ndiffuseSpecular *= pointDiffuse;\n#endif\nvec3 diffuseSpecularEmissive = diffuseSpecular + baseColor * emissionStrength;\n#ifdef HDR_OUTPUT\nif (alpha < 0.5) {\ndiscard;\n}\ngl_FragColor = hdrEncode(diffuseSpecularEmissive);\n#else // no HDR_OUTPUT\nvec3 exposedColor = pow(exposure * diffuseSpecularEmissive.xyz,\nvec3(cameraGamma));\nvec3 gammaColor =  linearToGammaUnreal(exposedColor);\n#ifdef USE_COLORMAP\ngl_FragColor.rgb = colormap(colorMap, min(gammaColor, 1.0));\n#else\ngl_FragColor.rgb = gammaColor;\n#endif\ngl_FragColor.a = alpha;\n#endif // no HDR_OUTPUT\n}\n";
WALK.SHADERS["standard_material_vertex.glsl"]="//AUTO GENERATED\nconst float PI = 3.14159265358979;\nconst float RECIPROCAL_PI2 = 0.15915494;\nfloat saturate(in float a) {\nreturn clamp(a, 0.0, 1.0);\n}\nvec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\nreturn normalize((vec4(normal, 0.0) * matrix).xyz);\n}\nvec3 sphericalDecode(in vec2 spNormal) {\nfloat theta = (spNormal.x / 254.0 + 0.5) * PI;\nfloat phi = spNormal.y * (PI / 127.0);\nfloat sinTheta = sin(theta);\nreturn vec3(sinTheta * cos(phi), sinTheta * sin(phi), cos(theta));\n}\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvarying vec2 vUv;\nuniform vec4 uvMod;\n#endif\n#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif\n#ifdef USE_BUMP_TEXTURE\nvarying vec3 vPositionV;\nvarying vec3 vNormalV;\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT) || defined(USE_DYNAMIC_LIGHT)\nvarying vec3 vNormalW;\nvarying vec3 vPositionW;\n#endif\nvoid main() {\n#if defined(USE_BASE_COLOR_TEXTURE) || defined(USE_ROUGHNESS_TEXTURE) || defined(USE_METALLIC_TEXTURE) || defined(USE_BUMP_TEXTURE)\nvUv = uv * uvMod.zw + uvMod.xy;\n#endif\nvec4 transformedPosition = transformPosition();\nvec4 mvPosition = modelViewMatrix * transformedPosition;\n#ifdef USE_LIGHTMAP\nfloat zeroOrOne = clamp(ceil(uv2.x + uv2.y), 0.0, 1.0);\nvUv2 = uv2 * uv2Mod.zw + uv2Mod.xy * zeroOrOne;\n#endif\n#if defined(USE_BUMP_TEXTURE) || defined(USE_ENVMAP) || defined(USE_HEADLIGHT) || defined(USE_DYNAMIC_LIGHT)\nvec3 n = sphericalDecode(sphericalNormal);\nvec3 normal = vec3(\nt0.x * n.x + t0.y * n.y + t0.z * n.z,\nt1.x * n.x + t1.y * n.y + t1.z * n.z,\nt2.x * n.x + t2.y * n.y + t2.z * n.z);\n#endif\n#if defined(USE_BUMP_TEXTURE)\nvPositionV = -mvPosition.xyz;\nvNormalV = normalize(normalMatrix * normal);\n#endif\n#if defined(USE_ENVMAP) || defined(USE_HEADLIGHT) || defined(USE_DYNAMIC_LIGHT)\nvNormalW = mat3(modelMatrix[0].xyz,\nmodelMatrix[1].xyz,\nmodelMatrix[2].xyz) * normal;\nvNormalW = normalize(vNormalW);\nvPositionW = (modelMatrix * transformedPosition).xyz;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}\n";
WALK.SHADERS["static_render_fragment.glsl"]="//AUTO GENERATED\nfloat _l2g(in float x) {\nreturn (x <= 0.0031308) ? x * 12.92 : pow(x, 1.0 / 2.4) * 1.055 - 0.055;\n}\nvec3 linearToGamma(in vec3 rgb) {\nreturn vec3(_l2g(rgb.r), _l2g(rgb.g), _l2g(rgb.b));\n}\nvec3 linearToGammaUnreal(in vec3 rgb) {\nreturn rgb / (rgb + 0.187) * 1.035;\n}\nuniform sampler2D staticRender;\nuniform vec2 sizeInv;\nvoid main() {\nvec3 colorLinear = texture2D(staticRender, gl_FragCoord.xy * sizeInv).rgb;\ngl_FragColor.rgb = linearToGammaUnreal(colorLinear);\n}\n";
WALK.SHADERS["static_render_vertex.glsl"]="//AUTO GENERATED\nvoid main() {\ngl_Position = modelViewMatrix * vec4(position, 1.0);\n}\n";WALK.SHADERS["water.glsl"]="//AUTO GENERATED\n#ifdef USE_NORMAL_TEXTURE\nuniform float time;\nuniform float wavesScale;\nuniform float refractionFactor;\nuniform sampler2D normalTexture;\nvec4 getNoise(in vec2 uv) {\nvec2 uv0 = (uv / 103.0) + vec2(time / 17.0, time / 29.0);\nvec2 uv1 = uv / 107.0 - vec2(time / -19.0, time / 31.0);\nvec2 uv2 = uv / vec2(897.0, 983.0) + vec2(time / 101.0, time / 97.0);\nvec2 uv3 = uv / vec2(991.0, 877.0) - vec2(time / 109.0, time / -113.0);\nvec4 noise = texture2D(normalTexture, uv0) +\ntexture2D(normalTexture, uv1) +\ntexture2D(normalTexture, uv2) +\ntexture2D(normalTexture, uv3);\nreturn noise * 0.5 - 1.0;\n}\nvec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity) {\nvec3 toEyeW = cameraPosition - vPositionW;\nvec3 viewW = normalize(toEyeW);\nvec4 noise = getNoise(vPositionW.xy * wavesScale);\nvec3 normalW = normalize(noise.xyz);\nfloat clampCosnv = saturate(dot(normalW, viewW));\nRoughness roughness;\nroughness.envMipLevel0 = 0.0;\nroughness.envMipLevel1 = 0.0;\nroughness.envMipMixFactor = 0.0;\nroughness.envFresnel = 1.0;\nconst float waterF0 = 0.02;\nvec3 specularColor = vec3(waterF0);\nvec3 reflectionW = reflect(-viewW, normalW);\nvec3 refractionW = refract(-viewW, normalW, 0.75);\nvec3 reflectedEnv = getEnvColor(envMap, roughness, normalize(reflectionW));\nvec3 refractedEnv = refractionFactor *\ngetEnvColor(envMap, roughness, normalize(refractionW));\nvec3 fresnel = fresnelSchlickEnv(specularColor, roughness,\nclampCosnv, opacity);\nvec3 totalSpec = reflectedEnv * fresnel + refractedEnv * (1.0 - fresnel);\nvec3 diffuseIntensity = totalIntensity * 0.98;\nfloat luminance = getLuminance(totalIntensity);\nreturn totalSpec * mix(0.4, 1.0, luminance) + baseColor * diffuseIntensity;\n}\n#else // NOT USE_NORMAL_TEXTURE\nvec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\ninout float opacity) {\nreturn baseColor * totalIntensity;\n}\n#endif\n";
WALK.SHADERS["wireframe_fragment.glsl"]="//AUTO GENERATED\nuniform vec3 lineColor;\nuniform float lineMaxAlpha;\nuniform vec3 highlight;\nuniform float highlightMix;\nvarying vec3 vBaryCentric;\nfloat edgeFactor(){\nvec3 d = fwidth(vBaryCentric);\nvec3 r = smoothstep(vec3(0.0), d * 1.5, vBaryCentric);\nreturn min(min(r.x, r.y), r.z);\n}\nvoid main(void){\nfloat edge = edgeFactor();\nif (edge < 1.0) {\ngl_FragColor.rgb = lineColor;\ngl_FragColor.w = (1.0 - edge) * lineMaxAlpha;\n} else {\ngl_FragColor.rgb = highlight;\ngl_FragColor.w = highlightMix;\n}\n}\n";
WALK.SHADERS["wireframe_vertex.glsl"]="//AUTO GENERATED\nvec4 transformPosition() {\nreturn vec4(\nt0.x * position.x + t0.y * position.y + t0.z * position.z + t0.w,\nt1.x * position.x + t1.y * position.y + t1.z * position.z + t1.w,\nt2.x * position.x + t2.y * position.y + t2.z * position.z + t2.w,\n1.0);\n}\nattribute float order;\nvarying vec3 vBaryCentric;\nvoid main() {\nif (order == 0.0) {\nvBaryCentric = vec3(1.0, 0.0, 0.0);\n} else if (order == 1.0) {\nvBaryCentric = vec3(0.0, 1.0, 0.0);\n} else {\nvBaryCentric = vec3(0.0, 0.0, 1.0);\n}\nvec4 transformedPosition = transformPosition();\ngl_Position = projectionMatrix * modelViewMatrix * transformedPosition;\n}\n";(function(){WALK.Shader=function(a,c){this.id=a;this.code=c};var a=0;WALK.InlineShader=function(b){WALK.Shader.call(this,"inline:"+a,b);a+=1};WALK.getShader=function(a){return new WALK.Shader(a,WALK.SHADERS[a])}})();(function(){var a=0,b=[0,0],c=Object.freeze({uv:b,uv2:b,uv2Mod:[0,0,1/65535,1/65535],t0:[1,0,0,0],t1:[0,1,0,0],t2:[0,0,1,0]}),d=Object.freeze("position sphericalNormal uv uv2 uv2Mod t0 t1 t2".split(" ")),e=new WALK.InlineShader("");WALK.BaseMaterial=function(b,f,h){h=void 0===h?e:h;a+=1;Object.defineProperty(this,"id",{value:a});this.name="";this.side=THREE.FrontSide;this.doNotOverrideSide=!1;this.opacity=1;this.transparent=!1;this.transparentRenderOrder=0;this.blending=THREE.NoBlending;this.blendSrc=
GLC.SRC_ALPHA;this.blendDst=GLC.ONE_MINUS_SRC_ALPHA;this.blendEquation=GLC.FUNC_ADD;this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null;this.colorWrite=this.depthWrite=this.depthTest=!0;this._hideFromLightProbes=!1;this._defines=new Set;this._definesString=null;this._textureLodExtension=this._standardDerivativesExtension=!1;this.uniforms={};this.attributes=d;this._vertexShaderBody=b;this._fragmentShaderBody=f;this._fragmentShaderHooks=h;this.defaultAttributeValues=c;this.index0AttributeName=
void 0;this._programNeedsUpdate=this.visible=!0;this.program=null};WALK.BaseMaterial.prototype={constructor:WALK.BaseMaterial,get isAnimated(){return!1},get isPlaying(){return!1},update:function(a){},play:function(){console.assert(!1)},pause:function(){console.assert(!1)},get hideFromLightProbes(){return this._hideFromLightProbes},set hideFromLightProbes(a){this._hideFromLightProbes=a},get programNeedsUpdate(){return this._programNeedsUpdate},set programNeedsUpdate(a){this._definesString=null;this._programNeedsUpdate=
a},hasDefine:function(a){return this._defines.has(a)},addDefine:function(a){this.hasDefine(a)||(this._defines.add(a),this.programNeedsUpdate=!0)},removeDefine:function(a){this.hasDefine(a)&&(this._defines.delete(a),this.programNeedsUpdate=!0)},condDefine:function(a,b){a?this.addDefine(b):this.removeDefine(b);return a},_getDefinesString:function(){if(null===this._definesString){for(var a=[],b=$jscomp.makeIterator(this._defines),c=b.next();!c.done;c=b.next())a.push("#define "+c.value);a.sort();this._definesString=
a.join("\n")}return this._definesString},generateProgramId:function(){return[this._fragmentShaderBody.id,this._fragmentShaderHooks.id,this._getDefinesString(),this._vertexShaderBody.id,this._standardDerivativesExtension?"+":"",this._textureLodExtension?"+":""].join("$")},enableStandardDerivativesExtension:function(){this._standardDerivativesExtension||(this.programNeedsUpdate=this._standardDerivativesExtension=!0)},enableTextureLodExtension:function(){this._textureLodExtension||(this.programNeedsUpdate=
this._textureLodExtension=!0)},generateVertexShader:function(){return["precision highp float;\nprecision highp int;",this._getDefinesString(),"uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec2 sphericalNormal;\nattribute vec2 uv;\nattribute vec2 uv2;\nattribute vec4 uv2Mod;\nattribute vec4 t0;\nattribute vec4 t1;\nattribute vec4 t2;",
this._vertexShaderBody.code].join("\n")},generateFragmentShader:function(){return[this._standardDerivativesExtension?"#extension GL_OES_standard_derivatives : enable":"",this._textureLodExtension?"#extension GL_EXT_shader_texture_lod : require":"","precision "+WALK.DETECTOR.fragmentPrecision+" float;","precision "+WALK.DETECTOR.fragmentPrecision+" int;",this._getDefinesString(),"uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;",this._fragmentShaderBody.code,this._fragmentShaderHooks.code].join("\n")},
dispose:function(){this.dispatchEvent({type:"dispose"})},setUniform:function(a,b,c){this.uniforms[a]={type:b,value:c}},propertyFromUniform:function(a){Object.defineProperty(this,a,{get:function(){return this.uniforms[a].value},set:function(b){this.uniforms[a].value=b}})},hash:function(){console.assert(!1,"hash not implemented")},canMerge:function(a){console.assert(!1,"canMerge not implemented")}};THREE.EventDispatcher.prototype.apply(WALK.BaseMaterial.prototype)})();(function(){WALK.CompressedTextureLoader=function(){this._parser=null};WALK.CompressedTextureLoader.prototype={constructor:WALK.CompressedTextureLoader,load:function(a,b,c,d){var e=this,g=[],f=new WALK.CompressedTexture;f.image=g;WALK.queueAjaxGet(a,b,!0,function(a){a=e._parser(a,!0);if(a.isCubemap)for(var b=a.mipmaps.length/a.mipmapCount,d=0;d<b;d+=1){g[d]={mipmaps:[]};for(var h=0;h<a.mipmapCount;h+=1)g[d].mipmaps.push(a.mipmaps[d*a.mipmapCount+h]),g[d].format=a.format,g[d].width=a.width,g[d].height=
a.height}else f.image.width=a.width,f.image.height=a.height,f.mipmaps=a.mipmaps;1===a.mipmapCount&&(f.minFilter=GLC.LINEAR);f.format=a.format;f.width=a.width;f.height=a.height;c&&c(f)},d);return f}}})();THREE.FXAAShader={uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new THREE.Vector2(1/1024,1/512)}},vertexShader:new WALK.InlineShader("void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"),fragmentShader:new WALK.InlineShader("uniform sampler2D tDiffuse;\nuniform vec2 resolution;\n#define FXAA_REDUCE_MIN   (1.0/128.0)\n#define FXAA_REDUCE_MUL   (1.0/8.0)\n#define FXAA_SPAN_MAX     8.0\nvoid main() {\nvec3 rgbNW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ).xyz;\nvec3 rgbNE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ).xyz;\nvec3 rgbSW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ).xyz;\nvec3 rgbSE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ).xyz;\nvec4 rgbaM  = texture2D( tDiffuse,  gl_FragCoord.xy  * resolution );\nvec3 rgbM  = rgbaM.xyz;\nvec3 luma = vec3( 0.299, 0.587, 0.114 );\nfloat lumaNW = dot( rgbNW, luma );\nfloat lumaNE = dot( rgbNE, luma );\nfloat lumaSW = dot( rgbSW, luma );\nfloat lumaSE = dot( rgbSE, luma );\nfloat lumaM  = dot( rgbM,  luma );\nfloat lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );\nfloat lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );\nvec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );\nfloat rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );\ndir = min( vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX),\nmax( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\ndir * rcpDirMin)) * resolution;\nvec4 rgbA = (1.0/2.0) * (\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (1.0/3.0 - 0.5)) +\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (2.0/3.0 - 0.5)));\nvec4 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (0.0/3.0 - 0.5)) +\ntexture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (3.0/3.0 - 0.5)));\nfloat lumaB = dot(rgbB, vec4(luma, 0.0));\nif ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) ) {\ngl_FragColor = rgbA;\n} else {\ngl_FragColor = rgbB;\n}\n}")};THREE.CopyShader={uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:new WALK.InlineShader("varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"),fragmentShader:new WALK.InlineShader("uniform float opacity;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\ngl_FragColor = opacity * texel;\n}")};THREE.EffectComposer=function(a){this.renderer=a;this.renderTarget2=this.renderTarget1=null;this.passes=[];void 0===THREE.CopyShader&&console.error("THREE.EffectComposer relies on THREE.CopyShader")};
THREE.EffectComposer.prototype={addPass:function(a){this.passes.push(a)},disposeTarget:function(){this.renderTarget1&&(this.renderTarget1.dispose(),this.renderTarget1=null);this.renderTarget2&&(this.renderTarget2.dispose(),this.renderTarget2=null)},configureTarget:function(a,b,c){this.disposeTarget();this.renderTarget1=this.renderer.createRenderTarget(a,b,c);this.renderTarget2=this.renderer.createRenderTarget(a,b,c)},render:function(){var a,b;return function(c){a=this.renderTarget1;b=this.renderTarget2;
var d,e=this.passes.length;for(d=0;d<e;d++){var g=this.passes[d];g.enabled&&(g.render(this.renderer,a,b,c),g.needsSwap&&d!=e-1&&(g=b,b=a,a=g))}}}()};THREE.ShaderPass=function(a,b){this.textureID=void 0!==b?b:"tDiffuse";this.material=new WALK.BaseMaterial(a.vertexShader,a.fragmentShader);this.material.uniforms=THREE.UniformsUtils.clone(a.uniforms);this.uniforms=this.material.uniforms;this.renderToScreen=!1;this.needsSwap=this.enabled=!0;this.clear=!1;this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1);this.scene=new THREE.Scene;this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),this.material);this.scene.add(this.quad)};
THREE.ShaderPass.prototype={render:function(a,b,c,d){if(d=this.material.uniforms[this.textureID])d.value=c;this.renderToScreen?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,this.clear)},dispose:function(){this.material.dispose();this.quad.geometry.dispose()}};THREE.RenderPass=function(a,b,c){this.scene=a;this.camera=b;this.overrideMaterial=c;this.needsSwap=this.clear=this.enabled=!0};THREE.RenderPass.prototype={render:function(a,b,c,d){c=this.scene.overrideMaterial;this.overrideMaterial&&(this.scene.overrideMaterial=this.overrideMaterial);a.render(this.scene,this.camera,b,this.clear);this.scene.overrideMaterial=c}};(function(a){function b(a){return!isNaN(a)&&isFinite(a)}function c(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1}a.Octree=function(c){c=c||{};this.nodeCount=0;this.INDEX_INSIDE_CROSS=-1;this.INDEX_OUTSIDE_OFFSET=2;this.INDEX_OUTSIDE_POS_X=b(c.INDEX_OUTSIDE_POS_X)?c.INDEX_OUTSIDE_POS_X:0;this.INDEX_OUTSIDE_NEG_X=b(c.INDEX_OUTSIDE_NEG_X)?c.INDEX_OUTSIDE_NEG_X:1;this.INDEX_OUTSIDE_POS_Y=b(c.INDEX_OUTSIDE_POS_Y)?c.INDEX_OUTSIDE_POS_Y:2;this.INDEX_OUTSIDE_NEG_Y=b(c.INDEX_OUTSIDE_NEG_Y)?
c.INDEX_OUTSIDE_NEG_Y:3;this.INDEX_OUTSIDE_POS_Z=b(c.INDEX_OUTSIDE_POS_Z)?c.INDEX_OUTSIDE_POS_Z:4;this.INDEX_OUTSIDE_NEG_Z=b(c.INDEX_OUTSIDE_NEG_Z)?c.INDEX_OUTSIDE_NEG_Z:5;this.INDEX_OUTSIDE_MAP=[];this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_X]={index:this.INDEX_OUTSIDE_POS_X,count:0,x:1,y:0,z:0};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_X]={index:this.INDEX_OUTSIDE_NEG_X,count:0,x:-1,y:0,z:0};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Y]={index:this.INDEX_OUTSIDE_POS_Y,count:0,x:0,y:1,z:0};
this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Y]={index:this.INDEX_OUTSIDE_NEG_Y,count:0,x:0,y:-1,z:0};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Z]={index:this.INDEX_OUTSIDE_POS_Z,count:0,x:0,y:0,z:1};this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Z]={index:this.INDEX_OUTSIDE_NEG_Z,count:0,x:0,y:0,z:-1};this.FLAG_POS_X=1<<this.INDEX_OUTSIDE_POS_X+1;this.FLAG_NEG_X=1<<this.INDEX_OUTSIDE_NEG_X+1;this.FLAG_POS_Y=1<<this.INDEX_OUTSIDE_POS_Y+1;this.FLAG_NEG_Y=1<<this.INDEX_OUTSIDE_NEG_Y+1;this.FLAG_POS_Z=
1<<this.INDEX_OUTSIDE_POS_Z+1;this.FLAG_NEG_Z=1<<this.INDEX_OUTSIDE_NEG_Z+1;this.utilVec31Search=new a.Vector3;this.utilVec32Search=new a.Vector3;if(this.scene=c.scene)this.visualGeometry=new a.BoxBufferGeometry(1,1,1),this.visualGeometry.addTriangleOrderAttribute(),this.visualMaterial=new WALK.WireframeMaterial(new a.Color(65280));this.depthMax=b(c.depthMax)?c.depthMax:Infinity;this.objectsThreshold=b(c.objectsThreshold)?c.objectsThreshold:8;this.overlapPct=b(c.overlapPct)?c.overlapPct:.15;this.root=
new a.OctreeNode({tree:this,parent:null,position:new a.Vector3})};a.Octree.prototype={add:function(b,c,d){this.root.addObject(new a.OctreeObjectData(b,c,d))},search:function(b,c,d){var f,e=[];this.root.appendObjectsFromNode(e);0<c||(c=Number.MAX_VALUE);if(d instanceof a.Vector3){d=this.utilVec31Search.copy(d).normalize();var g=this.utilVec32Search.set(1,1,1).divide(d)}var h=0;for(f=this.root.nodesIndices.length;h<f;h++){var q=this.root.nodesByIndex[this.root.nodesIndices[h]];q.search(b,c,d,g,e)}return e},
setRoot:function(b){b instanceof a.OctreeNode&&(this.root=b,this.root.updateProperties())},getDepthEnd:function(){return this.root.getDepthEnd()},getNodeCountEnd:function(){return this.root.getNodeCountEnd()},getObjectCountEnd:function(){return this.root.getObjectCountEnd()},toConsole:function(){this.root.toConsole()}};a.OctreeObjectData=function(a,b,c){this.object=a;b?(this.radius=c,this.position=b):(this.radius=this.object.geometry.boundingSphere.radius,this.position=this.object.geometry.boundingSphere.center)};
var d=new a.Vector3,e=new a.Vector3;new a.Vector3;a.OctreeNode=function(b){this.tree=b.tree;this.id=this.tree.nodeCount++;this.position=b.position;this.radius=0<b.radius?b.radius:1;this.indexOctant=b.indexOctant;this.depth=0;this.reset();this.setParent(b.parent);this.overlap=this.radius*this.tree.overlapPct;this.radiusOverlap=this.radius+this.overlap;this.left=this.position.x-this.radiusOverlap;this.right=this.position.x+this.radiusOverlap;this.bottom=this.position.y-this.radiusOverlap;this.top=this.position.y+
this.radiusOverlap;this.back=this.position.z-this.radiusOverlap;this.front=this.position.z+this.radiusOverlap;this.tree.scene&&(this.visual=new a.Mesh(this.tree.visualGeometry,this.tree.visualMaterial),this.visual.scale.set(2*this.radiusOverlap,2*this.radiusOverlap,2*this.radiusOverlap),this.visual.position.copy(this.position),this.tree.scene.add(this.visual),this.tree.scene.updateMatrixWorld())};a.OctreeNode.prototype={setParent:function(a){a!==this&&this.parent!==a&&(this.parent=a,this.updateProperties())},
updateProperties:function(){var b;this.parent instanceof a.OctreeNode?(this.tree=this.parent.tree,this.depth=this.parent.depth+1):this.depth=0;var c=0;for(b=this.nodesIndices.length;c<b;c++)this.nodesByIndex[this.nodesIndices[c]].updateProperties()},reset:function(a,b){var c,d=this.nodesIndices||[],f=this.nodesByIndex;this.objects=[];this.nodesIndices=[];this.nodesByIndex={};var e=0;for(c=d.length;e<c;e++){var g=f[d[e]];g.setParent(void 0);!0===a&&g.reset(a,b)}!0===b&&this.visual&&this.visual.parent&&
this.visual.parent.remove(this.visual)},addNode:function(a,b){a.indexOctant=b;-1===c(this.nodesIndices,b)&&this.nodesIndices.push(b);this.nodesByIndex[b]=a;a.parent!==this&&a.setParent(this)},removeNode:function(a){var b=c(this.nodesIndices,a);this.nodesIndices.splice(b,1);var d=d||this.nodesByIndex[a];delete this.nodesByIndex[a];d.parent===this&&d.setParent(void 0)},addObject:function(b){var d=this.getOctantIndex(b);-1<d&&0<this.nodesIndices.length?(d=this.branch(d),d.addObject(b)):-1>d&&this.parent instanceof
a.OctreeNode?this.parent.addObject(b):(d=c(this.objects,b),-1===d&&this.objects.push(b),b.node=this,this.checkGrow())},addObjectWithoutCheck:function(a){var b;var c=0;for(b=a.length;c<b;c++){var d=a[c];this.objects.push(d);d.node=this}},checkGrow:function(){this.objects.length>this.tree.objectsThreshold&&0<this.tree.objectsThreshold&&this.grow()},grow:function(){var a=[],b=[],c=[],d=[],e=[],p;var l=0;for(p=this.objects.length;l<p;l++){var q=this.objects[l];var r=this.getOctantIndex(q);-1<r?(c.push(q),
d.push(r)):-1>r?(a.push(q),b.push(r)):e.push(q)}0<c.length&&(e=e.concat(this.split(c,d)));0<a.length&&(e=e.concat(this.expand(a,b)));this.objects=e;this.checkMerge()},split:function(a,b){var c;if(this.depth<this.tree.depthMax){a=a||this.objects;b=b||[];var d=[];var f=0;for(c=a.length;f<c;f++){var e=a[f];var g=b[f];-1<g?(g=this.branch(g),g.addObject(e)):d.push(e)}a===this.objects&&(this.objects=d)}else d=this.objects;return d},branch:function(b){if(this.nodesByIndex[b]instanceof a.OctreeNode)var c=
this.nodesByIndex[b];else{c=.5*this.radiusOverlap;var e=c*this.tree.overlapPct;e=c-e;e=d.set(b&1?e:-e,b&2?e:-e,b&4?e:-e);e=(new a.Vector3).addVectors(this.position,e);c=new a.OctreeNode({tree:this.tree,parent:this,position:e,radius:c,indexOctant:b});this.addNode(c,b)}return c},expand:function(b,c){var d,f=this.tree.INDEX_OUTSIDE_MAP;if(this.tree.root.getDepthEnd()<this.tree.depthMax){b=b||this.objects;c=c||[];var g=[];var p=[];var l=0;for(d=f.length;l<d;l++)f[l].count=0;l=0;for(d=b.length;l<d;l++){var q=
b[l];var r=c[l];-1>r?(r=-r-this.tree.INDEX_OUTSIDE_OFFSET,r&this.tree.FLAG_POS_X?f[this.tree.INDEX_OUTSIDE_POS_X].count++:r&this.tree.FLAG_NEG_X&&f[this.tree.INDEX_OUTSIDE_NEG_X].count++,r&this.tree.FLAG_POS_Y?f[this.tree.INDEX_OUTSIDE_POS_Y].count++:r&this.tree.FLAG_NEG_Y&&f[this.tree.INDEX_OUTSIDE_NEG_Y].count++,r&this.tree.FLAG_POS_Z?f[this.tree.INDEX_OUTSIDE_POS_Z].count++:r&this.tree.FLAG_NEG_Z&&f[this.tree.INDEX_OUTSIDE_NEG_Z].count++,p.push(q)):g.push(q)}if(0<p.length){var m=f.slice(0);m.sort(function(a,
b){return b.count-a.count});r=m[0];l=r.index|1;q=m[1];f=m[2];c=(q.index|1)!==l?q:f;d=c.index|1;q=m[2];f=m[3];m=m[4];var u=q.index|1;var x=f.index|1;q=u!==l&&u!==d?q:x!==l&&x!==d?f:m;l=r.x+c.x+q.x;d=r.y+c.y+q.y;c=r.z+c.z+q.z;r=this.getOctantIndexFromPosition(l,d,c);c=this.getOctantIndexFromPosition(-l,-d,-c);d=this.overlap;q=this.radius;l=0<this.tree.overlapPct?d/(.5*this.tree.overlapPct*(1+this.tree.overlapPct)):2*q;f=l*this.tree.overlapPct;d=l+f-(q+d);e.set(r&1?d:-d,r&2?d:-d,r&4?d:-d);r=(new a.Vector3).addVectors(this.position,
e);r=new a.OctreeNode({tree:this.tree,position:r,radius:l});r.addNode(this,c);this.tree.setRoot(r);l=0;for(d=p.length;l<d;l++)this.tree.root.addObject(p[l])}b===this.objects&&(this.objects=g)}else g=b;return g},shrink:function(){this.checkMerge();this.tree.root.checkContract()},checkMerge:function(){for(var b=this,c;b.parent instanceof a.OctreeNode&&b.getObjectCountEnd()<this.tree.objectsThreshold;)c=b,b=b.parent;b!==this&&b.merge(c)},merge:function(a){var b;a=a?"[object Array]"===Object.prototype.toString.call(a)!==
!0?[a]:a:[];var c=0;for(b=a.length;c<b;c++){var d=a[c];this.addObjectWithoutCheck(d.getObjectsEnd());d.reset(!0,!0);this.removeNode(d.indexOctant,d)}this.checkMerge()},checkContract:function(){var b;if(0<this.nodesIndices.length){var c=0;var d=this.objects.length;var e=0;for(b=this.nodesIndices.length;e<b;e++){var n=this.nodesByIndex[this.nodesIndices[e]];var p=n.getObjectCountEnd();d+=p;if(!1===l instanceof a.OctreeNode||p>c){var l=n;c=p}}d-c<this.tree.objectsThreshold&&l instanceof a.OctreeNode&&
this.contract(l)}},contract:function(a){var b;var c=0;for(b=this.nodesIndices.length;c<b;c++){var d=this.nodesByIndex[this.nodesIndices[c]];d!==a&&(a.addObjectWithoutCheck(d.getObjectsEnd()),d.reset(!0,!0))}a.addObjectWithoutCheck(this.objects);this.reset(!1,!0);this.tree.setRoot(a);a.checkContract()},getOctantIndex:function(b){var c=this.position,d=this.radiusOverlap,e=this.overlap,g=0;if(b instanceof a.OctreeObjectData){var p=b.radius;var l=b.position}else b instanceof a.OctreeNode&&(l=b.position,
p=0);var q=l.x-c.x;var r=l.y-c.y;l=l.z-c.z;c=Math.abs(q);var m=Math.abs(r);var u=Math.abs(l);if(Math.max(c,m,u)+p>d)return c+p>d&&(g^=0<q?this.tree.FLAG_POS_X:this.tree.FLAG_NEG_X),m+p>d&&(g^=0<r?this.tree.FLAG_POS_Y:this.tree.FLAG_NEG_Y),u+p>d&&(g^=0<l?this.tree.FLAG_POS_Z:this.tree.FLAG_NEG_Z),b.indexOctant=-g-this.tree.INDEX_OUTSIDE_OFFSET,b.indexOctant;if(q-p>-e)g|=1;else if(!(q+p<e))return b.indexOctant=this.tree.INDEX_INSIDE_CROSS,b.indexOctant;if(r-p>-e)g|=2;else if(!(r+p<e))return b.indexOctant=
this.tree.INDEX_INSIDE_CROSS,b.indexOctant;if(l-p>-e)g|=4;else if(!(l+p<e))return b.indexOctant=this.tree.INDEX_INSIDE_CROSS,b.indexOctant;b.indexOctant=g;return b.indexOctant},getOctantIndexFromPosition:function(a,b,c){var d=0;0<a&&(d|=1);0<b&&(d|=2);0<c&&(d|=4);return d},appendObjectsFromNode:function(a){var b,c=this.objects;var d=0;for(b=c.length;d<b;d+=1)a.push(c[d].object)},search:function(a,b,c,d,e){var f;if(!0===this.intersectRay(a,c,b,d)){this.appendObjectsFromNode(e);var g=0;for(f=this.nodesIndices.length;g<
f;g++){var k=this.nodesByIndex[this.nodesIndices[g]];k.search(a,b,c,d,e)}}},intersectRay:function(a,b,c,d){b=(this.left-a.x)*d.x;var e=(this.right-a.x)*d.x,f=(this.bottom-a.y)*d.y,g=(this.top-a.y)*d.y,k=(this.back-a.z)*d.z;d=(this.front-a.z)*d.z;a=Math.min(Math.min(Math.max(b,e),Math.max(f,g)),Math.max(k,d));if(0>a)return!1;b=Math.max(Math.max(Math.min(b,e),Math.min(f,g)),Math.min(k,d));return b>a||b>c?!1:!0},getDepthEnd:function(a){var b;if(0<this.nodesIndices.length){var c=0;for(b=this.nodesIndices.length;c<
b;c++){var d=this.nodesByIndex[this.nodesIndices[c]];a=d.getDepthEnd(a)}}else a=!a||this.depth>a?this.depth:a;return a},getNodeCountEnd:function(){return this.tree.root.getNodeCountRecursive()+1},getNodeCountRecursive:function(){var a,b=this.nodesIndices.length;var c=0;for(a=this.nodesIndices.length;c<a;c++)b+=this.nodesByIndex[this.nodesIndices[c]].getNodeCountRecursive();return b},getObjectsEnd:function(a){var b;a=(a||[]).concat(this.objects);var c=0;for(b=this.nodesIndices.length;c<b;c++){var d=
this.nodesByIndex[this.nodesIndices[c]];a=d.getObjectsEnd(a)}return a},getObjectCountEnd:function(){var a,b=this.objects.length;var c=0;for(a=this.nodesIndices.length;c<a;c++)b+=this.nodesByIndex[this.nodesIndices[c]].getObjectCountEnd();return b},getObjectCountStart:function(){for(var b=this.objects.length,c=this.parent;c instanceof a.OctreeNode;)b+=c.objects.length,c=c.parent;return b},toConsole:function(a){var b;a="string"===typeof a?a:"   ";console.log(this.parent?a+" octree NODE > ":" octree ROOT > ",
this," // id: ",this.id," // indexOctant: ",this.indexOctant," // position: ",this.position.x,this.position.y,this.position.z," // radius: ",this.radius," // depth: ",this.depth);console.log(this.parent?a+" ":" ","+ objects ( ",this.objects.length," ) ",this.objects);console.log(this.parent?a+" ":" ","+ children ( ",this.nodesIndices.length," )",this.nodesIndices,this.nodesByIndex);var c=0;for(b=this.nodesIndices.length;c<b;c++){var d=this.nodesByIndex[this.nodesIndices[c]];d.toConsole(a+"   ")}}}})(THREE);THREE.PolyhedronBufferGeometry=function(a,b,c,d){function e(a){h.push(a.x,a.y,a.z)}function g(b,c){b*=3;c.x=a[b+0];c.y=a[b+1];c.z=a[b+2]}function f(a,b,c,d){0>d&&1===a.x&&(k[b]=a.x-1);0===c.x&&0===c.z&&(k[b]=d/2/Math.PI+.5)}THREE.BufferGeometry.call(this);this.type="PolyhedronBufferGeometry";this.parameters={vertices:a,indices:b,radius:c,detail:d};c=c||1;d=d||0;var h=[],k=[];(function(a){for(var c=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Vector3,k=0;k<b.length;k+=3){g(b[k+0],c);g(b[k+1],
d);g(b[k+2],f);var m,h,n=c,t=d,v=f,w=Math.pow(2,a),z=[];for(h=0;h<=w;h++){z[h]=[];var A=n.clone().lerp(v,h/w),y=t.clone().lerp(v,h/w),E=w-h;for(m=0;m<=E;m++)z[h][m]=0===m&&h===w?A:A.clone().lerp(y,m/E)}for(h=0;h<w;h++)for(m=0;m<2*(w-h)-1;m++)n=Math.floor(m/2),0===m%2?(e(z[h][n+1]),e(z[h+1][n]),e(z[h][n])):(e(z[h][n+1]),e(z[h+1][n+1]),e(z[h+1][n]))}})(d);(function(a){for(var b=new THREE.Vector3,c=0;c<h.length;c+=3)b.x=h[c+0],b.y=h[c+1],b.z=h[c+2],b.normalize().multiplyScalar(a),h[c+0]=b.x,h[c+1]=b.y,
h[c+2]=b.z})(c);(function(){for(var a=new THREE.Vector3,b=0;b<h.length;b+=3)a.x=h[b+0],a.y=h[b+1],a.z=h[b+2],k.push(Math.atan2(a.z,-a.x)/2/Math.PI+.5,1-(Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5));a=new THREE.Vector3;b=new THREE.Vector3;for(var c=new THREE.Vector3,d=new THREE.Vector3,e=new THREE.Vector2,g=new THREE.Vector2,u=new THREE.Vector2,x=0,t=0;x<h.length;x+=9,t+=6){a.set(h[x+0],h[x+1],h[x+2]);b.set(h[x+3],h[x+4],h[x+5]);c.set(h[x+6],h[x+7],h[x+8]);e.set(k[t+0],k[t+1]);g.set(k[t+
2],k[t+3]);u.set(k[t+4],k[t+5]);d.copy(a).add(b).add(c).divideScalar(3);var v=Math.atan2(d.z,-d.x);f(e,t+0,a,v);f(g,t+2,b,v);f(u,t+4,c,v)}for(a=0;a<k.length;a+=6)b=k[a+0],c=k[a+2],d=k[a+4],e=Math.min(b,c,d),.9<Math.max(b,c,d)&&.1>e&&(.2>b&&(k[a+0]+=1),.2>c&&(k[a+2]+=1),.2>d&&(k[a+4]+=1))})();this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(h),3));this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(h.slice()),3));this.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(k),
2));0===d?this.computeVertexNormals():this.normalizeNormals()};THREE.PolyhedronBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.PolyhedronBufferGeometry.prototype.constructor=THREE.PolyhedronBufferGeometry;THREE.IcosahedronBufferGeometry=function(a,b){var c=(1+Math.sqrt(5))/2;THREE.PolyhedronBufferGeometry.call(this,[-1,c,0,1,c,0,-1,-c,0,1,-c,0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,b);this.type="IcosahedronBufferGeometry";this.parameters={radius:a,detail:b}};THREE.IcosahedronBufferGeometry.prototype=Object.create(THREE.PolyhedronBufferGeometry.prototype);
THREE.IcosahedronBufferGeometry.prototype.constructor=THREE.IcosahedronBufferGeometry;(function(){WALK.ColorUtils={linearToGamma:function(a){return.0031308>=a?12.92*a:1.055*Math.pow(a,1/2.4)-.055},gammaToLinear:function(a){return.04045>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)},hdrEncode:function(a,b){var c=Math.sqrt(a.r)/2.82842712,d=Math.sqrt(a.g)/2.82842712;a=Math.sqrt(a.b)/2.82842712;var e=Math.max(Math.max(c,d),a);e=THREE.Math.clamp(e,1/255,1);e=Math.ceil(255*e)/255;b.setRGB(c/e,d/e,a/e);return 1-e}};THREE.Color.prototype.copyGammaToLinear=void 0;THREE.Color.prototype.copyLinearToGamma=
void 0;THREE.Color.prototype.convertLinearToGamma=void 0;THREE.Color.prototype.convertGammaToLinear=function(){this.r=WALK.ColorUtils.gammaToLinear(this.r);this.g=WALK.ColorUtils.gammaToLinear(this.g);this.b=WALK.ColorUtils.gammaToLinear(this.b)};THREE.Color.prototype.roundChannels=function(){this.r=WALK.round(this.r,3);this.g=WALK.round(this.g,3);this.b=WALK.round(this.b,3);return this}})();/*
 Copyright (C) 2017-present Shapespark
*/
(function(){var a=new THREE.Vector3;WALK.Math={toSnorm8:function(a){return Math.round(127*THREE.Math.clamp(a,-1,1))},minBytesToHold:function(a){return 127>=a?1:32767>=a?2:4},anyPositiveRootOfQuadraticEquation:function(a,c,d){d=c*c-4*a*d;if(0>d)return null;d=Math.sqrt(d);var b=(-c-d)/(2*a);if(0<b)return b;a=(-c+d)/(2*a);return 0<a?a:null},spheresUnion:function(b,c){if(c.empty())c.copy(b);else{var d=c.center.distanceTo(b.center);if(b.radius>c.radius){var e=b;b=c}else e=c;var g=(e.radius+b.radius+d)/
2;g<=e.radius?c.copy(e):(d=(g-e.radius)/d,console.assert(0<d),a.copy(b.center).sub(e.center).multiplyScalar(d),c.center.copy(e.center).add(a),c.radius=g)}}}})();(function(){WALK.Euler=function(a,b,c){THREE.Euler.call(this,b,c,a,"ZXY")};WALK.Euler.prototype=Object.create(THREE.Euler.prototype);WALK.Euler.prototype.constructor=WALK.Euler;Object.defineProperty(WALK.Euler.prototype,"yaw",{get:function(){return this.z},set:function(a){this.z=a}});Object.defineProperty(WALK.Euler.prototype,"pitch",{get:function(){return this.x},set:function(a){this.x=a}});Object.defineProperty(WALK.Euler.prototype,"roll",{get:function(){return this.y},set:function(a){this.y=a}});
Object.defineProperty(WALK.Euler.prototype,"yawDeg",{get:function(){return THREE.Math.radToDeg(this.yaw)},set:function(a){this.yaw=THREE.Math.degToRad(a)}});Object.defineProperty(WALK.Euler.prototype,"pitchDeg",{get:function(){return THREE.Math.radToDeg(this.pitch)},set:function(a){this.pitch=THREE.Math.degToRad(a)}});Object.defineProperty(WALK.Euler.prototype,"rollDeg",{get:function(){return THREE.Math.radToDeg(this.roll)},set:function(a){this.roll=THREE.Math.degToRad(a)}});WALK.Euler.prototype.setFromDegTriple=
function(a){var b=THREE.Math.degToRad(a[0]),c=THREE.Math.degToRad(a[1]);a=THREE.Math.degToRad(a[2]);this.set(c,a,b);return this};WALK.Euler.prototype.toDegTriple=function(){return[this.yawDeg,this.pitchDeg,this.rollDeg]};WALK.Euler.prototype.setFromDirection=function(a){this.set(Math.asin(a.z),0,Math.atan2(-a.x,a.y));return this};WALK.Euler.prototype.toQuaternion=function(){var a=new THREE.Quaternion;a.setFromEuler(this);return a};WALK.Euler.prototype.toRotationMatrix=function(){var a=new THREE.Matrix4;
a.makeRotationFromEuler(this);return a}})();(function(){var a=new THREE.Sphere;WALK.Frustum=function(){this.planes=[new THREE.Plane,new THREE.Plane,new THREE.Plane,new THREE.Plane,new THREE.Plane,new THREE.Plane]};WALK.Frustum.prototype={constructor:WALK.Frustum,setFromMatrix:function(a){var b=this.planes,d=a.elements;a=d[0];var e=d[1],g=d[2],f=d[3],h=d[4],k=d[5],n=d[6],p=d[7],l=d[8],q=d[9],r=d[10],m=d[11],u=d[12],x=d[13],t=d[14];d=d[15];b[0].setComponents(f-a,p-h,m-l,d-u).normalize();b[1].setComponents(f+a,p+h,m+l,d+u).normalize();b[2].setComponents(f+
e,p+k,m+q,d+x).normalize();b[3].setComponents(f-e,p-k,m-q,d-x).normalize();b[4].setComponents(f-g,p-n,m-r,d-t).normalize();b[5].setComponents(f+g,p+n,m+r,d+t).normalize();return this},intersectsObject:function(b){var c=b.geometry;null===c.boundingSphere&&c.computeBoundingSphere();b.matrixWorld?(a.copy(c.boundingSphere),a.applyMatrix4(b.matrixWorld),b=a):b=c.boundingSphere;return this.intersectsSphere(b)},nearPlaneDistanceToCenter:function(b){var c=b.geometry,d=this.planes[5];b.matrixWorld?(a.copy(c.boundingSphere),
a.applyMatrix4(b.matrixWorld),b=a):b=c.boundingSphere;return d.distanceToPoint(b.center)},intersectsSphere:function(a){var b=this.planes,d=a.center;a=-a.radius;for(var e=0;6>e;e+=1)if(b[e].distanceToPoint(d)<a)return!1;return!0},intersectsBox:function(){var a=new THREE.Vector3,c=new THREE.Vector3;return function(b){for(var d=this.planes,g=0;6>g;g+=1){var f=d[g];a.x=0<f.normal.x?b.min.x:b.max.x;c.x=0<f.normal.x?b.max.x:b.min.x;a.y=0<f.normal.y?b.min.y:b.max.y;c.y=0<f.normal.y?b.max.y:b.min.y;a.z=0<
f.normal.z?b.min.z:b.max.z;c.z=0<f.normal.z?b.max.z:b.min.z;var h=f.distanceToPoint(a);f=f.distanceToPoint(c);if(0>h&&0>f)return!1}return!0}}(),containsPoint:function(a){for(var b=this.planes,d=0;6>d;d+=1)if(0>b[d].distanceToPoint(a))return!1;return!0}}})();(function(){function a(){var a=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return a?parseInt(a[2],10):!1}WALK.Detector=function(b){function c(a){var c=f[a];if(void 0!==c)return c;switch(a){case "EXT_texture_filter_anisotropic":c=b.getExtension("EXT_texture_filter_anisotropic")||b.getExtension("MOZ_EXT_texture_filter_anisotropic")||b.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case "WEBGL_compressed_texture_s3tc":c=b.getExtension("WEBGL_compressed_texture_s3tc")||b.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||
b.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case "WEBGL_compressed_texture_pvrtc":c=b.getExtension("WEBGL_compressed_texture_pvrtc")||b.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case "WEBGL_compressed_texture_etc1":c=b.getExtension("WEBGL_compressed_texture_etc1");break;default:c=b.getExtension(a)}return f[a]=c}function d(a){var c=b.createTexture();b.bindTexture(b.TEXTURE_2D,c);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,2,2,0,b.RGBA,a,null);b.texParameteri(b.TEXTURE_2D,
b.TEXTURE_MAG_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR);a=b.createFramebuffer();b.bindFramebuffer(b.FRAMEBUFFER,a);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,c,0);var d=b.checkFramebufferStatus(b.FRAMEBUFFER)===b.FRAMEBUFFER_COMPLETE;b.deleteTexture(c);b.deleteFramebuffer(a);b.bindTexture(b.TEXTURE_2D,null);b.bindFramebuffer(b.FRAMEBUFFER,null);return d}function e(a,b){a=a.toLowerCase();b=b.toLowerCase();return-1!==a.indexOf(b)}function g(a){return navigator&&
navigator.userAgent?e(navigator.userAgent,a):!1}var f={};this.extension=c;this.https="https:"===window.location.protocol;this.localhost=WALK.isLocalhost();this.ipad=/iPad/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&1<navigator.maxTouchPoints;this.mobile=/mobile|ip(hone|od)|android|silk/i.test(navigator.userAgent)||this.ipad||WALK.urlHashContains("mobile");this.ios=/iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||this.ipad;this.android=/Android/.test(navigator.userAgent);
this.inCrossOriginIframe=function(){var a=window.self!==window.top,b=WALK.getOriginFromUrl(document.referrer),c=WALK.getOriginFromUrl(window.location.href);return a&&b!==c}();this.antialiasNative=b.getContextAttributes().antialias&&1<b.getParameter(b.SAMPLES);this.antialiasSamples=b.getParameter(b.SAMPLES);this.antialiasPostprocess=!this.mobile;this.floatTextures=c("OES_texture_float");this.floatTexturesInterpolate=c("OES_texture_float_linear");this.halfFloatTextures=c("OES_texture_half_float");this.halfFloatTexturesInterpolate=
c("OES_texture_half_float_linear");this.standardDerivatives=c("OES_standard_derivatives");this.maxAnisotropy=function(){var a=c("EXT_texture_filter_anisotropic");return null!==a?b.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}();this.indexUint=c("OES_element_index_uint");this.instances=c("ANGLE_instanced_arrays");this.fragmentPrecision=void 0===b.getShaderPrecisionFormat||0<b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,b.HIGH_FLOAT).precision?"highp":0<b.getShaderPrecisionFormat(b.FRAGMENT_SHADER,
b.MEDIUM_FLOAT).precision?"mediump":"lowp";var h=4096>b.getParameter(b.MAX_TEXTURE_SIZE)?"Your graphics card does not have sufficient capabilities, texture sizes 4096x4096 need to be supported.":null;this.missingCapabilities=h;this.maxRenderBufferSize=b.getParameter(b.MAX_RENDERBUFFER_SIZE);h=this.floatTextures?d(b.FLOAT):!1;this.floatTargets=h;h=this.halfFloatTextures?d(this.halfFloatTextures.HALF_FLOAT_OES):!1;this.dynamicLights=(this.halfFloatTargets=h)&&this.floatTargets&&this.halfFloatTexturesInterpolate;
this.dxtTextures=function(){try{if(WALK.urlHashContains("nodxt"))return!1;for(var a=c("WEBGL_compressed_texture_s3tc"),d=b.getParameter(b.COMPRESSED_TEXTURE_FORMATS),e=!1,f=!1,g=0;g<d.length;g+=1)e=e||d[g]===a.COMPRESSED_RGB_S3TC_DXT1_EXT,f=f||d[g]===a.COMPRESSED_RGBA_S3TC_DXT5_EXT;return e&&f}catch(r){}return!1}();h=WALK.urlHashContains("nopvr")?!1:c("WEBGL_compressed_texture_pvrtc");this.pvrtcTextures=h;h=WALK.urlHashContains("noetc1")?!1:c("WEBGL_compressed_texture_etc1")&&this.mobile;this.etc1Textures=
h;this.astcTextures=!1;this.firefox=g("firefox");this.opera=g("opera")||g("OPR/");this.ie=g("msie")||(navigator&&navigator.appVersion?e(navigator.appVersion,"trident/"):!1);this.edge=g("edge/");this.safari=g("safari/")&&!(g("chrome/")||g("chromium/"));this.mac=g("macintosh")&&!this.ipad;this.BASIS_DECODE_WORKERS=this.safari||this.ios?0:Math.min(4,navigator.hardwareConcurrency||4);this.textureLod=c("EXT_shader_texture_lod")&&(!this.firefox||!this.android);this.mirrorCubeMaps=!this.mobile||WALK.urlHashContains("mobilehi");
this.disableTextureSlotReuse=this.mac||83===a();this.reportToConsole=function(){WALK.log("Using "+this.fragmentPrecision+" fragment precision.");this.dxtTextures||WALK.log("DXT textures not supported.");this.textureLod||WALK.log("Texture fetch level of detail not supported.");this.floatTextures?(this.floatTexturesInterpolate||WALK.log("Float textures interpolation not supported."),this.floatTargets||WALK.log("Float render targets not supported")):WALK.log("Float textures not supported.");this.halfFloatTextures?
(this.halfFloatTexturesInterpolate||WALK.log("Half float textures interpolation not supported."),this.halfFloatTargets||WALK.log("Half float render targets not supported")):WALK.log("Half float textures not supported");this.antialiasNative?WALK.log("Native anti-aliasing supported with "+this.antialiasSamples+" samples."):WALK.log("Native anti-aliasing not supported");this.disableTextureSlotReuse&&WALK.log("WebGL texture slot reuse disabled.");this.indexUint||WALK.log("Uint index not supported");this.instances||
WALK.log("Instanced geometry not supported")}}})();(function(){WALK.Viewer=function(a,b,c){function d(){return null}function e(a){c.isMaterialEditable(a)||console.assert(!1,"Can't access material, call ViewerApi.setMaterialEditable('"+a+"') before the scene is loaded.")}function g(){for(var a=[],b=$jscomp.makeIterator(C.materials),d=b.next();!d.done;d=b.next())d=d.value,c.isMaterialEditable(d.name)&&a.push(d);return a}function f(){for(var a=[],b=$jscomp.makeIterator(C.nodeConfigs),d=b.next();!d.done;d=b.next())d=d.value,c.isNodeTypeEditable(d.name)&&
a.push(d.name);return a}function h(a){e(a);for(var b=$jscomp.makeIterator(C.materials),c=b.next();!c.done;c=b.next())if(c=c.value,c.name===a)return c;return null}function k(){ea.copy(B.cameraWorldPosition());return ea}function n(){ia.yaw=B.getYawAngle();ia.pitch=B.getPitchAngle();ia.roll=0;return ia}function p(){return C.boundingBox}function l(a){var b=[];e(a);for(var c=$jscomp.makeIterator(C.gpuMeshes),d=c.next();!d.done;d=c.next())d=d.value,d.material.name===a&&b.push(d);return b}function q(a){return(a=
C.findNodeConfig(a))?a.nodes:[]}function r(a,b){b.material=a;W.requestFrame()}function m(a,b){console.warn("setMaterialForNode() is deprecated, use setMaterialForMesh() instead");r(a,b)}function u(a,b,c){var d;(d="string"===typeof a?C.findViewByName(a):a)?(!0===b?b=0:!1===b&&(b=void 0),N.isRunning()&&(b=0,N.stop()),c?(H.activateSky(d),H.updateHiddenMeshes(d)):H.switchToView(d,b)):console.error("Unknown view: "+a)}function x(a){a=void 0===a?{}:a;var b=a.isPanorama||!1,c=a.width||(b?4E3:window.innerWidth),
d=a.height||(b?2E3:window.innerHeight);if(a.toDataUrl)return J.screenToDataUrl(b,c,d);J.screenToLocalImage(b,c,d)}function t(a){C.addAuxiliaryObject(a);a!==a.colliderMesh&&Q.uploadNewBuffers(a.colliderMesh);D.addDynamicObstacle(a.colliderMesh)}function v(a,b){for(var c=[],d=1;d<arguments.length;++d)c[d-1]=arguments[d];try{return a.apply(null,$jscomp.arrayFromIterable(c))}catch(pa){console.error(pa)}return!1}function w(a,b){for(var c=[],d=1;d<arguments.length;++d)c[d-1]=arguments[d];if(a){d=$jscomp.makeIterator(a);
for(var e=d.next();!e.done;e=d.next())v.apply(null,[e.value].concat($jscomp.arrayFromIterable(c)))}}function z(){P=!0;w(S.pageFirstInteraction);S.pageFirstInteraction=[];document.removeEventListener("mousedown",z);document.removeEventListener("touchend",z);document.removeEventListener("keydown",z)}function A(a,b){a=new WALK.Anchor(C,a);da.push(a);la&&t(a);S.anchorClicked[a.colliderMesh.id]=b;V=!0;W.requestFrame();return a}function y(a){delete S.anchorClicked[a.colliderMesh.id];la&&(C.removeAuxiliaryObject(a),
D.removeDynamicObstacle(a.colliderMesh));WALK.removeFromArray(a,da);a.dispose();W.requestFrame()}function E(a,b){a=new WALK.Avatar(C,a,b);ba.push(a);C.addAuxiliaryObject(a,!0);w(S.avatarListChanged);W.requestFrame();return a}function I(a){C.removeAuxiliaryObject(a);WALK.removeFromArray(a,ba);a.dispose();w(S.avatarListChanged);W.requestFrame()}function O(a){return WALK.find(ba,function(b){return b.uuid===a})}function K(){for(var a=$jscomp.makeIterator(C.getAnimatedMaterials()),b=a.next();!b.done;b=
a.next())b.value.sleepAnimation()}function T(){for(var a=$jscomp.makeIterator(C.getAnimatedMaterials()),b=a.next();!b.done;b=a.next())b.value.wakeAnimation();W.requestFrame()}function Y(a,b){var c=a[b];if(c)return c;c=[];return a[b]=c}var Q,C=null,B,H,N,D,J,L,W,M,R,F,P=!1,V=!1,aa=!1,U=null,X=null,S={pageFirstInteraction:[],viewerConfigLoaded:[],sceneReadyToDisplay:[],sceneLoadComplete:[],anchorClicked:{},materialPickerClicked:{},nodeTypeClicked:{},anyNodeTypeClicked:[],materialClicked:{},materialHoverChanged:{},
viewSwitchStarted:[],viewSwitchDone:[],vrChange:[],beforeRender:[],anchorsVisibilityChanged:[],apiUserStateChanged:{},anyApiUserStateChanged:[],meetingJoined:[],avatarListChanged:[]},da=[],ba=[],ea=new THREE.Vector3,ia=new WALK.Euler;document.addEventListener("mousedown",z);document.addEventListener("touchend",z);document.addEventListener("keydown",z);var la=!0;Object.defineProperty(this,"anchorsVisible",{get:function(){return la},set:function(a){a!==la&&((la=a)?da.forEach(function(a){return t(a)}):
da.forEach(function(a){C.removeAuxiliaryObject(a);D.removeDynamicObstacle(a.colliderMesh)}),this.requestFrame(),w(S.anchorsVisibilityChanged,la))}});var fa=function(){function a(a,b,d){c.set(a.x,a.y,g.z).sub(g);a=c.length();a>b&&(c.normalize().multiplyScalar(a-b),d.add(c))}var b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector3,e=new WALK.View,f=new THREE.Sphere,g;return function(c){g=B.cameraWorldPosition();var k=e.position;k.copy(g);c instanceof WALK.LightInstance&&"sun"===c.light.type?
(WALK.sunRotationToPosition(C,c.rotation,b),c=b):c instanceof WALK.Node?(WALK.computeNodeBoundingSphere(c,f),c=f.center,a(c,1+f.radius,k)):(c=c.position,a(c,1,k));d.copy(c).sub(k).normalize();e.rotation.setFromDirection(d);H.switchToView(e)}}();this.openMaterialPicker=function(a,b,c,d){U=new WALK.MaterialPicker(a,c,d,C,B,L,R);U.meshes.forEach(function(a){C.addAuxiliaryObject(a);D.addDynamicObstacle(a);S.materialPickerClicked[a.id]=b});W.requestFrame()};this._vrChange=function(a){w(S.vrChange,a)};
this._update=function(a){w(S.beforeRender,a)};this._clickListener=function(a,b,c){if(!V)return!1;if(U){var d=S.materialPickerClicked[a.id];if(d)return v(d,a.material,U.meshes.indexOf(a)),!0;U.meshes.forEach(function(a){C.removeAuxiliaryObject(a);D.removeDynamicObstacle(a);delete S.materialPickerClicked[a.id]});W.requestFrame();U.dispose();U=null;return!0}if(d=S.anchorClicked[a.id])return v(d,a.anchor,b,c),!0;d=function(a,d){if(a){a=$jscomp.makeIterator(a);for(var e=a.next();!e.done;e=a.next())if(v(e.value,
d,b,c))return!0}return!1};for(var e=a.node;e;){if(d(S.nodeTypeClicked[e.config.name],a.node))return!0;e=e.parent}return a.node&&d(S.anyNodeTypeClicked,a.node)?!0:a.material?d(S.materialClicked[a.material.name],a.material):!1};this._createHoverListener=function(){var a=S.materialHoverChanged,b=[];return 0===Object.keys(a).length?null:function(c,d){for(var e=$jscomp.makeIterator(a[c.material.name]||b),f=e.next();!f.done;f=e.next())if(v(f.value,c.material,d))return!0;return!1}};this._teleportStarted=
function(a){a=a.view;null!==a&&w(S.viewSwitchStarted,a.name,a)};this._teleportDone=function(a){a=a.view;null!==a&&w(S.viewSwitchDone,a.name,a)};this._viewerConfigLoaded=function(a){M=a;w(S.viewerConfigLoaded,M);S.viewerConfigLoaded=[]};this._sceneReadyToDisplay=function(a,b,c,d,e,t,v,z,P,aa,ia){Q=a;C=b;B=c;H=d;N=e;D=t;J=v;L=z;R=P;F=aa;W=ia;this.getEditableMaterials=g;this.getEditableNodeTypes=f;this.findMaterial=h;this.findMeshesWithMaterial=l;this.findNodesOfType=q;this.getCameraPosition=k;this.getCameraRotation=
n;this.getSceneBoundingBox=p;this.setMaterialForNode=m;this.setMaterialForMesh=r;this.switchToView=u;this.captureImage=x;this.addAnchor=A;this.removeAnchor=y;this.addAvatar=E;this.removeAvatar=I;this.findAvatar=O;this.seeItem=fa;this.sleepAnimatedMaterials=K;this.wakeAnimatedMaterials=T;w(S.sceneReadyToDisplay,C);S.sceneReadyToDisplay=[];H.addEventListener("teleportStarted",this._teleportStarted.bind(this));H.addEventListener("teleportDone",this._teleportDone.bind(this))};this._contextLost=function(){aa=
!1;M=C=H=N=D=J=F=W=null;this.wakeAnimatedMaterials=this.sleepAnimatedMaterials=this.findAvatar=this.removeAnchor=this.addAvatar=this.addAnchor=this.captureImage=this.switchToView=this.setMaterialForMesh=this.setMaterialForNode=this.findNodesOfType=this.findMeshesWithMaterial=this.findMaterial=this.getEditableNodeTypes=this.getEditableMaterials=d};this._sceneLoadComplete=function(){w(S.sceneLoadComplete);S.sceneLoadComplete=[];aa=!0;for(var a=$jscomp.makeIterator(da),b=a.next();!b.done;b=a.next())b.value.enableLightProbe()};
this.openUrl=function(b,c){c||a?window.open(b):window.location.href=b};this.onPageFirstInteraction=function(a){P?a():S.pageFirstInteraction.push(a)};this.onViewerConfigLoaded=function(a){M?a(M):S.viewerConfigLoaded.push(a)};this.isSceneReadyToDisplay=function(){return null!==C};this.onSceneReadyToDisplay=function(a){C?a(C):S.sceneReadyToDisplay.push(a)};this.onSceneLoadComplete=function(a){aa?a(C):S.sceneLoadComplete.push(a)};this.requestFrame=function(){W&&W.requestFrame()};this.setNodeTypeEditable=
function(a){console.assert(null===C,"setNodeTypeEditable must be called before the scene is loaded");c.setNodeTypeEditable(a)};this.setMaterialEditable=function(a){console.assert(null===C,"setMaterialEditable must be called before the scene is loaded");c.setMaterialEditable(a)};this.setAllMaterialsEditable=function(){console.assert(null===C,"setAllMaterialsEditable must be called before the scene is loaded");c.setAllMaterialsEditable()};this.onNodeTypeClicked=function(a,b){"function"===typeof a?S.anyNodeTypeClicked.push(a):
Y(S.nodeTypeClicked,a).push(b);V=!0};this.removeOnNodeTypeClicked=function(a,b){"function"===typeof a?WALK.removeFromArray(a,S.anyNodeTypeClicked):WALK.removeFromArray(b,S.nodeTypeClicked[a])};this.onMaterialClicked=function(a,b){this.setMaterialEditable(a);Y(S.materialClicked,a).push(b);V=!0};this.onMaterialHoverChanged=function(a,b){this.setMaterialEditable(a);Y(S.materialHoverChanged,a).push(b)};this.onViewSwitchStarted=function(a){S.viewSwitchStarted.push(a)};this.onViewSwitchDone=function(a){S.viewSwitchDone.push(a)};
this.onVrChange=function(a){S.vrChange.push(a)};this.onBeforeRender=function(a){S.beforeRender.push(a)};this.createTextureFromHtmlImage=function(a){function b(){d.needsUpdate=!0;d.width=a.naturalWidth;d.height=a.naturalHeight;THREE.Math.isPowerOfTwo(d.width)&&THREE.Math.isPowerOfTwo(d.height)||(d.minFilter=GLC.LINEAR);d.notifyLoaded()}function c(){b();e&&e();a.onload=e}var d=new WALK.Texture;d.image=a;d.wrapS=d.wrapT=GLC.REPEAT;d.minFilter=GLC.LINEAR_MIPMAP_LINEAR;d.anisotropy=WALK.DEFAULT_ANISOTROPY;
d.format=GLC.RGB;var e=null;a.complete&&0!==a.naturalHeight?b():(e=a.onload,a.onload=c);return d};this.createTextureFromHtmlVideo=function(a){var b=new WALK.VideoTexture;b.video=a;b.minFilter=GLC.LINEAR;b.anisotropy=WALK.DEFAULT_ANISOTROPY;b.format=GLC.RGB;b.generateMipmaps=!1;a.setAttribute("playsinline","");a.setAttribute("webkit-playsinline","");a.crossOrigin="anonymous";WALK.onVideoDataReady(a,function(a){b.width=a.videoWidth;b.height=a.videoHeight;THREE.Math.isPowerOfTwo(b.width)&&THREE.Math.isPowerOfTwo(b.height)?
(b.wrapS=GLC.REPEAT,b.wrapT=GLC.REPEAT):(b.wrapS=GLC.CLAMP_TO_EDGE,b.wrapT=GLC.CLAMP_TO_EDGE);b.notifyLoaded()});return b};this.addAnchor=function(){console.assert(!1,"Can't add anchors until the scene is ready to display")};this.removeAnchor=function(){console.assert(!1,"Can't remove anchors until the scene is ready to display")};this.addAvatar=function(){console.assert(!1,"Can't add avatars until the scene is ready to display")};this.removeAvatar=function(){console.assert(!1,"Can't remove avatars until the scene is ready to display")};
this.findAvatar=function(){console.assert(!1,"Can't find avatars until the scene is ready to display")};this.sleepAnimatedMaterials=function(){console.assert(!1,"Can't sleep animated materials until the scene is ready to display")};this.wakeAnimatedMaterials=function(){console.assert(!1,"Can't wake animated materials until the scene is ready to display")};this.onAnchorsVisibilityChanged=function(a){S.anchorsVisibilityChanged.push(a)};this.removeAnchorsVisibilityChangedListener=function(a){S.anchorsVisibilityChanged=
S.anchorsVisibilityChanged.filter(function(b){return b!==a})};this.seeItem=this.captureImage=this.switchToView=this.setMaterialForNode=this.getSceneBoundingBox=this.getCameraRotation=this.getCameraPosition=this.findNodesOfType=this.findMeshesWithMaterial=this.findMaterial=this.getEditableNodeTypes=this.getEditableMaterials=d;this.getViewerAssetUrl=function(a){return WALK.getViewerAssetUrl(a)};this.addMenuButton=function(a){return b.addExtraButton(a)};this.removeMenuButton=function(a){b.removeExtraButton(a)};
this.getMenuButtonIcon=function(a){return b.getExtraButonIcon(a)};Object.defineProperty(this,"menuVisible",{get:function(){return b.visible},set:function(a){b.visible=a}});this.onMenuVisibilityChanged=function(a){b.addEventListener("visibilityChanged",function(){a()})};this.play=function(){WALK.play()};var ha={};this.apiUserChangeState=function(a,b){WALK.deepEqual(ha[a],b)||(ha[a]=WALK.readOnlyCopy(b),b=WALK.cloneObject(b),w(S.apiUserStateChanged[a],a,b),w(S.anyApiUserStateChanged,a,b))};this.onApiUserStateChanged=
function(a,b){"function"===typeof a?S.anyApiUserStateChanged.push(a):Y(S.apiUserStateChanged,a).push(b)};this.removeOnApiUserStateChanged=function(a,b){"function"===typeof a?WALK.removeFromArray(a,S.anyApiUserStateChanged):WALK.removeFromArray(b,S.apiUserStateChanged[a])};this.getApiUserState=function(a){if(void 0===a)return WALK.cloneObject(ha);a=ha[a];return void 0===a?void 0:WALK.cloneObject(a)};this._meetingJoined=function(a){console.assert(null===X);X=a;w(S.meetingJoined,X)};this._onMeetingJoined=
function(a){S.meetingJoined.push(a);null!==X&&a(X)};this._removeOnMeetingJoined=function(a){WALK.removeFromArray(a,S.meetingJoined)};this._onAvatarListChanged=function(a){S.avatarListChanged.push(a)};this._removeOnAvatarListChanged=function(a){WALK.removeFromArray(a,S.avatarListChanged)};this._createPointerEventHelper=function(a){return new WALK.PointerEventHelper(F,a)};this._disableControls=function(){B.disable()};this._enableControls=function(){B.enable()};var ya=new WALK.RayIntersection;this._findIntersectionAtPosition=
function(a,b){D.findIntersectionAtPosition(a,b,!0,ya);return ya}}})();(function(){function a(a){return a[0].toUpperCase()+a.slice(1)}function b(a){for(var b=0,c=0;c<a.length;c+=1)a[c].id>=b&&(b=a[c].id+1);return b}function c(a,b){for(var c=0;c<a.length;c+=1)if(a[c].name===b)return!1;return!0}function d(a,b){for(var d=a,e=2;!c(b,d);e+=1)d=a+e.toString();return d}WALK.EditorHooks=function(c,g,f,h,k,n,p,l){function e(){WALK.USER_MSG.info("Failed to load texture")}var r={geometryFacesCnt:c.nodes.reduce(function(a,b){return a+b.facesInSubtree()},0)},m=new WALK.TextureLoader("./",
WALK.DETECTOR,function(a){l.requestFrame()},e,e,!0),u=new WALK.SkyLoader(m),x=k.transformControls;this.getExtensionManager=function(){return n};this.getCameraPosition=function(){var a=f.cameraWorldPosition();return[a.x,a.y,a.z]};this.getCameraRotation=function(){return[THREE.Math.radToDeg(f.getYawAngle()),THREE.Math.radToDeg(f.getPitchAngle())]};this.getCamera=function(){return c.camera};this.getSceneStats=function(){return r};this.getMaterials=function(){return c.sortedMaterials()};this.getLights=
function(){return c.lights};this.getLightProbes=function(){return c.lightProbes};this.getCameraVolumes=function(){return c.cameraVolumes};this.getNodes=function(){return c.nodes};this.addLight=function(a,b,e){a=new WALK.Light({name:d(a,c.lights),type:b,doNotImport:!0});a.addInstance(e);c.addLight(a)};this.removeLight=function(a){c.removeLight(a)};this.addLightInstance=function(a,b){a.addInstance(b)};this.removeLightInstance=function(a,b){a.removeInstance(b)};this.addLightProbe=function(a){var d=b(c.lightProbes);
a=new WALK.LightProbe({id:d,position:a});a.enableBoundingBox();c.addLightProbe(a);1===c.lightProbes.length&&c.enableLightProbesForMaterials()};this.removeLightProbe=function(a){c.removeLightProbe(a);0===c.lightProbes.length&&c.disableLightProbesForMaterials()};this.getCameraVolumeTypes=function(){return WALK.CameraVolume.CameraVolumeTypes};this.addCameraVolume=function(d,e){var f=(new THREE.Vector3).fromArray(this.getCameraPosition()),g=this.getCameraRotation();g=(new THREE.Vector3(0,3,0)).applyEuler(new WALK.Euler(g[0]/
180*Math.PI,g[1]/180*Math.PI,0));var k=b(c.cameraVolumes);c.addCameraVolume(new WALK.CameraVolume({id:k,name:e||a(d)+k,type:d,position:f.add(g).toArray(),rotation:[0,0,0],scale:[1,1,1],exposure:c.camera.defaultExposure,gamma:c.camera.defaultGamma}))};this.removeCameraVolume=function(a){c.removeCameraVolume(a)};this.shiftCameraVolume=function(a,b){c.shiftCameraVolume(a,b)};this.getViews=function(){return c.views.filter(function(a){return!a.internal})};this.markScreenshotArea=function(a){p.markArea(a)};
this.unmarkScreenshotArea=function(){p.unmarkArea()};this.screenToBuffer=function(a,b,c){return p.screenToBuffer(a,b,c)};this.addViewFromCamera=function(a,e){var g=[];console.assert("fps"===e||"top"===e||"orbit"===e);var k=f.cameraWorldPosition(),h=f.orbit;g[0]=THREE.Math.radToDeg(f.getYawAngle());g[1]=THREE.Math.radToDeg(f.getPitchAngle());a={id:b(c.views),name:d(a.trim()||"view",c.views),rotation:g};"fps"===e?(a.mode="fps",a.sky=WALK.EDITOR_CONTROLLED_SKY_NAME,a.position=k.toArray()):"top"===e?
(a.mode="orbit",a.sky=WALK.DEFAULT_SKY_NAME,a.panPrimary=!0,a.noPitchRotate=!0,a.rotation[1]=-90,a.minUpAngle=0,a.maxUpAngle=Math.PI/2,h.isEnabled()?(a.target=h.target.toArray(),a.distance=h.getCameraDistance()):(a.target=[k.x,k.y,c.boundingBox.min.z],a.distance=Math.max(k.z-c.boundingBox.min.z,1))):(a.mode="orbit",a.sky=WALK.DEFAULT_SKY_NAME,a.panPrimary=!1,a.noPitchRotate=!1,h.isEnabled()?(a.target=h.target.toArray(),a.distance=h.getCameraDistance(),a.minUpAngle=-h.getMaxPitchAngle(),a.maxUpAngle=
-h.getMinPitchAngle()):(e=c.boundingBox.center(),a.target=e.toArray(),e.sub(k),a.distance=e.length(),e.normalize(),a.rotation=[THREE.Math.radToDeg(Math.atan2(-e.x,e.y)),THREE.Math.radToDeg(Math.asin(e.z))],a.minUpAngle=0,a.maxUpAngle=Math.PI/2));k=new WALK.View(a);c.addView(k);return k};this.resetViewFromCamera=function(a){var b=f.cameraWorldPosition();"fps"===a.mode?a.position.copy(b):(a.target.copy(f.orbit.target),a.distance=b.distanceTo(a.target));"fps"!==a.mode&&a.isTop()||(a.rotation.pitch=f.getPitchAngle());
a.setYaw(f.getYawAngle())};this.removeView=function(a){c.removeView(a)};this.shiftView=function(a,b){c.shiftView(a,b)};this.activateSkyForView=function(a){h.activateSky(a)};this.switchToView=function(a){h.switchToView(a);$("walk-canvas").focus()};this.renameView=function(a,b){b=b.trim()||"view";a.name="";a.setName(d(b,c.views))};this.updateHiddenMeshes=function(a){h.updateHiddenMeshes(a)};this.getSky=function(){return c.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME)};this.loadTexture=function(a){a=
m.load(WALK.LOAD_PRIORITY.CORE_RESOURCE,a,!0,!0,WALK.DEFAULT_ANISOTROPY);a.fromEditor=!0;return a};this.materialTextureUpdated=function(a,b){var d=new Set,e="";a.textureNeedsUv0(b)&&c.visitMeshesWithMaterial(a,function(a){0===a.geometry.vertexCnt||a.uv0InBuffers()||d.has(a.node.type)||(d.add(a.node.type),5<d.size||(""!==e&&(e+=", "),e+="'"+a.node.type+"'"))});return 0<d.size&&"Texture "+b+" won't be correctly mapped. The following objects lack base color UV mapping coming from the 3D modeling tool: "+
e+(5<d.size?" (plus "+(d.size-5)+" more).":".")};this.changeSkyTexture=function(a){var b=c.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME);b.isEquirect?u.loadSkyTexture(b,a):(c.removeSkyMesh(b),u.loadSingleSky({name:WALK.EDITOR_CONTROLLED_SKY_NAME,type:"equirect",texture:a},c));c.adjustSkiesAndCameraFarToSpanWholeScene()};this.removeSkyTexture=function(){var a=c.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME);a.isEquirect&&(c.removeSkyMesh(a),u.loadSingleSky({name:WALK.EDITOR_CONTROLLED_SKY_NAME,type:"procedural"},
c));c.adjustSkiesAndCameraFarToSpanWholeScene()};this.getColorMapName=function(){return c.camera.colorMap?c.camera.colorMap.name:null};this.loadColorMap=function(a){a=m.load(WALK.LOAD_PRIORITY.CORE_RESOURCE,a,!1,!1,WALK.NO_ANISOTROPY);a.flipY=!1;return a};this.getSceneJson=function(){return c.serialize()};this.getCoverJson=function(){var a=g.cover;a.extensions=n.getConfig();return a};this.disableSelection=function(){k.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.OFF)};this.enableMaterialSelection=
function(){k.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.MATERIAL)};this.enableLightSelection=function(){k.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.LIGHT)};this.enableLightProbeSelection=function(){k.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE)};this.enableExtensionSelection=function(){k.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.EXTENSION)};this.enablePositionSelection=function(a){k.setDistanceToObject(a);k.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.POSITION)};
this.enableNodeSelection=function(){k.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.NODE)};this.enableCameraVolumeSelection=function(){k.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME)};this.selectMaterial=function(a){k.selectMaterial(a,!1)};this.replaceMaterial=function(a,b){a=c.replaceMaterial(a,b);a.isAnimated&&a.play();k.selectMaterial(a,!0);return a};this.selectLight=function(a){k.selectLight(a)};this.selectLightInstance=function(a){k.selectLightInstance(a,!1)};this.selectLightProbe=
function(a){k.selectLightProbe(a,!1)};this.selectCameraVolume=function(a){k.selectEditorCameraVolume(a)};this.selectExtension=function(a){k.selectExtension(a,!1)};this.selectNodes=function(a,b){k.selectNodes(a,b)};this.setMaterialSelectedCallback=function(a){k.setMaterialSelectedCallback(a)};this.setLightInstanceSelectedCallback=function(a){k.setLightInstanceSelectedCallback(a)};this.setLightProbeSelectedCallback=function(a){k.setLightProbeSelectedCallback(a)};this.setNodeSelectedCallback=function(a){k.setNodeSelectedCallback(a)};
this.setExtensionSelectedCallback=function(a){k.setExtensionSelectedCallback(a)};this.setPositionSelectedCallback=function(a){k.setPositionSelectedCallback(a)};this.setItemModifiedCallback=function(a){x.setItemModifiedCallback(a);c.addEventListener("sceneChanged",a)};this.setViewSelectedCallback=function(a){h.addEventListener("teleportStarted",function(b){null!==b.view&&a(b.view)})};this.coverModified=function(a){g.updateCover(a)};this.autoTourModified=function(){g.refresh()};this.hasLightMap=function(){return c.hasLightMap()};
this.getAutoTour=function(){return c.autoTour};this.getDisableProgressiveLoader=function(){return c.disableProgressiveLoader};this.setDisableProgressiveLoader=function(a){c.disableProgressiveLoader=a};this.getSceneScaleHtmlWarning=function(){var a=c.boundingBox;return!a.empty()&&(a=a.size(),200<a.x||200<a.y||200<a.z)?"The scene has unusually large dimensions: <strong>"+Math.round(a.x)+"m x "+Math.round(a.y)+"m x "+Math.round(a.z)+'m</strong>.</br></br>Shapespark assumes real-world scale, 1 meter in the scene should correspond to 1 meter in the real world. If the scale of the scene is invalid, either re-scale the model or change the scale in the import dialog, otherwise you can disable this message.</br></br>For more information consult <a href="/assets/help.html#importing-the-scene">Importing the scene</a> section of the help.':
null};this.getTransformMode=function(){return x.mode};this.setTransformMode=function(a){x.setTransformMode(a)};this.getSupportedTransformModes=function(){return x.supportedModes};this.seeItem=function(a){WALK.getViewer().seeItem(a)}};WALK.SceneLoadConfig=function(){this.assetsUrl="./";this.onSceneLoaded=null;this.enableCollisions=!0;this.forcedInitialCameraRotation=this.forcedInitialCameraPosition=null}})();(function(){function a(){var a=new THREE.BufferGeometry,b=new Float32Array(288);a.addAttribute("position",new THREE.BufferAttribute(b,3));var e=0;[[[-1,-1,-1],[-1,-.6,-1],[-.6,-1,-1]],[[-1,-1,-1],[-1,-1,-.6],[-1,-.6,-1]],[[-1,-1,-1],[-.6,-1,-1],[-1,-1,-.6]],[[-.6,-1,-1],[-1,-.6,-1],[-1,-1,-.6]],[[-1,-1,1],[-.6,-1,1],[-1,-.6,1]],[[-1,-1,1],[-1,-.6,1],[-1,-1,.6]],[[-1,-1,1],[-1,-1,.6],[-.6,-1,1]],[[-.6,-1,1],[-1,-1,.6],[-1,-.6,1]],[[1,-1,-1],[.6,-1,-1],[1,-.6,-1]],[[1,-1,-1],[1,-.6,-1],[1,-1,-.6]],
[[1,-1,-1],[1,-1,-.6],[.6,-1,-1]],[[.6,-1,-1],[1,-1,-.6],[1,-.6,-1]],[[-1,1,-1],[-.6,1,-1],[-1,.6,-1]],[[-1,1,-1],[-1,.6,-1],[-1,1,-.6]],[[-1,1,-1],[-1,1,-.6],[-.6,1,-1]],[[-.6,1,-1],[-1,1,-.6],[-1,.6,-1]],[[1,1,1],[.6,1,1],[1,.6,1]],[[1,1,1],[1,.6,1],[1,1,.6]],[[1,1,1],[1,1,.6],[.6,1,1]],[[.6,1,1],[1,1,.6],[1,.6,1]],[[1,-1,1],[1,-.6,1],[.6,-1,1]],[[1,-1,1],[1,-1,.6],[1,-.6,1]],[[1,-1,1],[.6,-1,1],[1,-1,.6]],[[.6,-1,1],[1,-.6,1],[1,-1,.6]],[[1,1,-1],[1,.6,-1],[.6,1,-1]],[[1,1,-1],[1,1,-.6],[1,.6,
-1]],[[1,1,-1],[.6,1,-1],[1,1,-.6]],[[.6,1,-1],[1,.6,-1],[1,1,-.6]],[[-1,1,1],[-1,.6,1],[-.6,1,1]],[[-1,1,1],[-1,1,.6],[-1,.6,1]],[[-1,1,1],[-.6,1,1],[-1,1,.6]],[[-.6,1,1],[-1,.6,1],[-1,1,.6]]].forEach(function(a){for(var c=0;3>c;c+=1)for(var d=0;3>d;d+=1)b[e]=a[c][d],e+=1});a.computeVertexNormals();a.convertNormalsToSpherical();return a}function b(){var a=new WALK.StandardMaterial;a.disableLightProbe=!0;a.headLight=!0;a.baseColor=WALK.EDITOR_SELECTION_COLOR;a.setUniforms();return a}WALK.LightControls=
function(c,d){function e(a){if("spot"===a.type){var b=THREE.Math.degToRad(a.angle);a=1*Math.cos(b/2);b=new THREE.CylinderBufferGeometry(0,1*Math.sin(b/2),a,32,1);x.makeTranslation(0,-a/2,0);u.makeRotationZ(Math.PI);t.multiplyMatrices(u,x);b.applyMatrix(t);b.convertNormalsToSpherical()}else b="area"===a.type?w:v;return b}function g(a,b,d){var e=new WALK.LightMaterial(a);d=new THREE.Mesh(d,e);d.visibilityId=null;var f=new THREE.Mesh(z,A);d.add(f);if("sun"!==a.type){var g=b.rotation.toQuaternion().multiply(d.quaternion);
d.setRotationFromQuaternion(g);d.position.copy(b.position);"area"===a.type?(e.side=THREE.DoubleSide,d.scale.set(a.width,1,a.height),e=Math.max(a.width,a.height)/2,f.scale.set(e/a.width,e,e/a.height)):d.scale.set(a.size,a.size,a.size)}else a=c.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME).radius,a=1*Math.PI*a*1.5/360,WALK.sunRotationToPosition(c,b.rotation,d.position),d.scale.set(a,a,a);d.userData.lightInstance=b;d.updateMatrixWorld();r.lightInstanceMeshes.push(d);m&&c.addAuxiliaryObject(d)}function f(a){var b=
e(a);a.forEachLightInstance(function(c){g(a,c,b)})}function h(a){for(var b=0;b<r.lightInstanceMeshes.length;b+=1){var c=r.lightInstanceMeshes[b];if(c.userData.lightInstance===a)return c}return null}function k(a){for(var b=[],d=0;d<r.lightInstanceMeshes.length;d+=1){var e=r.lightInstanceMeshes[d];e.userData.lightInstance.light===a?(m&&c.removeAuxiliaryObject(e),e.geometry!==v&&e.geometry!==w&&e.geometry.dispose(),e.material.dispose()):b.push(e)}r.lightInstanceMeshes=b}function n(a){a=a.light;k(a);
f(a)}function p(a){a=a.instance;var b=a.light;var c=b.instances[0]!==a?h(b.instances[0]).geometry:e(b);g(b,a,c);d.requestFrame()}function l(a){a=a.instance.light;k(a);f(a);d.requestFrame()}function q(a){f(a);a.addEventListener("lightUpdated",n);a.addEventListener("lightInstanceAdded",p);a.addEventListener("lightInstanceRemoved",l)}var r=this,m=!1,u=new THREE.Matrix4,x=new THREE.Matrix4,t=new THREE.Matrix4,v=new THREE.SphereBufferGeometry(1,32,16);v.convertNormalsToSpherical();var w=new THREE.PlaneBufferGeometry(1,
1);u.makeRotationX(-Math.PI/2);w.applyMatrix(u);w.convertNormalsToSpherical();var z=a(),A=b();this.lightInstanceMeshes=[];this.getLightInstanceMaterial=function(a){return h(a).material};this.showLights=function(){if(!m){m=!0;for(var a=0;a<this.lightInstanceMeshes.length;a+=1)c.addAuxiliaryObject(this.lightInstanceMeshes[a]);d.requestFrame()}};this.showSelectionMesh=function(a){this.lightInstanceMeshes.forEach(function(b){b.children[0].visible=b.userData.lightInstance.light===a?!0:!1})};this.hideLights=
function(){if(m){m=!1;for(var a=0;a<this.lightInstanceMeshes.length;a+=1)c.removeAuxiliaryObject(this.lightInstanceMeshes[a]);d.requestFrame()}};c.lights.forEach(q);c.addEventListener("lightAdded",function(a){q(a.light);d.requestFrame()});c.addEventListener("lightRemoved",function(a){k(a.light);d.requestFrame()})}})();(function(){WALK.LightProbeControls=function(a,b){function c(a,b){b.position.addVectors(a.boxMin,a.boxMax).multiplyScalar(.5).sub(a.position);b.scale.subVectors(a.boxMax,a.boxMin);b.scale.subScalar(.005)}function d(b){var d=new WALK.StandardMaterial;d.hideFromLightProbes=!0;d.disableLightProbe=!1;d.highlight=WALK.EDITOR_SELECTION_COLOR;d.metallic=1;d.roughness=0;d.setUniforms();d=new THREE.Mesh(q,d);d.visibilityId=null;d.lightProbe=b;d.position.copy(b.position);var e=new THREE.Mesh(m,r);e.visible=
!1;d.add(e);b.isBoundingBoxEnabled()&&c(b,e);d.updateMatrixWorld(!0);d.visible=p;n.lightProbeMeshes.push(d);a.addAuxiliaryObject(d)}function e(a){for(var b=0;b<n.lightProbeMeshes.length;b+=1)if(n.lightProbeMeshes[b].lightProbe===a)return b;console.assert(!1);return null}function g(a){a=a.lightProbe;var b=n.lightProbeMeshes[e(a)];b.position.copy(a.position);var d=b.children[0];a.isBoundingBoxEnabled()?(c(a,d),d.visible=!0):d.visible=!1;b.updateMatrixWorld()}function f(a){a=a.lightProbe;d(a);b.requestFrame();
a.addEventListener("lightProbePositionUpdated",g);a.addEventListener("lightProbeBoundsUpdated",g)}function h(c){c=e(c.lightProbe);var d=n.lightProbeMeshes[c];a.removeAuxiliaryObject(d);d.material.dispose();n.lightProbeMeshes.splice(c,1);b.requestFrame()}function k(a){for(var b=0;b<n.lightProbeMeshes.length;b+=1){var c=n.lightProbeMeshes[b];if(c.lightProbe===a)return c}return null}var n=this,p=!1,l=null;this.lightProbeMeshes=[];var q=new THREE.SphereBufferGeometry(.2,32,16);q.convertNormalsToSpherical();
var r=WALK.createBoundingBoxMaterial(),m=new THREE.BoxBufferGeometry(1,1,1);m.addTriangleOrderAttribute();m.convertNormalsToSpherical();this.getLightProbeMaterial=function(a){return(a=k(a))?a.material:null};this.showLightProbeBoundingBox=function(a){l&&(l.visible=!1,l=null);a.isBoundingBoxEnabled()&&(l=k(a).children[0],l.visible=!0)};this.showLightProbes=function(){if(!p){p=!0;for(var a=0;a<this.lightProbeMeshes.length;a+=1)this.lightProbeMeshes[a].visible=!0}b.requestFrame()};this.hideLightProbes=
function(){if(p){p=!1;for(var a=0;a<this.lightProbeMeshes.length;a+=1)this.lightProbeMeshes[a].visible=!1}b.requestFrame()};(function(){for(var b=0;b<a.lightProbes.length;b+=1){var c=a.lightProbes[b];d(c);c.addEventListener("lightProbePositionUpdated",g);c.addEventListener("lightProbeBoundsUpdated",g)}a.addEventListener("lightProbeAdded",f);a.addEventListener("lightProbeRemoved",h)})()}})();(function(){WALK.CameraVolumeControls=function(a,b){function c(a){function b(){d.position.copy(a.position);d.rotation.copy(a.rotation);d.scale.copy(a.scale);d.updateMatrixWorld()}var c=WALK.createBoundingBoxMaterial(),d=new THREE.Mesh(a.getVolumeGeometry(),c);d.visible=!1;d.visibilityId=null;g.add(d);e.set(a,d);b(a);a.addEventListener("cameraVolumeUpdated",b)}var d=function(){},e=new Map,g=new THREE.Object3D;g.visible=!1;a.addAuxiliaryObject(g);this.setHighlightedCameraVolume=function(a){d();var b=
e.get(a);b.visible=!0;d=function(){return b.visible=!1};return b.material};this.setControlsVisible=function(a){g.visible=a;b.requestFrame()};a.addEventListener("cameraVolumeAdded",function(a){c(a.cameraVolume);b.requestFrame()});a.addEventListener("cameraVolumeRemoved",function(a){a=a.cameraVolume;var c=e.get(a);g.remove(c);c.material.dispose();e.delete(a);b.requestFrame()});for(var f=0;f<a.cameraVolumes.length;f+=1)c(a.cameraVolumes[f])}})();/*
 Copyright (C) 2019-present Shapespark
*/
(function(){WALK.sunRotationToPosition=function(a,b,c){a=a.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME);c.set(0,-a.radius,0);c.applyEuler(b);c.add(a.position)};WALK.computeNodeBoundingSphere=function(a,b){b.radius=0;a.visitSubtree(function(a){a.mesh&&WALK.Math.spheresUnion(a.mesh.geometry.boundingSphere,b)})}})();(function(){WALK.PointerEventDispatcher=function(a,b){function c(a){if(void 0===a.button)return 0;switch(a.button){case 0:return 0;case 1:return 1;case 2:return 2}return-1}function d(a,b){if(0!==a.length){var c=void 0!==b.touches;if(!c&&(document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement))r.clipX=0,r.clipY=0;else{if(c){b:{for(c=0;c<b.changedTouches.length;c++){var d=b.changedTouches[c];if(d.identifier===q){b=d;break b}}for(c=0;c<b.touches.length;c++)if(d=
b.touches[c],d.identifier===q){b=d;break b}b=null}console.assert(null!==b);c=b.clientX;b=b.clientY}else c=b.clientX,b=b.clientY;r.clipX=c/window.innerWidth*2-1;r.clipY=2*-(b/window.innerHeight)+1}b=r;for(c=0;c<a.length&&(d=a[c].callback,!d(b.clipX,b.clipY));c++);}}function e(a){0!==c(a)||l||(l=!0,void 0!==a.touches&&(console.assert(0<a.changedTouches.length),q=a.changedTouches[0].identifier),d(k,a))}function g(a){0===c(a)&&l&&(l=!1,d(n,a))}function f(a){d(p,a)}function h(a,b,c){var d=a.filter(function(a){return a.callback===
b});console.assert(0===d.length,"Do not add the same callback twice!");c={callback:b,priority:c};for(d=d=0;d<a.length;d+=1){var e=a[d];if(c.priority<=e.priority){if(c.priority===e.priority){console.error("Adding two listeners with the same priority is not allowed!");return}break}}a.splice(d,0,c)}var k=[],n=[],p=[],l=!1,q=-1,r={clipX:0,clipY:0};this.addPointerDownListener=function(a,b){h(k,a,b)};this.removePointerDownListener=function(a){k=k.filter(function(b){return b.callback!==a})};this.addPointerUpListener=
function(a,b){h(n,a,b)};this.removePointerUpListener=function(a){n=n.filter(function(b){return b.callback!==a})};this.addPointerMoveListener=function(a,b){h(p,a,b)};this.removePointerMoveListener=function(a){p=p.filter(function(b){return b.callback!==a})};var m=!1;this.isEnabled=function(){return m};this.enable=function(){m||(a.addEventListener("mousedown",e,!1),a.addEventListener("touchstart",e,!1),a.addEventListener("mouseup",g,!1),a.addEventListener("touchend",g,!1),a.addEventListener("mousemove",
f,!1),a.addEventListener("touchmove",f,!1),window.addEventListener("mouseup",g,!1),b&&window.top.addEventListener("mouseup",g,!1),m=!0)};this.disable=function(){m&&(a.removeEventListener("mousedown",e,!1),a.removeEventListener("touchstart",e,!1),a.removeEventListener("mouseup",g,!1),a.removeEventListener("touchend",g,!1),a.removeEventListener("mousemove",f,!1),a.removeEventListener("touchmove",f,!1),window.removeEventListener("mouseup",g,!1),b&&window.top.removeEventListener("mouseup",g,!1),m=!1)};
this.enable()}})();(function(){WALK.PointerEventHelper=function(a,b){function c(){return!1}function d(a,b){var c=f.callbacks.onPointerDown(a,b);h=!0;k=a;n=b;return c}function e(a,b){var d=f.callbacks.onPointerUp(a,b);if(h){var e=Date.now();d=null!==q&&.03>=Math.abs(p-k)&&.03>=Math.abs(l-n)&&500>=Math.abs(q-e)&&f.callbacks.onDoubleClick!==c?f.callbacks.onDoubleClick(a,b)||d:f.callbacks.onClick(a,b)||d;q=e;p=a;l=b}return d}function g(a,b){var c=f.callbacks.onPointerMove(a,b);!h||.03>=Math.abs(a-k)&&.03>=Math.abs(b-n)||
(h=!1,q=null);return c}var f=this,h=!1,k=null,n=null,p=null,l=null,q=null;this.callbacks={onClick:c,onDoubleClick:c,onPointerDown:c,onPointerUp:c,onPointerMove:c};var r=!1;this.isEnabled=function(){return r};this.enable=function(){r||(a.addPointerDownListener(d,b),a.addPointerUpListener(e,b),a.addPointerMoveListener(g,b),r=!0)};this.disable=function(){r&&(a.removePointerDownListener(d),a.removePointerUpListener(e),a.removePointerMoveListener(g),r=!1)};this.enable()}})();(function(){function a(a){var b=new THREE.Box3;a instanceof THREE.Object3D&&a.traverse(function(a){a instanceof THREE.Mesh&&(a.geometry.boundingBox||a.geometry.computeBoundingBox(),b.union(a.geometry.boundingBox))});return b}function b(b,c){var d=a(b);b=d.size();b=new THREE.BoxBufferGeometry(b.x,b.y,b.z);d=d.center();var e=new THREE.Matrix4;e.makeTranslation(d.x,d.y,d.z);b.applyMatrix(e);b.computeBoundingBox();c=new THREE.Mesh(b,c);c.visible=!1;c.visibilityId=null;return c}function c(a,b){var c=new WALK.StandardMaterial;
c.hideFromLightProbes=!0;c.baseColor.copy(a);c.opacity=b;c.specularOff=1;c.depthTest=!1;c.depthWrite=!1;return c}function d(a){for(var d=[],e=0;e<arguments.length;++e)d[e-0]=arguments[e];console.assert(0<d.length,"Part must have at least one element!");var f=new THREE.Object3D;d.forEach(function(a){return f.add(a)});d=b(f,c(g,.6));return new q(f,d,f.children[0].material)}function e(a,b,c){var d=a.material;d.opacity=b===a.collider?a.hoveredOpacity:c&&null!==b?a.notUsedOpacity:a.defaultOpacity;d.setUniforms()}
WALK.TRANSFORM_MODE={TRANSLATE:0,ROTATE:1,SCALE:2};var g=new THREE.Color(16777215),f=new THREE.Color(16711680),h=new THREE.Color(65280),k=new THREE.Color(255),n=new THREE.Vector3(0,0,1),p=new THREE.Vector3(1,0,0),l=new THREE.Vector3(0,1,0),q=function(a,b,c){THREE.Object3D.call(this);this.add(a);this.add(b);this.material=c;this.collider=b;this.defaultOpacity=c.opacity;this.hoveredOpacity=.99;this.notUsedOpacity=.3;this.usedAxes=0};q.prototype=Object.create(THREE.Object3D.prototype);q.prototype.constructor=
q;var r=function(){function a(a){a=c(a,.6);a.depthTest=!0;return new THREE.Mesh(b,a)}THREE.Object3D.call(this);var b=new THREE.CylinderBufferGeometry(.005,.005,1E3,4,1,!1),d=a(f);d.rotation.set(0,0,Math.PI/2);var e=a(h),g=a(k);g.rotation.set(Math.PI/2,0,0);this.add(d);this.add(e);this.add(g);var m=[!1,!1,!1];this.show=function(a){m[0]=1===(1&a);m[1]=2===(2&a);m[2]=4===(4&a);d.visible=m[0];e.visible=m[1];g.visible=m[2]};var q=new THREE.Vector3;this.update=function(a){q.copy(a);q.sub(this.position);
q.normalize();d.visible=m[0]&&.998>Math.abs(p.dot(q));e.visible=m[1]&&.998>Math.abs(l.dot(q));g.visible=m[2]&&.998>Math.abs(n.dot(q))}};r.prototype=Object.create(THREE.Object3D.prototype);r.prototype.constructor=r;var m=function(){function a(){var a=c(g,.99);return new THREE.Mesh(b,a)}THREE.Object3D.call(this);var b=new THREE.SphereBufferGeometry(.012,10,10),d=a(),e=a(),f=a();this.add(d);this.add(e);this.add(f);this.show=function(a){d.visible=1===(1&a);e.visible=2===(2&a);f.visible=4===(4&a)};this.update=
function(a){d.position.set(a.x,0,0);d.updateMatrixWorld();e.position.set(0,a.y,0);e.updateMatrixWorld();f.position.set(0,0,a.z);f.updateMatrixWorld()}};m.prototype=Object.create(THREE.Object3D.prototype);m.prototype.constructor=m;var u=function(){function a(a){a=c(a,.2);a.depthTest=!0;a.side=THREE.DoubleSide;return d(new THREE.Mesh(b,a))}THREE.Object3D.call(this);var b=new THREE.PlaneBufferGeometry(1E3,1E3,1,1),e=a(g);this.add(e);var m=new THREE.Object3D;this.add(m);var l=a(k);l.rotation.set(0,0,
0);var q=a(h);q.rotation.set(Math.PI/2,0,0);var r=a(f);r.rotation.set(0,Math.PI/2,0);m.add(l);m.add(q);m.add(r);this.setLocalRotation=function(a){a?m.rotation.copy(a):m.rotation.set(0,0,0)};this.update=function(a){e.rotation.setFromRotationMatrix(a.matrixWorld);e.updateMatrixWorld()};this.cameraPlane=e;this.findPlaneIntersectionPoint=function(){function a(a){switch(a){case 1:return r;case 2:return q;case 4:return l;case 3:return l;case 5:return q;case 6:return r;case 7:return e;default:throw"Impossible";
}}var b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e,f,g){var k=a(d);k.getWorldPosition(b).sub(e);k.getWorldDirection(c);if(1===d||2===d||4===d){d=c.dot(c);k=c.dot(f);var m=f.dot(f),h=c.dot(b),l=f.dot(b);m=d*m-k*k;d=1E-5>Math.abs(m)?Infinity:(d*l-k*h)/m}else d=c.dot(f),d=1E-5>Math.abs(d)?Infinity:c.dot(b)/d;if(Infinity===d)return!1;g.copy(f).multiplyScalar(d).add(e);return!0}}();this.show=function(a){e.visible=7===a?!0:!1;l.visible=3===a;q.visible=5===a;r.visible=6===a}};u.prototype=
Object.create(THREE.Object3D.prototype);u.prototype.constructor=u;var x=function(){function a(a){for(var b=new Uint8Array(4096),c=Math.floor(255*a.r),e=Math.floor(255*a.g),f=Math.floor(255*a.b),g=0,k=0;32>k;k++)for(var m=0;32>m;m++)b[g]=c,b[g+1]=e,b[g+2]=f,b[g+3]=0===k||0===m||31===k||31===m?220:150,g+=4;b=new WALK.DataTexture(b,32,32,THREE.RGBAFormat);b.hasAlpha=!0;b.needsUpdate=!0;b.loaded=!0;c=new WALK.StandardMaterial;c.hideFromLightProbes=!0;c.specularOff=1;c.disableLightProbe=!0;c.depthTest=
!1;c.depthWrite=!1;c.transparent=!0;c.baseColor=a;c.side=THREE.DoubleSide;c.baseColorTexture=b;c.opacity=.6;c.configureTransparency();c.setUniforms();return d(new THREE.Mesh(l.squareGeometry,c))}function b(a){a=c(a,.6);return d(new THREE.Mesh(l.lineGeometry,a),new THREE.Mesh(l.arrowHeadGeometry,a))}var m=this;THREE.Object3D.call(this);var l=function(){var a=new THREE.Matrix4,b=new THREE.SphereBufferGeometry(.1,16,16),c=new THREE.PlaneBufferGeometry(.23,.23,1,1);a.makeTranslation(.45,.45,0);c.applyMatrix(a);
c.addTriangleOrderAttribute();var d=new THREE.CylinderBufferGeometry(.015,.015,1,4,1,!1);a.makeTranslation(0,.65,0);d.applyMatrix(a);var e=new THREE.CylinderBufferGeometry(0,.05,.2,10,1,!1);a.makeTranslation(0,1.25,0);e.applyMatrix(a);return{pickerGeometry:b,squareGeometry:c,lineGeometry:d,arrowHeadGeometry:e}}(),q=function(){var a=c(g,.6);return d(new THREE.Mesh(l.pickerGeometry,a))}(),r=b(f);r.rotation.set(0,0,-Math.PI/2);var n=b(h),p=b(k);p.rotation.set(Math.PI/2,0,0);var u=a(k),t=a(h);t.rotation.set(Math.PI/
2,0,0);var x=a(f);x.rotation.set(0,-Math.PI/2,0);q.usedAxes=7;r.usedAxes=1;n.usedAxes=2;p.usedAxes=4;u.usedAxes=3;t.usedAxes=5;x.usedAxes=6;var v=[q,r,n,p,u,t,x];v.forEach(function(a){return m.add(a)});var B=new Map(v.map(function(a){return[a.collider,a]}));this.colliders=[].concat($jscomp.arrayFromIterable(B.keys()));this.highlight=function(a,b){v.forEach(function(c){return e(c,a,b)})};this.usedAxes=function(a){return B.get(a).usedAxes}};x.prototype=Object.create(THREE.Object3D.prototype);x.prototype.constructor=
x;var t=function(){function a(a){var b=new THREE.TorusBufferGeometry(a,.012,6,64);a=new THREE.TorusBufferGeometry(a,.038,6,64);return{torusGeometry:b,colliderGeometry:a}}function b(a,b){a=new WALK.RotateGizmoMaterial(a,.6);var c=new THREE.Object3D;c.add(new THREE.Mesh(b.torusGeometry,a));b=new THREE.Mesh(b.colliderGeometry,a);b.visible=!1;b.visibilityId=null;return new q(c,b,a)}var d=this;THREE.Object3D.call(this);var m=a(.9),l=b(f,m);l.rotation.set(0,Math.PI/2,0);var r=b(h,m);r.rotation.set(Math.PI/
2,0,0);m=b(k,m);var n=a(1.12),p=b(g,n),u=function(a,b){a=c(a,0);var d=new THREE.SphereBufferGeometry(b,32,32);b=new THREE.Object3D;b.add(new THREE.Mesh(d,a));d=new THREE.Mesh(d,a);d.visible=!1;d.visibilityId=null;a=new q(b,d,a);a.defaultOpacity=0;a.hoveredOpacity=.2;a.notUsedOpacity=0;return a}(g,.848),t=[l,r,m,p,u];t.forEach(function(a){return d.add(a)});var x=new Map(t.map(function(a){return[a.collider,a]}));this.colliders=[].concat($jscomp.arrayFromIterable(x.keys()));this.update=function(a){var b=
this;t.filter(function(a){return a!==u}).forEach(function(a){a=a.material;a.gizmoPosition.copy(b.position);a.sphereRadius=.86*b.scale.x});p.rotation.setFromRotationMatrix(a.matrixWorld);p.updateMatrixWorld()};l.usedAxes=1;r.usedAxes=2;m.usedAxes=4;p.usedAxes=7;u.usedAxes=0;this.highlight=function(a,b){t.forEach(function(c){return e(c,a,b)})};this.usedAxes=function(a){return x.get(a).usedAxes}};t.prototype=Object.create(THREE.Object3D.prototype);t.prototype.constructor=t;var v=function(){function a(a){for(var b=
new Uint8Array(4096),c=Math.floor(255*a.r),e=Math.floor(255*a.g),f=Math.floor(255*a.b),g=0,k=0;32>k;k++)for(var m=0;32>m;m++)b[g]=c,b[g+1]=e,b[g+2]=f,b[g+3]=0===k||0===m||31===k||31===m?220:150,g+=4;b=new WALK.DataTexture(b,32,32,THREE.RGBAFormat);b.hasAlpha=!0;b.needsUpdate=!0;b.loaded=!0;c=new WALK.StandardMaterial;c.hideFromLightProbes=!0;c.specularOff=1;c.disableLightProbe=!0;c.depthTest=!1;c.depthWrite=!1;c.transparent=!0;c.baseColor=a;c.side=THREE.DoubleSide;c.baseColorTexture=b;c.opacity=.6;
c.configureTransparency();c.setUniforms();return d(new THREE.Mesh(l.squareGeometry,c))}function b(a){a=c(a,.6);return d(new THREE.Mesh(l.lineGeometry,a),new THREE.Mesh(l.cubeGeometry,a))}var m=this;THREE.Object3D.call(this);var l=function(){var a=new THREE.Matrix4,b=new THREE.BoxBufferGeometry(.3,.3,.3),c=new THREE.PlaneBufferGeometry(.23,.23,1,1);a.makeTranslation(.45,.45,0);c.applyMatrix(a);c.addTriangleOrderAttribute();var d=new THREE.CylinderBufferGeometry(.015,.015,1,4,1,!1);a.makeTranslation(0,
.65,0);d.applyMatrix(a);var e=new THREE.BoxBufferGeometry(.1,.1,.1);a.makeTranslation(0,1.1,0);e.applyMatrix(a);return{pickerGeometry:b,squareGeometry:c,lineGeometry:d,cubeGeometry:e}}(),q=function(){var a=c(g,.6);return d(new THREE.Mesh(l.pickerGeometry,a))}(),r=b(f);r.rotation.set(0,0,-Math.PI/2);var n=b(h),p=b(k);p.rotation.set(Math.PI/2,0,0);var u=a(k),t=a(h);t.rotation.set(Math.PI/2,0,0);var x=a(f);x.rotation.set(0,-Math.PI/2,0);q.usedAxes=7;r.usedAxes=1;n.usedAxes=2;p.usedAxes=4;u.usedAxes=
3;t.usedAxes=5;x.usedAxes=6;var v=[q,r,n,p,u,t,x];v.forEach(function(a){return m.add(a)});var B=new Map(v.map(function(a){return[a.collider,a]}));this.colliders=[].concat($jscomp.arrayFromIterable(B.keys()));this.highlight=function(a,b){v.forEach(function(c){return e(c,a,b)})};this.usedAxes=function(a){return B.get(a).usedAxes}};v.prototype=Object.create(THREE.Object3D.prototype);v.prototype.constructor=v;WALK.TransformGizmo=function(a,b,c,d){function e(a){k.oldPosition.copy(a);k.newPosition.copy(a);
h.position.copy(a);q.position.copy(a);w.position.copy(a);A.position.copy(a);B.position.copy(a);z.position.copy(a)}function f(a){k.oldRotation.copy(a);k.newRotation.copy(a);W===WALK.TRANSFORM_MODE.SCALE?(h.rotation.copy(a),q.setLocalRotation(a),z.rotation.copy(k.oldRotation)):(h.rotation.set(0,0,0),q.setLocalRotation(null))}function g(){M?W===WALK.TRANSFORM_MODE.TRANSLATE?(a.addAuxiliaryObject(h),a.addAuxiliaryObject(q),a.addAuxiliaryObject(w),a.addAuxiliaryObject(A),a.removeAuxiliaryObject(B),a.removeAuxiliaryObject(z)):
W===WALK.TRANSFORM_MODE.ROTATE?(a.addAuxiliaryObject(h),a.removeAuxiliaryObject(A),a.addAuxiliaryObject(B),a.removeAuxiliaryObject(z)):(a.addAuxiliaryObject(h),a.addAuxiliaryObject(q),a.removeAuxiliaryObject(A),a.removeAuxiliaryObject(B),a.addAuxiliaryObject(z)):(a.removeAuxiliaryObject(h),a.removeAuxiliaryObject(q),a.removeAuxiliaryObject(w),a.removeAuxiliaryObject(A),a.removeAuxiliaryObject(B),a.removeAuxiliaryObject(z))}var k=this;this.target=null;var h=new r;h.show(7);var q=new u;q.show(0);var w=
new m;w.show(0);var A=new x,B=new t,z=new v,y=!1;Object.defineProperty(this,"transforming",{get:function(){return y}});var D=new THREE.Vector3(0,0,0),J=0,L=new THREE.Vector3;this.oldPosition=new THREE.Vector3(0,0,0);this.newPosition=new THREE.Vector3(0,0,0);this.oldRotation=new THREE.Euler(0,0,0);this.newRotation=new THREE.Euler(0,0,0);this.oldScale=new THREE.Vector3(1,1,1);this.newScale=new THREE.Vector3(1,1,1);Object.defineProperty(this,"position",{get:function(){return h.position}});Object.defineProperty(this,
"rotation",{get:function(){return k.oldRotation}});var W=!1;Object.defineProperty(this,"scale",{get:function(){return k.oldScale}});var M=!1;Object.defineProperty(this,"mode",{get:function(){return W},set:function(a){W!==a&&(W=a,g(),d.requestFrame())}});Object.defineProperty(this,"visible",{get:function(){return M},set:function(a){M!==a&&(M=a,g())}});this.mode=WALK.TRANSFORM_MODE.TRANSLATE;var R=Infinity,F=Infinity,P=new THREE.Vector3(0,0,0),V=null,aa=!1,U=7,X=function(){var b=new THREE.Vector3,d=
new THREE.Vector3,e=new THREE.Quaternion;return function(f,g,k){b.set(g,k,1).unproject(a.camera);b.sub(c).normalize();if(!q.findPlaneIntersectionPoint(f,c,b,d))return null;d.sub(h.position);d.applyQuaternion(e.setFromEuler(h.rotation).inverse());f&1||(d.x=0);f&2||(d.y=0);f&4||(d.z=0);return d}}(),S=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e){var f=q.cameraPlane;a.set(0,0,-1);a.transformDirection(f.matrixWorld);b.set(-1,0,0);b.transformDirection(f.matrixWorld);
d=X(7,d,e).normalize();c.copy(b).cross(d);return Math.sign(a.dot(c))*Math.acos(b.dot(d))}}(),da=new THREE.Vector3;this.rotationSpeed=5;var ba=function(){var a=new THREE.Vector2(0,0),b=new THREE.Quaternion,c=new THREE.Euler,d=new THREE.Quaternion,e=new THREE.Quaternion,f=new THREE.Vector3,g=new THREE.Vector3,m=new THREE.Vector3;return function(h,r){b.setFromEuler(k.oldRotation);b.normalize();a.set(R-h,F-r);a.multiplyScalar(k.rotationSpeed);if(0===U)return h=q.cameraPlane,f.copy(p),f.transformDirection(h.matrixWorld),
g.set(0,1,0),g.transformDirection(h.matrixWorld),e.setFromAxisAngle(f,a.y),d.setFromAxisAngle(g,-a.x),d.multiply(e),d.multiply(b),d.normalize(),c.setFromQuaternion(d,"ZXY"),c;if(7===U){var u=q.cameraPlane;m.set(0,0,-1);m.transformDirection(u.matrixWorld);u=m;h=S(h,r);h-=J}else{4!==U&&a.multiplyScalar((1===U?-1:1)*Math.sign((1===U?l:p).dot(da)));a:{switch(U){case 1:u=p;break a;case 2:u=l;break a;case 4:u=n;break a}console.error("Unable to get direction for this value!");u=void 0}h=4===U?-a.x:a.y}d.setFromAxisAngle(u,
h);d.multiply(b);d.normalize();c.setFromQuaternion(d,"ZXY");return c}}(),ea=function(){var a={hoveredCollider:null,hasAnythingChanged:!1};return function(c,d,e){var f=W===WALK.TRANSFORM_MODE.TRANSLATE?A:W===WALK.TRANSFORM_MODE.ROTATE?B:z;c=b.findMeshFromListAtPosition(f.colliders,c,d,!0);d=!1;if(c!==V||aa!==e)V=c,f.highlight(c,e),d=!0;a.hoveredCollider=c;a.hasAnythingChanged=d;return a}}();this.onCanvasPointerMove=function(a,b){if(this.transforming){if(this.mode===WALK.TRANSFORM_MODE.TRANSLATE){var c=
X(U,a,b);c&&this.newPosition.copy(c.sub(D).add(h.position));P.copy(this.newPosition);P.sub(h.position);P.divide(h.scale);w.update(P);if(a!==R||b!==F)A.visible=!1,w.show(U),h.show(U)}else if(this.mode===WALK.TRANSFORM_MODE.ROTATE){if(h.show(U),this.newRotation.copy(ba(a,b)),a!==R||b!==F)B.visible=!1}else{h.show(U);if(c=X(U,a,b))c.addScalar(1).divide(L),this.newScale.copy(c);if(a!==R||b!==F)z.visible=!1}d.requestFrame();return!0}ea(a,b,aa).hasAnythingChanged&&d.requestFrame();return!1};this.onCanvasPointerDown=
function(a,b){var c=ea(a,b,!0);aa=!0;if(null!==c.hoveredCollider)return y=!0,U=(W===WALK.TRANSFORM_MODE.TRANSLATE?A:W===WALK.TRANSFORM_MODE.ROTATE?B:z).usedAxes(c.hoveredCollider),R=a,F=b,this.mode===WALK.TRANSFORM_MODE.TRANSLATE?(q.show(U),this.newPosition.copy(this.oldPosition),D.copy(X(U,a,b))):this.mode===WALK.TRANSFORM_MODE.ROTATE?7===U&&(this.newRotation.copy(this.oldRotation),J=S(a,b)):(q.show(7===U?0:U),this.newScale.copy(this.oldScale),a=X(U,a,b),L.copy(a).addScalar(1).divide(this.oldScale)),
!0;U=7;y=!1;c.hasAnythingChanged&&d.requestFrame();return!1};this.onCanvasPointerUp=function(a,b){if(this.transforming){e(this.newPosition);f(this.newRotation);var c=this.newScale;k.oldScale.copy(c);k.newScale.copy(c);q.show(0);w.show(0);U=7;h.show(U);this.mode===WALK.TRANSFORM_MODE.TRANSLATE?A.visible=!0:this.mode===WALK.TRANSFORM_MODE.ROTATE?B.visible=!0:z.visible=!0}c=this.transforming;y=!1;this.update();ea(a,b,!1).hasAnythingChanged&&d.requestFrame();aa=!1;return c};this.update=function(){if(!this.transforming&&
(void 0!==this.target.position&&e(this.target.position),void 0!==this.target.rotation&&f(this.target.rotation),void 0!==this.target.scale)){var b=this.target.scale;k.oldScale.copy(b);k.newScale.copy(b)}da.copy(c);da.sub(h.position);da.normalize();b=.18*h.position.distanceTo(c)*a.camera.fov/90;h.scale.set(b,b,b);q.scale.set(b,b,b);w.scale.set(b,b,b);A.scale.set(b,b,b);B.scale.set(b,b,b);z.scale.set(b,b,b);B.update(a.camera);q.update(a.camera);h.update(c);h.updateMatrixWorld();q.updateMatrixWorld();
w.updateMatrixWorld();A.updateMatrixWorld();B.updateMatrixWorld();z.updateMatrixWorld()}}})();(function(){WALK.TransformControls=function(a,b,c,d,e){function g(){}function f(a){e.isEnabled()!==a&&(a?e.enable():e.disable())}var h=this,k=!1,n=new WALK.TransformGizmo(c,d,e.cameraWorldPosition(),b);n.mode=WALK.TRANSFORM_MODE.TRANSLATE;var p={itemModified:g},l=[];Object.defineProperty(this,"supportedModes",{get:function(){return l}});Object.defineProperty(this,"mode",{get:function(){return n.mode}});this.setItemModifiedCallback=function(a){console.assert(p.itemModified===g);p.itemModified=a};var q=
new WALK.PointerEventHelper(a,WALK.POINTER_PRIORITY.TRANSFORM_CONTROLS);q.callbacks.onPointerDown=function(a,b){a=n.onCanvasPointerDown(a,b);f(!n.transforming);return a};q.callbacks.onPointerUp=function(a,b){a=n.onCanvasPointerUp(a,b);f(!n.transforming);return a};q.callbacks.onPointerMove=function(a,b){a=n.onCanvasPointerMove(a,b);n.transforming&&(n.mode===WALK.TRANSFORM_MODE.TRANSLATE?(b=n.newPosition,h.target.setPosition(b.x,b.y,b.z)):n.mode===WALK.TRANSFORM_MODE.ROTATE?(b=n.newRotation,h.target.setRotation(b.z,
b.x,b.y)):(b=n.newScale,h.target.setScale(b.x,b.y,b.z)),p.itemModified(h.target));return a};q.disable();Object.defineProperty(this,"target",{get:function(){return n.target}});this.setTransformMode=function(a){n.mode=a};this.update=function(){k&&n.update()};this.enable=function(a,b){k=!0;n.target=a;null!==a&&(n.update(),n.visible=!0);l=b;-1===b.indexOf(n.mode)&&(n.mode=b[0]);q.enable()};this.disable=function(){k=!1;l=[];n.visible=!1;q.disable()}}})();(function(){var a=function(a,c){this._nodesPrimary=a;this._nodesSecondary=c};a.prototype.constructor=a;Object.defineProperty(a.prototype,"highlightMix",{set:function(a){this._nodesPrimary.forEach(function(b){b.highlightMix=a});this._nodesSecondary.forEach(function(b){b.highlightMix=a})}});Object.defineProperty(a.prototype,"selected",{set:function(a){this._nodesPrimary.forEach(function(b){b.selected=a});this._nodesSecondary.forEach(function(b){b.selectedSecondary=a})}});WALK.EditorSelector=function(b,
c,d,e,g,f,h,k,n){function p(){}function l(){v.highlightMix=.8*Math.pow(w/t.selectionTimeSec,2)}function q(a){null!==v&&(v.highlightMix=0);null!==a&&(v=a,w=t.selectionTimeSec,l());k.requestFrame()}function r(a){var b=a.geometry;b&&void 0===b.getAttribute("order")&&a.visible&&(a.visible=!1,C.push(a))}function m(){for(var a=$jscomp.makeIterator(C),b=a.next();!b.done;b=a.next())b.value.visible=!0}function u(){O.set(!0,!1,!1);K.set(T);c.gpuMeshes.forEach(function(a){a.geometry.addTriangleOrderAttribute();
a.highlightMix=0;a.selected=!1;d.uploadNewBuffers(a)});C.length=0;c.threeScene.traverse(r);c.threeScene.overrideMaterial=Y;c.skyMeshes.forEach(function(a){a.visible=!1})}function x(){O.restore();K.restore();m();c.threeScene.overrideMaterial=null;c.gpuMeshes.forEach(function(a){a.highlightMix=null;a.selected=null;a.selectedSecondary=!1});z=null;c.skyMeshes.forEach(function(a){a.visible=!0})}var t=this,v=null,w=0,z=null,A=0,y=new WALK.RayIntersection,E=new WALK.TransformControls(b,k,c,e,n),I={materialSelected:p,
lightInstanceSelected:p,lightProbeSelected:p,nodeSelected:p,extensionSelected:p,positionSelected:p},O=new WALK.AutoClearAlter(d),K=new WALK.ClearColorAlter(d),T=new THREE.Color(16777215),Y=new WALK.WireframeMaterial(new THREE.Color(0));Y.highlight=Y.meshSelectedLineColor;var Q;this.selectionTimeSec=1;this.selectMaterial=function(a,b){console.assert(Q===WALK.EditorSelector.SELECTION_MODE.MATERIAL);q(a);null!==a&&b&&I.materialSelected(a)};this.selectLight=function(a){console.assert(Q===WALK.EditorSelector.SELECTION_MODE.LIGHT);
g.showSelectionMesh(a);k.requestFrame()};this.selectLightInstance=function(a,b){var c=null;console.assert(Q===WALK.EditorSelector.SELECTION_MODE.LIGHT);if(a){c=g.getLightInstanceMaterial(a);var d=a.light.type;E.enable(a,"point"===d?[WALK.TRANSFORM_MODE.TRANSLATE]:"sun"===d?[WALK.TRANSFORM_MODE.ROTATE]:[WALK.TRANSFORM_MODE.TRANSLATE,WALK.TRANSFORM_MODE.ROTATE])}else E.disable();q(c);a&&b&&I.lightInstanceSelected(a)};this.selectLightProbe=function(a,b){var c=null;console.assert(Q===WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE);
a?(f.showLightProbeBoundingBox(a),c=f.getLightProbeMaterial(a),E.enable(a,[WALK.TRANSFORM_MODE.TRANSLATE])):E.disable();q(c);a&&b&&I.lightProbeSelected(a)};this.selectEditorCameraVolume=function(a){console.assert(Q===WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME);a?(q(h.setHighlightedCameraVolume(a)),E.enable(a,[WALK.TRANSFORM_MODE.TRANSLATE,WALK.TRANSFORM_MODE.ROTATE,WALK.TRANSFORM_MODE.SCALE])):(q(null),E.disable())};this.selectExtension=function(a,b){var c=null;console.assert(Q===WALK.EditorSelector.SELECTION_MODE.EXTENSION);
if(a&&0<a.triggers.length){var d=a.triggers[0].mesh;d&&(c=d.material)}q(c);a&&b&&I.extensionSelected(a)};this.selectNodes=function(b,c){console.assert(Q===WALK.EditorSelector.SELECTION_MODE.NODE);z&&(z.selected=!1);b.length||c.length?(z=new a(b,c),z.selected=!0):z=null;q(z)};this._selectNode=function(a){null!==a?this.selectNodes([a],[]):this.selectNodes([],[]);a&&I.nodeSelected(a)};this.update=function(a){E.update();null!==v&&(w-=a,0<w?l():(v.highlightMix=0,v=null),k.requestFrame())};var C=[];this.setDistanceToObject=
function(a){A=a};this.setSelectionMode=function(a){if(a!==Q){Q===WALK.EditorSelector.SELECTION_MODE.NODE&&x();Q===WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME&&h.setControlsVisible(!1);switch(a){case WALK.EditorSelector.SELECTION_MODE.OFF:case WALK.EditorSelector.SELECTION_MODE.MATERIAL:case WALK.EditorSelector.SELECTION_MODE.EXTENSION:case WALK.EditorSelector.SELECTION_MODE.POSITION:case WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME:g.hideLights();f.hideLightProbes();break;case WALK.EditorSelector.SELECTION_MODE.LIGHT:g.showLights();
f.hideLightProbes();break;case WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE:g.hideLights();f.showLightProbes();break;case WALK.EditorSelector.SELECTION_MODE.NODE:g.hideLights(),f.hideLightProbes(),u()}a===WALK.EditorSelector.SELECTION_MODE.CAMERA_VOLUME&&h.setControlsVisible(!0);E.disable();if(a===WALK.EditorSelector.SELECTION_MODE.MATERIAL)for(var b=$jscomp.makeIterator(c.getAnimatedMaterials()),d=b.next();!d.done;d=b.next())d.value.play();else for(b=$jscomp.makeIterator(c.getAnimatedMaterials()),
d=b.next();!d.done;d=b.next())d.value.pause();Q=a}};this.setMaterialSelectedCallback=function(a){console.assert(I.materialSelected===p);I.materialSelected=a};this.setLightInstanceSelectedCallback=function(a){console.assert(I.lightInstanceSelected===p);I.lightInstanceSelected=a};this.setLightProbeSelectedCallback=function(a){console.assert(I.lightProbeSelected===p);I.lightProbeSelected=a};this.setNodeSelectedCallback=function(a){console.assert(I.nodeSelected===p);I.nodeSelected=a};this.setExtensionSelectedCallback=
function(a){console.assert(I.extensionSelected===p);I.extensionSelected=a};this.setPositionSelectedCallback=function(a){console.assert(I.positionSelected===p);I.positionSelected=a};(function(){var a=new WALK.PointerEventHelper(b,WALK.POINTER_PRIORITY.EDITOR_SELECTOR);a.callbacks.onClick=function(a,b){if(Q===WALK.EditorSelector.SELECTION_MODE.OFF)return!1;var c=!1;Q===WALK.EditorSelector.SELECTION_MODE.MATERIAL?(a=e.findObstacleMeshAtPosition(a,b),a=null!==a?a.material:null,t.selectMaterial(a,!0)):
Q===WALK.EditorSelector.SELECTION_MODE.LIGHT?(a=e.findMeshFromListAtPosition(g.lightInstanceMeshes,a,b),a=null!==a?a.userData.lightInstance:null,null!==a&&t.selectLightInstance(a,!0)):Q===WALK.EditorSelector.SELECTION_MODE.LIGHT_PROBE?(a=e.findMeshFromListAtPosition(f.lightProbeMeshes,a,b),a=null!==a?a.lightProbe:null,null!==a&&t.selectLightProbe(a,!0)):Q===WALK.EditorSelector.SELECTION_MODE.NODE?(a=e.findObstacleMeshAtPosition(a,b),a=null!==a?a.node:null,t._selectNode(a)):Q===WALK.EditorSelector.SELECTION_MODE.EXTENSION?
(a=e.findIntersectionAtPosition(a,b,!1,y)?y.object.anchor||null:null,t.selectExtension(a?a.extension:null,!0)):Q===WALK.EditorSelector.SELECTION_MODE.POSITION&&(a=e.findIntersectionAtPosition(a,b,!1,y)&&!y.object.anchor?e.movePointTowardsTheCamera(y.point,A):null,a&&(I.positionSelected(a),c=!0));return c};a.callbacks.onDoubleClick=function(a,b){return!1}})();Object.defineProperty(this,"transformControls",{get:function(){return E}});this.setSelectionMode(WALK.EditorSelector.SELECTION_MODE.OFF)};WALK.EditorSelector.SELECTION_MODE=
{OFF:0,MATERIAL:1,LIGHT:2,LIGHT_PROBE:3,NODE:4,EXTENSION:6,POSITION:7,CAMERA_VOLUME:8}})();(function(){function a(){WALK.BaseMaterial.call(this,WALK.getShader("static_render_vertex.glsl"),WALK.getShader("static_render_fragment.glsl"));this.uniforms={staticRender:{type:"t",value:null},sizeInv:{type:"v2",value:new THREE.Vector2}}}function b(a){a=WALK.createRenderer(a,{antialias:!1});a.autoClear=!1;a.autoUpdateObjects=!1;a.sortObjects=!1;return a}a.prototype=Object.create(WALK.BaseMaterial.prototype);a.prototype.constructor=a;WALK.StaticRenderViewer=function(c){var d=b(c),e=new a,g=new THREE.OrthographicCamera(-1,
1,1,-1,0,1),f=new THREE.Scene;c=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),e);d.uploadNewBuffers(c);f.add(c);this.update=function(a){var b=new Float32Array(a,0,a.byteLength/4);a=b[0];var c=b[1];b=b.subarray(2);console.assert(a*c===b.length/3);b=new WALK.DataTexture(b,a,c,GLC.RGB,GLC.FLOAT);b.minFilter=GLC.NEAREST;b.magFilter=GLC.NEAREST;b.generateMipmaps=!1;b.flipY=!1;b.needsUpdate=!0;e.uniforms.staticRender.value=b;e.uniforms.sizeInv.value.set(1/a,1/c);d.setCanvasSize(a,c);d.render(f,g);b.dispose()}}})();(function(){WALK.VRManager=function(a,b,c,d,e,g,f){function h(){return WALK.DETECTOR.ios&&void 0!==DeviceMotionEvent&&"function"===typeof DeviceMotionEvent.requestPermission&&void 0!==DeviceOrientationEvent&&"function"===typeof DeviceOrientationEvent.requestPermission?new Promise(function(a,b){Promise.all([DeviceMotionEvent.requestPermission(),DeviceOrientationEvent.requestPermission()]).then(function(c){"granted"===c[0]&&"granted"===c[1]?a():b()},function(){b()})}):Promise.resolve()}function k(){q=
null;z.dispose();m=r=x=z=null;b.removeAllXrGamepads();f(!1);if(w){var a=w;w=null;a()}}function n(a){for(var c=$jscomp.makeIterator(a.removed),d=c.next();!d.done;d=c.next())d=d.value,d.gamepad&&b.removeXrGamepad(d.gamepad);a=$jscomp.makeIterator(a.added);for(d=a.next();!d.done;d=a.next())c=d.value,c.gamepad&&b.addXrGamepad(c.gamepad,c.handedness)}var p=navigator.xr,l=c?!c.nativeWebXR:!1,q,r,m,u=!1,x,t,v,w=null,z,A=new THREE.Matrix4,y=WALK.CAMERA_MIN_FAR;this.setCameraFar=function(a){y=a;q&&(x.depthFar=
y,q.updateRenderState(x))};this.render=function(b,c,d){v.set(!1,!0,!1);t.matrixWorld=c;c=t.projectionMatrix;for(var e=m.views,f=0;f<e.length;++f){var g=e[f];A.fromArray(g.transform.inverse.matrix);c.fromArray(m.transform.matrix);A.multiply(c);c.fromArray(g.projectionMatrix);c.multiply(A);d(t);a.enableScissorTest(!0);g=x.baseLayer.getViewport(g);a.setScissor(g.x,g.y,g.width,g.height);z.x=g.x;z.y=g.y;z.width=g.width;z.height=g.height;a.render(b,t,z);a.enableScissorTest(!1)}v.restore()};this.enableVr=
function(b){p?u?(g(!0),h().then(function(){return b.makeXRCompatible().then(function(){return navigator.xr.requestSession("immersive-vr",{requiredFeatures:["local-floor"]})}).then(function(a){q=a;return q.requestReferenceSpace("local-floor")}).then(function(c){r=c;c=new XRWebGLLayer(q,b);z=a.createFrameBufferRenderTarget(c.framebuffer);x={baseLayer:c};t||(t=new THREE.PerspectiveCamera,v=new WALK.AutoClearAlter(a));x.depthNear=WALK.CAMERA_WALK_NEAR;x.depthFar=y;q.updateRenderState(x);q.addEventListener("end",
k);l||q.addEventListener("inputsourceschange",n);g(!1);f(!0)}).catch(function(){g(!1);WALK.USER_MSG.info("Failed to enable VR mode")})}).catch(function(){g(!1);WALK.USER_MSG.info("Permissions necessary for VR mode not granted")})):WALK.USER_MSG.info("VR device not connected"):WALK.USER_MSG.info('You need a <a href="https://mozvr.com/#start" target="_blank">VR ready browser</a>.')};this.disableVr=function(){q.end().then(function(){WALK.USER_MSG.hideInfo()},function(){WALK.USER_MSG.info("Failed to exit VR mode")})};
this.vrEnabled=function(){return!!r};this.requestAnimationFrame=function(){function a(a,b){m=b.getViewerPose(r);w&&(b=w,w=null,b(a))}return function(b){w=b;q.requestAnimationFrame(a)}}();this.update=function(){var a=new WALK.Euler,b=new THREE.Vector3;return function(){if(m){var c=m.transform;if(null!==c.orientation){a.setFromQuaternion(c.orientation,"YXZ");var d=a.y;a.y=-a.z;a.z=d;c=c.position;e(a,c&&b.set(c.x,-c.z,c.y,c.w))}}}}();(WALK.DETECTOR.https||WALK.DETECTOR.localhost)&&p?(c=function(){navigator.xr.isSessionSupported("immersive-vr").then(function(a){u=
a;d(a)})},c(),navigator.xr.addEventListener("devicechange",c,!1)):d(!1)}})();(function(){WALK.RaycasterConfig=function(a,b,c){this.ray=new THREE.Ray(a,b);this.far=c||Infinity;this.ignoreVisibility=this.onlyGroundCollisions=this.respectColliderSettings=!1};WALK.RayIntersection=function(){this.distance=Infinity;this.point=new THREE.Vector3;this.object=null};WALK.GpuRaycaster=function(a,b){function c(a,b){if(!b.ignoreVisibility&&!a.visible)return!1;var c=a.node||p;if(c.disableCollisions&&b.respectColliderSettings||!c.ground&&b.onlyGroundCollisions)return!1;c=b.ray;if(a.matrixWorld)return!0;
var d=a.geometry.boundingSphere;if(d.distanceToPoint(c.origin)>b.far||!1===c.isIntersectionSphere(d))return!1;a=a.geometry.boundingBox;return a.distanceToPoint(c.origin)>b.far||!c.isIntersectionBox(a)?!1:!0}var d=a.createRenderTarget(1,1,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,depthBuffer:!0,generateMipmaps:!1}),e=new Uint8Array(4),g=new WALK.AutoClearAlter(a),f=new WALK.ClearColorAlter(a),h=new THREE.Color(16777215),k=new WALK.ObjectDistanceMaterial(!1),n=new THREE.PerspectiveCamera(1,
1,b.near,b.far),p={disableCollisions:!1,ground:!1};this.closestIntersection=function(b,q,r){for(var m=[],l=0;l<b.length;l+=1){var p=b[l];console.assert(null===p.visibilityId);c(p,q)&&(p.visibilityId=m.length,m.push(p))}if(0===m.length)return!1;n.position.set(0,0,0);n.lookAt(q.ray.direction);n.position.copy(q.ray.origin);n.updateMatrixWorld();g.set(!0,!0,!1);f.set(h);b=a.sortObjects;a.sortObjects=!1;a.renderMeshes(m,k,n,d,!1,q.ignoreVisibility);a.sortObjects=b;f.restore();g.restore();a.readPixels(1,
1,e);a.setRenderTarget(null);b=256*e[0]+e[1];l=e[2]+e[3]/255;for(p=0;p<m.length;p+=1)m[p].visibilityId=null;if(65535===b||l>q.far)return!1;console.assert(b<m.length);r.object=m[b];r.distance=l;r.point.copy(q.ray.direction).multiplyScalar(l).add(q.ray.origin);return!0}}})();(function(){WALK.movePointTowards=function(){var a=new THREE.Vector3;return function(b,c,d){a.copy(b);a.sub(c).normalize();a.multiplyScalar(d);return b.sub(a)}}();WALK.Collider=function(a,b,c){var d=this,e=new THREE.Octree({scene:null,depthMax:Infinity,objectsThreshold:8,overlapPct:.15}),g=c.cameraWorldPosition(),f=b.camera,h=[];this.addStaticObstacle=function(a,b,c){e.add(a,b,c)};this.addDynamicObstacle=function(a){h.push(a)};this.removeDynamicObstacle=function(a){WALK.removeFromArray(a,h)};var k=
function(){var b=new WALK.GpuRaycaster(a,f);return function(a,c){for(var d=e.search(a.ray.origin,a.far,a.ray.direction),f=0;f<h.length;f+=1)d.push(h[f]);return b.closestIntersection(d,a,c)?!0:!1}}(),n=function(){var a=new WALK.RayIntersection;return function(b){return k(b,a)?a.distance:Infinity}}(),p=function(){var a=new WALK.RaycasterConfig;a.ray.direction.set(0,0,-1);a.respectColliderSettings=!0;a.onlyGroundCollisions=f.autoClimb;return function(b,c){a.ray.origin.copy(b);a.far=c;b=n(a);return f.autoClimb||
1<=b?b:Infinity}}();this.distanceToGround=function(a){return p(g,a)};this.objectBelowCamera=function(){var a=new WALK.RayIntersection,b=new WALK.RaycasterConfig(g);b.ray.direction.set(0,0,-1);b.respectColliderSettings=!0;return function(c){b.far=c;return k(b,a)?a.object:null}}();this.distanceToCeiling=function(){var a=new WALK.RaycasterConfig(g);a.ray.direction.set(0,0,1);a.respectColliderSettings=!0;return function(b){a.far=b;return n(a)}}();this.distanceToCeilingFrom=function(){var a=new WALK.RaycasterConfig;
a.ray.direction.set(0,0,1);a.respectColliderSettings=!0;return function(b,c){a.ray.origin.copy(b);a.far=c;return n(a)}}();this.cameraHeightFromPoint=function(a){a=p(a,WALK.MAX_GROUND_SEARCH_DEPTH);return Infinity===a?null:a};this.adjustPointToMatchCameraHeight=function(a){var b=c.cameraHeight;if(null===b)return!1;var d=p(a,WALK.MAX_GROUND_SEARCH_DEPTH);if(Infinity===d)return!1;b-=d;if(.01>Math.abs(b)||0<b&&Infinity!==this.distanceToCeilingFrom(a,b+WALK.MIN_DISTANCE_TO_CEILING))return!1;a.z+=b;return!0};
this.findIntersectionAtPosition=function(){var a=new WALK.RaycasterConfig(g),b=a.ray.direction;return function(d,e,f,h){b.set(d,e,1).unproject(c.camera());b.sub(g).normalize();a.respectColliderSettings=f;return k(a,h)}}();this.findObstacleMeshAtPosition=function(){var a=new WALK.RayIntersection;return function(b,c){return this.findIntersectionAtPosition(b,c,!1,a)?a.object:null}}();this.findMeshFromListAtPosition=function(){var b=new WALK.RaycasterConfig(g),c=new WALK.RayIntersection,d=new WALK.GpuRaycaster(a,
f),e=b.ray.direction;return function(a,k,h,m,q){b.ignoreVisibility=void 0===m?!1:m;m=void 0===q?c:q;e.set(k,h,1).unproject(f);e.sub(g).normalize();return d.closestIntersection(a,b,m)?m.object:null}}();this.clickedPointToMoveTarget=function(){function a(g){var m=c.x-h.x;var q=c.y-h.y;m=Math.sqrt(m*m+q*q);b.far=m+WALK.CLICK_MOVE_MIN_DISTANCE_TO_OBSTACLE;e.x=h.x-c.x;e.y=h.y-c.y;if(!(.01>Math.abs(e.x)&&.01>Math.abs(e.y)))if(e.z=0,e.normalize(),k(b,f)){if(q=f.distance-WALK.CLICK_MOVE_MIN_DISTANCE_TO_OBSTACLE,
0<q&&(g.x=c.x+e.x*q,g.y=c.y+e.y*q,g.z=c.z),q=Math.min(f.distance-.01,m),c.x+=e.x*q,c.y+=e.y*q,d.adjustPointToMatchCameraHeight(c))return a(g)}else g.x=h.x,g.y=h.y,g.z=c.z}var b=new WALK.RaycasterConfig;b.respectColliderSettings=!0;var c=b.ray.origin,e=b.ray.direction,f=new WALK.RayIntersection,h=new THREE.Vector3;return function(b){c.copy(g);h.copy(b);b.copy(g);a(b);d.adjustPointToMatchCameraHeight(b)}}();this.movePointTowardsTheCamera=function(a,b){return WALK.movePointTowards(a,g,b)};this.handleCollisions=
function(){function a(a){c.applyCameraYaw(d);d.normalize();var h=e.start.distanceTo(g),m=e.end.distanceTo(g);if(k-.02<h+m&&h+m<k+.02&&m>=a&&f.equals(d))return!1;h=n(b);Infinity===h&&(h=b.far);f.copy(d);e.start.copy(g);e.end.copy(d).multiplyScalar(h).add(g);k=e.distance();return h<a}var b=new WALK.RaycasterConfig(g),d=b.ray.direction,e=new THREE.Line3,f=new THREE.Vector3,k=0;b.respectColliderSettings=!0;b.far=5;console.assert(b.far>c.MAX_PER_FRAME_LINEAR_DISTANCE);return function(b){b=c.maxFrameMoveLinearDistance(b)+
WALK.KEY_MOVE_MIN_DISTANCE_TO_OBSTACLE;c.movesForward()&&(d.set(0,1,0),a(b)&&c.stopForward());c.movesBackward()&&(d.set(0,-1,0),a(b)&&c.stopBackward());c.movesLeft()&&(d.set(-1,0,0),a(b)&&c.stopLeft());c.movesRight()&&(d.set(1,0,0),a(b)&&c.stopRight());c.movesDown()&&(d.set(0,0,-1),a(b)&&c.stopDown());c.movesUp()&&(d.set(0,0,1),a(b)&&c.stopUp())}}()}})();(function(){WALK.OrbitControls=function(a,b,c,d){function e(){var a=b.getYawAngle(),c=b.getPitchAngle(),e=b.cameraWorldPosition();z.copy(e).sub(l.target);l.autoRotate&&J===D.NONE&&l.rotateLeft(2*Math.PI/60/60*l.autoRotateSpeed);a+=I;c+=O;a=THREE.Math.clamp(a,l.minYawAngle,l.maxYawAngle);c=THREE.Math.clamp(c,l.getMinPitchAngle(),l.getMaxPitchAngle());var f=z.length()*K;f=THREE.Math.clamp(f,l.minDistance,l.maxDistance);l.target.add(T);WALK.OrbitControls.computeCameraPosition(e,l.target,a,c,f);b.cameraPositionUpdated();
b.setYawAngle(a);b.setPitchAngle(c);O=I=0;K=1;T.set(0,0,0);d.requestFrame()}function g(){H=N=C=B=Q=0;L&&(L(),L=!1)}function f(a){if(!1!==q){a.preventDefault();var b=c===document?c.body:c;if(J===D.ROTATE){if(!0===l.noRotate)return;m.set(a.clientX,a.clientY);u.subVectors(m,r);l.rotateLeft(u.x/b.clientWidth*l.mouseRotateSpeed);!1===l.noPitchRotate&&l.rotateUp(u.y/b.clientHeight*l.mouseRotateSpeed);r.copy(m)}else if(J===D.DOLLY){if(!0===l.noZoom)return;y.set(a.clientX,a.clientY);E.subVectors(y,A);0<E.y?
l.dollyIn():0>E.y&&l.dollyOut();A.copy(y)}else if(J===D.PAN){if(!0===l.noPan)return;t.set(a.clientX,a.clientY);v.subVectors(t,x);l.pan(v.x/b.clientHeight,v.y/b.clientWidth);x.copy(t)}J!==D.NONE&&e()}}function h(){!1!==q&&L&&(L(),L=!1)}function k(a){if(!1!==q&&!0!==l.noZoom&&J===D.NONE){a.preventDefault();var b=0;void 0!==a.wheelDelta?b=a.wheelDelta:void 0!==a.detail&&(b=-a.detail);0<b?l.dollyOut():0>b&&l.dollyIn();e()}}function n(a,b,c){return!0===c?b:a===b?0:a}function p(a,b){var c=!1,e=a.keyCode;
if(!1!==q){if(!0===Y&&!1===l.noPan)if(38===e||87===e)N=n(N,1,b),c=!0;else if(40===e||83===e)N=n(N,-1,b),c=!0;else if(37===e||65===e)H=n(H,1,b),c=!0;else{if(39===e||68===e)H=n(H,-1,b),c=!0}else if(!1===Y&&!1===l.noRotate)if((38===e||87===e)&&!1===l.noPitchRotate)B=n(B,1,b),c=!0;else if((40===e||83===e)&&!1===l.noPitchRotate)B=n(B,-1,b),c=!0;else if(37===e||65===e)C=n(C,1,b),c=!0;else if(39===e||68===e)C=n(C,-1,b),c=!0;switch(e){case l.dollyKeys.IN1:case l.dollyKeys.IN2:case l.dollyKeys.IN3:!1===l.noZoom&&
(Q=n(Q,1,b),c=!0);break;case l.dollyKeys.OUT1:case l.dollyKeys.OUT2:case l.dollyKeys.OUT3:!1===l.noZoom&&(Q=n(Q,-1,b),c=!0)}c&&(a.preventDefault(),d.requestFrame())}}this.target=new THREE.Vector3;this.noZoom=!1;this.mouseZoomSpeed=.98;this.keyZoomSpeed=.7;this.minDistance=0;this.maxDistance=Infinity;this.minZoom=0;this.maxZoom=Infinity;this.noPitchRotate=this.noRotate=!1;this.mouseRotateSpeed=2*Math.PI;this.keyYawRotateSpeed=Math.PI/4;this.keyPitchRotateSpeed=this.keyYawRotateSpeed/2;this.autoRotate=
!1;this.autoRotateSpeed=2;this.getMinPitchAngle=function(){return-Math.PI/2};this.getMaxPitchAngle=function(){return Math.PI/2};this.minYawAngle=-Infinity;this.maxYawAngle=Infinity;this.noPan=!1;this.keyPanSpeed=.25;this.dollyKeys={IN1:61,IN2:187,IN3:69,OUT1:173,OUT2:189,OUT3:81};this.primaryMouseButton=THREE.MOUSE.LEFT;this.secondaryMouseButton=THREE.MOUSE.RIGHT;this.mouseButtons={ROTATE:this.primaryMouseButton,ZOOM:THREE.MOUSE.MIDDLE,PAN:this.secondaryMouseButton};var l=this,q=!1,r=new THREE.Vector2,
m=new THREE.Vector2,u=new THREE.Vector2,x=new THREE.Vector2,t=new THREE.Vector2,v=new THREE.Vector2,w=new THREE.Vector3,z=new THREE.Vector3,A=new THREE.Vector2,y=new THREE.Vector2,E=new THREE.Vector2,I=0,O=0,K=1,T=new THREE.Vector3,Y=!1,Q=0,C=0,B=0,H=0,N=0,D={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},J=D.NONE,L=!1;this.enable=function(){q=!0;e()};this.disable=function(){q=!1;g()};this.isEnabled=function(){return q};this.setPanPrimary=function(a){Y=a;!0===Y?(this.mouseButtons.PAN=
this.primaryMouseButton,this.mouseButtons.ROTATE=this.secondaryMouseButton):(this.mouseButtons.ROTATE=this.primaryMouseButton,this.mouseButtons.PAN=this.secondaryMouseButton)};this.getCameraDistance=function(){var a=new THREE.Vector3;return function(){a.copy(b.cameraWorldPosition()).sub(this.target);return a.length()}}();this.rotateLeft=function(a){void 0===a&&(a=2*Math.PI/60/60*l.autoRotateSpeed);I-=a};this.rotateUp=function(a){void 0===a&&(a=2*Math.PI/60/60*l.autoRotateSpeed);O-=a};this.panLeft=
function(b){var c=a.matrixWorld.elements;w.set(c[0],c[1],c[2]);w.multiplyScalar(-b);T.add(w)};this.panUp=function(b){var c=a.matrixWorld.elements;w.set(c[4],c[5],c[6]);w.multiplyScalar(b);T.add(w)};this.pan=function(c,d){if(a instanceof THREE.PerspectiveCamera){var e=b.cameraWorldPosition().clone().sub(l.target).length();e*=Math.tan(a.fov/2*Math.PI/180);l.panLeft(2*c*e);l.panUp(2*d*e)}else a instanceof THREE.OrthographicCamera&&(l.panLeft(c*(a.right-a.left)),l.panUp(d*(a.top-a.bottom)))};this.dollyIn=
function(b){void 0===b&&(b=this.mouseZoomSpeed);a instanceof THREE.PerspectiveCamera?K/=b:a instanceof THREE.OrthographicCamera&&(a.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,a.zoom*b)),a.updateProjectionMatrix())};this.dollyOut=function(b){void 0===b&&(b=this.mouseZoomSpeed);a instanceof THREE.PerspectiveCamera?K*=b:a instanceof THREE.OrthographicCamera&&(a.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,a.zoom/b)),a.updateProjectionMatrix())};this.update=function(a){if(q&&a){var b=!1;0!==
C&&(l.rotateLeft(C*l.keyYawRotateSpeed*a),b=!0);0!==B&&(l.rotateUp(B*l.keyPitchRotateSpeed*a),b=!0);if(0!==H||0!==N)l.pan(H*l.keyPanSpeed*a,N*l.keyPanSpeed*a),b=!0;0!==Q&&(a=Math.pow(l.keyZoomSpeed,a),-1===Q?l.dollyIn(a):l.dollyOut(a),b=!0);b&&e()}};c.addEventListener("mousedown",function(a){if(!1!==q){c.focus();a.preventDefault();if(a.button===l.mouseButtons.ROTATE){if(!0===l.noRotate)return;J=D.ROTATE;r.set(a.clientX,a.clientY)}else if(a.button===l.mouseButtons.ZOOM){if(!0===l.noZoom)return;J=D.DOLLY;
A.set(a.clientX,a.clientY)}else if(a.button===l.mouseButtons.PAN){if(!0===l.noPan)return;J=D.PAN;x.set(a.clientX,a.clientY)}J!==D.NONE&&(document.addEventListener("mousemove",f,!1),document.addEventListener("mouseup",h,!1),L=function(){document.removeEventListener("mousemove",f,!1);document.removeEventListener("mouseup",h,!1);J=D.NONE})}},!1);c.addEventListener("mousewheel",k,!1);c.addEventListener("DOMMouseScroll",k,!1);c.addEventListener("touchstart",function(a){if(!1!==q){var b=a.touches.length;
a.preventDefault();!l.noPan&&(Y&&1===b||!Y&&3===b)?(J=D.TOUCH_PAN,x.set(a.touches[0].clientX,a.touches[0].clientY)):l.noRotate||Y||1!==b?l.noZoom||2!==b?J=D.NONE:(J=D.TOUCH_DOLLY,b=a.touches[0].clientX-a.touches[1].clientX,a=a.touches[0].clientY-a.touches[1].clientY,A.set(0,Math.sqrt(b*b+a*a))):(J=D.TOUCH_ROTATE,r.set(a.touches[0].clientX,a.touches[0].clientY))}},!1);c.addEventListener("touchend",function(){!1!==q&&(J=D.NONE)},!1);c.addEventListener("touchmove",function(a){if(!1!==q){var b=a.touches.length;
a.preventDefault();var d=c===document?c.body:c;!l.noPan&&(Y&&1===b||!Y&&3===b)&&J===D.TOUCH_PAN?(t.set(a.touches[0].clientX,a.touches[0].clientY),v.subVectors(t,x),l.pan(v.x/d.clientHeight,v.y/d.clientWidth),x.copy(t),e()):l.noRotate||Y||1!==b||J!==D.TOUCH_ROTATE?l.noZoom||2!==b||J!==D.TOUCH_DOLLY?J=D.NONE:(b=a.touches[0].clientX-a.touches[1].clientX,a=a.touches[0].clientY-a.touches[1].clientY,y.set(0,Math.sqrt(b*b+a*a)),E.subVectors(y,A),0<E.y?l.dollyOut():0>E.y&&l.dollyIn(),A.copy(y),e()):(m.set(a.touches[0].clientX,
a.touches[0].clientY),u.subVectors(m,r),l.rotateLeft(u.x/d.clientWidth*l.mouseRotateSpeed),l.rotateUp(u.y/d.clientHeight*l.mouseRotateSpeed),r.copy(m),e())}},!1);c.addEventListener("blur",function(a){g()},!1);window.addEventListener("keydown",function(a){WALK.isModifierPressed(a)||p(a,!0)},!1);window.addEventListener("keyup",function(a){p(a,!1)},!1);a instanceof THREE.PerspectiveCamera||a instanceof THREE.OrthographicCamera||console.warn("WARNING: OrbitControls.js requires perspective or orthographic camers")};
WALK.OrbitControls.prototype.constructor=WALK.OrbitControls;WALK.OrbitControls.computeCameraPosition=function(){var a=new THREE.Vector3;return function(b,c,d,e,g){d-=Math.PI/2;e+=Math.PI/2;a.x=g*Math.sin(e)*Math.cos(d);a.y=g*Math.sin(e)*Math.sin(d);a.z=g*Math.cos(e);b.copy(c).add(a)}}()})();(function(){WALK.Controls=function(a,b,c,d){function e(){R.rotation.z=WALK.normalizeRotation(V.z+P.z)}function g(){e();M.rotation.x=WALK.normalizeRotation(V.x+P.x);W.rotation.y=V.y;R.updateMatrixWorld(!0)}function f(a){return 40>=Math.abs(a[0].y-a[1].y)}function h(a){K[0].copy(O[0]);K[1].copy(O[1]);a.touches?(O[0].set(a.touches[0].clientX,a.touches[0].clientY),2===a.touches.length?O[1].set(a.touches[1].clientX,a.touches[1].clientY):O[1].set(0,0)):(O[0].set(a.clientX,a.clientY),O[1].set(0,0))}function k(a){if(m)if(a.preventDefault(),
h(a),H){if(H!==B){if(H===Y){var b=N[0].distanceTo(N[1]);a=O[0].distanceTo(O[1]);10<=Math.abs(a-b)?(H=Q,b=!0):f(O)&&f(N)&&10<=Math.abs(O[0].y-N[0].y)?(H=C,b=!0):b=!1;if(!b)return}H===Q?(b=K[1].distanceTo(K[0]),b=O[1].distanceTo(O[0])-b,0<Math.abs(b)&&(D=Date.now(),y.activateDirectionFromSource(Math.sign(b),v)),d.requestFrame()):H===C&&f(O)&&(b=O[0].y-K[0].y,0<Math.abs(b)&&(J=Date.now(),E.activateDirectionFromSource(Math.sign(b),v)),d.requestFrame())}}else if(!r.mousePressLook||L||!H&&a.touches){b=
a.movementX||a.mozMovementX||a.webkitMovementX;void 0===b&&(b=O[0].x-K[0].x);var c=a.movementY||a.mozMovementY||a.webkitMovementY;void 0===c&&(c=O[0].y-K[0].y);a=r.flipMouseLook||!H&&a.touches?1:-1;P.z+=a*b*WALK.CAMERA_LOOK_SPEED;r.mouseControlsPitch&&(P.x+=a*c*WALK.CAMERA_LOOK_SPEED);r.restrictVerticalAngle&&(P.x>r.verticalAngleMax?P.x=r.verticalAngleMax:P.x<r.verticalAngleMin&&(P.x=r.verticalAngleMin));g();d.requestFrame()}}function n(a){m&&(b.focus(),a.preventDefault(),h(a),L=!0,d.requestFrame())}
function p(a){m&&(a.preventDefault(),L=!1)}function l(a){var c=0,e;(e=!m)||(e=void 0!==document.hasFocus?document.hasFocus():document.activeElement===b,e=!e);e||(a||(a=window.event),a.preventDefault(),a.wheelDelta?c=a.wheelDelta/120:a.detail&&(c=-a.detail/3),T+=c*WALK.CAMERA_SCROLL_SPEED,T=0<=T?Math.min(T,.5):Math.max(T,-.5),d.requestFrame())}function q(){r.stopForward();r.stopBackward();r.stopLeft();r.stopRight();r.stopUp();r.stopDown();I.stopInDirection(1);I.stopInDirection(-1)}var r=this,m=!0;
this.MAX_PER_FRAME_LINEAR_DISTANCE=1;var u=Math.PI/12;$jscomp.initSymbol();var x=Symbol("MOVE_SOURCE_NONE");$jscomp.initSymbol();var t=Symbol("MOVE_SOURCE_KEY");$jscomp.initSymbol();var v=Symbol("MOVE_SOURCE_GESTURE");$jscomp.initSymbol();var w=Symbol("MOVE_SOURCE_GAMEPAD"),z=function(a){this.activeDirection=0;this.activeSource=x;this.speed=0;this.moves=function(){return this.activeDirection||this.speed};this.movesInDirection=function(a){return this.activeDirection===a||Math.sign(this.speed)===a};
this.activateDirectionFromSource=function(a,b){this.activeDirection=a;this.activeSource=b};this.deactivateDirectionFromSource=function(a,b){this.activeDirection===a&&this.activeSource===b&&(this.activeDirection=0,this.activeSource=b)};this.deactivateSource=function(a){this.activeSource===a&&(this.activeDirection=0,this.activeSource=x)};this.stopInDirection=function(a){this.activeDirection===a&&(this.activeDirection=0,this.activeSource=x);Math.sign(this.speed)===a&&(this.speed=0)};this.update=function(b,
c){if(!this.moves())return 0;var d=Math.sign(this.speed),e=this.activeDirection||-d;e=c*e*(d===e?b/WALK.CAMERA_FULL_ACCELERATION_TIME:b/WALK.CAMERA_FULL_DECELERATION_TIME);c*=this.speed+e/2;this.speed=THREE.Math.clamp(this.speed+e,-b,b);this.activeDirection||Math.sign(this.speed)===d||(this.speed=0);return THREE.Math.clamp(c,-a,a)}},A=new z(this.MAX_PER_FRAME_LINEAR_DISTANCE),y=new z(this.MAX_PER_FRAME_LINEAR_DISTANCE),E=new z(this.MAX_PER_FRAME_LINEAR_DISTANCE),I=new z(u),O=[new THREE.Vector2(0,
0),new THREE.Vector2(0,0)],K=[new THREE.Vector2(0,0),new THREE.Vector2(0,0)],T=0;$jscomp.initSymbol();var Y=Symbol("GESTURE_RECOGNITION");$jscomp.initSymbol();var Q=Symbol("GESTURE_PINCH");$jscomp.initSymbol();var C=Symbol("GESTURE_TWO_POINTER_DRAG");$jscomp.initSymbol();var B=Symbol("GESTURE_IGNORE"),H=null,N=[new THREE.Vector2(0,0),new THREE.Vector2(0,0)],D=0,J=0,L=!1,W=new THREE.Object3D,M=new THREE.Object3D,R=new THREE.Object3D,F=!1,P=new THREE.Vector3(0,0,0),V=new THREE.Euler(0,0,0);W.add(a);
M.add(W);R.add(M);this.flipMouseLook=this.mousePressLook=!1;this.restrictVerticalAngle=this.mouseControlsPitch=!0;this.verticalAngleMin=-Math.PI/2;this.verticalAngleMax=Math.PI/3;this.arrowsTurn=!0;this.orbit=new WALK.OrbitControls(a,this,b,d);this.orbit.keyYawRotateSpeed=WALK.CAMERA_ARROWS_TURN_SPEED;this.orbit.keyPitchRotateSpeed=WALK.CAMERA_ARROWS_TURN_SPEED/2;this.cameraHeight=null;this.isFpsEnabled=function(){return m};this.isOrbitEnabled=function(){return this.orbit.isEnabled()};this.orbitModeEnable=
function(){m=!1;this.orbit.enable()};this.camera=function(){return a};this.applyCameraYaw=function(a){a.applyEuler(R.rotation)};this.cameraWorldPosition=function(){return R.position};this.cameraPositionUpdated=function(){var b={type:"positionChanged",target:null},c=null,d=null,e=null;return function(){R.updateMatrixWorld(!0);var f=R.position;if(c!==f.x||d!==f.y||e!==f.z)c=f.x,d=f.y,e=f.z,a.dispatchEvent(b)}}();this.resetRollAngle=function(){0!==W.rotation.y&&(V.y=0,g())};this.getPitchAngle=function(){return M.rotation.x};
this.setPitchAngle=function(a){a!==M.rotation.x&&(P.x=a,V.x=0,g())};this.resetPitchAngle=function(){this.setPitchAngle(0)};this.getYawAngle=function(){return R.rotation.z};this.setYawAngle=function(a){a!==R.rotation.z&&(P.z=a,V.z=0,g())};this.resetYawAngle=function(){this.setYawAngle(0)};this.isHandlingGesture=function(){return null!==H};this.hmdReset=function(){F=!0;this.resetPitchAngle()};this.onHmdUpdate=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector3,
e=new THREE.Vector3;return function(f,k){m&&(V.copy(f),F?P.z-=V.z:k&&(d.subVectors(k,c),a.set(Math.cos(P.z),Math.sin(P.z),0),b.set(-Math.sin(P.z),Math.cos(P.z),0),e.copy(a.multiplyScalar(d.x)),e.add(b.multiplyScalar(d.y)),e.z=d.z,R.position.add(e)),k&&c.copy(k),F=!1,g())}}();this.maxFrameMoveLinearDistance=function(b){return Math.min(b*a.moveMaxSpeed,this.MAX_PER_FRAME_LINEAR_DISTANCE)};this.movesForward=function(){return y.movesInDirection(1)||0<T};this.stopForward=function(){0<T&&(T=0);y.stopInDirection(1)};
this.movesBackward=function(){return y.movesInDirection(-1)||0>T};this.stopBackward=function(){0>T&&(T=0);y.stopInDirection(-1)};this.movesLeft=function(){return A.movesInDirection(-1)};this.stopLeft=function(){A.stopInDirection(-1)};this.movesRight=function(){return A.movesInDirection(1)};this.stopRight=function(){A.stopInDirection(1)};this.movesUp=function(){return E.movesInDirection(1)};this.stopUp=function(){E.stopInDirection(1)};this.movesDown=function(){return E.movesInDirection(-1)};this.stopDown=
function(){E.stopInDirection(-1)};this.enable=function(){this.orbit.disable();m=!0;L=0};this.disable=function(){this.orbit.disable();m=!1;q()};this.update=function(b){if(m){y.activeSource===v&&100<Date.now()-D&&y.deactivateSource(v);E.activeSource===v&&100<Date.now()-J&&E.deactivateSource(v);var c=A.update(a.moveMaxSpeed,b),f=y.update(a.moveMaxSpeed,b),g=E.update(a.moveMaxSpeed,b);var k=0;f?T=0:(T&&(f=r.maxFrameMoveLinearDistance(b),k=THREE.Math.clamp(T,-f,f),T-=k),f=k);R.translateX(c);R.translateY(f);
R.translateZ(g);b=I.update(WALK.CAMERA_ARROWS_TURN_SPEED,b);P.z+=b;e();(A.moves()||y.moves()||E.moves()||I.moves()||T)&&d.requestFrame();this.cameraPositionUpdated()}else this.orbit.update(b)};a.rotation.set(0,0,0);a.up.set(0,0,1);a.lookAt(new THREE.Vector3(0,1,0));b.setAttribute("tabindex",-1);b.addEventListener("contextmenu",function(a){a.preventDefault()},!1);b.addEventListener("mousedown",n,!1);b.addEventListener("touchstart",function(a){m&&(a.preventDefault(),h(a),2===a.touches.length?(H=Y,N[0].copy(O[0]),
N[1].copy(O[1])):2<a.touches.length&&(H=B))},!1);b.addEventListener("mousemove",k,!1);b.addEventListener("touchmove",k,!1);b.addEventListener("mouseup",p,!1);b.addEventListener("touchend",function(a){m&&(a.preventDefault(),H=0===a.touches.length?null:B)},!1);b.addEventListener("keydown",function(a){var b=!0;if(m&&!WALK.isModifierPressed(a)){switch(a.keyCode){case 38:case 32:case 87:y.activateDirectionFromSource(1,t);break;case 37:r.arrowsTurn?I.activateDirectionFromSource(1,t):A.activateDirectionFromSource(-1,
t);break;case 65:A.activateDirectionFromSource(-1,t);break;case 40:case 83:y.activateDirectionFromSource(-1,t);break;case 39:r.arrowsTurn?I.activateDirectionFromSource(-1,t):A.activateDirectionFromSource(1,t);break;case 68:A.activateDirectionFromSource(1,t);break;case 33:case 69:E.activateDirectionFromSource(1,t);break;case 34:case 81:E.activateDirectionFromSource(-1,t);break;default:b=!1}b&&(a.preventDefault(),d.requestFrame())}},!1);b.addEventListener("keyup",function(a){var b=!0;if(m){switch(a.keyCode){case 38:case 32:case 87:y.deactivateDirectionFromSource(1,
t);break;case 37:case 65:I.deactivateDirectionFromSource(1,t);A.deactivateDirectionFromSource(-1,t);break;case 40:case 83:y.deactivateDirectionFromSource(-1,t);break;case 39:case 68:I.deactivateDirectionFromSource(-1,t);A.deactivateDirectionFromSource(1,t);break;case 33:case 69:E.deactivateDirectionFromSource(1,t);break;case 34:case 81:E.deactivateDirectionFromSource(-1,t);break;default:b=!1}b&&a.preventDefault()}},!1);b.addEventListener("mouseout",function(a){p(a)},!1);b.addEventListener("mouseenter",
function(a){0<a.buttons&&n(a)},!1);b.addEventListener("DOMMouseScroll",l,!1);b.addEventListener("mousewheel",l,!1);b.addEventListener("blur",function(a){q()},!1);c.addEventListener("actionActivated",function(a){if(m)switch(a.action){case WALK.GAMEPAD_ACTION.BACKWARD:y.activateDirectionFromSource(-1,w);break;case WALK.GAMEPAD_ACTION.FORWARD:y.activateDirectionFromSource(1,w);break;case WALK.GAMEPAD_ACTION.LEFT:r.arrowsTurn?I.activateDirectionFromSource(1,w):A.activateDirectionFromSource(-1,w);break;
case WALK.GAMEPAD_ACTION.RIGHT:r.arrowsTurn?I.activateDirectionFromSource(-1,w):A.activateDirectionFromSource(1,w);break;case WALK.GAMEPAD_ACTION.DOWN:E.activateDirectionFromSource(-1,w);break;case WALK.GAMEPAD_ACTION.UP:E.activateDirectionFromSource(1,w)}});c.addEventListener("actionDeactivated",function(a){if(m)switch(a.action){case WALK.GAMEPAD_ACTION.BACKWARD:y.deactivateDirectionFromSource(-1,w);break;case WALK.GAMEPAD_ACTION.FORWARD:y.deactivateDirectionFromSource(1,w);break;case WALK.GAMEPAD_ACTION.LEFT:A.deactivateDirectionFromSource(-1,
w);I.deactivateDirectionFromSource(1,w);break;case WALK.GAMEPAD_ACTION.RIGHT:A.deactivateDirectionFromSource(1,w);I.deactivateDirectionFromSource(-1,w);break;case WALK.GAMEPAD_ACTION.DOWN:E.deactivateDirectionFromSource(-1,w);break;case WALK.GAMEPAD_ACTION.UP:E.deactivateDirectionFromSource(1,w)}});this.isEnabled=function(){return m}}})();(function(){WALK.ClickNavigator=function(a,b,c){function d(){c.teleportingToPoint&&c.cancelSwitchToPoint()}function e(){!b.mousePressLook&&c.teleportingToPoint&&c.cancelSwitchToPoint()}this.onMeshClicked=function(d,e){b.isOrbitEnabled()||b.isHandlingGesture()||(a.clickedPointToMoveTarget(e),c.switchToPoint(e))};this.dispose=function(){document.removeEventListener("keydown",d,!1);document.removeEventListener("mousedown",d,!1);document.removeEventListener("mousemove",e,!1);document.removeEventListener("touchstart",
d,!1);document.removeEventListener("DOMMouseScroll",d,!1);document.removeEventListener("mousewheel",d,!1)};document.addEventListener("keydown",d,!1);document.addEventListener("mousedown",d,!1);document.addEventListener("mousemove",e,!1);document.addEventListener("touchstart",d,!1);document.addEventListener("DOMMouseScroll",d,!1);document.addEventListener("mousewheel",d,!1)}})();(function(){WALK.StepsClimber=function(a,b,c){var d,e,g=b.cameraWorldPosition(),f=new THREE.Vector3;this.updateCameraHeight=function(h){if(d){var k=g.z-f.z;null!==b.cameraHeight&&(b.cameraHeight+=k);g.x!==f.x||g.y!==f.y?e=a.distanceToGround(WALK.MAX_GROUND_SEARCH_DEPTH):Infinity!==e&&(e+=k);if(Infinity!==e&&(null===b.cameraHeight&&(b.cameraHeight=e),k=b.cameraHeight,e<k-.005||e>k+.005)){var n=1.5*b.camera().moveMaxSpeed;k=b.cameraHeight;h=Math.min(n*h,Math.abs(e-k));e>k&&(h=-h);if(0>h||Infinity===
a.distanceToCeiling(h+WALK.MIN_DISTANCE_TO_CEILING))g.z+=h,e+=h,c.requestFrame()}f.copy(g)}};this.enable=function(){d=!0;e=a.distanceToGround(WALK.MAX_GROUND_SEARCH_DEPTH);b.cameraHeight=Infinity!==e?e:null;f.copy(g)};this.disable=function(){d=!1};this.isEnabled=function(){return d};this.enable()}})();(function(){WALK.VRHeightController=function(a,b){var c=a.cameraWorldPosition(),d,e,g;this.onHmdPositionUpdate=function(f){d&&!g&&1<f.z&&(a.cameraHeight=f.z,b.adjustPointToMatchCameraHeight(c),a.cameraPositionUpdated(),e=c.z,g=!0)};this.onTeleportDone=function(){d&&(e=c.z)};this.updateCameraHeight=function(){d&&(a.cameraHeight+=c.z-e,e=c.z)};this.enable=function(){d=!0;a.cameraHeight=b.cameraHeightFromPoint(c);null===a.cameraHeight&&(a.cameraHeight=WALK.VR_FALLBACK_CAMERA_HEIGHT);e=c.z;g=!1};this.disable=
function(){d=!1;a.cameraHeight=null}}})();(function(){function a(a){var b=null;this.activateSky=function(c){if(b){if(b.name===c)return;a.removeAuxiliaryObject(b)}var d=a.findSkyMesh(c);(c=d.material.map)&&!c.loaded?(this.activateSky(WALK.DEFAULT_SKY_NAME),b=d,c.addLoadedListener(function(){b===d&&(a.addAuxiliaryObject(d),d.updateMatrixWorld(!0))})):(a.addAuxiliaryObject(d),d.updateMatrixWorld(!0),b=d)};this.activeSkyName=function(){return b.name}}function b(a,b,c){this.position=a||new THREE.Vector3;this.rotation=b||new THREE.Vector2;this.fov=
c||0}var c=1/180;b.prototype={length:function(){return Math.sqrt(this.position.lengthSq()+this.rotation.lengthSq()+this.fov*this.fov)},multiplyScalar:function(a){this.position.multiplyScalar(a);this.rotation.multiplyScalar(a);this.fov*=a;return this},divideScalar:function(a){this.position.divideScalar(a);this.rotation.divideScalar(a);this.fov/=a;return this},normalize:function(){return this.divideScalar(this.length())},normalizeRotation:function(){this.rotation.x=WALK.normalizeRotation(this.rotation.x);
this.rotation.y=WALK.normalizeRotation(this.rotation.y);return this},distanceTo:function(a){var b=this.position.x-a.position.x,c=this.position.y-a.position.y,d=this.position.z-a.position.z,h=WALK.normalizeRotation(this.rotation.x-a.rotation.x),k=WALK.normalizeRotation(this.rotation.y-a.rotation.y);a=this.fov-a.fov;return Math.sqrt(b*b+c*c+d*d+h*h+k*k+a*a)},subVectors:function(a,b){this.position.subVectors(a.position,b.position);this.rotation.subVectors(a.rotation,b.rotation);this.fov=a.fov-b.fov;
return this.normalizeRotation()},copy:function(a){this.position.copy(a.position);this.rotation.copy(a.rotation);this.fov=a.fov;return this}};WALK.Teleport=function(d,e,g,f){function h(){x=[];for(var a=0;a<d.views.length;a+=1)x[d.views[a].id]=[];for(a=0;a<d.gpuMeshes.length;a+=1){var b=d.gpuMeshes[a],c=b.hideInViews;if(c)for(var e=0;e<c.length;e+=1)x[c[e]]?x[c[e]].push(b):console.warn("Invalid view id in hideInViews list: '"+c[a]+"'")}}function k(a){for(var b=0;b<a.length;b+=1){var c=a[b];c.visible=
!1;t.push(c)}}function n(){for(var a=0;a<t.length;a+=1)t[a].visible=!0;t.length=0}function p(a){n();k(a)}function l(){u.fov=v.fov;m.copy(v.position);e.setYawAngle(v.rotation.x);e.setPitchAngle(v.rotation.y);e.cameraPositionUpdated()}var q=this,r=new a(d),m=e.cameraWorldPosition(),u=d.camera,x,t=[],v=new b,w=new b,z=new THREE.Vector3,A=0,y=0,E=0,I,O,K,T=!1,Y={type:"teleportStarted",view:null},Q={type:"teleportDone",view:null},C=null;this.lastDestinationView=null;var B=this.teleportingToPoint=this.teleportingToView=
!1,H=!1,N=function(){var a=new b(e.cameraWorldPosition());return function(){a.rotation.set(e.getYawAngle(),e.getPitchAngle());a.normalizeRotation();a.fov=u.fov;return a}}();this.update=function(){function a(a,b){var c=0;y*y/(2*E)>=b?(c=y/E,c=2*(y*c-b)/(c*c)*-a):y<A&&(c=a*E);d.copy(w);y=THREE.Math.clamp(y+.5*c,0,A);d.multiplyScalar(y*a);y=THREE.Math.clamp(y+.5*c,0,A);d.fov&&(u.fov+=d.fov,u.updateProjectionMatrix());m.add(d.position);e.setYawAngle(e.getYawAngle()+d.rotation.x);e.setPitchAngle(e.getPitchAngle()+
d.rotation.y)}var d=new b;return function(b){if(q.teleportingToView||q.teleportingToPoint){b=Math.min(b,.067);b=Math.max(b,c);var d=N().distanceTo(v);this.teleportingToPoint&&(v.position.z=m.z);var g=!0;0!==d&&(a(b,d),N().distanceTo(v)>d||0===y?l():g=!1,e.cameraPositionUpdated());g&&(this.teleportingToView&&("orbit"!==K.mode||T?(b=e.camera(),b.near=WALK.CAMERA_WALK_NEAR,b.updateProjectionMatrix(),e.enable()):(e.orbit.minDistance=I,e.orbit.maxDistance=O,e.orbit.setPanPrimary(K.panPrimary||!1),e.orbit.noPan=
K.noPan||!1,e.orbit.noRotate=K.noRotate||!1,e.orbit.noPitchRotate=K.noPitchRotate||!1,e.orbit.getMinPitchAngle=function(){return-K.maxUpAngle},e.orbit.getMaxPitchAngle=function(){return-K.minUpAngle},e.orbit.minYawAngle=-K.maxSideAngle,e.orbit.maxYawAngle=-K.minSideAngle,e.orbit.target.copy(z),e.orbitModeEnable()),r.activateSky(K.sky),p(x[K.id]||[])),this.teleportingToView=this.teleportingToPoint=!1,Q.view=K,this.dispatchEvent(Q));f.requestFrame()}}}();this.cancelSwitchToPoint=function(){console.assert(this.teleportingToPoint);
this.teleportingToPoint=!1;Q.view=null;this.dispatchEvent(Q)};this.switchToPoint=function(a){if(a.x!==m.x||a.y!==m.y)if(K=null,this.teleportingToPoint=!0,this.teleportingToView=!1,Y.view=null,this.dispatchEvent(Y),B?v.position.set(a.x,a.y,a.z):v.position.set(a.x,a.y,m.z),a=Math.atan2(-(a.x-m.x),a.y-m.y),a=WALK.normalizeRotation(a),v.rotation.set(a,0),v.fov=u.defaultFov,B)l(),this.update(c);else{w.subVectors(v,N());a=w.length();A=2*WALK.CAMERA_DEFAULT_MOVE_MAX_SPEED;E=A/WALK.CAMERA_FULL_ACCELERATION_TIME;
var b=WALK.TELEPORT_TO_POINT_MAX_TIME;a>(b-WALK.CAMERA_FULL_ACCELERATION_TIME)*A&&(A=WALK.Math.anyPositiveRootOfQuadraticEquation(1,-E*b,E*a),null===A&&(b/=2,E=a/(b*b),A=E*b));w.normalize();y=0;f.requestFrame()}};this.switchToView=function(a,b){void 0===b&&(b=WALK.TELEPORT_TO_VIEW_MAX_TIME);a.hideFromMenu||(C=a);this.lastDestinationView=K=a;this.teleportingToView=!0;this.teleportingToPoint=!1;Y.view=K;this.dispatchEvent(Y);e.disable();e.resetRollAngle();k(x[K.id]||[]);void 0!==K.rotation?v.rotation.set(K.rotation.yaw,
K.rotation.pitch):v.rotation.set(0,0);v.fov=K.fov||u.defaultFov;"orbit"===K.mode?(void 0!==K.target?z.set(K.target.x,K.target.y,K.target.z):z.set(0,0,0),I=K.minDistance||0,O=K.maxDistance||100,a=THREE.Math.clamp(K.distance||10,I,O),WALK.OrbitControls.computeCameraPosition(v.position,z,v.rotation.x,v.rotation.y,a),a=e.camera(),a.near=WALK.CAMERA_ORBIT_NEAR,a.updateProjectionMatrix()):void 0!==K.position?(v.position.set(K.position.x,K.position.y,K.position.z),H&&g.adjustPointToMatchCameraHeight(v.position)):
v.position.set(0,0,0);if(0===b||B)l(),this.update(c);else{K.sky!==r.activeSkyName()&&r.activateSky(WALK.DEFAULT_SKY_NAME);w.subVectors(v,N());a=w.length();E=WALK.TELEPORT_TO_VIEW_ACCELERATION;var d=Math.sqrt(a/E);d>b/2&&(d=b/2,E=a/(d*d));A=E*d;w.normalize();y=0}f.requestFrame()};this._switchToAdjacentVisibleView=function(a,b){var c=d.visibleViews();if(0!==c.length)if(null===C)this.switchToView(c[0],b);else{var e=c.indexOf(C);-1===e&&this.switchToView(c[0],b);this.switchToView(c[(e+c.length+a)%c.length],
b)}};this.switchToPreviousVisibleView=function(a){this._switchToAdjacentVisibleView(-1,a)};this.switchToNextVisibleView=function(a){this._switchToAdjacentVisibleView(1,a)};this.updateHiddenMeshes=function(a){h();a?p(x[a.id]||[]):n();f.requestFrame()};this.activateSky=function(a){r.activateSky(a.sky);f.requestFrame()};this.executeWithViewVisibilitySettings=function(a,b){var c=t.slice();p(x[a.id]||[]);r.activateSky(a.sky);b();r.activateSky(this.lastDestinationView.sky);p(c)};this.onVrChange=function(a){H=
B=T=a;this.lastDestinationView&&"orbit"===this.lastDestinationView.mode&&this.switchToView(this.lastDestinationView,0)};h();d.addEventListener("viewAdded",h);d.addEventListener("viewRemoved",h);d.addEventListener("skyMeshAdded",function(a){r.activateSky(a.skyMesh.name);f.requestFrame()});d.addEventListener("skyMeshRemoved",function(a){r.activeSkyName()===a.skyMesh.name&&(r.activateSky(WALK.DEFAULT_SKY_NAME),f.requestFrame())})};THREE.EventDispatcher.prototype.apply(WALK.Teleport.prototype)})();(function(){WALK.AutoTour=function(a,b){function c(){d&&b.switchToNextVisibleView(4)}var d=!1,e={type:"tourStarted"},g={type:"tourStopped"};b.addEventListener("teleportDone",function(){d&&setTimeout(c,WALK.AUTO_TOUR_IN_VIEW_STILL_TIME_MS)});this.isRunning=function(){return d};this.start=function(){console.assert(!d);d=!0;this.dispatchEvent(e);c()};this.stop=function(){console.assert(d);d=!1;b.switchToView(b.lastDestinationView,0);this.dispatchEvent(g)}};THREE.EventDispatcher.prototype.apply(WALK.AutoTour.prototype)})();(function(){function a(a){return-.7>=a?0:.7<=a?1:-1}function b(a,b){if("xr-standard"===a.mapping)return"left"===(a.hand?a.hand:b)?d:e;b=$jscomp.makeIterator(c);for(var f=b.next();!f.done;f=b.next()){f=f.value;var g=a;var h=f;g=h.gamepadIdPattern.test(g.id)?void 0!==h.gamepadLayoutMappingId?g.mapping===h.gamepadLayoutMappingId:!0:!1;if(g)return f}console.error("No matching action mapping for gamepad found",a.id);return null}WALK.GAMEPAD_ACTION={TRIGGER:0,BACKWARD:1,FORWARD:2,LEFT:3,RIGHT:4,DOWN:5,
UP:6,PREVIOUS:7,NEXT:8};var c=[{gamepadIdPattern:/^Spatial Controller \(Spatial Interaction Source\).*$/,axisMapping:new Map([[2,[WALK.GAMEPAD_ACTION.PREVIOUS,WALK.GAMEPAD_ACTION.NEXT]],[3,[WALK.GAMEPAD_ACTION.UP,WALK.GAMEPAD_ACTION.DOWN]],[0,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[1,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[1,WALK.GAMEPAD_ACTION.TRIGGER]])},{gamepadIdPattern:/Oculus Touch \(Left\)/,axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.LEFT,
WALK.GAMEPAD_ACTION.RIGHT]],[1,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[1,WALK.GAMEPAD_ACTION.TRIGGER],[3,WALK.GAMEPAD_ACTION.DOWN],[4,WALK.GAMEPAD_ACTION.UP]])},{gamepadIdPattern:/Oculus Touch \(Right\)/,axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[1,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[1,WALK.GAMEPAD_ACTION.TRIGGER],[3,WALK.GAMEPAD_ACTION.NEXT],[4,WALK.GAMEPAD_ACTION.PREVIOUS]])},
{gamepadIdPattern:/OpenVR (Gamepad|Controller)/,axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.PREVIOUS,WALK.GAMEPAD_ACTION.NEXT]],[1,[WALK.GAMEPAD_ACTION.DOWN,WALK.GAMEPAD_ACTION.UP]]]),buttonMapping:new Map([[1,WALK.GAMEPAD_ACTION.TRIGGER]])},{gamepadIdPattern:/.*/,gamepadLayoutMappingId:"standard",axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[1,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]],[2,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[3,
[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[0,WALK.GAMEPAD_ACTION.DOWN],[1,WALK.GAMEPAD_ACTION.NEXT],[2,WALK.GAMEPAD_ACTION.PREVIOUS],[3,WALK.GAMEPAD_ACTION.UP],[4,WALK.GAMEPAD_ACTION.TRIGGER],[5,WALK.GAMEPAD_ACTION.TRIGGER]])},{gamepadIdPattern:/.*/,axisMapping:new Map([[0,[WALK.GAMEPAD_ACTION.PREVIOUS,WALK.GAMEPAD_ACTION.NEXT]],[1,[WALK.GAMEPAD_ACTION.UP,WALK.GAMEPAD_ACTION.DOWN]]]),buttonMapping:new Map([[0,WALK.GAMEPAD_ACTION.TRIGGER],[1,WALK.GAMEPAD_ACTION.TRIGGER],
[2,WALK.GAMEPAD_ACTION.TRIGGER],[3,WALK.GAMEPAD_ACTION.TRIGGER]])}],d={axisMapping:new Map([[2,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[3,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[0,WALK.GAMEPAD_ACTION.TRIGGER],[4,WALK.GAMEPAD_ACTION.DOWN],[5,WALK.GAMEPAD_ACTION.UP]])},e={axisMapping:new Map([[2,[WALK.GAMEPAD_ACTION.LEFT,WALK.GAMEPAD_ACTION.RIGHT]],[3,[WALK.GAMEPAD_ACTION.FORWARD,WALK.GAMEPAD_ACTION.BACKWARD]]]),buttonMapping:new Map([[0,WALK.GAMEPAD_ACTION.TRIGGER],
[4,WALK.GAMEPAD_ACTION.NEXT],[5,WALK.GAMEPAD_ACTION.PREVIOUS]])},g=function(c,d){d=b(c,d);this.axisMapping=d.axisMapping;this.buttonMapping=d.buttonMapping;this.axisPosition=c.axes.map(a);this.buttonPressed=c.buttons.map(function(a){return a.pressed})};WALK.GamepadManager=function(){function b(a){var b=a.gamepad;a=new g(a.gamepad);d.set(b.index,a)}function c(a){d.delete(a.gamepad.index)}var d=new Map,e=new Map,p=new Set,l=new Set,q={type:"actionActivated",action:null},r={type:"actionDeactivated",
action:null};this.hasGamepads=function(){return 0<d.size||0<e.size};this.update=function(){function b(b,c){for(var d=0;d<c.axes.length;++d){var e=a(c.axes[d]),f=b.axisPosition[d];if(e!==f){var g=b.axisMapping.get(d);void 0!==g&&(-1!==f&&l.add(g[f]),-1!==e&&p.add(g[e]))}b.axisPosition[d]=e}for(d=0;d<c.buttons.length;++d)e=c.buttons[d].pressed,f=b.buttonPressed[d],e!==f&&(g=b.buttonMapping.get(d),void 0!==g&&(f?l.add(g):p.add(g))),b.buttonPressed[d]=e}if(this.hasGamepads()){p.clear();l.clear();var c=
navigator.getGamepads?navigator.getGamepads():[];c=$jscomp.makeIterator(c);for(var f=c.next();!f.done;f=c.next())if(f=f.value){var g=d.get(f.index);b(g,f)}c=$jscomp.makeIterator(e);for(f=c.next();!f.done;f=c.next())g=$jscomp.makeIterator(f.value),f=g.next().value,g=g.next().value,b(g,f);f=$jscomp.makeIterator(l);for(c=f.next();!c.done;c=f.next())r.action=c.value,this.dispatchEvent(r);f=$jscomp.makeIterator(p);for(c=f.next();!c.done;c=f.next())q.action=c.value,this.dispatchEvent(q)}};this.addXrGamepad=
function(a,b){b=new g(a,b);e.set(a,b)};this.removeXrGamepad=function(a){e.delete(a)};this.removeAllXrGamepads=function(){e.clear()};(function(){if(navigator.getGamepads){window.addEventListener("gamepadconnected",b);window.addEventListener("gamepaddisconnected",c);for(var a=$jscomp.makeIterator(navigator.getGamepads()),e=a.next();!e.done;e=a.next())if(e=e.value){var f=new g(e);d.set(e.index,f)}}})()};THREE.EventDispatcher.prototype.apply(WALK.GamepadManager.prototype)})();/*
 Copyright (C) 2020-present Shapespark
*/
(function(){WALK.GazeModeObserver=function(){var a=this,b=!1,c={type:"modeDisabled"},d={type:"modeEnabled"};this.enableMode=function(){b=!0;a.dispatchEvent(d)};this.disableMode=function(){b=!1;a.dispatchEvent(c)};this.modeIsEnabled=function(){return b}};THREE.EventDispatcher.prototype.apply(WALK.GazeModeObserver.prototype)})();(function(){function a(){var a=new THREE.BufferGeometry,b=new Float32Array(18);a.addAttribute("position",new THREE.BufferAttribute(b,3));b[0]=.05;b[1]=-.05;b[2]=-2;b[3]=.05;b[4]=.05;b[5]=-2;b[6]=-.05;b[7]=-.05;b[8]=-2;b[9]=.05;b[10]=.05;b[11]=-2;b[12]=-.05;b[13]=.05;b[14]=-2;b[15]=-.05;b[16]=-.05;b[17]=-2;a.computeBoundingSphere();return a}console.assert(WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S<=WALK.GAZE_POINTER_ACTIVATE_AFTER_S);var b=Math.PI/60;WALK.GazePointer=function(c,d,e,g){function f(){k=n=
null;p=0;l=!1;q&&q.setCircleSpan(0)}var h=g.modeIsEnabled(),k,n,p,l,q=null,r=null,m=null;this.setGazeHandlers=function(a,b){r=a;m=b};var u=function(){if(!h)f();else if(!q){var b=new WALK.GazePointerMaterial,g=new THREE.Mesh(a(),b);c.addAuxiliaryObject(g);g.frustumCulled=!1;g.matrixWorld=d.camera().matrixWorld;q={setVisible:function(a){g.visible=a;e()},setCircleSpan:function(a){b.circleSpan=a;e()}};f()}q&&q.setVisible(h)};g.addEventListener("modeDisabled",function(){h=!1;u()});g.addEventListener("modeEnabled",
function(){h=!0;u()});this.reset=function(){null!==k&&f()};this.update=function(a){if(h){var c=d.getPitchAngle(),e=d.getYawAngle();null===k?(k=c,n=e):Math.abs(k-c)>b||Math.abs(n-e)>b?f():(p+=a,p>=WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S&&(l?(q.setCircleSpan(Math.min((p-WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S)/(WALK.GAZE_POINTER_ACTIVATE_AFTER_S-WALK.GAZE_POINTER_SHOW_LOADING_AFTER_S),1)),p>=WALK.GAZE_POINTER_ACTIVATE_AFTER_S&&(m&&m(),f())):r&&r()?l=!0:f()))}};u()}})();/*
 Copyright (C) 2018-present Shapespark
*/
(function(){WALK.HashChangeTeleport=function(a,b){function c(){var c=WALK.urlHashGetArgument("view");c&&(c=a.findViewByName(c))&&(b.switchToView(c),window.location.hash=WALK.urlHashRemoveArgument("view"))}window.addEventListener("hashchange",c,!1);this.dispose=function(){window.removeEventListener("hashchange",c,!1)}}})();(function(){WALK.AutoClearAlter=function(a){var b,c,d,e;this.set=function(g,f,h){console.assert(void 0===b&&void 0===c&&void 0===d&&void 0===e);b=a.autoClear;c=a.autoClearColor;d=a.autoClearDepth;e=a.autoClearStencil;a.autoClear=g||f||h;a.autoClearColor=g;a.autoClearDepth=f;a.autoClearStencil=h};this.restore=function(){console.assert(void 0!==b&&void 0!==c&&void 0!==d&&void 0!==e);a.autoClear=b;a.autoClearColor=c;a.autoClearDepth=d;a.autoClearStencil=e;e=d=c=b=void 0}}})();(function(){WALK.ClearColorAlter=function(a){var b=new THREE.Color,c=!1;this.set=function(d){console.assert(!c);c=!0;b.copy(a.getClearColor());a.setClearColor(d)};this.restore=function(){console.assert(c);c=!1;a.setClearColor(b)}}})();(function(){var a=WALK.getShader("standard_material_vertex.glsl"),b=WALK.getShader("standard_material_fragment.glsl"),c=new WALK.InlineShader("vec3 addSpecularHook(in vec3 baseColor, in vec3 totalIntensity,\n                     inout float opacity) {\n  return addSpecular(baseColor, totalIntensity, opacity);\n}"),d=new THREE.Color,e=new THREE.Vector3(0,0,0),g=new THREE.Vector4(0,0,1,1);WALK.ParallaxModes={basic:"USE_BASIC_PARALLAX",steep:"USE_STEEP_PARALLAX",occlusion:"USE_OCLUSION_PARALLAX",relief:"USE_RELIEF_PARALLAX"};
WALK.StandardMaterial=function(){var c=this;WALK.BaseMaterial.call(this,a,b,this.fragmentShaderHooks());this.type="standard";this.merged=!1;this._opacity=1;Object.defineProperty(this,"opacity",{get:function(){return this._opacity},set:function(a){this._opacity=.99<a?1:a;this.configureTransparency();this.setUniforms();this._updated()}});this.baseColor=new THREE.Color(16777215);this._baseColorTexture=null;this._baseColorTextureCorrection=this.planarReflector=!1;this._baseColorTextureContrast=0;this.baseColorTextureHslOffset=
{h:0,s:0,l:0};this._baseColorCorrectionUniform=new THREE.Vector4;this.lightMapped=!1;this.lightVisibilityMap=null;this._lightVisibilityMapSize=new THREE.Vector2;this.lightAttrMap=null;this.lightsCount=0;this._emissive=!1;this._roughness=this._emissionStrength=1;this._metallic=0;this._lastUsedLightProbeId=this.cubeCameraIndex=null;this._haveTextureLod=WALK.DETECTOR.textureLod;this._mipLevel1=this._mipLevel0=null;this.disableLightProbeTmp=this.disableLightProbe=!1;this._envMapProject=!0;this._hdrOutput=
!1;this._bumpScale=.001;this.parallaxCorrection=!1;this.parallaxMode="basic";this.parallaxScale=-.03;this.parallaxMinLayers=10;this.parallaxMaxLayers=15;this.colorMap=null;this.cameraExposure=0;this.cameraGamma=1;this.headLight=!1;this._uvOffsetScale=null;this.highlight=WALK.EDIT_MODE?WALK.EDITOR_SELECTION_COLOR:null;this._specularOff=this._highlightMix=0;this.doNotImport={baseColor:!1,opacity:!1};var d={type:"materialUpdated",target:this};this._updated=function(){return c.dispatchEvent(d)};this._alphaInLowerHalf=
!1;this._chromaKeyEnabled=void 0;this.chromaKeyColor=(new THREE.Color).setRGB(0,.94,0);this._chromaKeyDelta=new THREE.Vector3(.1,.1,.1);this._chromaKeyDeltaCoeff=new THREE.Vector3};WALK.StandardMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.StandardMaterial.prototype.constructor=WALK.StandardMaterial;WALK.StandardMaterial.prototype.addTextureProperty=function(a){var b="_"+a;Object.defineProperty(this,a,{get:function(){return this[b]||null},set:function(a){var c=this;(this[b]=a)?
a.addLoadedListener(function(){c.setUniforms();c._updated();c=a=null}):(c.setUniforms(),c._updated())}})};WALK.StandardMaterial.prototype.addTextureProperty("roughnessTexture");WALK.StandardMaterial.prototype.addTextureProperty("metallicTexture");WALK.StandardMaterial.prototype.addTextureProperty("bumpTexture");WALK.StandardMaterial.prototype.fragmentShaderHooks=function(){return c};WALK.StandardMaterial.prototype._useChromaKey=function(){return!(!this.isAnimated||!this.chromaKeyEnabled)};WALK.StandardMaterial.prototype._useAlphaInLowerHalf=
function(){return!(!this.isAnimated||!this.alphaInLowerHalf)};WALK.StandardMaterial.prototype._useBaseColorTextureAsCutout=function(){var a=this._baseColorTexture;return 1===this.opacity&&(a&&a.isCutout||this._useAlphaInLowerHalf()||this._useChromaKey())};WALK.StandardMaterial.prototype.configureTransparency=function(){var a=this._baseColorTexture;a=a&&(a.hasAlpha||this._useAlphaInLowerHalf()||this._useChromaKey());this.transparent=1>this.opacity||a;a=this._useBaseColorTextureAsCutout();this.transparent?
(this.blending=THREE.NormalBlending,this.transparentRenderOrder=a?0:1):this.blending=THREE.NoBlending;this.depthWrite=!this.transparent||a};Object.defineProperty(WALK.StandardMaterial.prototype,"alphaInLowerHalf",{get:function(){return this._alphaInLowerHalf},set:function(a){this._alphaInLowerHalf=a;this.configureTransparency();this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"chromaKeyEnabled",{get:function(){return!!this._chromaKeyEnabled},set:function(a){this._chromaKeyEnabled=
!!a;this.configureTransparency();this.setUniforms();this._updated()}});WALK.StandardMaterial.prototype.setChromaKeyColorRGB=function(a,b,c){this.chromaKeyColor.setRGB(a,b,c);this.setUniforms();this._updated()};WALK.StandardMaterial.prototype.getChromaKeyDeltaComponent=function(a){return this._chromaKeyDelta.getComponent(a)};WALK.StandardMaterial.prototype.setChromaKeyDeltaComponent=function(a,b){this._chromaKeyDelta.setComponent(a,b);this.setUniforms();this._updated()};Object.defineProperty(WALK.StandardMaterial.prototype,
"isAnimated",{get:function(){var a=this.baseColorTexture;return a&&a.isAnimated}});Object.defineProperty(WALK.StandardMaterial.prototype,"isPlaying",{get:function(){var a=this.baseColorTexture;return a&&a.isAnimated&&a.isPlaying}});WALK.StandardMaterial.prototype.play=function(){console.assert(this.isAnimated);var a=this.baseColorTexture.isPlaying;this.baseColorTexture.play();this.baseColorTexture.isPlaying!==a&&this._updated()};WALK.StandardMaterial.prototype.pause=function(){console.assert(this.isAnimated);
var a=this.baseColorTexture.isPlaying;this.baseColorTexture.pause();this.baseColorTexture.isPlaying!==a&&this._updated()};WALK.StandardMaterial.prototype.sleepAnimation=function(){console.assert(this.isAnimated);this.baseColorTexture.sleepAnimation()};WALK.StandardMaterial.prototype.wakeAnimation=function(){console.assert(this.isAnimated);this.baseColorTexture.wakeAnimation()};Object.defineProperty(WALK.StandardMaterial.prototype,"doubleSided",{get:function(){return this.side===THREE.DoubleSide},
set:function(a){this.side=a?THREE.DoubleSide:THREE.FrontSide;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"envMapMirror",{get:function(){return 0===this.roughness&&!this.roughnessTexture}});Object.defineProperty(WALK.StandardMaterial.prototype,"hdrOutput",{get:function(){return this._hdrOutput},set:function(a){a!==this._hdrOutput&&(this._hdrOutput=a,this.setUniforms())}});Object.defineProperty(WALK.StandardMaterial.prototype,"specularOff",{get:function(){return this._specularOff},
set:function(a){a!==this._specularOff&&(this._specularOff=a,this.setUniforms())}});Object.defineProperty(WALK.StandardMaterial.prototype,"highlightMix",{get:function(){return this._highlightMix},set:function(a){a!==this._highlightMix&&(this._highlightMix=a,this.uniforms.highlightMix.value=a)}});Object.defineProperty(WALK.StandardMaterial.prototype,"cameraExposure",{get:function(){return this._cameraExposure},set:function(a){this._cameraExposure=a;this.setUniform("exposure","f",Math.pow(2,a))}});Object.defineProperty(WALK.StandardMaterial.prototype,
"cameraGamma",{get:function(){return this.uniforms.cameraGamma.value},set:function(a){this.setUniform("cameraGamma","f",a)}});Object.defineProperty(WALK.StandardMaterial.prototype,"baseColorTexture",{get:function(){return this._baseColorTexture},set:function(a){var b=this;(this._baseColorTexture=a)?a.addLoadedListener(function(){b.configureTransparency();b.setUniforms();b._updated();b=a=null}):(b.setUniforms(),b._updated())}});Object.defineProperty(WALK.StandardMaterial.prototype,"baseColorTextureCorrection",
{get:function(){return this._baseColorTextureCorrection},set:function(a){this._baseColorTextureCorrection=a;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"baseColorTextureContrast",{get:function(){return this._baseColorTextureContrast},set:function(a){this._baseColorTextureContrast=a;this.setUniforms();this._updated()}});WALK.StandardMaterial.prototype.setBaseColorTextureHslOffset=function(a,b,c){this.baseColorTextureHslOffset.h=a;this.baseColorTextureHslOffset.s=
b;this.baseColorTextureHslOffset.l=c;this.setUniforms();this._updated()};Object.defineProperty(WALK.StandardMaterial.prototype,"emissive",{get:function(){return this._emissive},set:function(a){this._emissive=a;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"emissionStrength",{get:function(){return this._emissionStrength},set:function(a){this._emissionStrength=a;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,
"roughness",{get:function(){return this._roughness},set:function(a){this._roughness=a;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"metallic",{get:function(){return this._metallic},set:function(a){this._metallic=a;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,"envMapProject",{get:function(){return this._envMapProject},set:function(a){this._envMapProject=a;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterial.prototype,
"bumpScale",{get:function(){return this._bumpScale},set:function(a){this._bumpScale=a;this.setUniforms();this._updated()}});WALK.StandardMaterial.prototype.setDoNotImport=function(a,b){this.doNotImport[a]=b;this.setUniforms();this._updated()};WALK.StandardMaterial.prototype.isLightProbeDisabled=function(){return this.disableLightProbe||this.disableLightProbeTmp||this.specularOff||1===this.roughness&&!this._roughnessTexture||this.transparent&&this.doubleSided};WALK.StandardMaterial.prototype._setLightProbeUniforms=
function(){this.setUniform("envMap","t",null);if(!this.condDefine(this._haveTextureLod,"HAVE_TEXTURE_LOD")){var a=WALK.LIGHT_PROBE_MIPS_COUNT-1;this._mipLevel0=Math.floor(this.roughness*a);this._mipLevel1=Math.min(this._mipLevel0+1,a);this.setUniform("envMap2","t",null)}this.envMapMirror?this.setUniform("envMipsCount","f",1):this.setUniform("envMipsCount","f",0);this.condDefine(this.envMapProject,"USE_ENVMAP_PROJECT")&&(this.setUniform("envMapPosW","v3",e),this.setUniform("envBoxMin","v3",e),this.setUniform("envBoxMax",
"v3",e));this._lastUsedLightProbeId=null};WALK.StandardMaterial.prototype.setUvOffsetAndScale=function(a,b,c,d){this._uvOffsetScale||(this._uvOffsetScale=new THREE.Vector4);console.assert(!this.baseColorTexture||!this.baseColorTexture.parentTexture,"Can't set uv offset and scale if baseColor texture is in atlas");this._uvOffsetScale.set(a,b,c,d)};WALK.StandardMaterial.prototype.setUniforms=function(){this.setUniform("opacity","f",this.opacity);var a=!this.isLightProbeDisabled(),b=!1,c=this.roughnessTexture;
this.condDefine(c&&c.loaded&&a,"USE_ROUGHNESS_TEXTURE")?(this.setUniform("roughnessTexture","t",c),b=!0):this.setUniform("roughness","f",this.roughness);c=this.metallicTexture;this.condDefine(c&&c.loaded&&a,"USE_METALLIC_TEXTURE")?(this.setUniform("metallicTexture","t",c),b=!0):this.setUniform("metallic","f",this.metallic);this.setUniform("emissionStrength","f",this.emissive?this.emissionStrength:0);this._baseColorTexture&&this.baseColorTextureCorrection?(d.set(this.baseColor),d.offsetHSL(this.baseColorTextureHslOffset.h,
this.baseColorTextureHslOffset.s,this.baseColorTextureHslOffset.l),c=Math.max(1+this.baseColorTextureContrast,0),this._baseColorCorrectionUniform.set(c*(d.r-this.baseColor.r-.5)+.5,c*(d.g-this.baseColor.g-.5)+.5,c*(d.b-this.baseColor.b-.5)+.5,c)):this._baseColorCorrectionUniform.set(0,0,0,1);this.setUniform("baseColorCorrection","v4",this._baseColorCorrectionUniform);c=null;if(this._baseColorTexture)if(this._baseColorTexture.parentTexture){c=this._baseColorTexture.parentTexture;var e=this._baseColorTexture.uvOffsetScale}else c=
this._baseColorTexture,e=g;this.condDefine(c&&c.loaded,"USE_BASE_COLOR_TEXTURE")?(this.setUniform("baseColorTexture","t",c),b=!0,this.setUniform("baseColorAtlasUvMod","v4",e),this._useBaseColorTextureAsCutout()?this.setUniform("alphaDiscardThreshold","f",.25):this.setUniform("alphaDiscardThreshold","f",0)):this.setUniform("baseColor","c",this.baseColor);this.condDefine(this._useAlphaInLowerHalf(),"USE_ALPHA_IN_LOWER_HALF");this.condDefine(this._useChromaKey(),"USE_CHROMA_KEY")&&(this.setUniform("chromaKeyColor",
"c",this.chromaKeyColor),e=this._chromaKeyDelta,this._chromaKeyDeltaCoeff.x=1/(1.22*e.x),this._chromaKeyDeltaCoeff.y=1/(1.22*e.y),this._chromaKeyDeltaCoeff.z=1/(1.22*e.z),this.setUniform("chromaKeyDeltaCoeff","v3",this._chromaKeyDeltaCoeff));c=this.bumpTexture;this.condDefine(c&&c.loaded&&a,"USE_BUMP_TEXTURE")&&(this.enableStandardDerivativesExtension(),this.setUniform("bumpTexture","t",c),b=!0,this.setUniform("bumpScale","f",this.bumpScale),this.condDefine(this.parallaxCorrection,"USE_PARALLAX_CORRECTION")&&
(this.addDefine(WALK.ParallaxModes[this.parallaxMode]),this.setUniform("parallaxScale","f",this.parallaxScale),this.setUniform("parallaxMinLayers","f",this.parallaxMinLayers),this.setUniform("parallaxMaxLayers","f",this.parallaxMaxLayers)));b&&this.setUniform("uvMod","v4",this._uvOffsetScale||g);this.condDefine(this.lightMapped,"USE_LIGHTMAP")&&this.setUniform("lightMap","t",null);this.condDefine(this.lightAttrMap&&!this.specularOff,"USE_DYNAMIC_LIGHT")&&(console.assert(this.lightVisibilityMap),console.assert(this.lightsCount),
console.assert(this.lightVisibilityMap.width),console.assert(this.lightVisibilityMap.height),this.setUniform("lightVisibilityMap","t",this.lightVisibilityMap),this.setUniform("lightAttrMap","t",this.lightAttrMap),this.setUniform("lightsCount","f",this.lightsCount),this._lightVisibilityMapSize.set(this.lightVisibilityMap.width,this.lightVisibilityMap.height),this.setUniform("lightVisibilityMapSize","v2",this._lightVisibilityMapSize));this.condDefine(a,"USE_ENVMAP")&&(this._haveTextureLod&&this.enableTextureLodExtension(),
this._setLightProbeUniforms());this.condDefine(this.highlight,"USE_HIGHLIGTH")&&(this.setUniform("highlight","c",this.highlight),this.setUniform("highlightMix","f",this.highlightMix));this.condDefine(this.hdrOutput,"HDR_OUTPUT");this.condDefine(!this.hdrOutput&&this.colorMap,"USE_COLORMAP")&&this.setUniform("colorMap","t",this.colorMap);this.condDefine((this.headLight||!this.lightMapped)&&!this.specularOff,"USE_HEADLIGHT")};WALK.StandardMaterial.prototype.forceObjectUniformsRefresh=function(){this._lastUsedLightProbeId=
null};WALK.StandardMaterial.prototype.textureNeedsUv0=function(a){return!0};WALK.StandardMaterial.prototype.hash=function(){return this.baseColorTexture?"standard"+this.baseColorTexture.name:"standard#"+this.baseColor.r+":"+this.baseColor.g+":"+this.baseColor.b};WALK.StandardMaterial.prototype.canMerge=function(a){if(this.type!==a.type||this.opacity!==a.opacity)return!1;if(this._baseColorTexture||a._baseColorTexture){if(this._baseColorTexture!==a._baseColorTexture||this.baseColorTextureCorrection!==
a.baseColorTextureCorrection||this.baseColorTextureContrast!==a.baseColorTextureContrast||this.baseColorTextureHslOffset.h!==a.baseColorTextureHslOffset.h||this.baseColorTextureHslOffset.s!==a.baseColorTextureHslOffset.s||this.baseColorTextureHslOffset.l!==a.baseColorTextureHslOffset.l||this._useAlphaInLowerHalf()!==a._useAlphaInLowerHalf()||(this._useChromaKey()?!(a._useChromaKey()&&this.chromaKeyColor.equals(a.chromaKeyColor)&&this._chromaKeyDelta.equals(a._chromaKeyDelta)):a._useChromaKey()))return!1}else if(!this.baseColor.equals(a.baseColor))return!1;
if(this.emissive||a.emissive)if(this.emissive!==a.emissive||this.emissionStrength!==a.emissionStrength)return!1;if(this.roughnessTexture||a.roughnessTexture){if(this.roughnessTexture!==a.roughnessTexture)return!1}else if(this.roughness!==a.roughness)return!1;if(this.metallicTexture||a.metallicTexture){if(this.metallicTexture!==a.metallicTexture)return!1}else if(this.metallic!==a.metallic)return!1;return(this.bumpTexture||a.bumpTexture)&&(this.bumpTexture!==a.bumpTexture||this.bumpScale!==a.bumpScale)||
this.envMapProject!==a.envMapProject||this.doubleSided!==a.doubleSided||this.parallaxCorrection||a.parallaxCorrection?!1:!0};WALK.StandardMaterial.prototype.refreshPerObjectUniforms=function(a,b){var c=!1;if(!this.isLightProbeDisabled()){var d=a.lightProbe;if(this._lastUsedLightProbeId!==d.id){c=!0;this._lastUsedLightProbeId=d.id;var f=this.envMapMirror?d.getMirrorTexture():this._haveTextureLod?d.getFilteredTexture():d.getFilteredTextureNoLod(this._mipLevel0);b.envMap.value=f;this._haveTextureLod||
(b.envMap2.value=d.getFilteredTextureNoLod(this._mipLevel1));this.envMapMirror||(b.envMipsCount.value=WALK.LIGHT_PROBE_MIPS_COUNT);this.envMapProject&&(d.isBoundingBoxEnabled()?(b.envMapPosW.value=d.position,b.envBoxMin.value=d.boxMin,b.envBoxMax.value=d.boxMax):(b.envBoxMin.value=e,b.envBoxMax.value=e))}}a=a.lightMap;this.lightMapped&&b.lightMap.value!==a&&(c=!0,b.lightMap.value=a);return c};WALK.StandardMaterial.prototype.setBaseColorRGB=function(a,b,c){this.baseColor.setRGB(a,b,c);this.setUniforms();
this._updated()};WALK.StandardMaterial.prototype.setTexture=function(a,b){if(b){var c=this.baseColorTexture;c&&(b.wrapS=c.wrapS,b.wrapT=c.wrapT,b.anisotropy=c.anisotropy)}this[a]=b||null;"baseColorTexture"===a?(this._baseColorTextureCorrection=!1,this._baseColorTextureContrast=0,this.baseColorTextureHslOffset.h=0,this.baseColorTextureHslOffset.s=0,this.baseColorTextureHslOffset.l=0):"bumpTexture"===a&&(this._bumpScale=.001)};WALK.StandardMaterial.prototype.serialize=function(){var a=this,b=null;console.assert(!this.merged);
this.baseColorTextureCorrection&&(b={contrast:this.baseColorTextureContrast,hslOffset:[this.baseColorTextureHslOffset.h,this.baseColorTextureHslOffset.s,this.baseColorTextureHslOffset.l]});var c={name:this.name,type:this.type,baseColor:this.baseColor.roundChannels().toArray(),baseColorTextureCorrection:b,alphaInLowerHalf:this.alphaInLowerHalf,opacity:this.opacity,emissive:this.emissive,emissionStrength:this.emissionStrength,roughness:this.roughness,metallic:this.metallic,envMapProject:this.envMapProject,
bumpScale:this.bumpScale,doubleSided:this.doubleSided,doNotImport:this.doNotImport};void 0!==this._chromaKeyEnabled&&(c.chromaKeyEnabled=this.chromaKeyEnabled,c.chromaKeyColor=this.chromaKeyColor.roundChannels().toArray(),c.chromaKeyDelta=this._chromaKeyDelta.toArray());b=function(b){var d=a[b];d?d.fromEditor&&(c[b]=d.serialize()):c[b]=null};b("baseColorTexture");b("roughnessTexture");b("metallicTexture");b("bumpTexture");return c}})();(function(){WALK.StandardMaterialWater=function(){WALK.StandardMaterial.call(this);this.type="water";this._isPlaying=!0;this._isSleeping=!1;this.setUniform("time","f",0);this._roughness=0;this.baseColor=new THREE.Color(0);this._wavesScale=this._wavesSpeed=1;this._refractionFactor=0;this.opacity=.2;this.doNotImport={baseColor:!0,baseColorTexture:!0,opacity:!0}};WALK.StandardMaterialWater.prototype=Object.create(WALK.StandardMaterial.prototype);WALK.StandardMaterialWater.prototype.constructor=WALK.StandardMaterialWater;
WALK.StandardMaterialWater.prototype.addTextureProperty("normalTexture");WALK.StandardMaterialWater.prototype.textureNeedsUv0=function(a){return!1};WALK.StandardMaterialWater.prototype.hash=function(a){return"water"};WALK.StandardMaterialWater.prototype.canMerge=function(a){return this.type===a.type&&this.opacity===a.opacity&&this.baseColor.equals(a.baseColor)&&this.normalTexture===a.normalTexture&&this.wavesSpeed===a.wavesSpeed&&this.wavesScale===a.wavesScale&&this.refractionFactor===a.refractionFactor};
WALK.StandardMaterialWater.prototype.setUniforms=function(){WALK.StandardMaterial.prototype.setUniforms.call(this);var a=this.normalTexture;this.condDefine(a&&a.loaded&&!this.isLightProbeDisabled(),"USE_NORMAL_TEXTURE")&&(this.setUniform("normalTexture","t",a),this.setUniform("wavesScale","f",this.wavesScale),1!==this.opacity?this.setUniform("refractionFactor","f",this.refractionFactor):this.setUniform("refractionFactor","f",0))};WALK.StandardMaterialWater.prototype.fragmentShaderHooks=function(){return WALK.getShader("water.glsl")};
Object.defineProperty(WALK.StandardMaterialWater.prototype,"refractionFactor",{get:function(){return this._refractionFactor},set:function(a){this._refractionFactor=a;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"wavesSpeed",{get:function(){return this._wavesSpeed},set:function(a){this._wavesSpeed=a;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"wavesScale",{get:function(){return this._wavesScale},
set:function(a){this._wavesScale=a;this.setUniforms();this._updated()}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"hideFromLightProbes",{get:function(){return 1!==this.opacity&&0!==this.refractionFactor}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"isAnimated",{get:function(){return!0}});Object.defineProperty(WALK.StandardMaterialWater.prototype,"isPlaying",{get:function(){return!this._isSleeping&&this._isPlaying&&0<this.wavesSpeed}});WALK.StandardMaterialWater.prototype.play=
function(){this._isPlaying=!0};WALK.StandardMaterialWater.prototype.pause=function(){this._isPlaying=!1};WALK.StandardMaterialWater.prototype.sleepAnimation=function(){this._isSleeping=!0};WALK.StandardMaterialWater.prototype.wakeAnimation=function(){this._isSleeping=!1};WALK.StandardMaterialWater.prototype.update=function(a){this.uniforms.time.value+=a*this.wavesSpeed*.1};WALK.StandardMaterialWater.prototype.serialize=function(){return{name:this.name,type:this.type,baseColor:this.baseColor.roundChannels().toArray(),
baseColorTexture:null,opacity:this.opacity,normalTexture:this.normalTexture?this.normalTexture.serialize():null,wavesSpeed:this.wavesSpeed,wavesScale:this.wavesScale,refractionFactor:this.refractionFactor,doNotImport:this.doNotImport}}})();(function(){var a=WALK.getShader("standard_material_vertex.glsl"),b=WALK.getShader("luma_fragment.glsl"),c=new THREE.Color(16777215);WALK.LumaMaterial=function(d){WALK.BaseMaterial.call(this,a,b);this.computeIncidentLuma=d;this.setUniform("lightMap","t",null);this.color=new THREE.Color(c);this.setUniform("color","c",this.color);this.addDefine("USE_LIGHTMAP")};WALK.LumaMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.LumaMaterial.prototype.constructor=WALK.LumaMaterial;WALK.LumaMaterial.prototype.refreshPerObjectUniforms=
function(a,b){var d=a.lightMap,e=!1;b.lightMap.value!==d&&(b.lightMap.value=d,e=!0);a=this.computeIncidentLuma?c:a.material.baseColor;a.equals(this.color)||(this.color.copy(a),e=!0);return e}})();(function(){WALK.DebugMaterial=function(){WALK.StandardMaterial.call(this);this.noSharedBuffers=new THREE.Color(16777215);this.sharedBuffersMaster=new THREE.Color(255);this.sharedBuffersCopy=new THREE.Color(65280);this.headLight=!0;this.setUniforms();this.defaultAttributeValues=Object.assign({},this.defaultAttributeValues);this.defaultAttributeValues.sphericalNormal=[0,0]};WALK.DebugMaterial.prototype=Object.create(WALK.StandardMaterial.prototype);WALK.DebugMaterial.prototype.refreshPerObjectUniforms=
function(a,b){b.baseColor.value=0===a.sharedBuffersDebug?this.noSharedBuffers:1===a.sharedBuffersDebug?this.sharedBuffersMaster:this.sharedBuffersCopy;return!0}})();(function(){var a=WALK.getShader("equirect_sky_vertex.glsl"),b=WALK.getShader("equirect_sky_fragment.glsl");WALK.EquirectSkyMaterial=function(){WALK.BaseMaterial.call(this,a,b);this.depthWrite=!1;this.side=THREE.FrontSide;this.uniforms={map:{type:"t",value:null},colorMap:{type:"t",value:null},exposure:{type:"f",value:1},cameraGamma:{type:"f",value:1}}};WALK.EquirectSkyMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.EquirectSkyMaterial.prototype.constructor=WALK.EquirectSkyMaterial;
Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"map",{get:function(){return this.uniforms.map.value},set:function(a){this.uniforms.map.value=a;this.condDefine(this.map.isRgbm,"USE_RGBM_MAP")}});Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"hdrOutput",{get:function(){return this.hasDefine("HDR_OUTPUT")},set:function(a){this.condDefine(a,"HDR_OUTPUT")}});Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"colorMap",{get:function(){return this.uniforms.colorMap.value},set:function(a){this.uniforms.colorMap.value=
a;this.condDefine(a,"USE_COLORMAP")}});Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"cameraExposure",{get:function(){return Math.log2(this.uniforms.exposure.value)},set:function(a){this.uniforms.exposure.value=Math.pow(2,a)}});Object.defineProperty(WALK.EquirectSkyMaterial.prototype,"cameraGamma",{get:function(){return this.uniforms.cameraGamma.value},set:function(a){this.uniforms.cameraGamma.value=a}})})();(function(){WALK.ProceduralSkyMaterial=function(){WALK.BaseMaterial.call(this,WALK.getShader("procedural_sky_vertex.glsl"),WALK.getShader("procedural_sky_fragment.glsl"));this.depthWrite=!1;this.side=THREE.BackSide;this.uniforms={topColor:{type:"c",value:new THREE.Color(15135487)},bottomColor:{type:"c",value:new THREE.Color(16777215)},sinBottomAngle:{type:"f",value:Math.sin(THREE.Math.degToRad(-30))},exponent:{type:"f",value:.9},colorMap:{type:"t",value:null}}};WALK.ProceduralSkyMaterial.prototype=
Object.create(WALK.BaseMaterial.prototype);WALK.ProceduralSkyMaterial.prototype.constructor=WALK.ProceduralSkyMaterial;Object.defineProperty(WALK.ProceduralSkyMaterial.prototype,"hdrOutput",{get:function(){return this.hasDefine("HDR_OUTPUT")},set:function(a){this.condDefine(a,"HDR_OUTPUT")}});Object.defineProperty(WALK.ProceduralSkyMaterial.prototype,"colorMap",{get:function(){return this.uniforms.colorMap.value},set:function(a){this.uniforms.colorMap.value=a;this.condDefine(a,"USE_COLORMAP")}})})();(function(){var a=WALK.getShader("object_distance_vertex.glsl"),b=WALK.getShader("object_distance_float_fragment.glsl"),c=WALK.getShader("object_distance_byte_fragment.glsl");WALK.ObjectDistanceMaterial=function(d){WALK.BaseMaterial.call(this,a,d?b:c);this.doNotOverrideSide=!0;this.uniforms={objectId:{type:"i",value:null}}};WALK.ObjectDistanceMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.ObjectDistanceMaterial.prototype.constructor=WALK.ObjectDistanceMaterial;WALK.ObjectDistanceMaterial.prototype.refreshPerObjectUniforms=
function(a,b){b.objectId.value=a.visibilityId;return!0}})();(function(){var a=WALK.getShader("wireframe_vertex.glsl"),b=WALK.getShader("wireframe_fragment.glsl");WALK.WireframeMaterial=function(c){WALK.BaseMaterial.call(this,a,b);this.lineColor=c;this.setUniform("lineColor","c",c);this.setUniform("lineMaxAlpha","f",.65);this.setUniform("highlight","c",WALK.EDITOR_SELECTION_COLOR);this.setUniform("highlightMix","f",0);this.customLightmapResolutionLineColor=new THREE.Color(170);this.autoLightmapResolutionLineColor=new THREE.Color(43690);this.meshSelectedLineColor=
new THREE.Color(47872);this.meshSelectedSecondaryLineColor=new THREE.Color(13404160);this.transparent=!0;this.blending=THREE.NormalBlending;this.depthWrite=this.depthTest=!1;this.attributes=this.attributes.concat(["order"]);this.enableStandardDerivativesExtension()};WALK.WireframeMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.WireframeMaterial.prototype.constructor=WALK.WireframeMaterial;WALK.WireframeMaterial.prototype.propertyFromUniform("lineMaxAlpha");WALK.WireframeMaterial.prototype.propertyFromUniform("highlight");
WALK.WireframeMaterial.prototype.propertyFromUniform("highlightMix");WALK.WireframeMaterial.prototype.refreshPerObjectUniforms=function(a,b){var c=!1;null!==a.highlightMix&&void 0!==a.highlightMix&&a.highlightMix!==b.highlightMix.value&&(b.highlightMix.value=a.highlightMix,c=!0);return null!==a.selected&&void 0!==a.selected&&(a=!0===a.selected?this.meshSelectedLineColor:!0===a.selectedSecondary?this.meshSelectedSecondaryLineColor:null!==a.node.lightmapResolution?this.customLightmapResolutionLineColor:
0<=a.autoLightmapResolution?this.autoLightmapResolutionLineColor:this.lineColor,b.lineColor.value!==a)?(b.lineColor.value=a,!0):c}})();(function(){var a=new WALK.InlineShader("attribute vec3 envLookup;\nvarying vec3 vEnvLookup;\nvoid main() {\nvEnvLookup = envLookup;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"),b=new WALK.InlineShader("uniform samplerCube envMap;\nvarying vec3 vEnvLookup;\nvoid main() {\nint objectId = int(textureCube(envMap, vEnvLookup).x);\nint x = objectId / (256 * 256);\nint y = (objectId - 256 * 256 * x) / 256;\nint z = (objectId - 256 * 256 * x - 256 * y);\ngl_FragColor = vec4(float(x) / 255.0, float(y) / 255.0,\nfloat(z) / 255.0, 1.0);\n}");
WALK.ObjectDistanceReader=function(c,d){var e=[],g=[],f=3*d,h=2*d;this.readCubeMapToBuffer=function(a){r.uniforms.envMap.value=a;q.set(!0,!1,!1);c.render(n,k,p);c.readPixels(f,h,l);q.restore();return l};this.dispose=function(){for(var a=0;6>a;a+=1)e[a].geometry.dispose();r.dispose();p.dispose();l=null};var k=new THREE.OrthographicCamera(-1,1,1,-1,0,1);var n=new THREE.Scene;var p=c.createRenderTarget(f,h,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1});
var l=new Uint8Array(4*f*h);var q=new WALK.AutoClearAlter(c);var r=new WALK.BaseMaterial(a,b);r.uniforms={envMap:{type:"t",value:null}};r.attributes={envLookup:{type:"v3",value:null}};(function(){for(var a=[[[1,1,1],[1,1,-1],[1,-1,1],[1,-1,-1]],[[-1,1,-1],[-1,1,1],[-1,-1,-1],[-1,-1,1]],[[-1,1,-1],[1,1,-1],[-1,1,1],[1,1,1]],[[-1,-1,1],[1,-1,1],[-1,-1,-1],[1,-1,-1]],[[-1,1,1],[1,1,1],[-1,-1,1],[1,-1,1]],[[1,1,-1],[-1,1,-1],[1,-1,-1],[-1,-1,-1]]],b=0;6>b;b+=1){var c=new THREE.PlaneBufferGeometry(d,d),
f=new Float32Array(12);c.addAttribute("envLookup",new THREE.BufferAttribute(f,3));for(var k=0;4>k;k+=1){var h=k,q=a[b][k];f[3*h]=q[0];f[3*h+1]=q[1];f[3*h+2]=q[2]}e[b]=new THREE.Mesh(c,r);n.add(e[b])}g[0]=[0,0];g[1]=[d,0];g[2]=[2*d,0];g[3]=[0,d];g[4]=[d,d];g[5]=[2*d,d]})();(function(a,b){a/=2;var c=b/2;k.left=-a;k.right=a;k.top=c;k.bottom=-c;k.updateProjectionMatrix();b=-a+d/2;a=c-d/2;for(c=0;c<e.length;c+=1)e[c].position.set(b+g[c][0],a-g[c][1],0)})(f,h)}})();(function(){WALK.ObjectDistanceQuery=function(a,b,c){var d=new WALK.ObjectDistanceMaterial(!0),e=new WALK.CubeCamera(WALK.CAMERA_WALK_NEAR,c);c=WALK.LIGHT_DISTANCE_PROBE_SIZE;var g=a.createRenderTarget(c,c,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,type:GLC.HALF_FLOAT_OES,stencilBuffer:!1,generateMipmaps:!1}),f=new WALK.ObjectDistanceReader(a,WALK.OBJECT_VISIBILITY_PROBE_SIZE),h=new WALK.AutoClearAlter(a),k=new WALK.ClearColorAlter(a),n=new THREE.Color(16777215);this.updateCubeMapAndFindVisibleObjects=
function(c){var l=[],q=[],r=[];e.position.copy(c);e.updateMatrixWorld();for(c=0;c<b.length;c+=1){var m=b[c];console.assert(!m.visibilityId);m.visibilityId=c;q.push(m)}h.set(!0,!0,!1);k.set(n);for(c=0;6>c;c+=1)g.activeCubeFace=c,a.renderMeshes(q,d,e.sideCameras[c],g);k.restore();h.restore();q=f.readCubeMapToBuffer(g);c=q.length;for(m=0;m<c;m+=4){var p=Math.round(65536*q[m]+256*q[m+1]+q[m+2]);16777215!==p&&(l[p]=!0)}for(var x in l)l.hasOwnProperty(x)&&r.push(b[x]);for(l=0;l<b.length;l+=1)b[l].visibilityId=
null;return r};this.objectDistanceCubeMap=function(){return g};this.dispose=function(){d.dispose();g.dispose();g=null;f.dispose()}};WALK.ObjectDistanceQuery.prototype.constructor=WALK.ObjectDistanceQuery})();(function(){WALK.LightVisibilityMaterial=function(a,b,c,d){WALK.BaseMaterial.call(this,WALK.getShader("light_visibility_vertex.glsl"),WALK.getShader("light_visibility_fragment.glsl"));this.depthWrite=this.depthTest=!1;this.uniforms={objectId:{type:"f",value:a},lightId:{type:"f",value:0},lightAttrMap:{type:"t",value:b},lightsCount:{type:"f",value:c},objectDistanceMap:{type:"t",value:d},combineWithMap:{type:"t",value:null}}};WALK.LightVisibilityMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);
WALK.LightVisibilityMaterial.prototype.constructor=WALK.LightVisibilityMaterial;Object.defineProperty(WALK.LightVisibilityMaterial.prototype,"lightId",{get:function(){return this.uniforms.lightId.value},set:function(a){this.uniforms.lightId.value=a}});Object.defineProperty(WALK.LightVisibilityMaterial.prototype,"combineWithMap",{get:function(){return this.uniforms.combineWithMap.value},set:function(a){this.uniforms.combineWithMap.value=a}})})();(function(){var a=WALK.getShader("aabb_query_vertex.glsl"),b=WALK.getShader("aabb_query_fragment.glsl");WALK.AabbQueryMaterial=function(){WALK.BaseMaterial.call(this,a,b);this.side=THREE.DoubleSide;this.uniforms={axis:{type:"i",value:0}}};WALK.AabbQueryMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.AabbQueryMaterial.prototype.constructor=WALK.AabbQueryMaterial;Object.defineProperty(WALK.AabbQueryMaterial.prototype,"axis",{get:function(){return this.uniforms.axis.value},set:function(a){console.assert(0===
a||1===a||2===a);this.uniforms.axis.value=a}})})();(function(){var a=WALK.getShader("gaze_pointer_vertex.glsl"),b=WALK.getShader("gaze_pointer_fragment.glsl");WALK.GazePointerMaterial=function(){WALK.BaseMaterial.call(this,a,b);this.blending=THREE.NormalBlending;this.transparent=!0;this.transparentRenderOrder=2;this.setUniform("circleSpan","f",0)};WALK.GazePointerMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.GazePointerMaterial.prototype.constructor=WALK.GazePointerMaterial;Object.defineProperty(WALK.GazePointerMaterial.prototype,
"circleSpan",{set:function(a){console.assert(1>=a);this.uniforms.circleSpan.value=2*Math.PI*a-Math.PI}})})();(function(){var a=WALK.getShader("editor_light_vertex.glsl"),b=WALK.getShader("editor_light_fragment.glsl");WALK.LightMaterial=function(c){WALK.BaseMaterial.call(this,a,b);this.setUniform("color","c",c.color);this.setUniform("highlight","c",WALK.EDITOR_SELECTION_COLOR);this.setUniform("highlightMix","f",0)};WALK.LightMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.LightMaterial.prototype.propertyFromUniform("highlightMix")})();(function(){WALK.MirrorMaterial=function(a,b){WALK.BaseMaterial.call(this,WALK.getShader("mirror_vertex.glsl"),WALK.getShader("mirror_fragment.glsl"));this.hideFromLightProbes=!0;this.uniforms={mirrorColor:{type:"c",value:a},mirrorSampler:{type:"t",value:null},textureMatrix:{type:"m4",value:b}}};WALK.MirrorMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.MirrorMaterial.prototype.constructor=WALK.MirrorMaterial;Object.defineProperty(WALK.MirrorMaterial.prototype,"hdrOutput",{get:function(){return this.hasDefine("HDR_OUTPUT")},
set:function(a){this.condDefine(a,"HDR_OUTPUT")}});Object.defineProperty(WALK.MirrorMaterial.prototype,"mirrorSampler",{get:function(){return this.uniforms.mirrorSampler.value},set:function(a){this.uniforms.mirrorSampler.value=a}})})();(function(){WALK.createBoundingBoxMaterial=function(){var a=new WALK.WireframeMaterial(WALK.EDITOR_SELECTION_COLOR);a.depthTest=!0;a.depthWrite=!1;a.side=THREE.DoubleSide;a.hideFromLightProbes=!0;return a}})();(function(){var a=WALK.getShader("anchor_vertex.glsl");WALK.AnchorMaterial=function(){WALK.StandardMaterial.call(this);this._vertexShaderBody=a;this._metallic=.1;this._roughness=.5;this._bumpScale=.01;this.hideFromLightProbes=!0};WALK.AnchorMaterial.prototype=Object.create(WALK.StandardMaterial.prototype);var b=WALK.getShader("anchor_sprite_vertex.glsl");WALK.AnchorSpriteMaterial=function(){WALK.StandardMaterial.call(this);this._vertexShaderBody=b;this.hideFromLightProbes=!0};WALK.AnchorSpriteMaterial.prototype=
Object.create(WALK.StandardMaterial.prototype)})();(function(){var a=WALK.getShader("rotate_gizmo_material_vertex.glsl"),b=WALK.getShader("rotate_gizmo_material_fragment.glsl");WALK.RotateGizmoMaterial=function(c,d){WALK.BaseMaterial.call(this,a,b);this.blending=THREE.NormalBlending;this.depthWrite=this.depthTest=!1;this.transparent=!0;this.transparentRenderOrder=1E3;this.hideFromLightProbes=!0;this.uniforms={opacity:{type:"f",value:1},color:{type:"c",value:c},gizmoPosition:{type:"v3",value:new THREE.Vector3(0,0,0)},sphereRadius:{type:"f",value:1}};
Object.defineProperty(this,"color",{get:function(){return this.uniforms.color.value}});Object.defineProperty(this,"opacity",{get:function(){return this.uniforms.opacity.value},set:function(a){this.uniforms.opacity.value=a}});Object.defineProperty(this,"gizmoPosition",{get:function(){return this.uniforms.gizmoPosition.value}});Object.defineProperty(this,"sphereRadius",{get:function(){return this.uniforms.sphereRadius.value},set:function(a){this.uniforms.sphereRadius.value=a}});this.opacity=d;this.setUniforms=
function(){}};WALK.RotateGizmoMaterial.prototype=Object.create(WALK.BaseMaterial.prototype);WALK.RotateGizmoMaterial.prototype.constructor=WALK.RotatoGizmoMaterial})();(function(){function a(a){a instanceof THREE.Mesh&&(a.frustumCulled=!1)}function b(a){a instanceof THREE.Mesh&&(a.frustumCulled=!0)}function c(a){for(var b=0,c=0;c<a.length;c+=1)b+=a[c].instances.length;return b+1}function d(a,b,c){var d=[],e=new THREE.Vector2,f=new Uint8Array(4),g;this.findFreeChannel=function(b){g.material.uniforms.threshold.value=1024;for(var c=0;c<d.length;c+=1){var k=d[c];e.set(1/b.width,1/b.height);g.material.uniforms.sizeInv.value=e;g.render(a,k,b);b=k;g.material.uniforms.threshold.value=
1}b=a.context;b.readPixels(0,0,1,1,b.RGBA,b.UNSIGNED_BYTE,f);for(b=0;4>b;b+=1)if(0===f[b])return b;return null};this.dispose=function(){for(var a=0;a<d.length;a+=1)d[a].dispose(),d[a]=null;g.material.dispose()};(function(){for(var e={format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,generateMipmaps:!1},f=b,k=c;1!==f&&1!==k;){f=Math.max(f/2,1);k=Math.max(k/2,1);var h=a.createRenderTarget(f,k,e);d.push(h)}e={uniforms:{lightVisibilityMap:{type:"t",value:null},threshold:{type:"f",
value:null},sizeInv:{type:"v2",value:null}},vertexShader:THREE.CopyShader.vertexShader,fragmentShader:WALK.getShader("light_visibility_free_channel_fragment.glsl")};g=new THREE.ShaderPass(e,"lightVisibilityMap")})()}function e(a){var b=[],c={};this.lightMap=function(a){return b[a]};this.lightMapId=function(a){return c[a.name]};this.lightMapsCount=function(){return b.length};this.findObjectsWithLightMap=function(a,b){for(var d=[],e=0;e<a.length;e+=1){var f=a[e];c[f.userData.origMaterial.lightMap.name]===
b&&d.push(f)}return d};(function(){for(var d=0;d<a.length;d+=1){var e=a[d].lightMap;e&&void 0===c[e.name]&&(c[e.name]=b.length,b.push(e))}})()}function g(a){for(var b=c(a),d=new Float32Array(16*b),e=0;16>e;e+=1)d[e]=0;WALK.Light.iterateLightInstances(a,function(a,b,c){c*=16;d[c]=b.position.x;d[c+1]=b.position.y;d[c+2]=b.position.z;d[c+3]=a.size;d[c+4]=a.color.r;d[c+5]=a.color.g;d[c+6]=a.color.b;d[c+7]=a.strength;"spot"===a.type?(WALK.log("have spot light"),d[c+8]=1,b=b.directionW(),d[c+9]=b.x,d[c+
10]=b.y,d[c+11]=b.z,d[c+12]=THREE.Math.degToRad(a.angle/2)):(WALK.log("have point light"),d[c+8]=0)});a=new WALK.DataTexture(d,16*b/4,1,GLC.RGBA,GLC.FLOAT,GLC.CLAMP_TO_EDGE,GLC.CLAMP_TO_EDGE,GLC.NEAREST,GLC.NEAREST);a.needsUpdate=!0;return a}WALK.LightAssigner=function(f,h,k,n,p){var l,q,r,m,u,x,t,v,w;this.assignLightLookupMaps=function(){for(var a=0;a<n.length;a+=1){var b=n[a],d=b.lightMap;d&&(d=l.lightMapId(d),b.lightVisibilityMap=w[d],b.lightAttrMap=v,b.lightsCount=c(k),b.setUniforms())}};this.dispose=
function(){q.dispose();r.dispose();x.material.dispose();for(var a=0;a<l.lightMapsCount();a+=1)u[a].dispose()};(function(){var a=0,b=0;l=new e(n);m=[];u=[];w=[];for(var c=0;c<l.lightMapsCount();c+=1){var E=l.lightMap(c);console.assert(E.width&&E.height);var I=E.width/WALK.LIGHT_VISIBILITY_MAP_DOWNSAMPLE;E=E.height/WALK.LIGHT_VISIBILITY_MAP_DOWNSAMPLE;a=Math.max(a,I);b=Math.max(b,E);m[c]=f.createRenderTarget(I,E,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,type:GLC.HALF_FLOAT_OES,stencilBuffer:!0,
generateMipmaps:!1});u[c]=f.createRenderTarget(I,E,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,type:GLC.HALF_FLOAT_OES,stencilBuffer:!0,generateMipmaps:!1,shareDepthFrom:m[c]});w[c]=m[c]}q=new WALK.ObjectDistanceQuery(f,p,h);r=new d(f,a,b);v=g(k);x=new THREE.ShaderPass(THREE.CopyShader);t=new WALK.AutoClearAlter(f)})();(function(){for(var a=c(k),b=q.objectDistanceCubeMap(),d=0;d<p.length;d+=1)p[d].userData.origMaterial=p[d].material,p[d].material=new WALK.LightVisibilityMaterial(d+
1,v,a,b)})(p);WALK.Light.iterateLightInstances(k,function(c,d,e){var g=[];if(0===c.strength)WALK.log("skipping light instance with strength 0");else{c=f.context;d=q.updateCubeMapAndFindVisibleObjects(d.position);WALK.log("Objects visible from light"+e+" "+d.length);c.enable(c.STENCIL_TEST);for(var k=!0,h=0;h<l.lightMapsCount();h+=1){for(var n=l.findObjectsWithLightMap(d,h),v=new THREE.Scene,w=0;w<n.length;w+=1)v.add(new THREE.Mesh(n[w].geometry,n[w].material));n=v;n.traverse(a);v=e;w=u[h];for(var A=
0;A<p.length;A+=1){var C=p[A].material;console.assert(C instanceof WALK.LightVisibilityMaterial);C.lightId=v;C.combineWithMap=w}t.set(!0,!0,!0);c.stencilOp(c.REPLACE,c.REPLACE,c.REPLACE);c.stencilFunc(c.ALWAYS,1,4294967295);f.render(n,x.camera,m[h]);t.restore();n.traverse(b);t.set(!1,!1,!1);n=r.findFreeChannel(m[h]);t.restore();if(null===n){k=!1;break}g[h]=n}if(k){t.set(!1,!1,!1);c.stencilFunc(c.EQUAL,1,4294967295);c.stencilOp(c.KEEP,c.KEEP,c.KEEP);for(e=0;e<l.lightMapsCount();e+=1){switch(g[e]){case 0:c.colorMask(!0,
!1,!1,!1);break;case 1:c.colorMask(!1,!0,!1,!1);break;case 2:c.colorMask(!1,!1,!0,!1);break;case 3:c.colorMask(!1,!1,!1,!0);break;default:console.assert(!1)}x.render(f,u[e],m[e]);c.colorMask(!0,!0,!0,!0)}t.restore()}else WALK.log("Available channel not found, skipping light");c.disable(c.STENCIL_TEST)}});(function(){for(var a=0;a<p.length;a+=1)p[a].material.dispose(),p[a].material=p[a].userData.origMaterial,delete p[a].userData.origMaterial})(p);(function(){var a=new THREE.Vector2,b={uniforms:{lightVisibilityMap:{type:"t",
value:null},sizeInv:{type:"v2",value:null}},vertexShader:THREE.CopyShader.vertexShader,fragmentShader:WALK.getShader("light_visibility_dilate_fragment.glsl")};b=new THREE.ShaderPass(b,"lightVisibilityMap");t.set(!1,!1,!1);for(var c=0;c<l.lightMapsCount();c+=1){var d=w[c];a.set(1/d.width,1/d.height);b.material.uniforms.sizeInv.value=a;b.material.programNeedsUpdate=!0;b.render(f,d,u[c])}t.restore();b.material.dispose()})()}})();(function(){WALK.Camera=function(){var a=this;THREE.PerspectiveCamera.call(this,WALK.CAMERA_DEFAULT_FOV,1,WALK.CAMERA_WALK_NEAR,WALK.CAMERA_MIN_FAR);this._defaultFov=this.fov;this._exposure=this._defaultExposure=0;this._gamma=this._defaultGamma=1;this._autoExposure=!1;this._autoExposureDarkness=.3;this._moveMaxSpeed=WALK.CAMERA_DEFAULT_MOVE_MAX_SPEED;this._autoClimb=!1;this._colorMap=null;this._exposureUpdatedEvent={type:"exposureUpdated",target:null};this._gammaUpdatedEvent={type:"gammaUpdated",
target:null};this._colorMapUpdated={type:"colorMapUpdated",target:null};var b={type:"cameraUpdated",target:null};this._updated=function(){return a.dispatchEvent(b)}};WALK.Camera.prototype=Object.create(THREE.PerspectiveCamera.prototype);WALK.Camera.prototype.constructor=WALK.Camera;Object.defineProperty(WALK.Camera.prototype,"defaultFov",{get:function(){return this._defaultFov},set:function(a){this.fov=this._defaultFov=a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,"colorMap",{get:function(){return this._colorMap},
set:function(a){var b=this;this._colorMap&&this._colorMap.dispose();(this._colorMap=a)?a.addLoadedListener(function(){return b.dispatchEvent(b._colorMapUpdated)}):this.dispatchEvent(this._colorMapUpdated)}});WALK.Camera.prototype.colorMapReady=function(){return this._colorMap&&this._colorMap.loaded};Object.defineProperty(WALK.Camera.prototype,"defaultExposure",{get:function(){return this._defaultExposure},set:function(a){this._defaultExposure=a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,
"exposure",{get:function(){return this._exposure},set:function(a){a!==this._exposure&&(this._exposure=a,this.dispatchEvent(this._exposureUpdatedEvent))}});WALK.Camera.prototype.setExposureController=function(a){this.exposureController=a};WALK.Camera.prototype.setExposure=function(a){this.exposureController?this.exposureController.setTargetExposure(a):this.exposure=a};Object.defineProperty(WALK.Camera.prototype,"defaultGamma",{get:function(){return this._defaultGamma},set:function(a){this._defaultGamma=
a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,"gamma",{get:function(){return this._gamma},set:function(a){a!==this._gamma&&(this._gamma=a,this.dispatchEvent(this._gammaUpdatedEvent))}});WALK.Camera.prototype.setGamma=function(a){this.gamma=a};Object.defineProperty(WALK.Camera.prototype,"autoExposure",{get:function(){return this._autoExposure},set:function(a){a!==this._autoExposure&&(this._autoExposure=a,this._exposure=this._defaultExposure,this._updated())}});WALK.Camera.prototype.setFar=
function(a){this.far=a;this.updateProjectionMatrix();this._updated()};Object.defineProperty(WALK.Camera.prototype,"moveMaxSpeed",{get:function(){return this._moveMaxSpeed},set:function(a){this._moveMaxSpeed=a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,"autoClimb",{get:function(){return this._autoClimb},set:function(a){this._autoClimb=a;this._updated()}});Object.defineProperty(WALK.Camera.prototype,"autoExposureDarkness",{get:function(){return this._autoExposureDarkness},set:function(a){this._autoExposureDarkness=
a;this._updated()}});WALK.Camera.prototype.serialize=function(){return{fov:this.defaultFov,exposure:this.defaultExposure,gamma:this.defaultGamma,lutTexture:this.colorMap?this.colorMap.serialize():null,autoClimb:this.autoClimb,moveMaxSpeed:this.moveMaxSpeed}};THREE.EventDispatcher.prototype.apply(WALK.Camera.prototype)})();(function(){WALK.LightInstance=function(a,c,d){this.light=a;this.position=c;this.rotation=d;this._directionW=new THREE.Vector3};WALK.LightInstance.prototype={constructor:WALK.LightInstance,directionW:function(){this._directionW.set(0,1,0);this._directionW.applyEuler(this.rotation);return this._directionW},get index(){var a=this.light.instances.indexOf(this);console.assert(-1!==a,"Light instance not found");return a},setPosition:function(a,c,d){this.position.set(a,c,d);this.light._updated()},setRotation:function(a,
c,d){this.rotation.yaw=WALK.normalizeRotation(a);this.rotation.pitch=WALK.normalizeRotation(c);this.rotation.roll=WALK.normalizeRotation(d);this.light._updated()},setRotationDeg:function(a,c,d){a=THREE.Math.degToRad(a);c=THREE.Math.degToRad(c);d=void 0===d?this.rotation.roll:THREE.Math.degToRad(d);this.setRotation(a,c,d)},serialize:function(){return{position:this.position.toArray(),rotation:this.rotation.toDegTriple()}}};var a="angle color height photometricProfile strength size type width".split(" ");
WALK.Light=function(b){this.name=b.name;this._type=b.type||"spot";if(void 0!==b.strength)var c=b.strength;else a:{switch(this._type){case "point":case "spot":case "area":c=25;break a;case "sun":c=8;break a;default:console.assert(!1)}c=void 0}this._strength=c;if(void 0!==b.color)c=(new THREE.Color).fromArray(b.color);else a:{switch(this._type){case "point":case "spot":case "area":c=new THREE.Color(1,.88,.799);break a;case "sun":c=new THREE.Color(1,.8,.638);break a;default:console.assert(!1)}c=void 0}this._color=
c;if(void 0!==b.size)c=b.size;else a:{switch(this._type){case "point":case "spot":case "area":c=.1;break a;case "sun":c=.02;break a;default:console.assert(!1)}c=void 0}this._size=c;this._width=void 0!==b.width?b.width:.2;this._height=void 0!==b.height?b.height:.2;this._angle=void 0!==b.angle?b.angle:140;this._photometricProfile=void 0!==b.photometricProfile?b.photometricProfile:null;!0===b.doNotImport?this.doNotImport=!0:(this.doNotImport={},b.doNotImport&&WALK.copyProperties(b.doNotImport,a,this.doNotImport));
this.instances=[]};WALK.Light.prototype={constructor:WALK.Light,forEachLightInstance:function(a){for(var b=0;b<this.instances.length;b+=1)a(this.instances[b])},get type(){return this._type},set type(a){this._type=a;this._updated()},get size(){return this._size},set size(a){this._size=a;this._updated()},get width(){return this._width},set width(a){this._width=a;this._updated()},get height(){return this._height},set height(a){this._height=a;this._updated()},get angle(){return this._angle},set angle(a){this._angle=
a;this._updated()},get color(){return this._color},setColorRGB:function(a,c,d){this._color.setRGB(a,c,d);this._updated()},get strength(){return this._strength},set strength(a){this._strength=a;this._updated()},get photometricProfile(){return this._photometricProfile},set photometricProfile(a){this._photometricProfile=a;this._updated()},setDoNotImport:function(a,c){this.doNotImport[a]=c;this._updated()},addInstance:function(a,c){c=void 0===c?[0,-90,0]:c;a=(new THREE.Vector3).fromArray(a);c=(new WALK.Euler).setFromDegTriple(c);
c=new WALK.LightInstance(this,a,c);this.instances.push(c);this.dispatchEvent({type:"lightInstanceAdded",instance:c})},removeInstance:function(a){WALK.removeFromArray(a,this.instances);this.dispatchEvent({type:"lightInstanceRemoved",instance:a})},serialize:function(){return{name:this.name,type:this.type,angle:this.angle,strength:this.strength,photometricProfile:this.photometricProfile,size:this.size,width:this.width,height:this.height,color:this.color.roundChannels().toArray(),doNotImport:this.doNotImport,
instances:this.instances.map(function(a){return a.serialize()})}},_updated:function(){this.dispatchEvent({type:"lightUpdated",light:this})}};THREE.EventDispatcher.prototype.apply(WALK.Light.prototype);WALK.Light.iterateLightInstances=function(a,c){for(var b=1,e=0;e<a.length;e+=1)for(var g=a[e],f=0;f<g.instances.length;f+=1,b+=1)c(g,g.instances[f],b)}})();(function(){WALK.LightProbe=function(a){this.id=a.id;this.position=new THREE.Vector3;a.position&&this.position.fromArray(a.position);this._filteredCubeTexture=null;this._filteredCubeTextureNoLod={};this._mirrorCubeTexture=null;this._boxEnabled=a.box?!("enabled"in a.box)||a.box.enabled:!1;this.boxMin=new THREE.Vector3;this.boxMax=new THREE.Vector3;a.box&&(this.boxMin.fromArray(a.box.min),this._setClampedBoxMax(a.box.max[0],a.box.max[1],a.box.max[2]))};WALK.LightProbe.prototype={constructor:WALK.LightProbe,
setFilteredTexture:function(a){this._filteredCubeTexture&&this._filteredCubeTexture.dispose();this._filteredCubeTexture=a},setFilteredTextureNoLod:function(a,b){this._filteredCubeTextureNoLod[b]&&this._filteredCubeTextureNoLod[b].dispose();this._filteredCubeTextureNoLod[b]=a},isBoundingBoxInitialized:function(){return!this.boxMin.equals(this.boxMax)},resetBoundingBox:function(){this.boxMin.set(0,0,0);this.boxMax.set(0,0,0)},isBoundingBoxEnabled:function(){return this._boxEnabled},disableBoundingBox:function(){this._boxEnabled=
!1;this.dispatchEvent({type:"lightProbeBoundsUpdated",lightProbe:this})},enableBoundingBox:function(){this._boxEnabled=!0;this.isBoundingBoxInitialized()||this.dispatchEvent({type:"lightProbeBoundsInit",lightProbe:this});this.dispatchEvent({type:"lightProbeBoundsUpdated",lightProbe:this})},getFilteredTexture:function(){return this._filteredCubeTexture},getFilteredTextureNoLod:function(a){return this._filteredCubeTextureNoLod[a]},setMirrorTexture:function(a){this._mirrorCubeTexture&&this._mirrorCubeTexture.dispose();
this._mirrorCubeTexture=a},setPosition:function(a,b,c){this.position.set(a,b,c);this.dispatchEvent({type:"lightProbePositionUpdated",lightProbe:this})},texturesReady:function(){return this._mirrorCubeTexture||this._filteredCubeTexture||this._filteredCubeTextureNoLod[0]},getMirrorTexture:function(){return this._mirrorCubeTexture||this._filteredCubeTexture||this._filteredCubeTextureNoLod[0]},_setClampedBoxMin:function(a,b,c){a>this.boxMax.x-.1&&(a=this.boxMax.x-.1);b>this.boxMax.y-.1&&(b=this.boxMax.y-
.1);c>this.boxMax.z-.1&&(c=this.boxMax.z-.1);this.boxMin.set(a,b,c)},isBoxMinValid:function(a,b,c){return a>this.boxMax.x-.1||b>this.boxMax.y-.1||c>this.boxMax.z-.1?!1:!0},isBoxMaxValid:function(a,b,c){return a<this.boxMin.x+.1||b<this.boxMin.y+.1||c<this.boxMin.z+.1?!1:!0},setBoxMin:function(a,b,c){this._setClampedBoxMin(a,b,c);this.dispatchEvent({type:"lightProbeBoundsUpdated",lightProbe:this})},_setClampedBoxMax:function(a,b,c){a<this.boxMin.x+.1&&(a=this.boxMin.x+.1);b<this.boxMin.y+.1&&(b=this.boxMin.y+
.1);c<this.boxMin.z+.1&&(c=this.boxMin.z+.1);this.boxMax.set(a,b,c)},setBoxMax:function(a,b,c){this._setClampedBoxMax(a,b,c);this.dispatchEvent({type:"lightProbeBoundsUpdated",lightProbe:this})},serialize:function(){var a={id:this.id,position:this.position.toArray()};this.isBoundingBoxInitialized()&&(a.box={enabled:this._boxEnabled,min:this.boxMin.toArray(),max:this.boxMax.toArray()});return a},dispose:function(){this._filteredCubeTexture&&(this._filteredCubeTexture.dispose(),this._filteredCubeTexture=
null);for(var a in this._filteredCubeTextureNoLod)this._filteredCubeTextureNoLod.hasOwnProperty(a)&&this._filteredCubeTextureNoLod[a].dispose();this._filteredCubeTextureNoLod={};this._mirrorCubeTexture&&(this._mirrorCubeTexture.dispose(),this._mirrorCubeTexture=null)}};THREE.EventDispatcher.prototype.apply(WALK.LightProbe.prototype)})();(function(){function a(a){return null!==a&&void 0!==a}function b(a){a.configure()}function c(a){a.visitSubtree(b)}function d(a){var b=new THREE.Vector3(Infinity,Infinity,Infinity),c=new THREE.Matrix4,d=new THREE.Matrix4,e=new THREE.Matrix4,n,p=new THREE.Vector3,l=new WALK.Euler;return function(f){if(b.equals(f))return c;b.copy(f);if(!n){n=new THREE.Vector3;var g=new THREE.Box3;a.visitSubtree(function(a){(a=a.mesh)&&g.union(a.geometry.boundingBox)});g.center(n);e.elements[12]=-n.x;e.elements[13]=-n.y;
e.elements[14]=-n.z}p.copy(f).sub(n).normalize();l.setFromDirection(p);"yaw"===a.faceCamera&&(l.pitch=0);d.makeRotationFromEuler(l);c.identity().setPosition(n).multiply(d).multiply(e);return c}}WALK.NodeConfig=function(b){var c=this;this.name=b.name;this._editable=b.editable||!1;this._setsDisableCollisions=a(b.disableCollisions);this._disableCollisions=b.disableCollisions||!1;this._setsHideInViews=a(b.hideInViews);this.hideInViews=null;b.hideInViews&&(this.hideInViews=b.hideInViews,this.hideInViews.sort());
this._lightmapResolution=(this._setsLightmapResolution=a(b.lightmapResolution))?b.lightmapResolution:null;this._ground=a(b.ground)?b.ground:!1;this._faceCamera=b.faceCamera||null;this._isolateShadows=a(b.isolateShadows)?b.isolateShadows:!1;this.nodes=[];var d={type:"configUpdated",target:this};this._updated=function(){return c.dispatchEvent(d)}};WALK.NodeConfig.prototype.constructor=WALK.NodeConfig;THREE.EventDispatcher.prototype.apply(WALK.NodeConfig.prototype);WALK.NodeConfig.prototype._configUpdated=
function(){this.nodes.forEach(c);this._updated()};WALK.NodeConfig.prototype.addNode=function(a){this.nodes.push(a)};WALK.NodeConfig.prototype.isOnHideInViews=function(a){return-1!==this.hideInViews.indexOf(a)};WALK.NodeConfig.prototype.addToHideInViews=function(a){console.assert(this.setsHideInViews);console.assert(!this.isOnHideInViews(a));this.hideInViews.push(a);this._updated()};WALK.NodeConfig.prototype.removeFromHideInViews=function(a){if(this.hideInViews)for(var b=0;b<this.hideInViews.length;)this.hideInViews[b]===
a?this.hideInViews.splice(b,1):b+=1;this._updated()};WALK.NodeConfig.prototype.serialize=function(){return{name:this.name,disableCollisions:this.setsDisableCollisions?this.disableCollisions:null,hideInViews:this.setsHideInViews?this.hideInViews:null,lightmapResolution:this.setsLightmapResolution?this.lightmapResolution:null,ground:this.ground?!0:null,faceCamera:this.faceCamera,isolateShadows:this.isolateShadows?!0:null}};Object.defineProperty(WALK.NodeConfig.prototype,"setsDisableCollisions",{get:function(){return this._setsDisableCollisions},
set:function(a){this._setsDisableCollisions=a;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"disableCollisions",{get:function(){return this._disableCollisions},set:function(a){console.assert(this._setsDisableCollisions);this._disableCollisions=a;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"editable",{get:function(){return this._editable||null!==this.faceCamera},set:function(a){this._editable=a;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,
"ground",{get:function(){return this._ground},set:function(a){this._ground=a;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"faceCamera",{get:function(){return this._faceCamera},set:function(a){this._faceCamera=a;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"setsLightmapResolution",{get:function(){return this._setsLightmapResolution},set:function(a){this._setsLightmapResolution=a;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,
"lightmapResolution",{get:function(){return this._lightmapResolution},set:function(a){console.assert(this._setsLightmapResolution);this._lightmapResolution=a;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"isolateShadows",{get:function(){return this._isolateShadows},set:function(a){this._isolateShadows=a;this._configUpdated()}});Object.defineProperty(WALK.NodeConfig.prototype,"setsHideInViews",{get:function(){return this._setsHideInViews},set:function(a){this._setsHideInViews=
a;null===this.hideInViews&&(this.hideInViews=[]);this._configUpdated()}});WALK.Node=function(a,b,c){this.id=c.id;this.initialLightProbeId=void 0===c.lightProbeId?null:c.lightProbeId;this.parent=a;this.config=b;this.children=[];this.shadowsIsolatedWithin=this.lightmapResolution=this.hideInViews=this.getFaceCameraMatrix=this.faceCamera=this.ground=this.disableCollisions=this._facesCnt=this.mesh=null;this.editable=!1;b.addNode(this);this.configure()};WALK.Node.prototype.constructor=WALK.Node;WALK.Node.prototype.configure=
function(){this.ground=(this.disableCollisions=this.config.setsDisableCollisions?this.config.disableCollisions:this.parent?this.parent.disableCollisions:!1)?!1:this.config.ground;this.config.faceCamera?(this.faceCamera=this.config.faceCamera,this.getFaceCameraMatrix=d(this)):(this.parent?(this.faceCamera=this.parent.faceCamera,this.getFaceCameraMatrix=this.parent.getFaceCameraMatrix):this.getFaceCameraMatrix=this.faceCamera=null,this.mesh&&(this.mesh.matrixWorld=null));this.hideInViews=this.config.setsHideInViews?
this.config.hideInViews:this.parent?this.parent.hideInViews:null;this.lightmapResolution=this.config.setsLightmapResolution?this.config.lightmapResolution:this.parent?this.parent.lightmapResolution:null;this.shadowsIsolatedWithin=this.config.isolateShadows?this.config.name:this.parent&&this.parent.shadowsIsolatedWithin?this.parent.shadowsIsolatedWithin:null;this.editable=this.config.editable;this.parent&&(this.editable=this.editable||this.parent.editable)};WALK.Node.prototype.visitSubtree=function(a){a(this);
var b=this.children;if(b)for(var c=0;c<b.length;c+=1)b[c].visitSubtree(a)};WALK.Node.prototype.facesInSubtree=function(){var a=this;null===a._facesCnt&&(a._facesCnt=0,a.visitSubtree(function(b){b.mesh&&(a._facesCnt+=b.mesh.geometry.vertexCnt/3)}));return a._facesCnt};WALK.Node.prototype.hide=function(){this.visitSubtree(function(a){a.mesh&&(a.mesh.visible=!1)})};WALK.Node.prototype.show=function(){this.visitSubtree(function(a){a.mesh&&(a.mesh.visible=!0)})};WALK.Node.prototype.serialize=function(){var a=
{id:this.id,children:this.children.map(function(a){return a.serialize()})},b=this.mesh;b&&(a.lightProbeId=b.lightProbe?b.lightProbe.id:null,a.mesh=!0);return a};Object.defineProperty(WALK.Node.prototype,"type",{get:function(){return this.config.name}});Object.defineProperty(WALK.Node.prototype,"highlightMix",{set:function(a){this.visitSubtree(function(b){b.mesh&&(b.mesh.highlightMix=a)})}});Object.defineProperty(WALK.Node.prototype,"selected",{set:function(a){this.visitSubtree(function(b){b.mesh&&
(b.mesh.selected=a)})}});Object.defineProperty(WALK.Node.prototype,"selectedSecondary",{set:function(a){this.visitSubtree(function(b){b.mesh&&(b.mesh.selectedSecondary=a)})}})})();(function(){WALK.Mesh=function(a,b,c){this._visible=!0;THREE.Mesh.call(this,b,c);this.node=a;this.useFaces16=!1;this.quantUv0Max=this.quantUv0Range=this.quantVertexMax=this.quantVertexRange=this.transformByteOffset=this.uv1CoordVOffset=this.uv1CoordUOffset=this.uv1CoordVScale=this.uv1CoordUScale=this.lightMapIdx=this.uv1ByteOffset=this.uv0ByteOffset=this.normalByteOffset=this.vertexCnt=this.vertexByteOffset=this.faceCnt=this.faceByteOffset=0;this.lightMap=null;this.autoLightmapResolution=-1;this.lightProbe=
null;this.matrixAutoUpdate=this.rotationAutoUpdate=!1;this.selected=this.highlightMix=null;this.selectedSecondary=!1;this.visibilityId=null;this.cameraDistance=0;this.matrix=this.matrixWorld=null;this.sharedBuffersDebug=0;this._mergedMesh=null};WALK.Mesh.prototype=Object.create(THREE.Mesh.prototype);WALK.Mesh.prototype.constructor=WALK.Mesh;WALK.Mesh.prototype.clone=void 0;WALK.Mesh.prototype.updateMatrixWorld=function(){};WALK.Mesh.prototype.uv0InBuffers=function(){return-1!==this.uv0ByteOffset};
WALK.Mesh.prototype.uv1InBuffers=function(){return-1!==this.uv1ByteOffset};WALK.Mesh.prototype.quantVertexFactor=function(){return this.quantVertexRange/this.quantVertexMax};WALK.Mesh.prototype.quantUv0Disabled=function(){return 0===this.quantUv0Max};WALK.Mesh.prototype.quantUv0Factor=function(){return this.quantUv0Range/this.quantUv0Max};WALK.Mesh.prototype.update=function(a,b){this.node.faceCamera&&(this.matrixWorld=this.node.getFaceCameraMatrix(b))};Object.defineProperty(WALK.Mesh.prototype,"hideInViews",
{get:function(){return this.node.hideInViews},set:function(a){console.assert(!1)}});Object.defineProperty(WALK.Mesh.prototype,"visible",{get:function(){return this._visible},set:function(a){a!==this._visible&&(this._visible=a,this._mergedMesh&&!WALK.EDIT_MODE&&(this._mergedMesh.visible=a))}});Object.defineProperty(WALK.Mesh.prototype,"isAnimated",{get:function(){return null!==this.node.faceCamera}});WALK.MergedMesh=function(a,b){this._visible=!0;THREE.Mesh.call(this,a,b);this.anyLogicalMeshHasUvs=
!1;this.lightProbe=this.lightMap=null;this.matrixAutoUpdate=this.rotationAutoUpdate=!1;this.hideInViews=null;this.matrixAutoUpdate=this.rotationAutoUpdate=!1;this.center=null;this.cameraDistance=0;this.matrix=this.matrixWorld=null;this.logicalMeshes=[]};WALK.MergedMesh.prototype=Object.create(THREE.Mesh.prototype);WALK.MergedMesh.prototype.constructor=WALK.MergedMesh;WALK.MergedMesh.prototype.clone=void 0;WALK.MergedMesh.prototype.updateMatrixWorld=function(){};WALK.MergedMesh.prototype.addLogicalMesh=
function(a){this.logicalMeshes.push(a);a._mergedMesh=this};Object.defineProperty(WALK.MergedMesh.prototype,"visible",{get:function(){return this._visible},set:function(a){if(a!==this._visible){this._visible=a;for(var b=0;b<this.logicalMeshes.length;b+=1)this.logicalMeshes[b]._visible=a}}});Object.defineProperty(WALK.MergedMesh.prototype,"isAnimated",{get:function(){return!1}})})();(function(){WALK.SkyMesh=function(a,b,c,d){var e=this;THREE.Mesh.call(this,b,c);d&&this.position.fromArray(d);this.autoPosition=!d;this.name=a;var g={type:"skyMeshUpdated",target:this};this._updated=function(){return e.dispatchEvent(g)}};WALK.SkyMesh.prototype=Object.create(THREE.Mesh.prototype);WALK.SkyMesh.prototype.constructor=WALK.SkyMesh;WALK.SkyMesh.prototype.clone=void 0;WALK.SkyMesh.prototype.serialize=function(){var a={name:this.name};this.autoPosition||(a.center=this.position.toArray());
this.isEquirect?(a.type="equirect",a.yawRotation=this.yawRotationDeg,a.texture=this.material.map?this.material.map.serialize():null):a.type="procedural";return a};Object.defineProperty(WALK.SkyMesh.prototype,"yawRotationDeg",{get:function(){return THREE.Math.radToDeg(this.rotation.y)},set:function(a){a=THREE.Math.degToRad(a);this.rotation.y=a;this.updateMatrixWorld();this._updated()}});Object.defineProperty(WALK.SkyMesh.prototype,"isEquirect",{get:function(){return this.material instanceof WALK.EquirectSkyMaterial}});
Object.defineProperty(WALK.SkyMesh.prototype,"radius",{get:function(){return this.scale.x},set:function(a){this.scale.set(a,a,a);this.updateMatrixWorld(!0);this._updated()}})})();(function(){var a=1E3,b={internal:!1,position:[0,0,0],rotation:[0,0],hideFromMenu:!0,sky:WALK.EDITOR_CONTROLLED_SKY_NAME};WALK.View=function(c){var d=this;void 0===c&&(c=b);this.id=void 0!==c.id?c.id:a++;this.name=c.name||"view"+this.id;this.internal=c.internal||!1;c.position&&(this.position=new THREE.Vector3(c.position[0],c.position[1],c.position[2]));this.rotation=new WALK.Euler(WALK.normalizeRotation(THREE.Math.degToRad(c.rotation[0])),WALK.normalizeRotation(THREE.Math.degToRad(c.rotation[1])),
0);this.hideFromMenu=c.hideFromMenu||!1;this.sky=c.sky||WALK.EDITOR_CONTROLLED_SKY_NAME;this.mode=c.mode||"fps";this.distance=c.distance;this.minDistance=c.minDistance;this.maxDistance=c.maxDistance;this.panPrimary=c.panPrimary;this.noPan=c.noPan;this.noRotate=c.noRotate;this.noPitchRotate=c.noPitchRotate;this.minUpAngle=void 0===c.minUpAngle?-Math.PI/2:c.minUpAngle;this.maxUpAngle=void 0===c.maxUpAngle?Math.PI/2:c.maxUpAngle;this.minSideAngle=void 0===c.minSideAngle?-Infinity:c.minSideAngle;this.maxSideAngle=
void 0===c.maxSideAngle?Infinity:c.maxSideAngle;c.target&&(this.target=new THREE.Vector3(c.target[0],c.target[1],c.target[2]));this.fov=c.fov;var e={type:"viewUpdated",target:this};this._updated=function(){return d.dispatchEvent(e)}};WALK.View.prototype={constructor:WALK.View,isTop:function(){return"orbit"===this.mode&&this.panPrimary&&this.noPitchRotate},isOrbit:function(){return"orbit"===this.mode&&!this.isTop()},usesDefaultSky:function(){return this.sky===WALK.DEFAULT_SKY_NAME},switchSky:function(){this.usesDefaultSky()?
this.sky=WALK.EDITOR_CONTROLLED_SKY_NAME:this.sky=WALK.DEFAULT_SKY_NAME;this._updated()},setName:function(a){this.name=a;this._updated()},setYaw:function(a){this.rotation.yaw=a;this._updated()},setMinUpAngle:function(a){a!==this.minUpAngle&&(this.minUpAngle=a,this._updated())},setMaxUpAngle:function(a){a!==this.maxUpAngle&&(this.maxUpAngle=a,this._updated())},setHideFromMenu:function(a){a!==this.hideFromMenu&&(this.hideFromMenu=a,this._updated())},serialize:function(){var a=this,b={id:this.id,name:this.name,
mode:this.mode,rotation:this.rotation.toDegTriple().slice(0,2),hideFromMenu:this.hideFromMenu||!1,sky:this.sky};this.position&&(b.position=this.position.toArray());this.target&&(b.target=this.target.toArray());-Infinity!==this.minSideAngle&&(b.minSideAngle=this.minSideAngle);Infinity!==this.maxSideAngle&&(b.maxSideAngle=this.maxSideAngle);"distance minDistance maxDistance panPrimary noPan noRotate noPitchRotate minUpAngle maxUpAngle fov".split(" ").forEach(function(c){void 0!==a[c]&&(b[c]=a[c])});
return b}};THREE.EventDispatcher.prototype.apply(WALK.View.prototype)})();(function(){WALK.Mirror=function(a,b,c){THREE.Object3D.call(this);this.name="mirror_"+this.id;this.scene=a;this.mirrorCamera=b.clone();this.renderTargetParams={minFilter:GLC.LINEAR,magFilter:GLC.LINEAR,format:GLC.RGBA,stencilBuffer:!1,generateMipmaps:!0};this.texture=null;c=c||{};this.matrixNeedsUpdate=!0;this.clipBias=void 0!==c.clipBias?c.clipBias:0;a=void 0!==c.color?new THREE.Color(c.color):new THREE.Color(8355711);this.textureMatrix=new THREE.Matrix4;this.mirrorWorldPosition=new THREE.Vector3;
this.mirrorRotationMatrix=new THREE.Matrix4;this.mirrorNormal=new THREE.Vector3;this.cameraWorldPosition=new THREE.Vector3;this.cameraRotationMatrix=new THREE.Matrix4;this.mirrorToCamera=new THREE.Vector3;this.cameraFrustum=null;this.material=new WALK.MirrorMaterial(a,this.textureMatrix)};WALK.Mirror.prototype=Object.create(THREE.Object3D.prototype);WALK.Mirror.prototype.renderWithMirror=function(a){this.updateTextureMatrix();this.matrixNeedsUpdate=!1;var b=a.camera;a.camera=this.mirrorCamera;a.renderTemp();
a.material.uniforms.mirrorSampler.value=a.tempTexture;this.render();this.matrixNeedsUpdate=!0;a.material.uniforms.mirrorSampler.value=a.texture;a.camera=b;a.updateTextureMatrix()};WALK.Mirror.prototype.updateMatrixWorld=function(a){THREE.Object3D.prototype.updateMatrixWorld.call(this,a);this.mirrorWorldPosition.setFromMatrixPosition(this.matrixWorld);this.mirrorRotationMatrix.extractRotation(this.matrixWorld);this.mirrorNormal.set(0,0,1);this.mirrorNormal.applyMatrix4(this.mirrorRotationMatrix)};
WALK.Mirror.prototype.updateCameraPosition=function(a,b){this.cameraWorldPosition.setFromMatrixPosition(a.matrixWorld);this.cameraRotationMatrix.extractRotation(a.matrixWorld);this.matrixNeedsUpdate=!0;this.cameraFrustum=b};WALK.Mirror.prototype.inFrustum=function(){this.mirrorToCamera.subVectors(this.cameraWorldPosition,this.mirrorWorldPosition);return this.mirrorToCamera.angleTo(this.mirrorNormal)<Math.PI/2&&this.cameraFrustum.intersectsBox(this.parent.geometry.boundingBox)};WALK.Mirror.prototype.updateTextureMatrix=
function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector4,e=new THREE.Plane,g=new THREE.Vector4;return function(){a.copy(this.mirrorWorldPosition).sub(this.cameraWorldPosition).reflect(this.mirrorNormal).negate().add(this.mirrorWorldPosition);c.set(0,0,-1);c.applyMatrix4(this.cameraRotationMatrix);c.add(this.cameraWorldPosition);b.copy(this.mirrorWorldPosition).sub(c).reflect(this.mirrorNormal).negate().add(this.mirrorWorldPosition);this.up.set(0,-1,0);this.up.applyMatrix4(this.cameraRotationMatrix);
this.up.reflect(this.mirrorNormal).negate();this.mirrorCamera.position.copy(a);this.mirrorCamera.up=this.up;this.mirrorCamera.lookAt(b);this.mirrorCamera.updateProjectionMatrix();this.mirrorCamera.updateMatrixWorld();this.mirrorCamera.matrixWorldInverse.getInverse(this.mirrorCamera.matrixWorld);this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix);this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse);e.setFromNormalAndCoplanarPoint(this.mirrorNormal,
this.mirrorWorldPosition);e.applyMatrix4(this.mirrorCamera.matrixWorldInverse);d.set(e.normal.x,e.normal.y,e.normal.z,e.constant);var f=this.mirrorCamera.projectionMatrix;g.x=(Math.sign(d.x)+f.elements[8])/f.elements[0];g.y=(Math.sign(d.y)+f.elements[9])/f.elements[5];g.z=-1;g.w=(1+f.elements[10])/f.elements[14];d.multiplyScalar(2/d.dot(g));f.elements[2]=d.x;f.elements[6]=d.y;f.elements[10]=d.z+1-this.clipBias;f.elements[14]=d.w}}();WALK.Mirror.prototype.configure=function(a,b,c,d){this.mirrorCamera.aspect=
c;this.mirrorCamera.fov=d;this.mirrorCamera.updateProjectionMatrix();null!==this.texture&&this.texture.dispose();this.material.mirrorSampler=this.texture};WALK.Mirror.prototype.render=function(a){this.material.visible&&(this.matrixNeedsUpdate&&(this.updateTextureMatrix(),this.matrixNeedsUpdate=!1),this.material.visible=!1,a.render(this.scene,this.mirrorCamera,this.texture,!0),this.material.visible=!0)};WALK.Mirror.prototype.renderTemp=function(a){this.matrixNeedsUpdate&&this.updateTextureMatrix();
a.render(this.scene,this.mirrorCamera,this.tempTexture,!0)}})();(function(){function a(a,b,c){c=c||"id";for(var d=0;d<a.length;d+=1)if(a[d].hasOwnProperty(c)&&a[d][c]===b)return!1;return!0}function b(a,b,c){c=c||"id";for(var d=0;d<a.length;d+=1)if(a[d][c]===b)return a[d];return null}function c(a,b){a=a.name.toUpperCase();b=b.name.toUpperCase();return a<b?-1:a>b?1:0}function d(a,b,c){for(var d=a[b],e=c>b?1:-1;b!==c;b+=e)a[b]=a[b+e];a[c]=d}var e=0;WALK.Scene=function(g){function f(){l.dispatchEvent(q)}function h(){l.dispatchEvent(r);f()}function k(a){a=a.target;
var b=l._mainAnimatedMaterials.has(a);a.isAnimated&&!b?l._mainAnimatedMaterials.add(a):!a.isAnimated&&b&&l._mainAnimatedMaterials.delete(a);f()}function n(){l._animatedMeshes.length=0;for(var a=$jscomp.makeIterator(l.gpuMeshes),b=a.next();!b.done;b=a.next())b=b.value,b.isAnimated&&l._animatedMeshes.push(b);f()}function p(a){l._nodeLookup[a.id]=a}var l=this,q={type:"sceneChanged"},r={type:"anyViewUpdated"};this.id=e++;this._headLight=!1;this.threeScene=new THREE.Scene;this.autoAddLightProbes=!0;this.autoTour=
{disabled:!1,startOnLoad:!1};this.canStartAutoTour=function(){return!this.autoTour.disabled&&1<this.visibleViews().length};this.startAutoTourOnLoad=function(){return this.canStartAutoTour()&&this.autoTour.startOnLoad};this.disableProgressiveLoader=!1;this.camera=g;this._colorMap=null;this.materials=[];this._mainAnimatedMaterials=new Set;this._animatedMeshes=[];this._disabledMaterials=[];this._sortedMaterials=null;this.nodeConfigs=[];this._nodeConfigsLookup={};this.nodes=[];this._nodeLookup={};this.gpuMeshes=
[];this.mirrors=[];this._animatableAuxiliaryObjects=new Set;this.boundingBox=new THREE.Box3;this._sumLogicalMeshCenter=new THREE.Vector3;this._logicalNonemptyMeshCount=0;this._center=new THREE.Vector3;this.skyMeshes=[];this.hideViewsMenu=!1;this.views=[];this.lights=[];this.lightProbes=[];this.cameraVolumes=[];this.serialize=function(){return{disableProgressiveLoader:this.disableProgressiveLoader,autoTour:this.autoTour,camera:this.camera.serialize(),materials:this.materials.map(function(a){return a.serialize()}),
nodeConfigs:this.nodeConfigs.map(function(a){return a.serialize()}),nodes:this.nodes.map(function(a){return a.serialize()}),lights:this.lights.map(function(a){return a.serialize()}),lightProbes:this.lightProbes.map(function(a){return a.serialize()}),cameraVolumes:this.cameraVolumes.map(function(a){return a.serialize()}),autoAddLightProbes:!1,views:this.views.filter(function(a){return!a.internal}).map(function(a){return a.serialize()}),skies:this.skyMeshes.filter(function(a){return a.name!==WALK.DEFAULT_SKY_NAME}).map(function(a){return a.serialize()})}};
this.addMaterial=function(a){this.materials.push(a);a.addEventListener("materialUpdated",k);a.isAnimated&&this._mainAnimatedMaterials.add(a);this.camera.colorMapReady()&&void 0!==a.colorMap&&(a.colorMap=this.camera.colorMap);void 0!==a.cameraExposure&&(a.cameraExposure=this.camera.exposure);void 0!==a.cameraGamma&&(a.cameraGamma=this.camera.gamma);void 0!==a.headLight&&(a.headLight=this.headLight)};this.replaceMaterial=function(a,b){var c=this.materials.indexOf(a);void 0===this._disabledMaterials[c]&&
(this._disabledMaterials[c]=new Map);this._disabledMaterials[c].set(a.type,a);var d=this._disabledMaterials[c].get(b);d||(d=WALK.createMaterialOfType(b),d.addEventListener("materialUpdated",k),d.name=a.name,0===this.lightProbes.length&&(d.disableLightProbeTmp=!0));this.materials[c]=d;f();for(b=0;b<this.gpuMeshes.length;b+=1)this.gpuMeshes[b].material===a&&(this.gpuMeshes[b].material=d);a.isAnimated&&this._mainAnimatedMaterials.delete(a);d.isAnimated&&this._mainAnimatedMaterials.add(d);this._sortedMaterials=
null;d.setUniforms();return d};this.addNodeConfig=function(a){this.nodeConfigs.push(a);this._nodeConfigsLookup[a.name]=a;a.addEventListener("configUpdated",n)};this.findNodeConfig=function(a){return this._nodeConfigsLookup.hasOwnProperty(a)?this._nodeConfigsLookup[a]:null};this.addNode=function(a){this.nodes.push(a);a.visitSubtree(p)};this.findNode=function(a){return this._nodeLookup[a]};this.visitAllNodes=function(a){for(var b=0;b<this.nodes.length;b+=1)this.nodes[b].visitSubtree(a)};this.visitMeshesWithMaterial=
function(a,b){this.visitAllNodes(function(c){(c=c.mesh)&&c.material===a&&b(c)})};this.sortedMaterials=function(){null===this._sortedMaterials&&(this._sortedMaterials=this.materials.slice(0).sort(c));return this._sortedMaterials};this._updateSceneCenterWithGpuMesh=function(){var a=new THREE.Vector3;return function(b){if(b.logicalMeshes)for(var c=0;c<b.logicalMeshes.length;c+=1){var d=b.logicalMeshes[c].geometry.boundingBox;d.empty()||(d.center(a),this._sumLogicalMeshCenter.add(a),++this._logicalNonemptyMeshCount)}else b=
b.geometry.boundingBox,b.empty()||(b.center(a),this._sumLogicalMeshCenter.add(a),++this._logicalNonemptyMeshCount);this._logicalNonemptyMeshCount&&this._center.copy(this._sumLogicalMeshCenter).divideScalar(this._logicalNonemptyMeshCount)}}();this.addGpuMesh=function(a){a.isAnimated&&this._animatedMeshes.push(a);if(a.material.planarReflector){var b=new WALK.Mirror(this.threeScene,this.camera,{clipBias:0,color:8355711,debugMode:!1});b.material.name=a.material.name;var c=a.geometry;console.assert(c.boundingBox);
var d=c.boundingBox,e=Math.sqrt(Math.pow(d.max.x-d.min.x,2)+Math.pow(d.max.z-d.min.z,2)),f=d.max.y-d.min.y;e&&f?(e=new THREE.Mesh(new THREE.PlaneBufferGeometry(e,f),b.material),e.rotation.y=Math.atan2(c.normals[0],c.normals[2]),d.center(e.position),e.geometry.boundingBox=d,e.add(b),b=e):(WALK.log("mirror with 0 dimension"),b=null);this.mirrors.push(b.children[0]);this.addAuxiliaryObject(b)}else this.addAuxiliaryObject(a);this.gpuMeshes.push(a);this.boundingBox.union(a.geometry.boundingBox);this._updateSceneCenterWithGpuMesh(a)};
this.addAuxiliaryObject=function(a,b){b=void 0===b?!1:b;this.threeScene.add(a);b&&this._animatableAuxiliaryObjects.add(a)};this.removeAuxiliaryObject=function(a){this.threeScene.remove(a);this._animatableAuxiliaryObjects.delete(a)};this.addSkyMesh=function(a){var b=a.material;this.skyMeshes.push(a);this.camera.colorMapReady()&&(b.colorMap=this.camera.colorMap);void 0!==b.cameraExposure&&(b.cameraExposure=this.camera.exposure);void 0!==b.cameraGamma&&(b.cameraGamma=this.camera.gamma);a.addEventListener("skyMeshUpdated",
f);this.dispatchEvent({type:"skyMeshAdded",skyMesh:a})};this.removeSkyMesh=function(a){WALK.removeFromArray(a,this.skyMeshes);this.dispatchEvent({type:"skyMeshRemoved",skyMesh:a});a.geometry.dispose();a.material.map&&a.material.map.dispose();a.material.dispose()};this.findSkyMesh=function(a){return b(this.skyMeshes,a,"name")};this.addLight=function(b){console.assert(a(this.lights,b.name,"name"));this.lights.push(b);b.addEventListener("lightUpdated",f);b.addEventListener("lightInstanceAdded",f);b.addEventListener("lightInstanceRemoved",
f);f();this.dispatchEvent({type:"lightAdded",light:b})};this.removeLight=function(a){WALK.removeFromArray(a,this.lights);f();this.dispatchEvent({type:"lightRemoved",light:a})};this.addLightProbe=function(b){console.assert(a(this.lightProbes,b.id));this.lightProbes.push(b);b.addEventListener("lightProbePositionUpdated",f);b.addEventListener("lightProbeBoundsUpdated",f);f();this.dispatchEvent({type:"lightProbeAdded",lightProbe:b})};this.removeLightProbe=function(a){WALK.removeFromArray(a,this.lightProbes);
for(var b=0;b<this.gpuMeshes.length;b+=1)this.gpuMeshes[b].lightProbe===a&&(this.gpuMeshes[b].lightProbe=null);f();this.dispatchEvent({type:"lightProbeRemoved",lightProbe:a});a.dispose()};this.findLightProbe=function(a){return b(this.lightProbes,a)};this.addCameraVolume=function(b){console.assert(a(this.cameraVolumes,b.id));this.cameraVolumes.push(b);b.addEventListener("cameraVolumeUpdated",f);f();this.dispatchEvent({type:"cameraVolumeAdded",cameraVolume:b})};this.removeCameraVolume=function(a){WALK.removeFromArray(a,
this.cameraVolumes);f();this.dispatchEvent({type:"cameraVolumeRemoved",cameraVolume:a});a.dispose()};this.findCameraVolume=function(a){return b(this.cameraVolumes,a)};this.shiftCameraVolume=function(a,b){d(this.cameraVolumes,this.cameraVolumes.indexOf(a),b);this.dispatchEvent({type:"cameraVolumeShifted",cameraVolume:a})};this.findView=function(a){return b(this.views,a)};this.findViewByName=function(a){return b(this.views,a,"name")};this.visibleViews=function(){return WALK.filter(this.views,function(a){return!a.hideFromMenu})};
this.addView=function(b){console.assert(a(this.views,b.id));this.views.push(b);b.addEventListener("viewUpdated",h);f();this.dispatchEvent({type:"viewAdded",view:b})};this.removeView=function(a){WALK.removeFromArray(a,this.views);this.nodeConfigs.forEach(function(b){b.removeFromHideInViews(a.id)});f();this.dispatchEvent({type:"viewRemoved",view:a})};this.shiftView=function(a,b){d(this.views,this.views.indexOf(a),b);this.dispatchEvent({type:"viewShifted",view:a})};this.hasLightMap=function(){return void 0!==
WALK.find(this.materials,function(a){return a.lightMapped})};this.adjustSkiesAndCameraFarToSpanWholeScene=function(){for(var a=0,b=0;b<this.skyMeshes.length;b+=1){var c=this.skyMeshes[b];c.autoPosition&&c.position.copy(this.center);if(this.boundingBox.empty())var d=0;else{var e=this.boundingBox,f=c.position;d=Math.max(Math.abs(e.min.x-f.x),Math.abs(e.max.x-f.x));var g=Math.max(Math.abs(e.min.y-f.y),Math.abs(e.max.y-f.y));e=Math.max(Math.abs(e.min.z-f.z),Math.abs(e.max.z-f.z));d=Math.sqrt(d*d+g*g+
e*e)}d+=WALK.SKY_DISTANCE_TO_SCENE;c.radius=d;a=Math.max(a,d)}this.camera.setFar(Math.max(this.camera.far,2*a));WALK.log("Camera far set to "+this.camera.far)};g.addEventListener("colorMapUpdated",function(){var a=g.colorMap;l.materials.forEach(function(b){void 0!==b.colorMap&&(b.colorMap=a);b.setUniforms()});l.skyMeshes.forEach(function(b){b.material.colorMap=a});f()});g.addEventListener("cameraUpdated",f);this.disableLightProbesForMaterials=function(){for(var a=0;a<this.materials.length;a+=1)this.materials[a].disableLightProbeTmp=
!0,this.materials[a].setUniforms()};this.enableLightProbesForMaterials=function(){for(var a=0;a<this.materials.length;a+=1)this.materials[a].disableLightProbeTmp=!1,this.materials[a].setUniforms()};this.getAnimatedMaterials=function(){var a=!1,b=new Map;return function(){function c(a){a instanceof THREE.Mesh&&a.material.isAnimated&&b.set(a.material,d)}for(var d=!a,e=$jscomp.makeIterator(l._mainAnimatedMaterials),f=e.next();!f.done;f=e.next())b.set(f.value,d);e=$jscomp.makeIterator(l._animatableAuxiliaryObjects);
for(f=e.next();!f.done;f=e.next())f.value.traverse(c);e=$jscomp.makeIterator(b);for(f=e.next();!f.done;f=e.next()){f=$jscomp.makeIterator(f.value);var g=f.next().value;f.next().value===a&&b.delete(g)}a=d;return b.keys()}}();this.getAnimatedMeshes=function(){return this._animatedMeshes};g.addEventListener("exposureUpdated",function(a){var b=g.exposure;l.materials.forEach(function(a){void 0!==a.cameraExposure&&(a.cameraExposure=b)});l.skyMeshes.forEach(function(a){a=a.material;void 0!==a.cameraExposure&&
(a.cameraExposure=b)})});g.addEventListener("gammaUpdated",function(a){var b=g.gamma;l.materials.forEach(function(a){void 0!==a.cameraGamma&&(a.cameraGamma=b)});l.skyMeshes.forEach(function(a){a=a.material;void 0!==a.cameraGamma&&(a.cameraGamma=b)})})};WALK.Scene.prototype={constructor:WALK.Scene,get center(){return this._center},get headLight(){return this._headLight},set headLight(a){a!==this._headLight&&(this._headLight=a,this.materials.forEach(function(b){b.headLight=a;b.setUniforms()}))}};THREE.EventDispatcher.prototype.apply(WALK.Scene.prototype);
WALK.createMaterialOfType=function(a){return"water"===a?new WALK.StandardMaterialWater:new WALK.StandardMaterial}})();(function(){WALK.BufferAttribute=function(a,b,c){THREE.BufferAttribute.call(this,a,b);this._length=a.length;this.releaseOnLoadedToGpu=!0;this.divisor=c||0;this.glType=this.buffer=null};WALK.BufferAttribute.prototype={constructor:WALK.BufferAttribute,get length(){return this._length}}})();(function(){function a(a,c,d,e,g){d=new WALK.BufferAttribute(d,e,g||0);a.addAttribute(c,d)}THREE.BufferGeometry.prototype.addTriangleOrderAttribute=function(){if(void 0===this.getAttribute("order")){for(var a=this.getAttribute("position").length/3,c=new Float32Array(a),d=0;d<a;d+=1)c[d]=d%3;this.addAttribute("order",new WALK.BufferAttribute(c,1))}};THREE.BufferGeometry.prototype.convertNormalsToSpherical=function(){console.assert(void 0===this.getAttribute("sphericalNormal"));var a=this.getAttribute("normal");
console.assert(!a.buffer);a=a.array;for(var c=a.length/3,d=WALK.DETECTOR.ios?new Int16Array(2*c):new Int8Array(2*c),e=0;e<c;e+=1){var g=3*e,f=2*e,h=Math.atan2(a[g+1],a[g])/Math.PI;d[f]=WALK.Math.toSnorm8(2*(Math.acos(a[g+2])/Math.PI-.5));d[f+1]=WALK.Math.toSnorm8(h)}delete this.attributes.normal;this.addAttribute("sphericalNormal",new WALK.BufferAttribute(d,2))};THREE.BufferGeometry.prototype.changePosition=function(a){var b=this.getAttribute("position"),d=b.length/3;b=b.array;for(var e=0;e<3*d;e+=
3)b[e]+=a.x,b[e+1]+=a.y,b[e+2]+=a.z};THREE.BufferGeometry.prototype.clone=function(){console.error("WALK.BufferGeometry cloning not supported")};WALK.Geometry=function(){THREE.BufferGeometry.call(this);this.isInstanced=!1;this.instanceCount=0;this.index=null;this.indexUint=!0;this.uvs1=this.uvs0=this.normals=this.vertices=null;this.vertexOffset=this.vertexCnt=this.indexOffset=this.indexCnt=0;this.boundingBox=new THREE.Box3;this.boundingSphere=new THREE.Sphere;this.gpuSize=0};WALK.Geometry.prototype=
Object.create(THREE.BufferGeometry.prototype);WALK.Geometry.prototype.constructor=WALK.Geometry;WALK.Geometry.prototype.allocateCoreBuffers=function(a){console.assert(!this.vertices);a&&(65536>=this.vertexCnt?(this.indexUint=!1,this.index=new Uint16Array(this.indexCnt),this.gpuSize+=2*this.indexCnt):(this.indexUint=!0,this.index=new Uint32Array(this.indexCnt),this.gpuSize+=4*this.indexCnt));this.vertices=new Float32Array(3*this.vertexCnt);this.gpuSize+=12*this.vertexCnt;this.normals=WALK.DETECTOR.ios?
new Int16Array(2*this.vertexCnt):new Int8Array(2*this.vertexCnt);this.gpuSize+=2*this.vertexCnt};WALK.Geometry.prototype.addCoreAttributes=function(){this.index&&(a(this,"index",this.index,1),this.index=null);a(this,"position",this.vertices,3);this.vertices=null;a(this,"sphericalNormal",this.normals,2);this.normals=null};WALK.Geometry.prototype.allocateUv0=function(){console.assert(!this.uvs0);this.uvs0=new Float32Array(2*this.vertexCnt);this.gpuSize+=8*this.vertexCnt};WALK.Geometry.prototype.addUv0Attribute=
function(){a(this,"uv",this.uvs0,2);this.uvs0=null};WALK.Geometry.prototype.allocateUv1=function(){console.assert(!this.uvs1);this.uvs1=new Uint16Array(2*this.vertexCnt);this.gpuSize+=4*this.vertexCnt};WALK.Geometry.prototype.addUv1Attribute=function(){a(this,"uv2",this.uvs1,2);this.uvs1=null};WALK.Geometry.prototype.computeBoundingBox=void 0;WALK.Geometry.prototype.computeBoundingSphere=void 0;WALK.InstancedGeometry=function(a,c){THREE.BufferGeometry.call(this);this.parent=a;this.ownsGpuBuffers=
c;this.isInstanced=!0;this.instanceCount=0;this.transforms2=this.transforms1=this.transforms0=this.uvs1Mod=null;this.vertexOffset=this.indexOffset=0;this.boundingBox=new THREE.Box3;this.boundingSphere=new THREE.Sphere;this._gpuSize=0};WALK.InstancedGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);WALK.InstancedGeometry.prototype.constructor=WALK.InstancedGeometry;WALK.InstancedGeometry.prototype.allocateCoreBuffers=function(a){console.assert(!this.transforms0);this.parent.vertices||
this.parent.allocateCoreBuffers(a);a=4*this.instanceCount;this.transforms0=new Float32Array(a);this.transforms1=new Float32Array(a);this.transforms2=new Float32Array(a);this._gpuSize+=12*a};WALK.InstancedGeometry.prototype.addCoreAttributes=function(){this.parent.attributes.position||this.parent.addCoreAttributes();for(var b=$jscomp.makeIterator(Object.keys(this.parent.attributes)),c=b.next();!c.done;c=b.next())c=c.value,this.addAttribute(c,this.parent.attributes[c]);a(this,"t0",this.transforms0,
4,1);a(this,"t1",this.transforms1,4,1);a(this,"t2",this.transforms2,4,1);this.transforms2=this.transforms1=this.transforms0=null};WALK.InstancedGeometry.prototype.allocateUv0=function(){this.parent.uvs0||this.parent.allocateUv0()};WALK.InstancedGeometry.prototype.addUv0Attribute=function(){this.parent.attributes.uv||this.parent.addUv0Attribute();this.addAttribute("uv",this.parent.attributes.uv)};WALK.InstancedGeometry.prototype.allocateUv1=function(){console.assert(!this.uvs1Mod);this.parent.uvs1||
this.parent.allocateUv1();this.uvs1Mod=new Float32Array(4*this.instanceCount);this._gpuSize+=16*this.instanceCount};WALK.InstancedGeometry.prototype.addUv1Attribute=function(){this.parent.attributes.uv2||this.parent.addUv1Attribute();this.addAttribute("uv2",this.parent.attributes.uv2);a(this,"uv2Mod",this.uvs1Mod,4,1);this.uvs1Mod=null};WALK.InstancedGeometry.prototype.computeBoundingBox=void 0;WALK.InstancedGeometry.prototype.computeBoundingSphere=void 0;Object.defineProperty(WALK.InstancedGeometry.prototype,
"index",{get:function(){return this.parent.index}});Object.defineProperty(WALK.InstancedGeometry.prototype,"vertices",{get:function(){return this.parent.vertices}});Object.defineProperty(WALK.InstancedGeometry.prototype,"normals",{get:function(){return this.parent.normals}});Object.defineProperty(WALK.InstancedGeometry.prototype,"uvs0",{get:function(){return this.parent.uvs0}});Object.defineProperty(WALK.InstancedGeometry.prototype,"uvs1",{get:function(){return this.parent.uvs1}});Object.defineProperty(WALK.InstancedGeometry.prototype,
"indexUint",{get:function(){return this.parent.indexUint}});Object.defineProperty(WALK.InstancedGeometry.prototype,"vertexCnt",{get:function(){return this.parent.vertexCnt},set:function(a){this.parent.vertexCnt=a}});Object.defineProperty(WALK.InstancedGeometry.prototype,"indexCnt",{get:function(){return this.parent.indexCnt},set:function(a){this.parent.indexCnt=a}});Object.defineProperty(WALK.InstancedGeometry.prototype,"gpuSize",{get:function(){return this.ownsGpuBuffers?this._gpuSize+this.parent.gpuSize:
this._gpuSize}});WALK.SubGeometry=function(a,c,d,e,g,f,h){THREE.BufferGeometry.call(this);this.indexCnt=a;this.vertexCnt=c;this.parent=d;this.vertexOffset=g;this.indexOffset=e;this.boundingBox=f;this.boundingSphere=h;this.isInstanced=d.isInstanced;this.instanceId=0;this.instanceCount=1};WALK.SubGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);WALK.SubGeometry.prototype.constructor=WALK.SubGeometry;Object.defineProperty(WALK.SubGeometry.prototype,"attributes",{get:function(){return this.parent.attributes}});
Object.defineProperty(WALK.SubGeometry.prototype,"attributesKeys",{get:function(){return this.parent.attributesKeys}});Object.defineProperty(WALK.SubGeometry.prototype,"indexUint",{get:function(){return this.parent.indexUint}});WALK.SubGeometry.prototype.computeBoundingBox=void 0;WALK.SubGeometry.prototype.computeBoundingSphere=void 0;WALK.SubGeometry.prototype.addTriangleOrderAttribute=function(){this.parent.addTriangleOrderAttribute()}})();(function(){function a(a){a.dispatchEvent({type:"cameraVolumeUpdated",cameraVolume:a})}var b=null,c=null,d=new THREE.Vector3,e=new THREE.Quaternion;WALK.CameraVolume=function(a){this.id=a.id;this.name=a.name;this._type=a.type;console.assert(0<=WALK.CameraVolume.CameraVolumeTypes.indexOf(this._type));this.position=(new THREE.Vector3).fromArray(a.position);this.rotation=(new WALK.Euler).setFromDegTriple(a.rotation);this.scale=(new THREE.Vector3).fromArray(a.scale);this.exposure=a.exposure;this.gamma=
a.gamma;this._inverse=new THREE.Matrix4;this._inverseDirty=!0};WALK.CameraVolume.CameraVolumeTypes=["cube","sphere"];WALK.CameraVolume.prototype={constructor:WALK.CameraVolume,getVolumeGeometry:function(){b||(b=new THREE.BoxBufferGeometry(2,2,2),b.addTriangleOrderAttribute(),b.convertNormalsToSpherical(),c=new THREE.IcosahedronBufferGeometry(1,2),c.addTriangleOrderAttribute(),c.convertNormalsToSpherical());return"sphere"===this._type?c:b},setName:function(b){this.name=b;a(this)},setPosition:function(b,
c,d){this.position.set(b,c,d);this._inverseDirty=!0;a(this)},setRotation:function(b,c,d){this.rotation.yaw=WALK.normalizeRotation(b);this.rotation.pitch=WALK.normalizeRotation(c);this.rotation.roll=WALK.normalizeRotation(d);this._inverseDirty=!0;a(this)},setRotationDeg:function(a,b,c){a=THREE.Math.degToRad(a);b=THREE.Math.degToRad(b);c=THREE.Math.degToRad(c);this.setRotation(a,b,c)},setScale:function(b,c,d){this.scale.set(b,c,d);this._inverseDirty=!0;a(this)},setExposure:function(b){this.exposure=
b;a(this)},setGamma:function(b){this.gamma=b;a(this)},worldCoordinatesInside:function(a){this._inverseDirty&&(this._inverseDirty=!1,this._inverse.compose(this.position,e.setFromEuler(this.rotation),this.scale),this._inverse.getInverse(this._inverse));d.copy(a).applyMatrix4(this._inverse);return"sphere"===this._type?1>=d.lengthSq():1>=Math.abs(d.x)&&1>=Math.abs(d.y)&&1>=Math.abs(d.z)},serialize:function(){return{id:this.id,name:this.name,type:this._type,position:this.position.toArray(),rotation:this.rotation.toDegTriple(),
scale:this.scale.toArray(),exposure:this.exposure,gamma:this.gamma}},dispose:function(){}};THREE.EventDispatcher.prototype.apply(WALK.CameraVolume.prototype)})();(function(){function a(a,b,c,d){var e=WALK.SPRITE_ANCHOR_FONT_SIZE,f=a.getContext("2d");f.font="700 "+e+"px "+c;for(var g=b,k=b.length-1,h;;){h=f.measureText(g).width;h+=2*d;if(1024>=h)break;g=b.substring(0,k)+"...";--k}a.width=h;a.height=1.5*e;f=a.getContext("2d");f.font="700 "+e+"px "+c;return[f,g]}function b(b){var d=b.icon&&WALK.ICONS[b.icon],e=d?d.value:b.text,f=d?d.fontFamily:"Noto Sans";var g=b.color||"#4c9ed9";var h=b.opacity;void 0===h||1<=h||(k.setStyle(g),g="rgba("+(255*k.r|0)+","+(255*
k.g|0)+","+(255*k.b|0)+","+h+")");var p=g;h=b.textColor||"#ffffff";g=void 0!==b.opacity&&1>b.opacity;var t="sphere"===b.type,v=t||void 0===b.textMargin?20:b.textMargin;d=[d||"",e,f,p,t,v,b.borderRadius||0,g].join("_");var w=n.get(d);if(w)return w.usedTimes++,[d,w.texture];w=document.getElementById("anchor-canvas");w||(w=document.createElement("canvas"),w.id="anchor-canvas");t?(t=w,v=e,t.width=512,t.height=512,t=t.getContext("2d"),t.font="700 128px "+f,v=t.measureText(v).width,v=Math.floor(c/v*128),
v=Math.min(v,c),t.font="700 "+v+"px "+f,f=t):(e=$jscomp.makeIterator(a(w,e,f,v)),f=e.next().value,e=e.next().value);f.fillStyle=p;b.borderRadius?(p=f,t=w.width,v=w.height,b=.5*b.borderRadius*Math.min(t,v),p.beginPath(),p.moveTo(0+b,0),p.lineTo(0+t-b,0),p.quadraticCurveTo(0+t,0,0+t,0+b),p.lineTo(0+t,0+v-b),p.quadraticCurveTo(0+t,0+v,0+t-b,0+v),p.lineTo(0+b,0+v),p.quadraticCurveTo(0,0+v,0,0+v-b),p.lineTo(0,0+b),p.quadraticCurveTo(0,0,0+b,0),p.closePath(),p.fill()):f.fillRect(0,0,w.width,w.height);f.fillStyle=
h;f.textAlign="center";f.textBaseline="middle";f.shadowColor="black";f.shadowBlur=16;f.fillText(e,w.width/2,w.height/2);b=new WALK.Texture(w);b.width=w.width;b.height=w.height;b.hasAlpha=g;b.minFilter=GLC.LINEAR;b.loaded=!0;b.needsUpdate=!0;n.set(d,{usedTimes:1,texture:b});return[d,b]}var c=512-2*Math.floor(512*(.5-.5*Math.sin(70/180*Math.PI/2))),d=null,e,g,f=null,h,k=new THREE.Color,n=new Map;WALK.Anchor=function(a,c){d&&f===a.id||(d=new THREE.SphereBufferGeometry(1,32,16),d.convertNormalsToSpherical(),
e=new THREE.PlaneBufferGeometry(1,1),e.convertNormalsToSpherical(),g=new THREE.CylinderBufferGeometry(.5,.5,1,16,1),h||(h=new THREE.Matrix4,h.makeRotationX(Math.PI/2)),g.applyMatrix(h),g.convertNormalsToSpherical(),f=a.id);var k=new THREE.Vector3;k.fromArray(c.position);var l=$jscomp.makeIterator(b(c)),m=l.next().value;l=l.next().value;this._textureSignature=m;if("sphere"===c.type){m=d;var n=new WALK.AnchorMaterial;var p=null;var t=Infinity;a=$jscomp.makeIterator(a.lightProbes);for(var v=a.next();!v.done;v=
a.next()){v=v.value;var w=k.distanceTo(v.position);w<t&&(t=w,p=v)}t=p;n.bumpTexture=l;n.disableLightProbe=null===t||!t.texturesReady();n.headLight=!0;p=[c.radius,c.radius,c.radius]}else{m=e;n=new WALK.AnchorSpriteMaterial;t=null;n.disableLightProbe=!0;n.headLight=!1;n.specularOff=1;p=[l.width/l.height*c.height,c.height,1];var z=new THREE.Mesh(g,null)}n.baseColorTexture=l;n.configureTransparency();n.setUniforms();THREE.Mesh.call(this,m,n);this.position.copy(k);this.scale.fromArray(p);this.updateMatrixWorld(!0);
this.lightProbe=t;z?(z.position.copy(k),k=Math.max(p[0],p[1]),z.scale.fromArray([k,k,c.height]),z.updateMatrixWorld(!0),this.colliderMesh=z):this.colliderMesh=this;this.colliderMesh.visibilityId=null;this.colliderMesh.anchor=this;this.extension=null};WALK.Anchor.prototype=Object.create(THREE.Mesh.prototype);WALK.Anchor.prototype.dispose=function(){var a=this.material;a.dispose();var b=this._textureSignature,c=n.get(b),d=c.texture;console.assert(a.baseColorTexture===d);c.usedTimes--;0===c.usedTimes&&
(d.dispose(),n.delete(b))};WALK.Anchor.prototype.enableLightProbe=function(){if(this.lightProbe){console.assert(this.lightProbe.texturesReady());var a=this.material;a.disableLightProbe=!1;a.setUniforms()}}})();(function(){var a=null,b=null,c=null,d=null;WALK.Avatar=function(e,g,f){THREE.Object3D.call(this);this.uuid=g;this.displayName=f.displayName;b&&a===e.id||(c=new THREE.SphereBufferGeometry(.08,32,16),c.convertNormalsToSpherical(),d=new THREE.TorusBufferGeometry(.03,-.011,8,6),d.convertNormalsToSpherical(),b=new THREE.PlaneBufferGeometry(1,1),b.convertNormalsToSpherical(),a=e.id);g=new WALK.StandardMaterial;g.baseColor.setStyle(f.color).convertGammaToLinear();g.disableLightProbe=!0;g.headLight=!0;g.setUniforms();
this._body=new THREE.Object3D;this._head=new THREE.Mesh(c,g);this._head.rotation.order="ZXY";var h=new THREE.Mesh(d,g);h.rotateX(Math.PI/2);h.position.set(.05,.09,0);var k=new THREE.Mesh(d,g);k.rotateX(Math.PI/2);k.position.set(-.05,.09,0);this._head.add(h);this._head.add(k);this._displayNameAnchor=new WALK.Anchor(e,{type:"sprite",position:[0,0,.15],height:.1,text:f.displayName,textColor:f.color,opacity:0});this._pointer=new THREE.Mesh(c,g);this._pointer.scale.set(.4,.4,.4);this._pointer.visible=
!1;this._body.add(this._head);this.add(this._body);this.add(this._displayNameAnchor);this.add(this._pointer);f.position&&this.position.fromArray(f.position);this.updateMatrixWorld(!0);this._videoTexture1=this._videoTexture0=this._videoScreenBack=this._videoScreen=null};WALK.Avatar.prototype=Object.create(THREE.Object3D.prototype);WALK.Avatar.prototype.constructor=WALK.Avatar;WALK.Avatar.prototype.hideBody=function(){this._head.visible=!1;this._displayNameAnchor.visible=!1};WALK.Avatar.prototype._updated=
function(){this.dispatchEvent({type:"avatarUpdated",target:this})};WALK.Avatar.prototype.rotate=function(a,b){this._body.rotation.z=a;this._head.rotation.x=b};WALK.Avatar.prototype._addVideoScreen=function(){if(!this._videoScreen){var a=new WALK.StandardMaterial;this._videoScreen=new THREE.Mesh(b,a);this._videoScreen.rotateZ(Math.PI);this._videoScreen.rotateX(Math.PI/2);this._videoScreen.position.set(0,0,-.26);console.assert(!this._videoScreenBack);this._videoScreenBack=new THREE.Mesh(b,this.getMainMaterial());
this._videoScreenBack.rotateZ(Math.PI);this._videoScreenBack.rotateX(-Math.PI/2);this._videoScreenBack.position.set(0,0,-.26);this._videoScreen.visible=!1;this._videoScreenBack.visible=!1;this._body.add(this._videoScreen);this._body.add(this._videoScreenBack)}};WALK.Avatar.prototype._removeVideoScreen=function(){this._videoScreen&&(this._body.remove(this._videoScreen),this._body.remove(this._videoScreenBack),this._videoScreen.material.dispose(),this._videoScreenBack=this._videoScreen=null)};WALK.Avatar.prototype.setVideoTexture0=
function(a){var b=this;this._videoTexture0&&(this._videoTexture0.dispose(),this._videoTexture0=null,this._updated());null===a?this._removeVideoScreen():(this._addVideoScreen(),a.addLoadedListener(function(){b._videoScreen.material.baseColorTexture=a;var c=a.width/a.height;b._videoScreen.scale.set(.3*c,.3,1);b._videoScreenBack.scale.set(.3*c,.3,1);b._videoScreen.visible=!0;b._videoScreenBack.visible=!0;b.updateMatrixWorld(!0);b._videoTexture0=a;b._updated()}))};WALK.Avatar.prototype.getVideoTexture0=
function(){return this._videoTexture0};WALK.Avatar.prototype.setVideoTexture1=function(a){var b=this;this._videoTexture1&&(this._videoTexture1.dispose(),this._videoTexture1=null,this._updated());a&&a.addLoadedListener(function(){b._videoTexture1=a;b._updated()})};WALK.Avatar.prototype.getVideoTexture1=function(){return this._videoTexture1};WALK.Avatar.prototype.getMainMaterial=function(){return this._head.material};WALK.Avatar.prototype.placePointer=function(a,b,c){this._pointer.position.set(a-this.position.x,
b-this.position.y,c-this.position.z);this._pointer.visible=!0};WALK.Avatar.prototype.hidePointer=function(){this._pointer.visible=!1};WALK.Avatar.prototype.dispose=function(){this._head.material.dispose();this._videoTexture0&&this._videoTexture0.dispose();this._videoTexture1&&this._videoTexture1.dispose();this._videoScreen&&this._videoScreen.material.dispose();this._displayNameAnchor.dispose();this.dispatchEvent({type:"dispose"})};WALK.Avatar.prototype.enableLightProbe=function(){}})();(function(){function a(a,b,c,d,e){c=new THREE.SphereBufferGeometry(c,32,16);c.changePosition(d);c.computeBoundingSphere();c.convertNormalsToSpherical();d=new WALK.Mesh(null,c,b);b.lightMapped&&(d.lightMap=e);a.camera.getWorldPosition(g);b=g;e=null;c=Infinity;a=$jscomp.makeIterator(a.lightProbes);for(var f=a.next();!f.done;f=a.next()){f=f.value;var k=b.distanceTo(f.position);k<c&&(c=k,e=f)}d.lightProbe=e;d.frustumCulled=!1;d.userData.hideFromLightProbes=!0;return d}function b(a){c.setRGB(a,a,a);a=
WALK.ColorUtils.hdrEncode(c,d);var b=new Uint8Array(4);b[0]=Math.round(255*d.r);b[1]=Math.round(255*d.g);b[2]=Math.round(255*d.b);b[3]=Math.round(255*a);a=new WALK.DataTexture(b,1,1);a.magFilter=GLC.NEAREST;a.minFilter=GLC.NEAREST;a.anisotropy=WALK.NO_ANISOTROPY;a.hasAlpha=!0;a.isRgbm=!0;a.loaded=!0;a.needsUpdate=!0;return a}var c,d,e,g,f=new THREE.Matrix4,h=new THREE.Vector2;WALK.MaterialPicker=function(k,n,p,l,q,r,m){function u(a){t.forEach(function(b){return b(a)})}var x=this;this.lightMap=null;
this.meshes=[];var t=[];c||(c=new THREE.Color,d=new THREE.Color,g=new THREE.Vector3,e=new THREE.Vector3,g=new THREE.Vector3);var v=l.camera.aspect,w=.1*Math.tan(THREE.Math.degToRad(l.camera.fov/2)),z=-w;v=Math.abs(v*w-v*z);w=Math.abs(w-z);var A=.01*v,y=(v-k.length*A-A)/(2*k.length);y=Math.min(y,.05*v);var E=k.length/2*-(2*y+A)+y+A;z=(window.innerHeight-$("menu-bar").getBoundingClientRect().top)/window.innerHeight;var I=-w/2+w*z+y+A;k.some(function(a){return a.lightMapped})&&(r=r.measureIncidentLuma(),
0>r&&(r=1),this.lightMap=b(r));k.forEach(function(b,c){if(b){e.set(E,I,-.1);var d=a(l,b,y,e,x.lightMap);E+=2*y+A;var g=new THREE.Matrix4;g.multiply(f.makeTranslation(n.x,n.y,n.z));b=q.cameraWorldPosition();h.x=b.x-n.x;h.y=b.y-n.y;g.multiply(f.makeRotationZ(Math.abs(h.y)>Math.abs(h.x)?0<h.x?0:-Math.PI:0<h.y?Math.PI/2:-Math.PI/2));g.multiply(f.makeRotationX(-Math.PI/2));g.multiply(f.makeScale(p,p,p));g.multiply(f.makeTranslation(2.1*(c+1),0,0));g.multiply(f.makeScale(1/y,1/y,1/y));g.multiply(f.makeTranslation(-e.x,
-e.y,-e.z));x.meshes.push(d);t.push(function(a){a?(d.matrix=g,d.matrixWorld=g):(d.matrix=l.camera.matrix,d.matrixWorld=l.camera.matrixWorld)})}});var O=function(){return u(!0)},K=function(){return u(!1)};m.addEventListener("modeEnabled",O);m.addEventListener("modeDisabled",K);this.dispose=function(){t.length=0;m.removeEventListener("modeEnabled",O);m.removeEventListener("modeDisabled",K);this.meshes.forEach(function(a){return a.geometry.dispose()});this.meshes=null;this.lightMap&&(this.lightMap.dispose(),
this.lightMap=null)};u(m.modeIsEnabled())}})();(function(){function a(){var a=new Set,c=[];this.add=function(b){b instanceof RegExp?c.push(b):a.add(b)};this.matchesAny=function(b){return a.has(b)?!0:c.some(function(a){return a.test(b)})}}WALK.MergeConfig=function(){this._editableNodeTypes=new a;this._editableMaterialNames=new a;this._allMaterialsEditable=!1;this.setNodeTypeEditable=function(a){this._editableNodeTypes.add(a)};this.setMaterialEditable=function(a){this._editableMaterialNames.add(a)};this.setAllMaterialsEditable=function(){this._allMaterialsEditable=
!0};this.isMaterialEditable=function(a){return this._allMaterialsEditable||this._editableMaterialNames.matchesAny(a)};this.isNodeTypeEditable=function(a){return this._editableNodeTypes.matchesAny(a)}}})();(function(){WALK.KTXLoader=function(){this._parser=WALK.KTXLoader.parse};WALK.KTXLoader.prototype=Object.create(WALK.CompressedTextureLoader.prototype);WALK.KTXLoader.parse=function(a){var b=[],c=new Int32Array(a,0,16);67305985===c[3]&&console.assert("Big endian machines not supported");console.assert(0===c[4]);console.assert(1===c[5]);console.assert(0===c[6]);if(35842===c[7]){console.assert(6408===c[8]);var d=GLC.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG}else 36196===c[7]?(console.assert(6407===c[8]),d=GLC.COMPRESSED_RGB_ETC1_WEBGL):
33776===c[7]?(console.assert(6407===c[8]),d=GLC.COMPRESSED_RGB_S3TC_DXT1_EXT):33779===c[7]?(console.assert(6408===c[8]),d=GLC.COMPRESSED_RGBA_S3TC_DXT5_EXT):console.error("Unknown KTX glInternalFormat: "+c[7]);var e=c[9],g=c[10];console.assert(0===(e&e-1));console.assert(0===(g&g-1));console.assert(0===c[11]);console.assert(0===c[12]);console.assert(1===c[13]);var f=c[14];c=c[15];console.assert(0===c%4);c=64+c;for(var h=new DataView(a,0),k=e,n=g,p=0;p<f;++p){var l=h.getUint32(c,!0);c+=4;var q=new Uint8Array(a,
c,l);b.push({data:q,width:k,height:n});c+=l+(3-(l+3)%4);k=Math.max(k/2,1);n=Math.max(n/2,1)}console.assert(c===a.byteLength);return{format:d,width:e,height:g,mipmapCount:f,mipmaps:b}}})();(function(){function a(a,b,c,d,k){a({wasmBinary:b}).then(function(a){function b(a,b,e){var f=0===Math.log2(b)%1&&0===Math.log2(e)%1;return d.dxtTextures?a?c.BC3:c.BC1:d.pvrtcTextures&&b===e&&f?a?c.PVRTC1_4_RGBA:c.PVRTC1_4_RGB:d.etc1Textures&&!a?c.ETC1:d.astcTextures?c.ASTC_4x4:c.RGBA32}a.initializeBasis();k(function(c){var d=new a.BasisFile(new self.Uint8Array(c));c=function(a){d.close();d.delete();throw a;};var e=d.getHasAlpha(),f=d.getNumImages(),g=d.getNumLevels(0),k=d.getImageWidth(0,0),h=d.getImageHeight(0,
0);0!==k&&0!==h&&0!==f&&0!==g||c("Invalid .basis file");1<f&&c("Missing multiple images handling");f=b(e,k,h);k=f.formatIdx;d.startTranscoding()||c("startTranscoding failed");h=[];for(var l=0;l<g;++l){var n=d.getImageWidth(0,l),p=d.getImageHeight(0,l),A=d.getImageTranscodedSizeInBytes(0,l,k);A=new self.Uint8Array(new self.ArrayBuffer(A));d.transcodeImage(A,0,l,k,0,e)||c(".transcodeImage failed");h.push({data:A,width:n,height:p})}d.close();d.delete();return{gpuFormat:f.gpuFormat,mipmaps:h}})})}function b(a){var b=
new window.SharedArrayBuffer(a.byteLength);(new Uint8Array(b)).set(new Uint8Array(a),0);return b}function c(c,g,f,h){function e(){if(0<r.length)if(0<q.length)q.shift().handleTexItem(r.shift()),e();else if(l<h&&!p){l++;p=!0;var a=new window.Worker(n),b=function(a){throw"Worker error @L"+a.lineno+": "+a.message;};a.addEventListener("error",b);var c=function(){function d(){0<r.length?(q.push(g),e()):(l--,a.terminate())}a.removeEventListener("error",b);a.removeEventListener("message",c);p=!1;var f,g=
{handleTexItem:function(b){f=b;a.postMessage(b.texBuffer,[b.texBuffer])}};a.addEventListener("error",function(a){f.onError("Worker error @L"+a.lineno+": "+a.message)});a.addEventListener("message",function(a){f.callback(a.data);d()});d()};a.addEventListener("message",c);a.postMessage(m)}}c="\nself.importScripts("+JSON.stringify(c)+");\nconst initBasis = "+a.toString()+";\nconst basisFormats = "+JSON.stringify(d)+";\nconst detector = "+JSON.stringify({astcTextures:g.astcTextures,dxtTextures:g.dxtTextures,
etc1Textures:g.etc1Textures,pvrtcTextures:g.pvrtcTextures})+";\n\nfunction initHandler(evt) {\n  self.removeEventListener('message', initHandler);\n\n  const wasmBinary = evt.data;\n  initBasis(BASIS, wasmBinary, basisFormats, detector, decodeTexBuffer => {\n    self.addEventListener('message', function(evt) {\n        const texBuffer = evt.data;\n        const texDatas = decodeTexBuffer(texBuffer);\n        // second argument to transfer ownership to the main thread\n        self.postMessage(texDatas, texDatas.mipmaps.map(t => t.data.buffer));\n    });\n    self.postMessage({}); // communicate end of init\n  });\n}\n\nself.addEventListener('message', initHandler);\n";
var n=window.URL.createObjectURL(new window.Blob([c])),p=!1,l=0,q=[],r=[],m=window.SharedArrayBuffer?b(f):f;return function(a,b,c){r.push({texBuffer:a,onError:b,callback:c});e()}}var d=function(){function a(a,b){return{formatIdx:a,gpuFormat:b}}return{ETC1:a(0,GLC.COMPRESSED_RGB_ETC1_WEBGL),BC1:a(2,GLC.COMPRESSED_RGB_S3TC_DXT1_EXT),BC3:a(3,GLC.COMPRESSED_RGBA_S3TC_DXT5_EXT),PVRTC1_4_RGB:a(8,GLC.COMPRESSED_RGB_PVRTC_4BPPV1_IMG),PVRTC1_4_RGBA:a(9,GLC.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG),ASTC_4x4:a(10,GLC.COMPRESSED_RGBA_ASTC_4x4_KHR),
RGBA32:a(13,GLC.RGBA)}}();WALK.createBasisLoader=function(b){if(!window.WebAssembly||!(b.pvrtcTextures||b.etc1Textures||b.dxtTextures||b.astcTextures))return null;var e=function(){var e=!1,g=null,k=[];return function(f){var h=function(){return f(g)};g?h():k.push(h);e||(e=!0,WALK.ajaxGet(WALK.getViewerAssetUrl("lib/basis/basis_transcoder.wasm"),!0,function(e){var f=WALK.getViewerAssetUrl("lib/basis/basis_transcoder.js"),h=b.BASIS_DECODE_WORKERS;if(0>=h){var m=window.document.createElement("script");
m.addEventListener("load",function x(){m.removeEventListener("load",x);a(window.BASIS,e,d,b,function(a){g=function(b,c,d){try{d(a(b))}catch(A){c(A)}};k.forEach(function(a){return a()});k.length=0})});m.src=f;window.document.head.appendChild(m)}else g=c(f,b,e,h),k.forEach(function(a){return a()}),k.length=0},function(a){throw a;}))}}();return{load:function(a,b,c,d){var f=new WALK.CompressedTexture;e(function(e){WALK.queueAjaxGet(a,b,!0,function(a){e(a,d,function(a){f.format=a.gpuFormat;a=a.mipmaps;
f.mipmaps=a;f.width=a[0].width;f.height=a[0].height;f.generateMipmaps=!1;f.minFilter=1===a.length?GLC.LINEAR:GLC.LINEAR_MIPMAP_LINEAR;f.flipY=!1;f.needsUpdate=!0;c(f)})},d)});return f}}}})();(function(){function a(){var a={};this.cacheKey=function(a,b,c,d,e){return a+"@"+b+"@"+c+"@"+d+"@"+e};this.get=function(b){return a[b]};this.insert=function(b,c){a[b]=c}}function b(a,b,c,h,k){function e(a){f.image=a;f.width=a.width;f.height=a.height;h(f)}var f=new WALK.Texture;f.format=c;WALK.queueImageGet(a,b,d?function(a){createImageBitmap(a,{premultiplyAlpha:"none",imageOrientation:f.flipY?"flipY":"none"}).then(e).catch(k)}:e,k);return f}function c(a,b,c,d,k){var e=new WALK.VideoTexture;e.format=
c;WALK.queueVideoGet(a,b,function(a){e.video=a;e.width=a.videoWidth;e.height=a.videoHeight;THREE.Math.isPowerOfTwo(e.width)&&THREE.Math.isPowerOfTwo(e.height)||(e.wrapS=GLC.CLAMP_TO_EDGE,e.wrapT=GLC.CLAMP_TO_EDGE);d(e)},k);return e}var d=!1;WALK.TextureLoader=function(d,g,f,h,k,n){function e(a){var b=a.id,c=a.webFormats;if(a.video)return d+"video/"+c[0]+"/"+b+"."+a.stdExt;var e=d+"img/",f=g.ios&&a.rgbm;if(v&&!f){if(!g.mobile&&-1<c.indexOf("large/basis"))return e+"large/basis/"+b+".basis";if(-1<c.indexOf("small/basis"))return e+
"small/basis/"+b+".basis"}if(g.pvrtcTextures&&!f&&-1<c.indexOf("small/pvr"))return e+"small/pvr/"+b+".ktx";if(g.etc1Textures&&-1<c.indexOf("small/etc1"))return e+"small/etc1/"+b+".ktx";if(g.dxtTextures&&-1<c.indexOf("large/dxt"))return e+"large/dxt/"+b+".ktx";f=-1<c.indexOf("small/std");return!(-1<c.indexOf("large/std"))||g.mobile&&f?e+"small/std/"+b+"."+a.stdExt:e+"large/std/"+b+"."+a.stdExt}function l(a){--u.texturesToLoad;a.needsUpdate=!0;f(a);a.notifyLoaded()}function q(){--u.texturesToLoad;h()}
function r(){--u.texturesToLoad;k()}function m(a,b,c,d,e){var f=new WALK.DataTexture;WALK.queueAjaxGet(a,b,!0,function(a){a=new Uint8Array(a,0,a.byteLength);var b=a[1];f.image.width=Math.pow(2,a[0]);f.image.height=Math.pow(2,b);f.format=c;f.type=GLC.UNSIGNED_BYTE;f.image.data=a.subarray(2);d&&d(f);f=null},e);return f}var u=this,x=new a,t=new WALK.KTXLoader,v=!WALK.urlHashContains("nobasis")&&WALK.createBasisLoader(g);n&&(x.insert=function(){});this.texturesToLoad=0;this.clearCache=function(){x=null};
this.load=function(a,d,f,g,k){var h=d.alpha?GLC.RGBA:GLC.RGB,n=e(d),p=/\.basis$/.test(n),w=/\.ktx$/.test(n),A=/\.buf$/.test(n),z=d.video,C=!(w||A||z),B=x.cacheKey(n,f,g,k,h),y=x.get(B);if(y)return y;u.texturesToLoad+=1;A?y=m(a,n,h,l,q):p?y=v.load(a,n,l,q):w?y=t.load(a,n,l,q):C?y=b(a,n,h,l,q):(console.assert(z),y=c(WALK.LOAD_PRIORITY.VIDEO,n,h,l,r));y.hasAlpha=!!d.alpha;y.isRgbm=!!d.rgbm;f&&(y.wrapS=GLC.REPEAT,y.wrapT=GLC.REPEAT);g&&!z?(y.minFilter=GLC.LINEAR_MIPMAP_LINEAR,y.generateMipmaps=!w):(y.minFilter=
GLC.LINEAR,y.generateMipmaps=!1);k&&(y.anisotropy=k);x.insert(B,y);y.id=d.id;y.name=d.name;y.webFormats=d.webFormats;d.rawExt&&(y.rawExt=d.rawExt);y.stdExt=d.stdExt;return y}}})();(function(){function a(a,b,c){for(var d=0;d<b.length;d+=1){var e=b[d],f=a[e];void 0!==f&&(c["_"+e]=f)}}var b="doubleSided name opacity parallaxCorrection parallaxMode parallaxScale parallaxMinLayers parallaxMaxLayers planarReflector".split(" "),c="bumpScale emissive emissionStrength envMapProject metallic roughness alphaInLowerHalf chromaKeyEnabled".split(" "),d="baseColor bumpScale bumpTexture doubleSided emissive metallic opacity roughness".split(" ");WALK.MaterialLoader=function(e,g,f){var h=WALK.DETECTOR;
this.load=function(k,n){for(var p=new Map,l=0,q=0;q<k.length;q+=1){var r;var m=k[q];var u=WALK.createMaterialOfType(m.type);if("water"===u.type)u.name=m.name,m.normalTexture&&(u.normalTexture=e.load(WALK.LOAD_PRIORITY.SPECULARITY,m.normalTexture,!0,!1,WALK.DEFAULT_ANISOTROPY)),m.baseColor&&u.baseColor.fromArray(m.baseColor),void 0!==m.opacity&&(u.opacity=m.opacity),a(m,["wavesSpeed","wavesScale","refractionFactor"],u),u.setUniforms();else{WALK.copyProperties(m,b,u);a(m,c,u);m.baseColor&&(u.baseColor.fromArray(m.baseColor),
u.baseColor.roundChannels());if(r=m.baseColorTextureCorrection)u._baseColorTextureCorrection=!0,void 0!==r.contrast&&(u._baseColorTextureContrast=r.contrast),u.baseColorTextureHslOffset.h=r.hslOffset[0],u.baseColorTextureHslOffset.s=r.hslOffset[1],u.baseColorTextureHslOffset.l=r.hslOffset[2];if(r=m.baseColorTexture)r=r.atlasId?g[r.atlasId].getAtlasEntry(r.name,r.atlasOffset[0],r.atlasOffset[1],r.atlasScale[0],r.atlasScale[1]):e.load(WALK.LOAD_PRIORITY.DIFFUSE,r,!0,!0,WALK.DEFAULT_ANISOTROPY),r.isCutout=
null,u.baseColorTexture=r;m.roughnessTexture&&(u.roughnessTexture=e.load(WALK.LOAD_PRIORITY.SPECULARITY,m.roughnessTexture,!0,!0,WALK.DEFAULT_ANISOTROPY));m.metallicTexture&&(u.metallicTexture=e.load(WALK.LOAD_PRIORITY.SPECULARITY,m.metallicTexture,!0,!0,WALK.DEFAULT_ANISOTROPY));m.bumpTexture&&h.standardDerivatives&&(u.bumpTexture=e.load(WALK.LOAD_PRIORITY.SPECULARITY,m.bumpTexture,!0,!0,WALK.DEFAULT_ANISOTROPY));m.doNotImport&&WALK.copyProperties(m.doNotImport,d,u.doNotImport);m.chromaKeyColor&&
(u.chromaKeyColor.fromArray(m.chromaKeyColor),u.chromaKeyColor.roundChannels());m.chromaKeyDelta&&u._chromaKeyDelta.fromArray(m.chromaKeyDelta)}m=u;if(!f.isMaterialEditable(m.name)){u=m.hash();r=p.get(u)||[];for(var x=$jscomp.makeIterator(r),t=x.next();!t.done;t=x.next())if(t=t.value,t.canMerge(m)){l+=1;t.merged=!0;m=t;break}m.merged||(r.push(m),p.set(u,r))}n.addMaterial(m);m.merged||m.setUniforms()}WALK.log("Have "+k.length+" materials and "+(k.length-l)+" merged materials.")}}})();(function(){WALK.SkyLoader=function(a){function b(a,b,c){var d=new THREE.SphereBufferGeometry(1,64,64);return new WALK.SkyMesh(a,d,b,c)}function c(a){var c=new WALK.ProceduralSkyMaterial;return b(a.name,c,a.center)}this.loadSkyTexture=function(b,c){b.material.map&&b.material.map.dispose();b.material.map=a.load(WALK.LOAD_PRIORITY.SKY,c,!1,!1,WALK.NO_ANISOTROPY);b.yawRotationDeg=0};this.loadSingleSky=function(d,e){if("procedural"===d.type||void 0===d.type)d=c(d);else if("equirect"===d.type){var g=new WALK.EquirectSkyMaterial;
g.map=a.load(WALK.LOAD_PRIORITY.SKY,d.texture,!1,!1,WALK.NO_ANISOTROPY);g=b(d.name,g,d.center);g.geometry.applyMatrix((new THREE.Matrix4).makeScale(1,1,-1));g.rotation.x=Math.PI/2;g.yawRotationDeg=d.yawRotation||0;d=g}else console.warn("Unknown sky type: ",d.type),d=c(d);e.addSkyMesh(d)};this.load=function(a,b){this.loadSingleSky({name:WALK.DEFAULT_SKY_NAME,type:"procedural"},b);for(var c=0;c<a.length;c+=1)this.loadSingleSky(a[c],b)}}})();(function(){WALK.LightmapLoader=function(a,b){function c(){--e;if(0===e)d.onComplete()}var d=this,e=b;this.lightmaps=[];this.onComplete=null;this.load=function(){for(var d={id:null,name:null,stdExt:"png",webFormats:["large/std"],alpha:!0,rgbm:!0},e=0;e<b;e+=1){d.id=d.name="lightmap-rgbm"+e;var h=a.load(WALK.LOAD_PRIORITY.LIGHTMAP,d,!1,!1,WALK.NO_ANISOTROPY);h.addLoadedListener(c);this.lightmaps.push(h)}}}})();(function(){WALK.TextureAtlasLoader=function(a){this.atlases={};this.load=function(b){for(var c=0;c<b.length;++c){var d=a.load(WALK.LOAD_PRIORITY.DIFFUSE,b[c],!1,!0,WALK.DEFAULT_ANISOTROPY);d.flipY=!1;d.enableAtlas();this.atlases[b[c].id]=d}}}})();(function(){WALK.BufferLoader=function(a,b){var c={};this.onHaveBuffer=this.onFailure=this.onProgress=null;this._buffersDone={};this.buffers={meshes:null,transforms:null,bounds:null,faces16:null,faces:null,vertices:null,normals:null,uvs0:null,uvs1:null};this.haveAllBuffers=function(){for(var a in this.buffers)if(this.buffers.hasOwnProperty(a)&&null===this.buffers[a])return!1;return!0};this.haveCoreBuffers=function(){var a=this.buffers;return a.faces16&&a.faces&&a.vertices&&a.normals&&a.transforms};
this.releaseCoreBuffers=function(){var a=this.buffers;a.faces16=a.faces=a.vertices=a.normals=null};this.load=function(){function d(a){return function(b){g.buffers[a]=b;g.onHaveBuffer()}}function e(a){return function(b){c[a]=b.loaded;g.onProgress()}}var g=this,f=WALK.LOAD_PRIORITY.CORE_RESOURCE,h={meshes:f,transforms:f,bounds:f,faces16:f,faces:f,vertices:f,normals:f,uvs0:b?f:WALK.LOAD_PRIORITY.UV0,uvs1:b?f:WALK.LOAD_PRIORITY.LIGHTMAP};(function(){for(var b in g.buffers)if(g.buffers.hasOwnProperty(b)){var c=
h[b];console.assert(void 0!==c);WALK.queueAjaxGet(c,a+b+".buf",!0,d(b),g.onFailure,e(b))}})()};this.totalDone=function(){var a=0,b;for(b in c)c.hasOwnProperty(b)&&(a+=c[b]);return a}}})();(function(){function a(a,b,e){var c=new Int32Array(a);a=new Float32Array(a);var d=new Float32Array(b),h={},k=c[0],n=c[1],p=2;for(b=0;p<c.length;){var l={nodeId:c[p],materialIdx:c[p+1],useFaces16:1===c[p+2],faceByteOffset:c[p+3],faceCnt:c[p+4],vertexByteOffset:c[p+5],vertexCnt:c[p+6],normalByteOffset:c[p+7],uv0ByteOffset:c[p+8],uv1ByteOffset:c[p+9],lightMapIdx:c[p+10],uv1CoordUScale:a[p+11],uv1CoordVScale:a[p+12],uv1CoordUOffset:c[p+13],uv1CoordVOffset:c[p+14],transformByteOffset:c[p+15],boundsByteOffset:c[p+
16],quantVertexRange:a[p+17],quantVertexMax:c[p+18],quantUv0Range:a[p+19],quantUv0Max:c[p+20],autoLightmapResolution:2<=k?c[p+21]:-1,useInstances:!1,hasCopies:!1,isMasterCopy:!1};l.boundingBox=new THREE.Box3;l.boundingSphere=new THREE.Sphere;a:{for(var q=l.boundingBox,r=l.boundingSphere,m=l.boundsByteOffset/4,u=0;6>u;++u)if(!isFinite(d[m+u]))break a;q.max.x=d[m];q.max.y=d[m+1];q.max.z=d[m+2];q.min.x=d[m+3];q.min.y=d[m+4];q.min.z=d[m+5];q.center(r.center);r.radius=d[m+6]}b=Math.max(b,l.lightMapIdx+
1);WALK.DETECTOR.instances&&(q=l.vertexByteOffset,h.hasOwnProperty(q)?(q=h[q],r=q[0],r.isMasterCopy=!0,r.hasCopies=!0,l.hasCopies=!0,q.push(l)):h[q]=[l]);e.push(l);p+=n}e=$jscomp.makeIterator(Object.values(h));for(c=e.next();!c.done;c=e.next())if(c=c.value,a=c.length,1<a&&500<a*c[0].faceCnt)for(c=$jscomp.makeIterator(c),a=c.next();!a.done;a=c.next())a.value.useInstances=!0;return b}var b=function(a,b,e,g,f){this.meshPropsSet=new Set;this.meshPropsSet.add(a);this.material=b;this.lightMap=e;this.lightProbe=
g;this.hideInViews=f;this.anyLogicalMeshHasUvs=-1!==a.uv0ByteOffset;this.sharedGeometryId=a.useInstances?a.vertexByteOffset:null};b.prototype.canUseLightMap=function(a){return null===this.lightMap||null===a||this.lightMap===a};WALK.MeshMaker=function(c,d,e,g){function f(a){var d=[],e=new Map;k.forEach(function(f){var g=c.findNode(f.nodeId),k=c.materials[f.materialIdx],h=null;null!==g.initialLightProbeId&&(h=c.findLightProbe(g.initialLightProbeId));var m=null;-1!==f.lightMapIdx&&(m=a[f.lightMapIdx]);
var l=g.hideInViews||[];if(g.editable||1!==k.opacity)d.push(new b(f,k,m,h,l));else{var q=f.useInstances?f.vertexByteOffset:null;g=e.get(k)||[];for(var n=$jscomp.makeIterator(g),r=n.next();!r.done;r=n.next()){r=r.value;var p;if(p=r.lightProbe===h&&r.canUseLightMap(m)&&r.sharedGeometryId===q)a:if(p=r.hideInViews,p.length!==l.length)p=!1;else{for(var I=0;I<p.length;I+=1)if(p[I]!==l[I]){p=!1;break a}p=!0}if(p){null!==m&&(r.lightMap=m);r.anyLogicalMeshHasUvs=r.anyLogicalMeshHasUvs||-1!==f.uv0ByteOffset;
r.meshPropsSet.add(f);return}}f=new b(f,k,m,h,l);g.push(f);e.set(k,g);d.push(f)}});return d}var h=this,k=[],n=d.byteLength,p=0;this.mergedMeshes=[];this.lightmapCount=this.geometryDownloadSize=this.coreGeometryDownloadSize=0;this.createMeshes=function(a){var b=a?a[0]:null,d=f(a);a={};d=$jscomp.makeIterator(d);for(var e=d.next();!e.done;e=d.next()){var k=e.value;e=k.sharedGeometryId;if(null!==e){var h=a[e],l=!1;h||(h=new WALK.Geometry,l=!0,a[e]=h);e=new WALK.InstancedGeometry(h,l)}else e=new WALK.Geometry;
h=new WALK.MergedMesh(e,k.material);h.lightProbe=k.lightProbe;h.lightMap=k.lightMap||b;h.hideInViews=k.hideInViews;h.anyLogicalMeshHasUvs=k.anyLogicalMeshHasUvs;this.mergedMeshes.push(h);k=$jscomp.makeIterator(k.meshPropsSet);for(l=k.next();!l.done;l=k.next()){l=l.value;var n,w=e;if(g){var z=3*l.faceCnt;var A=l.vertexCnt}else z=0,A=3*l.faceCnt;if(w.isInstanced)var y=n=0;else n=w.indexCnt,y=w.vertexCnt;y=new WALK.SubGeometry(z,A,w,n,y,l.boundingBox,l.boundingSphere);w.boundingBox.union(l.boundingBox);
WALK.Math.spheresUnion(l.boundingSphere,w.boundingSphere);w.isInstanced?(y.instanceId=w.instanceCount,w.instanceCount+=1,w.indexCnt=z,w.vertexCnt=A):(w.indexCnt+=z,w.vertexCnt+=A);z=y;A=c.findNode(l.nodeId);z=new WALK.Mesh(A,z,h.material);z.lightMap=h.lightMap;z.lightProbe=h.lightProbe;z.autoLightmapResolution=l.autoLightmapResolution;z.useFaces16=l.useFaces16;z.faceByteOffset=l.faceByteOffset;z.faceCnt=l.faceCnt;z.vertexByteOffset=l.vertexByteOffset;z.vertexCnt=l.vertexCnt;z.normalByteOffset=l.normalByteOffset;
z.uv0ByteOffset=l.uv0ByteOffset;z.uv1ByteOffset=l.uv1ByteOffset;z.lightMapIdx=l.lightMapIdx;z.uv1CoordUScale=l.uv1CoordUScale;z.uv1CoordVScale=l.uv1CoordVScale;z.uv1CoordUOffset=l.uv1CoordUOffset;z.uv1CoordVOffset=l.uv1CoordVOffset;z.transformByteOffset=l.transformByteOffset;z.quantVertexRange=l.quantVertexRange;z.quantVertexMax=l.quantVertexMax;z.quantUv0Range=l.quantUv0Range;z.quantUv0Max=l.quantUv0Max;l.hasCopies&&(z.sharedBuffersDebug=l.isMasterCopy?1:2);p+=1;h.addLogicalMesh(z);A.mesh=z}}WALK.log("Have "+
p+" meshes and "+this.mergedMeshes.length+" merged meshes.")};this.lightmapCount=a(d,e,k);d=e=null;(function(){for(var a=0,b=0,c=0,d=0,e=0,f=0,g=0,p=$jscomp.makeIterator(k),w=p.next();!w.done;w=p.next()){w=w.value;var z=w.vertexCnt;a=Math.max(a,w.faceByteOffset+3*w.faceCnt*(w.useFaces16?2:4));b=Math.max(b,w.vertexByteOffset+3*z*WALK.Math.minBytesToHold(w.quantVertexMax)+3&-4);c=Math.max(c,w.normalByteOffset+2*z);d=Math.max(d,w.transformByteOffset+64);e=Math.max(e,w.boundsByteOffset+28);-1!==w.uv0ByteOffset&&
(f=Math.max(f,w.uv0ByteOffset+2*z*WALK.Math.minBytesToHold(w.quantVertexMax)+3&-4));-1!==w.uv1ByteOffset&&(g=Math.max(g,w.uv1ByteOffset+4*z))}h.coreGeometryDownloadSize=n+a+b+c+d+e;h.geometryDownloadSize+=h.coreGeometryDownloadSize+f+g})()}})();(function(){function a(a,b,c,d,e,f,g){var k=0;for(c*=3;k<c;k+=3){var h=a[k+b]*e,l=a[k+b+1]*e,m=a[k+b+2]*e;f[g+k]=d[0]*h+d[1]*l+d[2]*m+d[3];f[g+k+1]=d[4]*h+d[5]*l+d[6]*m+d[7];f[g+k+2]=d[8]*h+d[9]*l+d[10]*m+d[11]}}function b(a,b,c,d,e,f){var g=0;for(c*=2;g<c;g+=2){var k=(a[g+b]/254+.5)*Math.PI,h=Math.PI/127*a[g+b+1],l=Math.sin(k),m=l*Math.cos(h);h=l*Math.sin(h);k=Math.cos(k);l=d[0]*m+d[1]*h+d[2]*k;var q=d[4]*m+d[5]*h+d[6]*k;k=2*(Math.acos(d[8]*m+d[9]*h+d[10]*k)/Math.PI-.5);h=Math.atan2(q,l)/Math.PI;
e[f+g]=WALK.Math.toSnorm8(k);e[f+g+1]=WALK.Math.toSnorm8(h)}}function c(a){return 0!==a.instanceId||!1===a.parent.ownsGpuBuffers}function d(a,b,c,d,e,f,g,k,h){var l=0;for(c*=2;l<c;l+=2){var m=a[l+b],q=a[l+b+1];0!==m||0!==q?(k[h+l]=Math.round(m*d)+f,k[h+l+1]=Math.round(q*e)+g):(k[h+l]=0,k[h+l+1]=0)}}function e(a,b,c,d,e){function f(){for(;k<a.length;){var l=a[k];if(0!==h||b(l)){for(;h<l.logicalMeshes.length;){var m=l.logicalMeshes[h];c(m);h+=1;if(g.shouldInterrupt(m.vertexCnt)){setTimeout(f,0);return}}d(l);
k+=1;h=0}else k+=1}e()}var g=new l(5E4),k=0,h=0;f()}function g(a,b){b.geometry.allocateCoreBuffers(a);return!0}function f(a,b){a?a=b.anyLogicalMeshHasUvs:(a=b.material,a=b.anyLogicalMeshHasUvs&&(a.baseColorTexture||a.bumpTexture||a.roughnessTexture||a.metallicTexture));return a?(b.geometry.allocateUv0(),!0):!1}function h(a){return a.lightMap?(a.geometry.allocateUv1(),!0):!1}function k(a,b,c,d,e){var f=4*e.instanceId;e=e.parent.uvs1Mod;e[f]=c/65535;e[f+1]=d/65535;e[f+2]=a/65535;e[f+3]=b/65535}function n(a,
b){var c=b.parent;b=4*b.instanceId;var d=c.transforms0;d[b]=a[0];d[b+1]=a[1];d[b+2]=a[2];d[b+3]=a[3];d=c.transforms1;d[b]=a[4];d[b+1]=a[5];d[b+2]=a[6];d[b+3]=a[7];c=c.transforms2;c[b]=a[8];c[b+1]=a[9];c[b+2]=a[10];c[b+3]=a[11]}var p=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0]),l=function(a){this.minVerticesUntilTimeCall=a;this.verticesCount=0;this.timer=new WALK.Timer};l.prototype.shouldInterrupt=function(a){this.verticesCount+=a;return this.verticesCount>this.minVerticesUntilTimeCall&&10<this.timer.elapsedMSec()?
(this.verticesCount=0,this.timer.reset(),!0):!1};WALK.asyncFillIndexedUv0=function(a,b,d,g,k){var h=new Uint16Array(a),l=new Float32Array(a);e(b,f.bind(null,d),function(a){if(a.uv0InBuffers()){var b=a.geometry;if(!c(b)){var d=b.vertexOffset,e=b.parent;if(a.quantUv0Disabled()){b=a.uv0ByteOffset/4;var f=e.uvs0;e=0;for(a=2*a.vertexCnt;e<a;e+=1)f[2*d+e]=l[e+b]}else{b=a.uv0ByteOffset/2;f=a.quantUv0Factor();e=e.uvs0;var g=0;for(a=2*a.vertexCnt;g<a;g+=1)e[2*d+g]=h[g+b]*f}}}},g,k)};WALK.asyncFillIndexedUv1=
function(a,b,f,g){var l=new Uint16Array(a);e(b,h,function(a){if(a.uv1InBuffers()){var b=a.uv1CoordUScale,e=a.uv1CoordVScale,f=a.uv1CoordUOffset,g=a.uv1CoordVOffset,h=a.geometry;if(h.isInstanced){k(b,e,f,g,h);if(c(h))return;b=e=1;f=g=0}d(l,a.uv1ByteOffset/2,a.vertexCnt,b,e,f,g,h.parent.uvs1,2*h.vertexOffset)}},f,g)};WALK.asyncFillIndexedCoreGeometry=function(d,f,k,h){var l=d.faces16?new Uint16Array(d.faces16):null,m=d.faces?new Uint32Array(d.faces):null,q=new Int8Array(d.vertices),r=new Int16Array(d.vertices),
u=new Int32Array(d.vertices),A=new Int8Array(d.normals);e(f,g.bind(null,!0),function(e){var f=e.geometry,g=f.parent,k=new Float32Array(d.transforms,e.transformByteOffset,16);if(f.isInstanced){n(k,f);if(c(f))return;k=p}switch(WALK.Math.minBytesToHold(e.quantVertexMax)){case 1:var h=q;var t=e.vertexByteOffset;break;case 2:h=r;t=e.vertexByteOffset/2;break;case 4:h=u,t=e.vertexByteOffset/4}var v=f.vertexOffset;a(h,t,e.vertexCnt,k,e.quantVertexFactor(),g.vertices,3*v);b(A,e.normalByteOffset,e.vertexCnt,
k,g.normals,2*v);g=g.index;f=f.indexOffset;e.useFaces16?(t=e.faceByteOffset/2,k=l):(t=e.faceByteOffset/4,k=m);h=t;for(e=t+3*e.faceCnt;h<e;h+=1,f+=1)g[f]=k[h]+v},k,h)};WALK.asyncFillNotIndexedGeometry=function(l,r,m,u,x){var q=l.faces16?new Uint16Array(l.faces16):null,v=l.faces?new Uint32Array(l.faces):null,w=new Int8Array(l.vertices),z=new Int16Array(l.vertices),A=new Int32Array(l.vertices),y=new Int8Array(l.normals),E=new Uint16Array(l.uvs0),I=new Float32Array(l.uvs0),O=l.uvs1?new Uint16Array(l.uvs1):
null;e(r,function(a){g(!1,a);f(m,a);h(a);return!0},function(e){var f=e.geometry,g=e.geometry.parent,h=new Float32Array(l.transforms,e.transformByteOffset,16);if(e.uv0InBuffers()&&g.uvs0)var m=g.uvs0;if(e.uv1InBuffers()&&g.uvs1){var r=g.uvs1;var u=e.uv1CoordUScale;var t=e.uv1CoordVScale;var x=e.uv1CoordUOffset;var J=e.uv1CoordVOffset}if(f.isInstanced){n(h,f);r&&k(u,t,x,J,f);if(c(f))return;h=p;u=t=1;x=J=0}if(e.useFaces16){f=q;var L=e.faceByteOffset/2}else f=v,L=e.faceByteOffset/4;switch(WALK.Math.minBytesToHold(e.quantVertexMax)){case 1:var K=
w;var M=e.vertexByteOffset;break;case 2:K=z;M=e.vertexByteOffset/2;break;case 4:K=A,M=e.vertexByteOffset/4}var R=e.quantUv0Disabled();if(R)var F=e.uv0ByteOffset/4;else{var P=e.quantUv0Factor();F=e.uv0ByteOffset/2}var V=3*e.geometry.vertexOffset,aa=2*e.geometry.vertexOffset,U=e.quantVertexFactor(),X=g.vertices;g=g.normals;var S=e.normalByteOffset,da=e.uv1ByteOffset/2,ba=L;for(e=L+3*e.faceCnt;ba<e;ba+=1,V+=3,aa+=2){L=f[ba];a(K,M+3*L,1,h,U,X,V);b(y,S+2*L,1,h,g,aa);if(m){var ea=F+2*L;if(R)for(var ia=
m,la=aa,fa=0;2>fa;fa+=1)ia[la+fa]=I[fa+ea];else{ia=P;la=m;fa=aa;for(var ha=0;2>ha;ha+=1)la[fa+ha]=E[ha+ea]*ia}}r&&d(O,da+2*L,1,u,t,x,J,r,aa)}},u,x)}})();(function(){function a(a,b){a.forEach(function(a){b.addView(new WALK.View(a))})}function b(a,b,c){a.forEach(function(a){c.isNodeTypeEditable(a.name)&&(a.editable=!0);b.addNodeConfig(new WALK.NodeConfig(a))})}function c(a,b){a.forEach(function(a){var c=new WALK.Light(a);a=a.instances;for(var d=0;d<a.length;d+=1){var e=a[d];c.addInstance(e.position,e.rotation)}b.addLight(c)})}function d(a,b){a.forEach(function(a){b.addLightProbe(new WALK.LightProbe(a))})}function e(a,b,c){c=c.camera;a&&(c.defaultFov=
a.fov,a.exposure&&(c.defaultExposure=a.exposure),a.gamma&&(c.defaultGamma=a.gamma),a.lutTexture&&(b=b.load(WALK.LOAD_PRIORITY.COLORMAP,a.lutTexture,!1,!1,WALK.NO_ANISOTROPY),b.flipY=!1,c.colorMap=b),c.autoClimb=!!a.autoClimb,c.autoExposure=!!a.autoExposure,void 0!==a.autoExposureDarkness&&(c.autoExposureDarkness=a.autoExposureDarkness),a.moveMaxSpeed&&(c.moveMaxSpeed=a.moveMaxSpeed),c.updateProjectionMatrix())}function g(a,b){function c(a,d){var e=b.findNodeConfig(d.config),f=new WALK.Node(a,e,d);
void 0!==d.children&&(f.children=d.children.map(function(a){return c(f,a)}));return f}a.forEach(function(a){b.addNode(c(null,a))})}function f(){WALK.USER_MSG.error("Scene failed to load. Reload the page to retry.")}WALK.SceneLoader=function(h,k,n,p){var l=!n&&WALK.DETECTOR.indexUint,q=!n&&!WALK.DEBUG_SHARED_BUFFERS,r=new WALK.Timer;this.onComplete=this.onReadyToDisplay=this.onTextureLoaded=this.onMeshBuffersLoaded=this.onProgress=null;this.panoramas=[];this.load=function(){function m(){if(void 0!==
F.total)Q.onProgress(F)}function u(){D||(D=!0,Q.onReadyToDisplay(h))}function x(a){0===a.name.indexOf("lightmap-rgbm")?F.texturesDone+=12582912:F.texturesDone+=524288;m();Q.onTextureLoaded(a);P()}function t(){console.warn("Failed to load video texture");P()}function v(){if(0===C.texturesToLoad&&L){C.clearCache();for(var a=0,b=$jscomp.makeIterator(H.mergedMeshes),c=b.next();!c.done;c=b.next())a+=c.value.geometry.gpuSize;WALK.log("Total GPU geometry buffers size "+a+" bytes");C=B=H=null;WALK.defer(function(){u();
Q.onComplete(h)})}}function w(){W&&J&&N&&(P=v,R&&h.materials.forEach(function(a){a.lightMapped||(a.lightMapped=!0,a.setUniforms())}),P())}function z(a){a.geometry.addUv1Attribute();Q.onMeshBuffersLoaded(a)}function A(){B.buffers.uvs1&&(P=w,WALK.asyncFillIndexedUv1(B.buffers.uvs1,H.mergedMeshes,z,function(){B.buffers.uvs1=null;W=!0;P()}))}function y(a){a.geometry.addUv0Attribute();Q.onMeshBuffersLoaded(a)}function E(){B.buffers.uvs0&&(P=A,WALK.asyncFillIndexedUv0(B.buffers.uvs0,H.mergedMeshes,n,y,
function(){B.buffers.uvs0=null;L=!0;P()}))}function I(){N=!0;0===h.views.length&&h.addView(new WALK.View({id:0,name:"Start place",hideFromMenu:!0,position:h.center.toArray(),rotation:[0,0],internal:!0,sky:WALK.EDITOR_CONTROLLED_SKY_NAME}));if(!n&&!h.disableProgressiveLoader){var a=1E3*WALK.PROGRESSIVE_LOADER_AFTER_SEC-r.elapsedMSec();0>=a?u():setTimeout(u,a)}P()}function O(a){h.addGpuMesh(a)}function K(a){a.geometry.addCoreAttributes();var b=a.logicalMeshes;console.assert(!b[0].node.editable||1===
b.length);b[0].node.editable||!q?b.forEach(O):O(a);Q.onMeshBuffersLoaded(a)}function T(a){a.geometry.uvs0&&a.geometry.addUv0Attribute();a.geometry.uvs1&&a.geometry.addUv1Attribute();K(a)}function Y(){if(l){if(!B.haveCoreBuffers())return;WALK.log("Using indexed geometry");P=E;WALK.asyncFillIndexedCoreGeometry(B.buffers,H.mergedMeshes,K,I)}else{if(!B.haveAllBuffers())return;P=w;WALK.asyncFillNotIndexedGeometry(B.buffers,H.mergedMeshes,n,T,function(){W=L=!0;I()})}B&&B.releaseCoreBuffers()}var Q=this,
C=null,B=null,H=null,N=!1,D=!1,J=!1,L=!1,W=!1,M=null,R=!1,F={total:void 0,texturesDone:0,totalDone:function(){return this.texturesDone+B.totalDone()}};r.reset();var P=function(){if(M&&B.buffers.meshes&&B.buffers.bounds){P=Y;void 0!==M.autoAddLightProbes&&(h.autoAddLightProbes=M.autoAddLightProbes);h.disableProgressiveLoader=M.disableProgressiveLoader||!1;void 0!==M.autoTour&&(h.autoTour.disabled=M.autoTour.disabled||!1,h.autoTour.startOnLoad=M.autoTour.startOnLoad||!1);c(M.lights,h);d(M.lightProbes||
[],h);M.cameraVolumes&&M.cameraVolumes.forEach(function(a){return h.addCameraVolume(new WALK.CameraVolume(a))});C=new WALK.TextureLoader(k,WALK.DETECTOR,x,f,t,!1);e(M.camera,C,h);var m=new WALK.TextureAtlasLoader(C);m.load(M.atlases||[]);(new WALK.MaterialLoader(C,m.atlases,p)).load(M.materials||[],h);(new WALK.SkyLoader(C)).load(M.skies||[],h);null===h.findSkyMesh(WALK.EDITOR_CONTROLLED_SKY_NAME)&&console.error("A sky with name "+WALK.EDITOR_CONTROLLED_SKY_NAME+" is missing.");a(M.views||[],h);M.hideViewsMenu&&
(h.hideViewsMenu=!0);b(M.nodeConfigs,h,p);g(M.nodes,h);H=new WALK.MeshMaker(h,B.buffers.meshes,B.buffers.bounds,l);m=null;if(0!==H.lightmapCount){R=!0;var n=new WALK.LightmapLoader(C,H.lightmapCount);n.onComplete=function(){J=!0;P()};n.load();m=n.lightmaps;n=null}else J=!0;H.createMeshes(m);F.total=H.geometryDownloadSize+524288*(C.texturesToLoad-H.lightmapCount)+12582912*H.lightmapCount;M.panoramas&&(Q.panoramas=M.panoramas);M=null;P()}};WALK.queueAjaxGet(WALK.LOAD_PRIORITY.CORE_RESOURCE,k+"scene.json",
!1,function(a){M=a;P()},f);B=new WALK.BufferLoader(k,!l);B.onProgress=m;B.onFailure=f;B.onHaveBuffer=function(){P()};B.load()};this.elapsedLoadTimeSec=function(){return r.elapsedSec()}}})();(function(){function a(a,d,e,g){for(var c=[],h=0;6>h;h+=1){var k=g?new THREE.OrthographicCamera(-1,1,1,-1,a,d):new THREE.PerspectiveCamera(90,1,a,d);e.add(k);c.push(k)}c[0].up.set(0,-1,0);b.set(1,0,0);c[0].lookAt(b);c[1].up.set(0,-1,0);b.set(-1,0,0);c[1].lookAt(b);c[2].up.set(0,0,1);b.set(0,1,0);c[2].lookAt(b);c[3].up.set(0,0,-1);b.set(0,-1,0);c[3].lookAt(b);c[4].up.set(0,-1,0);b.set(0,0,1);c[4].lookAt(b);c[5].up.set(0,-1,0);b.set(0,0,-1);c[5].lookAt(b);return c}var b=new THREE.Vector3;WALK.CubeCamera=
function(b,d){THREE.Object3D.call(this);this.sideCameras=a(b,d,this,!1)};WALK.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);WALK.CubeCamera.prototype.constructor=WALK.CubeCamera;WALK.OrthoCubeCamera=function(b,d){THREE.Object3D.call(this);this.sideCameras=a(b,d,this,!0)};WALK.OrthoCubeCamera.prototype=Object.create(THREE.Object3D.prototype);WALK.OrthoCubeCamera.prototype.constructor=WALK.OrthoCubeCamera})();(function(){WALK.CubeMapFilterShader={uniforms:{gloss:{type:"f",value:.9},face:{type:"f",value:0},mipSize:{type:"f",value:128},envMap:{type:"t",value:null}},vertexShader:WALK.getShader("cubemap_filter_vertex.glsl"),fragmentShader:WALK.getShader("cubemap_filter_fragment.glsl")}})();(function(){function a(a,b){b=b.target;a.deleteTexture(b.__webglTexture);b.__webglTexture=null;b.image=null}function b(a,b,c){for(var d=!0;d;){a.readPixels(b,b,c);for(var e=0;e<b*b*4;e+=4)if(0!==c[e]||0!==c[e+1]||0!==c[e+2]){d=!1;break}if(d){console.warn("Cube face has all pixels black.");break}}}function c(a,b){var c=new Set;a.traverse(function(a){if(a instanceof THREE.Mesh&&a.visible){var d=a.material;a.userData.hideFromLightProbes||d.hideFromLightProbes?(b.add(a),a.visible=!1):c.has(d)||(c.add(d),
d.configureTransparency&&(d.transparent=!1,d.blending=THREE.NoBlending,d.depthWrite=!0),void 0!==d.hdrOutput&&(d.hdrOutput=!0),void 0!==d.specularOff&&(d.specularOff+=1))}});c=null}function d(a,b){var c=new Set;a.traverse(function(a){if(a instanceof THREE.Mesh){var d=a.material;d.forceObjectUniformsRefresh&&d.forceObjectUniformsRefresh();a.visible?c.has(d)||(c.add(d),void 0!==d.hdrOutput&&(d.hdrOutput=!1),d.configureTransparency&&d.configureTransparency(),void 0!==d.specularOff&&--d.specularOff):
b.has(a)&&(a.visible=!0)}});c=null}function e(a,b){var c={format:GLC.RGBA,magFilter:GLC.LINEAR,minFilter:GLC.LINEAR,stencilBuffer:!1,generateMipmaps:!1};this.renderer=a;this.scene=b;this.threeScene=b.threeScene;this.aabbQueryMaterial=new WALK.AabbQueryMaterial;this.filterPass=new THREE.ShaderPass(WALK.CubeMapFilterShader,"envMap");b=WALK.LIGHT_PROBE_MAX_MIP_SIZE;this.pixelBuf=new Uint8Array(b*b*4);this.targetCubeRaw=a.createRenderTargetCube(b,b,c);c.depthBuffer=!1;this.targetFiltered=a.createRenderTarget(b,
b,c);this.autoClearAlter=new WALK.AutoClearAlter(a);this.dispose=function(){this.targetCubeRaw.dispose();this.targetFiltered.dispose();this.aabbQueryMaterial.dispose();this.filterPass.material.dispose();this.pixelBuf=null}}function g(a,b){var c=b.geometry.boundingSphere.center;if(null===b.lightProbe||c.distanceTo(a.position)<c.distanceTo(b.lightProbe.position))b.lightProbe=a}function f(a,b){for(var c=0;c<b.length;c+=1)g(a,b[c])}function h(a,b){WALK.log("No visible light probe found for "+b.length+
" objects. Assigning the closest ones.");for(var c=0;c<b.length;c+=1)for(var d=0;d<a.length;d+=1)g(a[d],b[c])}var k=function(){var a=null;return function(b,c){var d=null,e=0;c*=c;console.assert(c<Math.pow(2,16));null===a&&(a=new Uint16Array(65536));for(var f=0;f<4*c;f+=4)a[256*b[f]+b[f+1]]+=1;a[0]>.7*c&&(e=a[0]);a[0]=0;for(b=1;b<a.length;b+=1)a[b]>e&&(e=a[b],d=Math.floor(b/256)+b%256/255),a[b]=0;return d}}(),n=function(){var a=null;return function(c,d,e){var f=c.renderer,g=c.aabbQueryMaterial,h=c.pixelBuf,
l=c.targetCubeRaw;null===a&&(a=new WALK.OrthoCubeCamera(.01,255));a.position.copy(d.position);a.updateMatrixWorld();var n;for(n=0;6>n;n+=1){l.activeCubeFace=n;g.axis=Math.floor(n/2);f.renderMeshes(c.scene.gpuMeshes,g,a.sideCameras[n],l);b(f,l.width,h);var p=k(h,l.width);if(null===p){WALK.log("failed to find light probe bound");break}switch(n){case 0:e.boxMax.x=d.position.x+p;break;case 1:e.boxMin.x=d.position.x-p;break;case 2:e.boxMax.y=d.position.y+p;break;case 3:e.boxMin.y=d.position.y-p;break;
case 4:e.boxMax.z=d.position.z+p;break;case 5:e.boxMin.z=d.position.z-p}}6!==n&&(WALK.log("Light probe bounds: X["+e.boxMin.x.toFixed(2)+":"+e.boxMax.x.toFixed(2)+"] Y["+e.boxMin.y.toFixed(2)+":"+e.boxMax.y.toFixed(2)+"] Z["+e.boxMin.z.toFixed(2)+":"+e.boxMax.z.toFixed(2)+"]"),e.resetBoundingBox())}}();e.prototype.constructor=e;WALK.LightProbeMaker=function(g,k,q,r,m){function l(c,d){z.position.copy(c.position);z.updateMatrixWorld();var e;if((e=r)&&!(e=m))a:{e=g.gpuMeshes;for(var f=0;f<e.length;f+=
1){var k=e[f];if(k.lightProbe===c&&k.material.envMapMirror){e=!0;break a}}e=!1}(f=e)&&WALK.log("Mirror texture needed for the light probe.");w.reset();e=v.renderer;v.autoClearAlter.set(!0,!0,!1);if(f){f=v.renderer;var h=WALK.LIGHT_PROBE_MIRROR_SIZE;h=f.createRenderTargetCube(h,h,{format:GLC.RGBA,magFilter:GLC.LINEAR,minFilter:GLC.LINEAR,stencilBuffer:!1,generateMipmaps:!1});for(k=0;6>k;k+=1)h.activeCubeFace=k,f.render(v.threeScene,z.sideCameras[k],h);f=f.context;k=new WALK.Texture;k.minFilter=GLC.LINEAR;
k.generateMipmaps=!1;k.needsUpdate=!1;k.isCube=!0;k.addEventListener("dispose",a.bind(void 0,f));k.__webglTexture=h.__webglTexture;h.__webglTexture=null;h.dispose();h=k;c.setMirrorTexture(h)}d&&n(v,z,c);d=v.renderer;f=v.targetCubeRaw;for(k=0;6>k;k+=1)f.activeCubeFace=k,d.render(v.threeScene,z.sideCameras[k],f);v.autoClearAlter.restore();e.enableScissorTest(!0);v.autoClearAlter.set(!1,!1,!1);q&&(h=e.createCubeTexture(v.targetFiltered.width,!0),c.setFilteredTexture(h));for(d=0;d<WALK.LIGHT_PROBE_MIPS_COUNT;d+=
1){f=d;f=Math.pow(2,WALK.log2(v.targetFiltered.width)-f);e.setScissor(0,0,f,f);v.filterPass.uniforms.mipSize.value=f;v.filterPass.uniforms.gloss.value=WALK.LIGHT_PROBE_GLOSS_FOR_MIP[d];q||(h=e.createCubeTexture(f,!1),c.setFilteredTextureNoLod(h,d));k=v.filterPass;var l=v.targetCubeRaw,p=v.targetFiltered,u=v.pixelBuf,t=q?d:0,x=h;if(WALK.DEBUG_LIGHT_PROBE_MIPS)for(var A=u,y=255*t/WALK.LIGHT_PROBE_MIPS_COUNT,D=0;D<4*f*f;D+=4)A[D]=y,A[D+1]=y,A[D+2]=y,A[D+3]=31.875;for(A=0;6>A;A+=1)WALK.DEBUG_LIGHT_PROBE_MIPS||
(k.uniforms.face.value=A,k.render(e,p,l),b(e,f,u)),e.copyBufferToCubeFaceMip(t,f,A,u,x)}e.enableScissorTest(!1);v.autoClearAlter.restore();WALK.log("Cube generation time "+w.elapsedSec())}var p,t=g.threeScene,v=new e(k,g),w=new WALK.Timer,z=new WALK.CubeCamera(.15,g.camera.far);this.assignLightProbesToObjects=function(){w.reset();void 0===p&&(p=new WALK.ObjectDistanceQuery(k,g.gpuMeshes,g.camera.far));for(var a=0;a<g.gpuMeshes.length;a+=1)g.gpuMeshes[a].lightProbe=null;for(a=0;a<g.lightProbes.length;a+=
1){var b=g.lightProbes[a],c=p.updateCubeMapAndFindVisibleObjects(b.position);WALK.log("Have visible objects "+c.length);f(b,c)}WALK.log("Light probe assigment time "+w.elapsedSec());h(g.lightProbes,WALK.filter(g.gpuMeshes,function(a){return null===a.lightProbe}))};this.findBounds=function(a){z.position.copy(a.position);z.updateMatrixWorld();v.autoClearAlter.set(!0,!0,!1);n(v,z,a);v.autoClearAlter.restore()};this.createLightProbeTexture=function(a,b){var e=new Set;c(t,e);l(a,b);d(t,e)};this.createAllLightProbeTextures=
function(){var a=new Set;c(t,a);for(var b=0;b<g.lightProbes.length;b+=1)l(g.lightProbes[b],!1);d(t,a)};this.dispose=function(){v.dispose();p&&p.dispose()}}})();(function(){function a(a){if(a.empty())return 0;a.size(d);return d.x*d.y*d.z}function b(a){if(a.empty())return 0;a.size(d);a=d.x*d.y;return 1>d.x||1>d.y||1.9>d.z||1.5>a?0:a*d.z}function c(c){var d=[],e=[];d.push(c);this.addFilledBox=function(a){e.push(a)};this.findBestFilledBoxes=function(){function b(a){return a[1]}function c(a){a=a[0];a=a.max.x<h.min.x+.2||a.min.x>h.max.x-.2||a.max.y<h.min.y+.2||a.min.y>h.max.y-.2||a.max.z<h.min.z+.2||a.min.z>h.max.z-.2?!1:!0;return!a}var d=[],f=[];for(e.forEach(function(b){f.push([b,
a(b)])});0<f.length&&10>d.length;){var g=WALK.indexOfMax(f,b);var h=f[g][0];d.push(h);f=f.filter(c)}return d};this.isEnclosedInFilledBox=function(a){return WALK.any(e,function(b){b=b.min.x-.1<=a.min.x&&a.max.x<=b.max.x+.1&&b.min.y-.1<=a.min.y&&a.max.y<=b.max.y+.1&&b.min.z-.1<=a.min.z&&a.max.z<=b.max.z+.1?!0:!1;return b})};this.findLargestEmptyBox=function(){var b=WALK.indexOfMax(d,a);return null!==b?d[b]:null};var h=function(){var a=[];a[0]=new THREE.Box3;a[1]=new THREE.Box3;a[2]=new THREE.Box3;a[3]=
new THREE.Box3;a[4]=new THREE.Box3;a[5]=new THREE.Box3;return function(c,d,e){a[0].max.copy(c.max);a[0].min.copy(c.min);a[0].min.z=d.max.z;a[1].max.copy(c.max);a[1].max.z=d.min.z;a[1].min.copy(c.min);a[2].max.copy(c.max);a[2].min.copy(c.min);a[2].min.x=d.max.x;a[3].max.copy(c.max);a[3].max.x=d.min.x;a[3].min.copy(c.min);a[4].max.copy(c.max);a[4].min.copy(c.min);a[4].min.y=d.max.y;a[5].max.copy(c.max);a[5].max.y=d.min.y;a[5].min.copy(c.min);var f=WALK.indexOfMax(a,b);0!==b(a[f])&&(e.push(a[f].clone()),
0===f?c.max.z=d.max.z:1===f?c.min.z=d.min.z:2===f?c.max.x=d.max.x:3===f?c.min.x=d.min.x:4===f?c.max.y=d.max.y:5===f&&(c.min.y=d.min.y),h(c,d,e))}}();this.split=function(a){for(var b=[],c=0;c<d.length;c+=1){var e=d[c];e.isIntersectionBox(a)?h(e,a,b):b.push(e)}d=b}}var d;WALK.arrangeLightProbes=function(e,g,f){function h(a){var b=new WALK.LightProbe({id:e.lightProbes.length});a.center(b.position);b.position.z=a.min.z+1.3;b.enableBoundingBox();b.boxMin.copy(a.min);b.boxMax.copy(a.max);e.lightProbes.push(b)}
var k=new c(e.boundingBox.clone()),n=new THREE.Box3,p=new THREE.Box3,l=new THREE.Vector3,q=new WALK.Timer;d=new THREE.Vector3;for(var r=new WALK.LightProbe({id:0}),m=0;200>m;m+=1){var u=k.findLargestEmptyBox();if(null===u)break;u.center(r.position);r.position.z=u.min.z+1.3;r.enableBoundingBox();p.makeEmpty();for(var x=0;5>x;x+=1){g.findBounds(r);if(!r.isBoundingBoxInitialized())break;n.set(r.boxMin,r.boxMax);var t=b(n);if(0===t)break;if(k.isEnclosedInFilledBox(n))break;n.center(l);l.z=n.min.z+1.3;
var v=r.position.distanceToSquared(l);a(p)<t&&.25>v&&p.set(n.min,n.max);if(.04>v)break;r.position.copy(l)}p.empty()?(u.center(n.min),u.center(n.max),k.split(n)):(k.addFilledBox(p.clone()),k.split(p))}WALK.log("Light probes arrangement time "+q.elapsedSec());g=k.findBestFilledBoxes();(g.reduce(function(b,c){return b+a(c)},0)>.2*a(e.boundingBox)||f)&&g.forEach(h);0===e.lightProbes.length&&f&&h(e.boundingBox)}})();/*
 Copyright (C) 2015-present Shapespark
*/
(function(){function a(a,b){a=document.getElementsByClassName(a);for(var c=0;c<a.length;c+=1)b(a[c])}function b(b){var c=[];a(b,function(a){c.push(a)});for(var d=0;d<c.length;d+=1)c[d].classList.remove(b)}function c(a,b){a.style.display=b?"":"none"}function d(a,b){c($(a),b)}function e(b,d){a(b,function(a){c(a,d)})}function g(a){c(a,!0);a.style.opacity=0;WALK.defer(function(){a.style.opacity=1})}function f(a){a.style.opacity=0;var b=window.getComputedStyle(a).transitionDuration;if(b){var d=parseFloat(b);
-1===b.indexOf("ms")&&(d*=1E3);setTimeout(function(){c(a,!1);a.style.opacity=1},d)}else c(a,!1),a.style.opacity=1}WALK.Menu=function(h,k,n,p,l){function q(a){return function(b){b.stopPropagation();a();WALK.DETECTOR.ios||$("walk-canvas").focus()}}function r(a,b){a.addEventListener("click",q(b))}function m(a,b){r($(a),b)}function u(a){if(a){var b=null===L?[]:L.visibleViews(),c;for(c=0;c<b.length&&b[c]!==a;c+=1);a=$("view-list-items").children;if(c<a.length)return a[c]}return null}function x(a){return function(){a.classList.remove("active-view");
a.classList.remove("next-active-view")}}function t(){for(var a=$("view-list-items").children,b=0;b<a.length;b+=1)a[b].classList.remove("active-view"),a[b].classList.remove("next-active-view")}function v(){$("tour-button").classList.add("tour-on")}function w(){$("tour-button").classList.remove("tour-on");t()}function z(){M.isRunning()?M.stop():M.start()}function A(){return M.isRunning()?(M.stop(),!0):!1}function y(a){t();(a=u(a.view))&&a.classList.add("next-active-view")}function E(a){if(a=u(a.view))a.classList.remove("next-active-view"),
a.classList.add("active-view"),setTimeout(x(a),WALK.AUTO_TOUR_IN_VIEW_STILL_TIME_MS)}function I(a){return q(function(){var b=A();W.switchToView(a,b?0:void 0)})}function O(){var a=$("info-bar"),b=$("info-bar-slide"),e=$("view-list"),f=$("view-list-slide"),g=$("menu-bar"),k=$("menu-bar-slide"),h=$("menu-bar-folder");c(h,L&&!aa);if(D.visible){a.style.pointerEvents=null;b.style.left=0;e.style.pointerEvents=null;f.style.top=0;g.style.pointerEvents=null;k.style.right=0;h.style.pointerEvents=null;h.children[0].style.transform=
"";if(null!==D.cover){g=D.cover.title;f=D.cover.author;h=D.cover.authorLogoUrl;k=D.cover.authorHref;e=D.cover.engineLogoOn;a=D.cover.engineLogoText;b=D.cover.engineLogoUrl;var l=$("author-logo");c(l,h);h&&(k&&(l.href=k),l.firstElementChild.src=h);h=null===L||null!==ba;d("info-text",h&&(g||f));h&&(WALK.setTextContent($("info-title"),g),WALK.setTextContent($("info-author"),f),k&&($("info-author").href=k));g=g?g:"3D scene";f&&(g+=" by "+f);document.title=g;f=$("engine-logo");c(f,e);e&&(a&&(e=$("engine-logo-text"),
c(e,!0),WALK.setTextContent(e,a)),b&&(f.href=b))}a=null===L?[]:L.visibleViews();b=$("view-list-items");d("view-list",0<a.length&&!aa);if(0<a.length){e=b.children[0];for(x(e)();1!==b.children.length;)b.removeChild(b.children[b.children.length-1]);for(f=0;f<a.length;f+=1)g=a[f],g.hideFromMenu||(WALK.setTextContent(e,g.name),e.onclick=I(g),b.appendChild(e),e=e.cloneNode(!0))}d("menu-buttons",L&&!aa);L&&L.canStartAutoTour()&&!U?d("tour-button",!0):(M&&M.isRunning()&&M.stop(),d("tour-button",!1))}else l=
$("menu-bar-content"),a.style.pointerEvents="none",b.style.left=-b.offsetWidth+"px",e.style.pointerEvents="none",f.style.top=-f.offsetHeight+"px",g.style.pointerEvents="none",h.style.pointerEvents="auto",k.style.right=-l.offsetWidth+"px",h.children[0].style.transform="rotate(180deg)";a=S&&!(U&&WALK.DETECTOR.mobile)&&!aa;WALK.DETECTOR.mobile?d("mobile-help",a):(d("desktop-help",a),S&&(a=$("desktop-help-switch"),b=$("desktop-help-content"),e=da?1:0,a.children[e].classList.add("selected"),c(b.children[e],
!0),a.children[1-e].classList.remove("selected"),c(b.children[1-e],!1)))}function K(){D.visible=!X}function T(){S=!S;O()}function Y(){da=!1;O()}function Q(){da=!0;O()}function C(){var a=A();W.switchToPreviousVisibleView(a?0:void 0)}function B(){var a=A();W.switchToNextVisibleView(a?0:void 0)}function H(a){if(!(a.ctrlKey||a.altKey||a.metaKey)){var b=a.target||a.srcElement;b=b.nodeType===Node.ELEMENT_NODE?b.nodeName.toUpperCase():"";if(!/INPUT|SELECT|TEXTAREA/.test(b))if(67===a.keyCode&&WALK.DEBUG)a.shiftKey?
WALK.DETECTOR.extension("WEBGL_lose_context").restoreContext():WALK.DETECTOR.extension("WEBGL_lose_context").loseContext();else if(null!==L){switch(a.keyCode){case 27:A();break;case 70:P&&p();break;case 76:V&&l();break;case 72:T();break;case 77:K();break;case 86:F&&n();break;case 80:h||(a.shiftKey?R.screenToLocalImage(!0,4E3,2E3):R.screenToLocalImage(!1,window.innerWidth,window.innerHeight));break;case 219:C();break;case 221:B()}b=a.keyCode-48;if(1<=b&&9>=b){--b;var c=null===L?[]:L.visibleViews();
b=c.length>b?c[b]:null;null!==b&&I(b)(a)}}}}function N(a){switch(a.action){case WALK.GAMEPAD_ACTION.PREVIOUS:C();break;case WALK.GAMEPAD_ACTION.NEXT:B()}}var D=this,J={type:"visibilityChanged"},L=null,W=null,M=null,R=null,F=!1,P=!1,V=!1,aa=!1,U=!1,X=!0,S=!1,da=!1,ba=null;this.cover=null;Object.defineProperty(this,"visible",{get:function(){var a=U&&WALK.DETECTOR.mobile;return X&&!a},set:function(a){var b=this.visible;X=a;b!==this.visible&&this.dispatchEvent(J);O()}});this.updateCover=function(a){this.cover=
a;null!==ba&&clearTimeout(ba);ba=setTimeout(function(){ba=null;O()},5E3);O()};this.refresh=function(){O()};this.onFullScreenChange=function(a){};this.onPointerLockChange=function(a){aa=a;O()};this.onVrChange=function(a){var b=this.visible;U=a;b!==this.visible&&this.dispatchEvent(J);O()};this.onResize=function(){if(!this.visible){var a=$("info-bar-slide"),b=$("menu-bar-slide"),c=$("view-list-slide");a.style.transition="none";b.style.transition="none";c.style.transition="none";O();a.style.transition=
"";b.style.transition="";c.style.transition=""}};this.enablePlayButton=function(a){var b=$("play-button");b.addEventListener("click",a);c(b,!0)};this.setVrSupported=function(a){F=a;e("vr-specific",a)};this.setFullScreenSupported=function(){(P=!h)&&e("fullscreen-specific",!0)};this.setPointerLockSupported=function(){V=!h};this.addExtraButton=function(a){var b=$("tour-button"),c=document.createElement("img");c.src=a;a=document.createElement("div");a.className="menu-button menu-item ui-hoverable ui-panel";
a.appendChild(c);b.parentNode.insertBefore(a,b);return a};this.removeExtraButton=function(a){a.remove()};this.getExtraButonIcon=function(a){return a.firstElementChild};this.sceneLoadStarted=function(a){d("play-button",!1);d("primary-progress",!0);a&&T()};this.loadProgress=function(a){a=a.totalDone()/a.total;if(null===L){var b=Math.max(314.159*(1-a),0);$("primary-progress-done").style.strokeDashoffset=b}a=Math.floor(100*a);$("secondary-progress-done").style.width=a+"%"};this.sceneReadyToDisplay=function(a,
b,c,d){L=a;W=b;W.addEventListener("teleportStarted",y);W.addEventListener("teleportDone",E);M=c;M.addEventListener("tourStarted",v);M.addEventListener("tourStopped",w);R=d;f($("cover-image"));f($("primary-progress"));g($("secondary-progress"));L.addEventListener("viewAdded",O);L.addEventListener("viewRemoved",O);L.addEventListener("viewShifted",O);document.body.style.backgroundImage="none";document.body.style.backgroundColor="#000";O()};this.sceneLoadComplete=function(){d("secondary-progress",!1)};
this.init=function(){h&&(e("viewer-specific",!1),e("editor-specific",!0));a("ui-panel",function(a){r(a,function(){})});WALK.DETECTOR.mobile&&b("ui-hoverable");document.addEventListener("keydown",H,!1);m("help-button",T);m("fullscreen-button",p);m("vr-button",n);m("tour-button",z);m("menu-bar-folder",K);m("view-list-folder",K);m("basic-desktop-help-option",Y);m("advanced-desktop-help-option",Q);m("close-desktop-help-button",T);m("close-mobile-help-button",T);k.addEventListener("actionActivated",N);
O()};this.contextLost=function(){L=W=M=R=null;O()}};THREE.EventDispatcher.prototype.apply(WALK.Menu.prototype)})();(function(){WALK.USER_MSG=new function(){this.hideInfo=function(){$("info-message").style.display="none"};this.info=function(a,b){var c=$("info-message");c.innerHTML=a;c.style.display="";setTimeout(this.hideInfo,b||15E3)};this.error=function(a){var b=$("error-message");b.innerHTML=a;b.style.display=""}}})();(function(){WALK.Timer=function(){this.clock=performance||Date;this.reset()};WALK.Timer.prototype={constructor:WALK.Timer,reset:function(){this.startMS=this.clock.now()},elapsedMSec:function(){return this.clock.now()-this.startMS},elapsedSec:function(){return.001*this.elapsedMSec()}};WALK.Perf=function(){var a=new WALK.Timer,b=[];this.begin=function(){a.reset()};this.end=function(){b.push(a.elapsedSec());0===b.length%100&&(b.sort(),console.log("Best "+b[0]+" Median "+b[Math.floor(.5*b.length)]+" 95 "+
b[Math.floor(.95*b.length)]))}};WALK.DeferringExecutor=function(a,b){function c(){d=null;a()}var d=null;this.deferRun=function(){null!==d&&clearTimeout(d);d=setTimeout(c,b)}}})();(function(){WALK.AnimationController=function(a,b,c){function d(){r(a.vrEnabled())}function e(){r(!1)}var g=this,f=new THREE.Clock,h=!1,k=!1,n=!1,p=0,l=!1,q=function(){k||(h||f.getDelta(),k=!0,a.vrEnabled()?a.requestAnimationFrame(d):requestAnimationFrame(e))};var r=function(a){l&&(k=!1,n?(console.assert(!a),c(f.getDelta(),p)?(p+=1,q()):n=!1):(h=!0,b(f.getDelta(),a),WALK.ALWAYS_RENDER&&g.requestFrame(),h=!1,k||(n=!0,p=0,q())))};this.requestFrame=function(){l&&(n=!1,q())};this.disable=function(){l=
!1};this.enable=function(){l=!0;k=!1;this.requestFrame()};this.isEnabled=function(){return l}}})();(function(){WALK.ExposureController=function(a,b,c){var d=a.camera,e=!1,g=0,f,h,k,n=new WALK.Timer,p=function(a){k=a;g=a-d.exposure;h=Math.sign(g);g=Math.abs(g);f=g/1};this.adaptExposure=function(){if(e&&d.autoExposure){n.reset();var a=c.measureReflectedLuma();0>a?g=0:(p(Math.log2(d.autoExposureDarkness/a)),.3>g&&(g=0))}};this.exposureNeedsUpdate=function(){return 0<g};var l=new THREE.Vector3(Infinity,Infinity,Infinity),q=function(){return function(){if(!e||!d.autoExposure){for(var b=a.cameraVolumes.length-
1;0<=b;--b){var c=a.cameraVolumes[b];if(c.worldCoordinatesInside(l)){p(c.exposure);d.setGamma(c.gamma);return}}p(d.defaultExposure);d.setGamma(d.defaultGamma)}}}();a.addEventListener("cameraVolumeAdded",function(a){a.cameraVolume.addEventListener("cameraVolumeUpdated",q);q()});a.addEventListener("cameraVolumeShifted",q);a.addEventListener("cameraVolumeRemoved",function(a){a.cameraVolume.removeEventListener("cameraVolumeUpdated",q);q()});d.addEventListener("cameraUpdated",q);this.update=function(a){var c=
b.cameraWorldPosition();l.equals(c)||(l.copy(c),q());this.exposureNeedsUpdate()&&(a=Math.min(f*a,g),g-=a,1E-5>g?(g=0,d.exposure=k):d.exposure+=a*h)};this.updateWithoutDelay=function(){this.update(1)};this.enableAutoExposure=function(){e=!0;g=0};this.disableAutoExposure=function(){e=!1;q()}}})();(function(){function a(a,c){for(var b=0,e=0,g=0;65536>g;++g){var f=4*g;f=a[f]+255*a[f+1];0!==f&&(e+=1,c[f]+=1,b=Math.max(b,f))}if(256>e)return-1;g=a=0;for(f=1;f<=b;++f)if(c[f]+a<.3*e)a+=c[f],c[f]=0;else break;for(f=b;0<=f;--f)if(c[f]+g<.1*e)g+=c[f],c[f]=0;else break;f=0;for(var h=1;h<=b;++h)f+=c[h]*Math.log(h/255),c[h]=0;return Math.exp(f/(e-a-g))}WALK.LumaMeter=function(b,c){function d(d){g||(console.assert(!g),g=b.createRenderTarget(256,256,{minFilter:GLC.NEAREST,magFilter:GLC.NEAREST,format:GLC.RGBA,
stencilBuffer:!1,generateMipmaps:!1}),f=new WALK.AutoClearAlter(b),h=new Uint8Array(262144),k=new Uint32Array(65280),n=new WALK.LumaMaterial(!0),p=new WALK.LumaMaterial(!1));d=d?n:p;f.set(!0,!0,!1);var l=c.gpuMeshes.filter(function(a){return!a.material.transparent});b.renderMeshes(l,d,e,g);b.readPixels(256,256,h);b.setRenderTarget(null);f.restore();return a(h,k)}var e=c.camera,g,f,h,k,n,p;this.measureIncidentLuma=function(){return d(!0)};this.measureReflectedLuma=function(){return d(!1)}}})();(function(){function a(){var a={uniforms:{inputBuffer:{type:"t",value:null},weight:{type:"f",value:1}},vertexShader:WALK.getShader("accumulate_vertex.glsl"),fragmentShader:WALK.getShader("accumulate_fragment.glsl")};a=new THREE.ShaderPass(a,"inputBuffer");a.material.depthTest=!1;a.material.depthWrite=!1;a.material.blending=THREE.CustomBlending;a.material.blendEquation=GLC.FUNC_ADD;a.material.blendDst=GLC.ONE_MINUS_SRC_ALPHA;a.material.blendSrc=GLC.SRC_ALPHA;return a}WALK.SsaaRenderer=function(b,c){var d,
e,g=0,f=[[.375,.4375],[.625,.0625],[.875,.1875],[.125,.0625],[.375,.6875],[.875,.4375],[.625,.5625],[.375,.9375],[.625,.3125],[.125,.5625],[.125,.8125],[.375,.1875],[.875,.9375],[.875,.6875],[.125,.3125],[.625,.8125]],h=new THREE.RenderPass(c.threeScene,c.camera),k=a(),n=new THREE.ShaderPass(THREE.CopyShader);n.renderToScreen=!0;var p=new WALK.AutoClearAlter(b);this.reset=function(){g=0};this.renderSample=function(){console.assert(g<f.length);p.set(!0,!0,!1);var a=e.width,n=e.height,r=f[g][0]-.5,
m=f[g][1]-.5,u=c.camera,x=a/n,t=Math.tan(.5*THREE.Math.degToRad(u.fov));t=u.near*t/u.zoom;var v=-t,w=v*x;x*=t;a=(x-w)/a;n=(t-v)/n;u.projectionMatrix.makeFrustum(w-r*a,x-r*a,v-m*n,t-m*n,u.near,u.far);h.render(b,d);p.restore();p.set(!1,!1,!1);k.uniforms.weight.value=1/(g+1);k.render(b,e,d);p.restore();c.camera.updateProjectionMatrix();g+=1};this.renderedSamplesCount=function(){return g};this.allSamplesRendered=function(){return g===f.length};this.renderAccumulatedSamplesToScreen=function(){p.set(!0,
!0,!1);n.render(b,void 0,e);p.restore()};this.copyAccumulatedSamplesToBuffer=function(){var a=e.width,c=e.height,d=new Uint8Array(a*c*4);b.readPixels(a,c,d);return d};this.setTargets=function(a,b){console.assert(a.width===b.width&&a.height===b.height);d=a;e=b};this.dispose=function(){k.material.dispose()}}})();(function(){function a(a){return a.split("\n").map(function(a,b){return b+1+": "+a}).join("\n")}WALK.createWebGLShader=function(b,c,d){c=b.createShader(c);b.shaderSource(c,d);b.compileShader(c);var e=!1===b.getShaderParameter(c,b.COMPILE_STATUS);e&&console.error("Shader failed to compile.");if(e||WALK.LOG_INFO)b=b.getShaderInfoLog(c),""!==b&&console.warn("Shader info log: ",b,a(d));return c}})();(function(){WALK.WebGLState=function(a,b){var c=Array(16).fill(0),d=Array(16).fill(null),e=c.map(function(){return 0}),g=null,f=null,h=null,k=null,n=null,p=null,l=null,q=null,r=null,m=null,u=null,x=null,t=null,v=null,w=null,z=null;this.resetAttributeStates=function(){for(var a=0,b=c.length;a<b;a++)c[a]=0};this.disableAttributeStates=function(){for(var b=0,d=c.length;b<d;b++)a.disableVertexAttribArray(b),c[b]=0};this.enableAttributeArray=function(b){2!==c[b]&&(a.enableVertexAttribArray(b),c[b]=2)};
this.disableAttributeArray=function(b,e){1!==c[b]&&(a.disableVertexAttribArray(b),c[b]=1);d[b]!==e&&(2===e.length?a.vertexAttrib2fv(b,e):3===e.length?a.vertexAttrib3fv(b,e):4===e.length&&a.vertexAttrib4fv(b,e),d[b]=e)};this.resetAttributeDivisors=function(){for(var a=0,c=e.length;a<c;a++)e[a]&&(b.vertexAttribDivisorANGLE(a,0),e[a]=0)};this.setAttributeDivisor=function(a,c){b.vertexAttribDivisorANGLE(a,c);e[a]=c};this.setBlending=function(b){var c=b.blending;c!==g&&(c===THREE.NoBlending?a.disable(a.BLEND):
c===THREE.AdditiveBlending?(a.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE)):c===THREE.SubtractiveBlending?(a.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.ONE_MINUS_SRC_COLOR)):c===THREE.MultiplyBlending?(a.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.SRC_COLOR)):c===THREE.CustomBlending?a.enable(a.BLEND):(a.enable(a.BLEND),a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,
a.ONE_MINUS_SRC_ALPHA)),g=c);if(c===THREE.CustomBlending){c=b.blendEquation;var d=b.blendEquationAlpha||c,e=b.blendSrc,m=b.blendDst,q=b.blendSrcAlpha||e;b=b.blendDstAlpha||m;if(c!==f||d!==n)a.blendEquationSeparate(c,d),f=c,n=d;if(e!==h||m!==k||q!==p||b!==l)a.blendFuncSeparate(e,m,q,b),h=e,k=m,p=q,l=b}else l=p=n=k=h=f=null};this.setDepthTest=function(b){q!==b&&(b?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),q=b)};this.setDepthWrite=function(b){r!==b&&(a.depthMask(b),r=b)};this.setColorWrite=function(b){m!==
b&&(a.colorMask(b,b,b,b),m=b)};this.setDoubleSided=function(b){u!==b&&(b?a.disable(a.CULL_FACE):a.enable(a.CULL_FACE),u=b)};this.setFlipSided=function(b){x!==b&&(b?a.frontFace(a.CW):a.frontFace(a.CCW),x=b)};this.setViewport=function(b,c,d,e){if(t!==b||v!==c||w!==d||z!==e)a.viewport(b,c,d,e),t=b,v=c,w=d,z=e}}})();(function(){function a(a,e){var d=e.index0AttributeName,f=a.createProgram(),h=WALK.createWebGLShader(a,a.VERTEX_SHADER,e.generateVertexShader()),k=WALK.createWebGLShader(a,a.FRAGMENT_SHADER,e.generateFragmentShader());a.attachShader(f,h);a.attachShader(f,k);void 0!==d&&a.bindAttribLocation(f,0,d);a.linkProgram(f);d=a.getProgramInfoLog(f);!1===a.getProgramParameter(f,a.LINK_STATUS)&&console.error("Shader link error: "+a.getError(),"validate status: ",a.getProgramParameter(f,a.VALIDATE_STATUS));""!==
d&&"\x00"!==d&&console.warn("program info log: "+d);a.deleteShader(h);a.deleteShader(k);h={};k=0;for(d=b.length;k<d;k++){var n=b[k];h[n]=a.getUniformLocation(f,n)}this.transformUniformCache=h;h=e.uniforms;k={i:[],f:[],v2:[],v3:[],c:[],v4:[],m4:[],t:[]};var p;for(l in h)h.hasOwnProperty(l)&&(d=a.getUniformLocation(f,l))&&(n=h[l].type,console.assert(k.hasOwnProperty(n)),"i"===n||"f"===n||"t"===n?p=null:"v2"===n?p=[null,null]:"v3"===n||"c"===n?p=[null,null,null]:"v4"===n?p=[null,null,null,null]:"m4"===
n?p=null:console.assert(!1),k[n].push({id:l,value:p,location:d}));this.materialUniformCache=k;e=e.attributes;p={};var l=0;for(h=e.length;l<h;l++)k=e[l],p[k]=a.getAttribLocation(f,k);this.attributes=p;this.attributesKeys=Object.keys(this.attributes);this.id=c++;this.usedTimes=1;this.program=f;return this}var b="viewMatrix modelViewMatrix projectionMatrix normalMatrix modelMatrix cameraPosition".split(" "),c=0;WALK.WebGLProgramStore=function(b){var c=new Map;this.assignProgramToMaterial=function(d){console.assert(d instanceof
WALK.BaseMaterial);var e=d.generateProgramId(),g=c[e];g?g.usedTimes++:(g=new a(b,d),c[e]=g);d.program&&this.resetProgramAssignment(d);d.program=g};this.resetProgramAssignment=function(a){var d=a.program;a.program=null;--d.usedTimes;if(0===d.usedTimes){for(var e in c)if(c.hasOwnProperty(e)&&c[e]===d){delete c[e];break}b.deleteProgram(d.program)}}}})();(function(){function a(){this.texture=null;this.locked=!1;this.usedCount=0}function b(b){for(var c=[],e=0;e<b;e+=1)c[e]=new a;return c}WALK.WebGLTextureSlotter=function(a){var c=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),e=b(c);this.setSlot=function(a,b){var d=a.__webglSlot;if(null!==d){var f=e[d];f.usedCount+=1;f.locked=f.locked||b;return!1}for(var g=Infinity,p=0;p<c;p+=1)f=e[p],!f.locked&&f.usedCount<g&&(g=f.usedCount,d=p);null===d&&(console.warn("Not enough texture units"),d=0);f=e[d];f.texture&&
(f.texture.__webglSlot=null);f.texture=a;f.usedCount=1;f.locked=b;a.__webglSlot=d;return!0};this.unlockAllSlots=function(){for(var a=0;a<c;a+=1)e[a].locked=!1};this.freeSlot=function(a){if(null!==a.__webglSlot){var b=e[a.__webglSlot];a.__webglSlot=null;b.texture=null;b.locked=!1;b.usedCount=0}}};WALK.WebGLTextureSlotterSequential=function(a){var b=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),c=0;this.setSlot=function(a,d){c===b&&(console.warn("Not enough texture units"),c=0);a.__webglSlot=c;d&&(c+=1);
return!0};this.unlockAllSlots=function(){c=0};this.freeSlot=function(a){a.__webglSlot=null}}})();(function(){function a(a,b){for(var c={HALF_FLOAT_OES:"OES_texture_half_float",COMPRESSED_RGB_S3TC_DXT1_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGBA_S3TC_DXT1_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGBA_S3TC_DXT3_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGBA_S3TC_DXT5_EXT:"WEBGL_compressed_texture_s3tc",COMPRESSED_RGB_PVRTC_4BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",COMPRESSED_RGB_PVRTC_2BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",
COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:"WEBGL_compressed_texture_pvrtc",COMPRESSED_RGB_ETC1_WEBGL:"WEBGL_compressed_texture_etc1",COMPRESSED_RGBA_ASTC_4x4_KHR:"WEBGL_compressed_texture_astc"},d=$jscomp.makeIterator(Object.entries(GLC)),f=d.next();!f.done;f=d.next()){var h=$jscomp.makeIterator(f.value);f=h.next().value;h=h.next().value;var k=c[f];void 0!==k?(k=b.extension(k))&&console.assert(k[f]===h):console.assert(a[f]===h)}}function b(a){return WALK.DETECTOR.disableTextureSlotReuse?new WALK.WebGLTextureSlotterSequential(a):
new WALK.WebGLTextureSlotter(a)}WALK.WebGLRenderer=function(c,d){function e(){C=WALK.DETECTOR.instances;K=O=null;T=-1;Q=Y=null;B=new WALK.WebGLState(d,C);H=new WALK.WebGLProgramStore(d);d.clearColor(0,0,0,1);d.clearDepth(1);d.clearStencil(0);d.enable(d.DEPTH_TEST);d.depthFunc(d.LEQUAL);d.frontFace(d.CCW);d.cullFace(d.BACK);d.enable(d.CULL_FACE);d.enable(d.BLEND);d.blendEquation(d.FUNC_ADD);d.blendFunc(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA);B.setViewport(0,0,c.width,c.height);d.clearColor(z.r,z.g,z.b,
A);d.pixelStorei(d.UNPACK_COLORSPACE_CONVERSION_WEBGL,d.NONE)}function g(a){a=a.target;a.removeEventListener("dispose",g);delete a.__webglInit;a=a.attributes;for(var b in a)if(a.hasOwnProperty(b)){var c=a[b];void 0!==c.buffer&&(d.deleteBuffer(c.buffer),delete c.buffer)}B.disableAttributeStates();Y=null}function f(a){a=a.target;a.removeEventListener("dispose",f);L.freeSlot(a);a.__webglTexture&&(d.deleteTexture(a.__webglTexture),a.__webglTexture=null)}function h(a){a=a.target;a.removeEventListener("dispose",
h);L.freeSlot(a);a.__webglTexture&&(d.deleteTexture(a.__webglTexture),a.__webglTexture=null);if(a.isCube)for(var b=0;6>b;b++)d.deleteFramebuffer(a.__webglFramebuffer[b]),d.deleteRenderbuffer(a.__webglRenderbuffer[b]);else d.deleteFramebuffer(a.__webglFramebuffer),d.deleteRenderbuffer(a.__webglRenderbuffer);a.__webglFramebuffer=null;a.__webglRenderbuffer=null}function k(a){a=a.target;a.removeEventListener("dispose",k);H.resetProgramAssignment(a)}function n(a,b,c){var e=c.attributes,f=b.attributes;
b=b.attributesKeys;c=16*(c.instanceId||0);for(var g=0,k=b.length;g<k;g++){var h=b[g],l=f[h];if(0<=l){var m=e[h];if(void 0!==m){h=m.itemSize;var n=m.glType;d.bindBuffer(d.ARRAY_BUFFER,m.buffer);m=m.divisor||0;B.enableAttributeArray(l);d.vertexAttribPointer(l,h,n,!1,0,c*m);C&&B.setAttributeDivisor(l,m)}else B.disableAttributeArray(l,a.defaultAttributeValues[h])}}}function p(a,b){var c=WALK.DETECTOR;d.texParameteri(a,d.TEXTURE_WRAP_S,b.wrapS);d.texParameteri(a,d.TEXTURE_WRAP_T,b.wrapT);d.texParameteri(a,
d.TEXTURE_MAG_FILTER,b.magFilter);d.texParameteri(a,d.TEXTURE_MIN_FILTER,b.minFilter);var e=c.extension("EXT_texture_filter_anisotropic");e&&1<b.anisotropy&&d.texParameterf(a,e.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(b.anisotropy,c.maxAnisotropy))}function l(a,b){var c=a.material,d=b.material,e=c.program,f=d.program;return e&&f&&e.id!==f.id?e.id-f.id:c.id-d.id||a.id-b.id}function q(a,b){var c=a.material.transparentRenderOrder-b.material.transparentRenderOrder;return c?c:b.cameraDistance-a.cameraDistance||
a.id-b.id}function r(a,b,c){if(c||!1!==a.visible){a instanceof THREE.Mesh&&(!1===a.frustumCulled||!0===N.intersectsObject(a))&&((b||a.material).transparent?(!0===I.sortObjects&&(a.cameraDistance=N.nearPlaneDistanceToCenter(a)),E.push(a)):y.push(a));for(var d=0,e=a.children.length;d<e;d++)r(a.children[d],b,c)}}function m(a){B.setDoubleSided(a.side===THREE.DoubleSide);B.setFlipSided(a.side===THREE.BackSide)}function u(a){a.__webglTexture||(a.addEventListener("dispose",f),a.__webglTexture=d.createTexture());
d.activeTexture(d.TEXTURE0+a.__webglSlot);d.bindTexture(d.TEXTURE_2D,a.__webglTexture);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,a.flipY);d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha);d.pixelStorei(d.UNPACK_ALIGNMENT,a.unpackAlignment);var b=a.image,c=THREE.Math.isPowerOfTwo(b.width)&&THREE.Math.isPowerOfTwo(b.height),e=a.format,g=a.type;p(d.TEXTURE_2D,a);var k=a.mipmaps;if(a instanceof WALK.DataTexture)if(0<k.length&&c){for(var h=0,l=k.length;h<l;h++)b=k[h],d.texImage2D(d.TEXTURE_2D,
h,e,b.width,b.height,0,e,g,b.data),a.releaseOnLoadedToGpu&&(b.data=null);a.generateMipmaps=!1}else d.texImage2D(d.TEXTURE_2D,0,e,b.width,b.height,0,e,g,b.data),a.releaseOnLoadedToGpu&&(b.data=null);else if(a instanceof WALK.CompressedTexture)for(h=0,l=k.length;h<l;h++)b=k[h],a.format!==GLC.RGBA&&a.format!==GLC.RGB?d.compressedTexImage2D(d.TEXTURE_2D,h,e,b.width,b.height,0,b.data):d.texImage2D(d.TEXTURE_2D,h,e,b.width,b.height,0,e,g,b.data),a.releaseOnLoadedToGpu&&(b.data=null);else if(0<k.length&&
c){h=0;for(l=k.length;h<l;h++)b=k[h],d.texImage2D(d.TEXTURE_2D,h,e,e,g,b);a.releaseOnLoadedToGpu&&(a.mipmaps=null);a.generateMipmaps=!1}else d.texImage2D(d.TEXTURE_2D,0,e,e,g,a.image),a.releaseOnLoadedToGpu&&(a.image=null);a.generateMipmaps&&c&&d.generateMipmap(d.TEXTURE_2D);a.needsUpdate=!1}function x(a){B.setBlending(a);B.setDepthTest(a.depthTest);B.setDepthWrite(a.depthWrite);B.setColorWrite(a.colorWrite)}function t(a,b,c){if(c){var e=c;x(e);m(e)}for(var f=0,g=a.length;f<g;f+=1){var h=a[f],l=h.geometry,
q=h.material;c?c.doNotOverrideSide&&q&&m(q):(e=q,x(e),m(e));q=e;if(!1!==q.visible&&0!==l.vertexCnt){var r=b;var t=q;t.programNeedsUpdate&&(H.assignProgramToMaterial(t),t.addEventListener("dispose",k),t.programNeedsUpdate=!1);console.assert(!t.morphTargets);var v=!1,w=!1;var z=t.program;var F=z.transformUniformCache;var A=t.uniforms;z.id!==O&&(d.useProgram(z.program),O=z.id,w=v=!0);t.id!==T&&(T=t.id,w=!0);if(v||r!==Q)d.uniformMatrix4fv(F.projectionMatrix,!1,r.projectionMatrix.elements),r!==Q&&(Q=r),
console.assert(t instanceof WALK.BaseMaterial),null!==F.cameraPosition&&(J.setFromMatrixPosition(r.matrixWorld),d.uniform3f(F.cameraPosition,J.x,J.y,J.z)),null!==F.viewMatrix&&d.uniformMatrix4fv(F.viewMatrix,!1,r.matrixWorldInverse.elements);t.refreshPerObjectUniforms&&t.refreshPerObjectUniforms(h,A)&&(w=!0);if(w){var P=z;w=A;v=P.materialUniformCache.i;t=0;for(A=v.length;t<A;t+=1){var y=v[t];var D=y.id;var N=w[D].value;y.value!==N&&(d.uniform1i(y.location,N),y.value=N)}v=P.materialUniformCache.f;
t=0;for(A=v.length;t<A;t+=1)y=v[t],D=y.id,N=w[D].value,y.value!==N&&(d.uniform1f(y.location,N),y.value=N);v=P.materialUniformCache.v2;t=0;for(A=v.length;t<A;t+=1){y=v[t];D=y.id;N=w[D].value;var E=N.x;var V=N.y;if(y.value[0]!==E||y.value[1]!==V)d.uniform2f(y.location,E,V),y.value[0]=E,y.value[1]=V}v=P.materialUniformCache.v3;t=0;for(A=v.length;t<A;t+=1)if(y=v[t],D=y.id,N=w[D].value,E=N.x,V=N.y,D=N.z,y.value[0]!==E||y.value[1]!==V||y.value[2]!==D)d.uniform3f(y.location,E,V,D),y.value[0]=E,y.value[1]=
V,y.value[2]=D;v=P.materialUniformCache.c;t=0;for(A=v.length;t<A;t+=1)if(y=v[t],D=y.id,N=w[D].value,E=N.r,V=N.g,D=N.b,y.value[0]!==E||y.value[1]!==V||y.value[2]!==D)d.uniform3f(y.location,E,V,D),y.value[0]=E,y.value[1]=V,y.value[2]=D;v=P.materialUniformCache.v4;t=0;for(A=v.length;t<A;t+=1)if(y=v[t],D=y.id,N=w[D].value,E=N.x,V=N.y,D=N.z,N=N.w,y.value[0]!==E||y.value[1]!==V||y.value[2]!==D||y.value[3]!==N)d.uniform4f(y.location,E,V,D,N),y.value[0]=E,y.value[1]=V,y.value[2]=D,y.value[3]=N;v=P.materialUniformCache.m4;
t=0;for(A=v.length;t<A;t+=1)y=v[t],D=y.id,d.uniformMatrix4fv(location,!1,w[D].value.elements);v=P.materialUniformCache.t;t=0;for(A=v.length;t<A;t+=1)if(y=v[t],D=y.id,V=w[D].value,D=L.setSlot(V,!0),P=V.__webglSlot,y.value!==P&&(d.uniform1i(y.location,P),y.value=P),D||V.needsUpdate)if(V.isCube){if(y=V,d.activeTexture(d.TEXTURE0+y.__webglSlot),d.bindTexture(d.TEXTURE_CUBE_MAP,y.__webglTexture),y.needsUpdate){d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,y.flipY);P=y instanceof WALK.CompressedTexture;D=y.image;
V=y.format;E=y.type;p(d.TEXTURE_CUBE_MAP,y);for(N=0;6>N;N++)if(P)for(var K=D[N].mipmaps,I=0,Aa=K.length;I<Aa;I++){var ta=K[I];y.format!==GLC.RGBA&&y.format!==GLC.RGB?d.compressedTexImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+N,I,V,ta.width,ta.height,0,ta.data):d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+N,I,V,ta.width,ta.height,0,V,E,ta.data);y.releaseOnLoadedToGpu&&(ta.data=null)}else d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+N,0,V,V,E,D[N]),y.releaseOnLoadedToGpu&&(D[N]=null);y.generateMipmaps&&d.generateMipmap(d.TEXTURE_CUBE_MAP);
y.needsUpdate=!1}}else y=V,y.needsUpdate?u(y):(d.activeTexture(d.TEXTURE0+y.__webglSlot),d.bindTexture(d.TEXTURE_2D,y.__webglTexture));L.unlockAllSlots()}A=r;r=F;h.matrixWorld?(M.multiplyMatrices(A.matrixWorldInverse,h.matrixWorld),A=M):A=A.matrixWorldInverse;d.uniformMatrix4fv(r.modelViewMatrix,!1,A.elements);r.normalMatrix&&(R.getNormalMatrix(A),d.uniformMatrix3fv(r.normalMatrix,!1,R.elements));null!==F.modelMatrix&&(h.matrixWorld?d.uniformMatrix4fv(F.modelMatrix,!1,h.matrixWorld.elements):d.uniformMatrix4fv(F.modelMatrix,
!1,W));r=z;A=!1;if(l.id!==Y||r.id!==O)Y=l.id,A=!0;console.assert(h instanceof THREE.Mesh);h=d.TRIANGLES;(t=l.attributes.index)?(z=t.glType,F=l.indexUint?4:2,A&&(n(q,r,l),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,t.buffer)),void 0!==l.indexOffset?(q=l.indexCnt,F*=l.indexOffset):(q=t.length,F=0),l.isInstanced?C.drawElementsInstancedANGLE(h,q,z,F,l.instanceCount):d.drawElements(h,q,z,F)):(A&&n(q,r,l),q=l.attributes.position,void 0!==l.vertexOffset?(z=l.vertexCnt,q=l.vertexOffset):(z=q.length/q.itemSize,q=
0),l.isInstanced?C.drawArraysInstancedANGLE(h,q,z,l.instanceCount):d.drawArrays(h,q,z));C&&B.resetAttributeDivisors()}}}function v(a,b){d.bindRenderbuffer(d.RENDERBUFFER,a);b.depthBuffer?(d.renderbufferStorage(d.RENDERBUFFER,d.DEPTH_STENCIL,b.width,b.height),d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,a)):d.renderbufferStorage(d.RENDERBUFFER,d.RGBA4,b.width,b.height)}function w(a,b){b.addEventListener("dispose",h);b.__webglTexture=d.createTexture();var c=b.format,
e=b.type;L.setSlot(b,!1);d.activeTexture(d.TEXTURE0+b.__webglSlot);if(a){d.bindTexture(d.TEXTURE_CUBE_MAP,b.__webglTexture);p(d.TEXTURE_CUBE_MAP,b);for(a=0;6>a;a++){b.__webglFramebuffer[a]=d.createFramebuffer();b.__webglRenderbuffer[a]=d.createRenderbuffer();d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,c,b.width,b.height,0,c,e,null);var f=d.TEXTURE_CUBE_MAP_POSITIVE_X+a,g=b.__webglTexture;d.bindFramebuffer(d.FRAMEBUFFER,b.__webglFramebuffer[a]);d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,
f,g,0);v(b.__webglRenderbuffer[a],b)}b.generateMipmaps&&d.generateMipmap(d.TEXTURE_CUBE_MAP)}else b.__webglFramebuffer=d.createFramebuffer(),b.__webglRenderbuffer=b.shareDepthFrom?b.shareDepthFrom.__webglRenderbuffer:d.createRenderbuffer(),d.bindTexture(d.TEXTURE_2D,b.__webglTexture),p(d.TEXTURE_2D,b),d.texImage2D(d.TEXTURE_2D,0,c,b.width,b.height,0,c,e,null),c=d.TEXTURE_2D,e=b.__webglTexture,d.bindFramebuffer(d.FRAMEBUFFER,b.__webglFramebuffer),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,
c,e,0),b.shareDepthFrom?b.depthBuffer&&d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,b.__webglRenderbuffer):v(b.__webglRenderbuffer,b),b.generateMipmaps&&d.generateMipmap(d.TEXTURE_2D);d.bindRenderbuffer(d.RENDERBUFFER,null);d.bindFramebuffer(d.FRAMEBUFFER,null)}var z=new THREE.Color(0),A=0,y=[],E=[];this.domElement=c;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;var I=this,O,K,T,Y,Q,C,B,H,N=new WALK.Frustum,D=
new THREE.Matrix4,J=new THREE.Vector3;e();a(d,WALK.DETECTOR);this.webGLContextRestored=function(){e()};this.context=d;this.state=B;var L=b(d),W=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setCanvasSize=function(a,b){c.width=a;c.height=b;null===K&&this.setViewport(0,0,a,b)};this.setViewport=function(a,b,c,d){B.setViewport(a,b,c,d)};this.setScissor=function(a,b,c,e){d.scissor(a,b,c,e)};this.enableScissorTest=function(a){a?d.enable(d.SCISSOR_TEST):d.disable(d.SCISSOR_TEST)};this.setClearColor=
function(a,b){z.copy(a);A=void 0!==b?b:1;d.clearColor(z.r,z.g,z.b,A)};this.getClearColor=function(){return z};this.getClearAlpha=function(){return A};this.clear=function(a,b,c){var e=0;a&&(e|=d.COLOR_BUFFER_BIT);b&&(e|=d.DEPTH_BUFFER_BIT);c&&(e|=d.STENCIL_BUFFER_BIT);d.clear(e)};this.clearColor=function(){d.clear(d.COLOR_BUFFER_BIT)};this.clearDepth=function(){d.clear(d.DEPTH_BUFFER_BIT)};this.clearStencil=function(){d.clear(d.STENCIL_BUFFER_BIT)};var M=new THREE.Matrix4,R=new THREE.Matrix3;this.setRenderTarget=
function(a){if(a){var b=a.isCube?a.__webglFramebuffer[a.activeCubeFace]:a.__webglFramebuffer;var e=a.x;var f=a.y;var g=a.width;a=a.height}else b=null,f=e=0,g=c.width,a=c.height;b!==K&&(d.bindFramebuffer(d.FRAMEBUFFER,b),K=b);B.setViewport(e,f,g,a)};this.render=function(a,b,c,d){this.renderMeshes(a.children,a.overrideMaterial,b,c,d)};this.renderMeshes=function(a,b,c,e,f,g){Y=null;T=-1;Q=null;c.matrixWorldInverse.getInverse(c.matrixWorld);D.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse);
N.setFromMatrix(D);y.length=0;E.length=0;g=void 0===g?!1:g;for(var h=0;h<a.length;h+=1)r(a[h],b,g);!0===I.sortObjects&&(y.sort(l),E.sort(q));this.setRenderTarget(e);(this.autoClear||f)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);t(y,c,b);t(E,c,b);e&&e.generateMipmaps&&(a=L.setSlot(e,!1),d.activeTexture(d.TEXTURE0+e.__webglSlot),e.isCube?(a&&d.bindTexture(d.TEXTURE_CUBE_MAP,e.__webglTexture),d.generateMipmap(d.TEXTURE_CUBE_MAP)):(a&&d.bindTexture(d.TEXTURE_2D,e.__webglTexture),
d.generateMipmap(d.TEXTURE_2D)));B.setDepthTest(!0);B.setDepthWrite(!0);B.setColorWrite(!0);B.resetAttributeStates()};this.uploadNewBuffers=function(a){var b=a.geometry;a=b.attributes;var c=b.attributesKeys;void 0===b.__webglInit&&(b.__webglInit=!0,b.addEventListener("dispose",g));console.assert(b instanceof THREE.BufferGeometry);b=0;for(var e=c.length;b<e;b+=1){var f=c[b],h=a[f];f="index"===f?d.ELEMENT_ARRAY_BUFFER:d.ARRAY_BUFFER;if(h.buffer)!0===h.needsUpdate&&console.assert(!1);else{h.buffer=d.createBuffer();
d.bindBuffer(f,h.buffer);var k=h.array;WALK.DETECTOR.ios&&f===d.ARRAY_BUFFER&&console.assert(0===h.itemSize*k.BYTES_PER_ELEMENT%4);d.bufferData(f,k,d.STATIC_DRAW);k instanceof Float32Array?h.glType=d.FLOAT:k instanceof Int8Array?h.glType=d.BYTE:k instanceof Int16Array?h.glType=d.SHORT:k instanceof Uint16Array?h.glType=d.UNSIGNED_SHORT:k instanceof Uint32Array?h.glType=d.UNSIGNED_INT:console.assert(!1);h.releaseOnLoadedToGpu&&(h.array=null);h.needsUpdate=!1}}};this.uploadTexture=function(a){L.setSlot(a,
!1);u(a)};this.copyBufferToCubeFaceMip=function(a,b,c,e,f){L.setSlot(f,!1);d.activeTexture(d.TEXTURE0+f.__webglSlot);d.bindTexture(d.TEXTURE_CUBE_MAP,f.__webglTexture);d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+c,a,d.RGBA,b,b,0,d.RGBA,d.UNSIGNED_BYTE,e)};this.createCubeTexture=function(a,b){var c=new WALK.Texture;c.isCube=!0;c.minFilter=b?GLC.LINEAR_MIPMAP_NEAREST:GLC.LINEAR;c.generateMipmaps=!1;c.needsUpdate=!1;c.addEventListener("dispose",f);c.__webglTexture=d.createTexture();L.setSlot(c,!1);d.activeTexture(d.TEXTURE0+
c.__webglSlot);d.bindTexture(d.TEXTURE_CUBE_MAP,c.__webglTexture);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1);d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MAG_FILTER,d.LINEAR);b?d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MIN_FILTER,d.LINEAR_MIPMAP_NEAREST):d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MIN_FILTER,d.LINEAR);for(var e=0;6>e;e+=1)d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+
e,0,d.RGBA,a,a,0,d.RGBA,d.UNSIGNED_BYTE,null);b&&d.generateMipmap(d.TEXTURE_CUBE_MAP);return c};this.createFrameBufferRenderTarget=function(a){return new WALK.WebGLRenderTargetVR(a)};this.createRenderTarget=function(a,b,c){a=new WALK.WebGLRenderTarget(a,b,c);w(!1,a);return a};this.createRenderTargetCube=function(a,b,c){a=new WALK.WebGLRenderTargetCube(a,b,c);w(!0,a);return a};this.readPixels=function(a,b,c){d.readPixels(0,0,a,b,d.RGBA,d.UNSIGNED_BYTE,c)}}})();(function(){var a={minFilter:GLC.LINEAR,magFilter:GLC.LINEAR,format:GLC.RGBA,stencilBuffer:!1,generateMipmaps:!1};WALK.createGlobalDetector=function(a){a=new WALK.Detector(a);a.reportToConsole();WALK.DETECTOR=a};WALK.createRenderer=function(a,c){void 0===c.alpha&&(c.alpha=!1);void 0===c.depth&&(c.depth=!0);void 0===c.stencil&&(c.stencil=!1);void 0===c.premultipliedAlpha&&(c.premultipliedAlpha=!0);void 0===c.antialias&&(c.antialias=!0);void 0===c.preserveDrawingBuffer&&(c.preserveDrawingBuffer=!1);
try{var b=a.getContext("webgl",c)||a.getContext("experimental-webgl",c)}catch(e){b=null}c=b;if(!c)return null;WALK.createGlobalDetector(c);return new WALK.WebGLRenderer(a,c)};WALK.createWebwalkRenderer=function(a){if(a=WALK.createRenderer(a,{antialias:!WALK.FORCE_FXAA}))a.autoClear=!0,a.autoClearColor=!1,a.autoClearDepth=!0,a.autoClearStencil=!1,a.sortObjects=!0;return a};WALK.Renderer=function(b,c,d,e){var g=null,f,h,k=d.camera,n=d.threeScene,p=function(){var a=new WALK.Frustum,c=new THREE.Matrix4;
return function(e){if(0!==d.mirrors.length){e.matrixWorldInverse.getInverse(e.matrixWorld);c.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse);a.setFromMatrix(c);for(var f=0;f<d.mirrors.length;f+=1){var g=d.mirrors[f];g.updateCameraPosition(e,a);g.inFrustum()&&g.render(b)}}}}();this.resize=function(c){if(!c){var e=window.innerWidth;var l=window.innerHeight;var m=e*window.devicePixelRatio;var n=l*window.devicePixelRatio;k.aspect=m/n;k.updateProjectionMatrix();b.setCanvasSize(m,n);b.domElement.style.width=
e+"px";b.domElement.style.height=l+"px";f&&(f.configureTarget(m,n,a),h.setTargets(f.renderTarget1,f.renderTarget2));g&&g.uniforms.resolution.value.set(1/m,1/n)}e=n;c?(c=m/2,m=70):(c=m,m=k.fov);l=c/e;for(n=0;n<d.mirrors.length;n+=1)d.mirrors[n].configure(c,e,l,m)};this.renderIdle=function(a,b){0===b&&(e.adaptExposure(),h&&h.reset());if(e.exposureNeedsUpdate())return this.renderToScreen(a,!1),!0;if(!h)return!1;h.renderSample();4<=h.renderedSamplesCount()&&h.renderAccumulatedSamplesToScreen();return!h.allSamplesRendered()};
this.renderToScreen=function(a,d){e.update(a);d?c.render(n,k.matrixWorld,p):(p(k),g?f.render(a):b.render(n,k))};this.enableAutoExposure=function(){e.enableAutoExposure()};this.disableAutoExposure=function(){e.disableAutoExposure()};(function(){if(WALK.DETECTOR.antialiasPostprocess){f=new THREE.EffectComposer(b);if(!WALK.DETECTOR.antialiasNative){WALK.log("using FXAA");b.autoClear=!1;g=new THREE.ShaderPass(THREE.FXAAShader);g.clear=!1;g.renderToScreen=!0;g.material.depthTest=!1;g.material.depthWrite=
!1;g.uniforms.resolution.value.set(1/window.innerWidth,1/window.innerHeight);var a=new THREE.RenderPass(n,k);f.addPass(a);f.addPass(g)}h=new WALK.SsaaRenderer(b,d)}})()}})();(function(){WALK.ScreenshotTaker=function(a,b,c){function d(){var a=(document.body.offsetWidth-document.body.offsetHeight*h)/2,b=a+"px";a=Math.max(a,0)+"px";k.style.width=a;n.style.width=a;p.style.left=b;p.style.right=b}function e(c,d,e,f){var g=new WALK.CubeCamera(b.camera.near,b.camera.far);g.rotateZ(d);g.position.copy(c);g.updateMatrixWorld();c=a.createRenderTargetCube(4096,4096,{format:GLC.RGBA,magFilter:GLC.LINEAR,minFilter:GLC.LINEAR,stencilBuffer:!1,generateMipmaps:!1});for(d=0;6>d;d+=1)c.activeCubeFace=
d,a.render(b.threeScene,g.sideCameras[d],c);g=a.createRenderTarget(e,f,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,generateMipmaps:!1});d={uniforms:{panoramaCube:{type:"t",value:null}},vertexShader:WALK.getShader("cube_to_equirect_vertex.glsl"),fragmentShader:WALK.getShader("cube_to_equirect_fragment.glsl")};d=new THREE.ShaderPass(d,"panoramaCube");d.render(a,g,c);d.dispose();c.dispose();c=new Uint8Array(e*f*4);a.readPixels(e,f,c);g.dispose();return c}function g(c,
d){var e=a.createRenderTarget(c,d,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,generateMipmaps:!1});c=a.createRenderTarget(c,d,{format:GLC.RGBA,magFilter:GLC.NEAREST,minFilter:GLC.NEAREST,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1});d=new WALK.SsaaRenderer(a,b);for(d.setTargets(e,c);!d.allSamplesRendered();)d.renderSample();var f=d.copyAccumulatedSamplesToBuffer();e.dispose();c.dispose();d.dispose();return f}function f(a,b){var c=Math.min(WALK.MAX_PANORAMA_SIZE,
WALK.DETECTOR.maxRenderBufferSize);if(a<=c&&b<=c)return[a,b];var d=a/b;return a>b?[c,Math.floor(c/d)]:[Math.floor(c*d),c]}var h=null,k=null,n=null,p=null,l=new THREE.Vector3;this.markArea=function(a){function b(a,b){a.style.zIndex=1;a.style.pointerEvents="none";a.style.position="absolute";a.style.top=0;a.style.bottom=0;a.style[b]=0;a.style.backgroundColor="rgba(0, 0, 0, 0.5)"}function c(a){a.style.zIndex=1;a.style.pointerEvents="none";a.style.position="absolute";a.style.boxSizing="border-box";a.style.top=
0;a.style.bottom=0;a.style.border="4px solid rgba(35, 181, 233, 0.5)"}p||(k=document.createElement("div"),b(k,"left"),n=document.createElement("div"),b(n,"right"),p=document.createElement("div"),c(p),document.body.appendChild(k),document.body.appendChild(n),document.body.appendChild(p),window.addEventListener("resize",d));h=a;d()};this.unmarkArea=function(){p&&(k.remove(),n.remove(),p.remove(),window.removeEventListener("resize",d),p=n=k=h=null)};this.screenToBuffer=function(a,b,d){return a?e(c.cameraWorldPosition(),
c.getYawAngle(),b,d):g(b,d)};this.screenToDataUrl=function(a,b,c){a=this.screenToBuffer(a,b,c);for(var d=0;d<c;++d)for(var e=0;e<b;++e){var f=4*(d*b+e);if(d<c/2)for(var g=4*((c-d-1)*b+e),h=0;3>h;++h){var k=a[f+h];a[f+h]=a[g+h];a[g+h]=k}a[f+3]=255}a=new Uint8ClampedArray(a);a=new ImageData(a,b,c);d=document.createElement("canvas");d.width=b;d.height=c;d.getContext("2d").putImageData(a,0,0);return d.toDataURL("image/jpeg")};this.screenToLocalImage=function(a,b,c){a=this.screenToDataUrl(a,b,c);navigator.msSaveOrOpenBlob?
fetch(a).then(function(a){return a.blob()}).then(function(a){return navigator.msSaveOrOpenBlob(a,"screen.jpg")}):(b=document.createElement("a"),document.body.appendChild(b),b.style.cssText="display: none",b.href=a,b.download="screenshot",b.click(),window.URL.revokeObjectURL(a),b.parentNode.removeChild(b))};this.coverToServer=function(a,b){var c=g(a,b);WALK.ajaxPost("screenshot?width="+a+"&height="+b,"application/binary",c)};this.panoramaToServer=function(a,b){a.position?l.fromArray(a.position):l.copy(c.cameraWorldPosition());
var d=void 0!==a.width?a.width:8E3,g=void 0!==a.height?a.height:4E3;g=$jscomp.makeIterator(f(d,g));d=g.next().value;g=g.next().value;var h=void 0!==a.rotation?THREE.Math.degToRad(a.rotation):0;h=e(l,h,d,g);WALK.ajaxPost("panorama?width="+d+"&height="+g+"&name="+a.name,"application/binary",h,b,b)}}})();(function(){WALK.InteractionDispatcher=function(a,b,c,d,e,g,f,h){function k(a,b){a=a?e:d;for(var c=0;c<a.length;c+=1)if(a[c](b.object,b.point,b.distance))return!0;return!1}function n(){return b.findIntersectionAtPosition(0,0,!0,u)}function p(){k(!1,u)}function l(a,c,d){h&&h.reset();return b.findIntersectionAtPosition(a,c,!0,v)?k(d,v):!1}function q(a){h&&h.reset();a.action===WALK.GAMEPAD_ACTION.TRIGGER&&l(0,0,!1)}function r(a,b){for(var c=0;c<g.length&&!g[c](a,b);c+=1);}var m=!1,u=new WALK.RayIntersection,
x=null;h&&h.setGazeHandlers(n,p);var t=new WALK.PointerEventHelper(a,WALK.POINTER_PRIORITY.INTERACTION_DISPATCHER);a=t.callbacks;var v=new WALK.RayIntersection,w=null,z=null;a.onPointerMove=function(a,b){console.assert(m);0!==g.length&&(w=a,z=b,c());return!1};a.onClick=function(a,b){return l(a,b,!1)};a.onDoubleClick=function(a,b){return l(a,b,!0)};f.addEventListener("actionActivated",q);this.handleHover=function(){if(m&&0!==g.length){var a=b.findObstacleMeshAtPosition(w,z);null===a?x&&(r(x,!1),x=
null):a!==x&&(x&&r(x,!1),r(a,!0),x=a)}};this.enable=function(){m=!0;t.enable();console.assert(null===x)};this.disable=function(){m=!1;null!==x&&(r(x,!1),x=null);t.disable()};this.dispose=function(){this.disable();f.removeEventListener("actionActivated",q)};this.enable()}})();(function(){function a(a,b){return S.renderIdle(a,b)}function b(a,b){b&&za.update();fa.update(a);P.enableCollisions&&!b&&da.handleCollisions(a);ia&&ia.handleHover();R.update(a);ba&&ba.updateCameraHeight(a);ea&&ea.updateCameraHeight();b&&!fa.teleportingToPoint&&(W.update(),F.requestFrame());ha&&(b&&!za.hasGamepads()?ha.update(a):ha.reset());for(var c=$jscomp.makeIterator(X.getAnimatedMeshes()),d=c.next();!d.done;d=c.next())d.value.update(a,R.cameraWorldPosition());c=!1;d=$jscomp.makeIterator(X.getAnimatedMaterials());
for(var e=d.next();!e.done;e=d.next())e=e.value,e.isPlaying&&(e.update(a),c=!0);c&&F.requestFrame();ua&&ua.update(a);sa._update(a);S.renderToScreen(a,b);xa&&xa.animate()}function c(a){a.view&&(ba&&ba.disable(),ia&&ia.disable())}function d(a){!ba||ba.isEnabled()||W.vrEnabled()||ba.enable();if(ea&&W.vrEnabled())ea.onTeleportDone();a.view&&ia&&ia.enable();W.vrEnabled()&&R.hmdReset()}function e(){if("hidden"===document.visibilityState){if(X)for(var a=$jscomp.makeIterator(X.getAnimatedMaterials()),b=a.next();!b.done;b=
a.next())b.value.sleepAnimation()}else if("visible"===document.visibilityState&&X){a=$jscomp.makeIterator(X.getAnimatedMaterials());for(b=a.next();!b.done;b=a.next())b.value.wakeAnimation();F.requestFrame()}}function g(){WALK.DETECTOR.ios&&(document.documentElement.style.height=window.innerHeight+"px",0!==document.body.scrollTop&&window.scrollTo(0,0));S.resize(W.vrEnabled());F.requestFrame();ca.onResize()}function f(){return document.pointerLockElement===D||document.mozPointerLockElement===D||document.webkitPointerLockElement===
D}function h(){return document.fullscreenElement||document.mozFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement}function k(){if(f()){R.mousePressLook=!1;ca.onPointerLockChange(!0);var a=WALK.urlHashContains("gazeinpointerlock");a?ta.enableMode():ta.disableMode();sa.anchorsVisible=a}else R.mousePressLook=!0,ca.onPointerLockChange(!1),ta.disableMode(),sa.anchorsVisible=!0;xa&&dat.GUI.toggleHide()}function n(){if(h())ca.onFullScreenChange(!0),
screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary");else ca.onFullScreenChange(!1)}function p(){var a=document.body;return void 0!==document.fullscreenEnabled||void 0!==document.webkitFullscreenEnabled||void 0!==document.mozFullScreenEnabled||void 0!==document.msFullscreenEnabled?!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled):void 0!==a.mozRequestFullScreen||void 0!==a.webkitRequestFullscreen||
void 0!==a.msRequestFullscreen||void 0!==a.requestFullscreen}function l(a){L.uploadNewBuffers(a);F&&F.requestFrame()}function q(a){L.uploadTexture(a);a.isAtlas()?a.forEachAtlasEntry(function(a){console.assert(null===a.isCutout);pa.isCutoutTexture(a)}):null===a.isCutout&&pa.isCutoutTexture(a);F&&F.requestFrame()}function r(a){a=[];var b=[],c=[];a.push(sa._clickListener);var d=sa._createHoverListener();d&&c.push(d);la=new WALK.ClickNavigator(da,R,fa);b.push(la.onMeshClicked);J||a.push(la.onMeshClicked);
ia=new WALK.InteractionDispatcher(V,da,function(){F.requestFrame()},a,b,c,za,ha)}function m(){ba&&ba.disable();ea&&ea.enable();R.mouseControlsPitch=!1;R.hmdReset();fa.onVrChange(!0);ta.enableMode();ca.onVrChange(!0);sa._vrChange(!0);g()}function u(a){F.isEnabled()&&(a?m():(R.resetRollAngle(),R.resetPitchAngle(),R.mouseControlsPitch=!0,console.assert(!W.vrEnabled()),ea&&ea.disable(),ba&&ba.enable(),fa.onVrChange(!1),ta.disableMode(),ca.onVrChange(!1),sa._vrChange(!1),g(),setTimeout(g,1E3)))}function x(a){J||
WALK.DETECTOR.mobile&&!WALK.ALLOW_MOBILE_VR||(WALK.DETECTOR.ios||WALK.DETECTOR.mobile&&WALK.DETECTOR.firefox)&&WALK.DETECTOR.inCrossOriginIframe||ca.setVrSupported(a)}function t(a,b){if(ea&&null!==b)ea.onHmdPositionUpdate(b);R.onHmdUpdate(a,b)}function v(a,b){a&&R.cameraWorldPosition().set(a[0],a[1],a[2]);b&&(a=new WALK.Euler,a.setFromDegTriple(b),R.setYawAngle(a.yaw),R.setPitchAngle(a.pitch))}function w(a){for(var b=0;b<a.length;b+=1)if(!a[b].lightProbe)return!1;return!0}function z(a,b,c){da=new WALK.Collider(a,
b,c);b.visitAllNodes(function(a){a.mesh&&da.addStaticObstacle(a.mesh)})}function A(){var a=THREE.Scene.prototype.add;THREE.Object3D.prototype.add=function(b){b instanceof THREE.Mesh&&L.uploadNewBuffers(b);a.call(this,b)}}function y(a){var b=WALK.urlHashGetArgument("view"),c=null;b&&(c=a.findViewByName(b));return c||a.views[0]}function E(a){function b(){F.requestFrame()}X=a;X.adjustSkiesAndCameraFarToSpanWholeScene();X.headLight=WALK.HEAD_LIGHT;X.addEventListener("sceneChanged",function(){return F.requestFrame()});
X.addEventListener("anyViewUpdated",function(){return ca.refresh()});X.disableLightProbesForMaterials();R.enable();X.threeScene.updateMatrixWorld(!0);W.setCameraFar(X.camera.far);S=new WALK.Renderer(L,W,X,U);V=new WALK.PointerEventDispatcher(L.domElement,J);((a=P.enableCollisions)||J)&&z(L,X,R);fa=new WALK.Teleport(X,R,da,F);fa.addEventListener("teleportStarted",c);fa.addEventListener("teleportDone",d);Z=new WALK.AutoTour(X,fa);a&&X.camera.autoClimb&&(ba=new WALK.StepsClimber(da,R,F));a&&(ea=new WALK.VRHeightController(R,
da));fa.switchToView(y(X),0);U.updateWithoutDelay();ya=new WALK.HashChangeTeleport(X,fa);wa=new WALK.ScreenshotTaker(L,X,R);a&&!WALK.urlHashContains("nogazeteleport")&&(ha=new WALK.GazePointer(X,R,b,ta));sa._sceneReadyToDisplay(L,X,R,fa,Z,da,wa,aa,ta,V,F);r(a);document.addEventListener("visibilitychange",e);window.addEventListener("resize",function(){WALK.DETECTOR.ios?setTimeout(g,1E3):g()},!1);p()&&ca.setFullScreenSupported();WALK.DETECTOR.mobile||WALK.DETECTOR.opera||void 0===document.pointerLockElement&&
void 0===document.mozPointerLockElement&&void 0===document.webkitPointerLockElement||ca.setPointerLockSupported();ca.sceneReadyToDisplay(X,fa,Z,wa);g();WALK.DEBUG&&WALK.DebugUI&&(xa=new WALK.DebugUI(X,R,g,F));WALK.DETECTOR.ios||D.focus();WALK.DEBUG_SHARED_BUFFERS&&(X.threeScene.overrideMaterial=new WALK.DebugMaterial);X.startAutoTourOnLoad()&&Z.start();F.enable();W.vrEnabled()&&m();Aa=qa.elapsedLoadTimeSec()}function I(a){J||WALK.urlHashContains("nostats")||0!==ka||ca.cover.sendStats&&WALK.ajaxPost("./stats/"+
a,null,null)}function O(a,b){function c(c){function d(){f.delete(e);null!==a.findLightProbe(e.id)&&(b.assignLightProbesToObjects(),b.createLightProbeTexture(e,!1),F.requestFrame())}var e=c.lightProbe;c=f.get(e);void 0===c&&(c=new WALK.DeferringExecutor(d,1E3),f.set(e,c));c.deferRun()}function d(a){a=a.lightProbe;b.createLightProbeTexture(a,!0);if(!a.isBoundingBoxInitialized()){var c=a.boxMax;a.boxMin.copy(a.position).addScalar(-1);c.copy(a.position).addScalar(1);a.enableBoundingBox()}}function e(b){for(b=
0;b<a.materials.length;b+=1)a.materials[b].forceObjectUniformsRefresh()}var f=new Map;a.addEventListener("lightProbeAdded",function(a){a=a.lightProbe;b.assignLightProbesToObjects();b.createLightProbeTexture(a,!0);a.isBoundingBoxInitialized()||a.disableBoundingBox();a.addEventListener("lightProbeBoundsInit",d);a.addEventListener("lightProbePositionUpdated",c);a.addEventListener("lightProbeBoundsUpdated",e)});a.addEventListener("lightProbeRemoved",function(){b.assignLightProbesToObjects()});for(var g=
0;g<a.lightProbes.length;g+=1)a.lightProbes[g].addEventListener("lightProbePositionUpdated",c),a.lightProbes[g].addEventListener("lightProbeBoundsInit",d),a.lightProbes[g].addEventListener("lightProbeBoundsUpdated",e)}function K(a,b,c){function d(f){if(f===a.length)c();else{var g=a[f],h=g.name;e.has(h)?d(f+1):(e.add(h),b.panoramaToServer(g,function(){return d(f+1)}))}}var e=new Set;d(0)}function T(a){function b(){if(P.onSceneLoaded)P.onSceneLoaded(new WALK.EditorHooks(a,ca,R,fa,ua,M,wa,F));ca.sceneLoadComplete();
sa._sceneLoadComplete();F.requestFrame();var b=qa.elapsedLoadTimeSec();I("loaded?readyToDisplayTime="+Aa.toFixed(1)+"&loadTime="+b.toFixed(1));qa=null}var c=WALK.urlHashContains("headless");pa.dispose();pa=null;if(0<a.lightProbes.length||J){var d=new WALK.LightProbeMaker(a,L,WALK.DETECTOR.textureLod,WALK.DETECTOR.mirrorCubeMaps,J);0===a.lightProbes.length&&J&&a.autoAddLightProbes&&WALK.arrangeLightProbes(a,d,c);if(0<a.lightProbes.length){w(a.gpuMeshes)||(console.warn("Some objects do not have light probes assigned, this is not optimal."),
d.assignLightProbesToObjects());var e;for(e=0;e<a.views.length&&"orbit"===a.views[e].mode;e+=1);e===a.views.length&&(e=0);fa.executeWithViewVisibilitySettings(a.views[e],function(){d.createAllLightProbeTextures()});a.enableLightProbesForMaterials()}}a.hasLightMap()&&S.enableAutoExposure();if(J){d?O(a,d):console.warn("Cube maps support is required in the edit mode");e=new WALK.LightControls(a,F);var f=new WALK.LightProbeControls(a,F),g=new WALK.CameraVolumeControls(a,F);ua=new WALK.EditorSelector(V,
a,L,da,e,f,g,F,R);wa.coverToServer(WALK.EDITOR_COVER_WIDTH,WALK.EDITOR_COVER_HEIGHT);v(P.forcedInitialCameraPosition,P.forcedInitialCameraRotation)}else d&&(d.dispose(),d=null);0<a.lights.length&&WALK.DETECTOR.dynamicLights&&WALK.DYNAMIC_LIGHTS&&(e=new WALK.LightAssigner(L,a.camera.far,a.lights,a.materials,a.logicalMeshes),e.assignLightLookupMaps(),e.dispose());J&&c?K(qa.panoramas,wa,b):b()}function Y(){Ha&&(Ha=!1,qa.load(),ca.sceneLoadStarted(WALK.urlHashContains("help")),I("play"))}function Q(a){ca.updateCover(a);
M.updateConfig(a.extensions||[]);J||M.startExtensions();sa._viewerConfigLoaded(a);pa=new WALK.CutoutTextureDetector(L);Ha=!0;a=new WALK.Scene(R.camera());qa=new WALK.SceneLoader(a,P.assetsUrl,J,Ca);aa=new WALK.LumaMeter(L,a);U=new WALK.ExposureController(a,R,aa);qa.onProgress=ca.loadProgress;qa.onTextureLoaded=q;qa.onMeshBuffersLoaded=l;qa.onReadyToDisplay=E;qa.onComplete=T;WALK.urlHashContains("autoplay")||Ba||0<ka?Y():WALK.urlHashContains("hideplay")||ca.enablePlayButton(Y)}function C(a){a.preventDefault();
ka+=1;F.disable();!J&&null===qa&&ka<=WALK.CONTEXT_LOST_RESTORE_LIMIT?(M.stopExtensions(),sa._contextLost(),ya.dispose(),ya=null,ia.dispose(),ia=null,la&&(la.dispose(),la=null),ca.contextLost()):WALK.USER_MSG.error("Graphics context lost, reload to retry.")}function B(a){a.preventDefault();!J&&null===qa&&ka<=WALK.CONTEXT_LOST_RESTORE_LIMIT&&(WALK.USER_MSG.info("Graphics context switched, reloading the scene to use the new context.",5E3),WALK.createGlobalDetector(L.context),L.webGLContextRestored(),
Q(ca.cover))}function H(){WALK.ajaxGet(WALK.COVER_JSON_URL,!1,Q,function(){WALK.USER_MSG.error("Failed to initialize the scene.")})}function N(c){A();P=c;if(L=WALK.createWebwalkRenderer(D))if(WALK.DETECTOR.missingCapabilities)WALK.USER_MSG.error(WALK.DETECTOR.missingCapabilities);else{D.addEventListener("webglcontextlost",C,!1);D.addEventListener("webglcontextrestored",B,!1);ca.init();M=new WALK.ExtensionsManager;c=null;try{WALK.urlHashContains("vrlo")?WebXRConfig.cardboardConfig.BUFFER_SCALE*=.5:
WALK.urlHashContains("vrhi")&&(WebXRConfig.cardboardConfig.BUFFER_SCALE*=1.5),c=new WebXRPolyfill(WebXRConfig)}catch(Oa){WALK.log("Failed to initialize WebXR polyfill")}W=new WALK.VRManager(L,za,c,x,t,function(a){a?F.disable():F.enable()},u);F=new WALK.AnimationController(W,b,a);F.disable();c=new WALK.Camera;R=new WALK.Controls(c,D,za,F);R.mousePressLook=!0;WALK.urlHashContains("flipmouse")&&(R.flipMouseLook=!0);R.disable();H()}else WALK.USER_MSG.error(window.WebGLRenderingContext?'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" target="_blank">WebGL</a> or your browser has WebGL disabled.<br/><a href="http://get.webgl.org/" target="_blank">Find out how to get it.</a>':
'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" target="_blank">WebGL</a>.<br/><a href="http://get.webgl.org/" target="_blank">Find out how to get it.</a>')}var D=$("walk-canvas"),J=WALK.EDIT_MODE,L,W,M,R,F,P,V,aa,U,X,S,da,ba,ea,ia,la,fa,ha,ya,Z,ua,qa=null,xa=null,pa,wa,ka=0,Ha=!1,Ba=!1,Aa,ta=new WALK.GazeModeObserver;var za=new WALK.GamepadManager;var ca=new WALK.Menu(J,za,function(){W.vrEnabled()?W.disableVr():(Z.isRunning()&&Z.stop(),
W.enableVr(L.context))},function(){if(h())h()&&(document.exitFullScreen=document.exitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitExitFullscreen,document.exitFullScreen&&document.exitFullScreen());else{var a=document.body;(a.mozRequestFullScreen||a.webkitRequestFullscreen||a.msRequestFullscreen||a.requestFullscreen).call(a);document.addEventListener("fullscreenchange",n,!1);document.addEventListener("mozfullscreenchange",n,!1);document.addEventListener("webkitfullscreenchange",
n,!1);document.addEventListener("MSFullscreenChange",n,!1)}},function(){f()?f()&&(document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()):(D.requestPointerLock=D.requestPointerLock||D.mozRequestPointerLock||D.webkitRequestPointerLock,D.requestPointerLock(),document.addEventListener("pointerlockchange",k,!1),document.addEventListener("mozpointerlockchange",k,!1),document.addEventListener("webkitpointerlockchange",
k,!1))});var Ca=new WALK.MergeConfig;J&&Ca.setAllMaterialsEditable();var sa=new WALK.Viewer(J,ca,Ca);var Ma={FontAwesomeSolid:"\uf2b9",FontAwesomeRegular:"\uf2b9",FontAwesomeBrands:"\uf293"};WALK.loadFontFamilies=function(a,b){var c={};a.forEach(function(a){console.assert(Ma[a],"Font "+JSON.stringify(a)+" is not supported.");c[a]=Ma[a]});WebFont.load({custom:{families:a,testStrings:c},active:b,fontinactive:function(a){console.error("Cannot load font: "+a);WALK.USER_MSG.info("Cannot load required fonts.")}})};
WALK.getViewerAssetUrl=function(){var a=function(){for(var a=document.getElementsByTagName("script"),b=0;b<a.length;++b){var c=a[b].src.match(/^(.*\/)walk(\.min)?\.js$/);if(c)return c[1]}console.error("Cannot determine webwalk URL.");return"/webwalk/"}();return function(b){return a+b}}();WALK.initEditMode=function(a){var b=document.createElement("base");b.target="_blank";document.head.appendChild(b);WALK.loadFontFamilies(Object.keys(Ma),function(){N(a)})};WALK.init=function(a){J||N(a)};WALK.play=
function(){Ha?Y():Ba=!0};WALK.getViewer=function(){return sa};WALK.Extensions={}})();(function(){WALK.ExtensionsManager=function(){this.extensionTypes=WALK.Extensions};WALK.ExtensionsManager.prototype={constructor:WALK.ExtensionsManager,updateConfig:function(a){this.extensions=[];a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())this._createExtensionFromConfig(b.value)},_createExtensionFromConfig:function(a){function b(b,c){return b.some(function(b){return b.name===c&&b.config.type===a.type})}a.name=a.name.toString();for(var c=a.name,d=2;b(this.extensions,a.name);)a.name=
c+d.toString(),d+=1;c=new this.extensionTypes[a.type](a);this.extensions.push(c);return c},startExtensions:function(){var a=this;this._loadFontAwesomeIfNeeded(function(){for(var b=0;b<a.extensions.length;b+=1)a.extensions[b].start()})},_loadFontAwesomeIfNeeded:function(a){var b=this,c=this.extensions.map(function(a){return b._getFonts(a.config)}).concat(WALK.FONT_FAMILIES_TO_LOAD).reduce(function(a,b){return a.concat(b)},[]).filter(function(a,b,c){return b===c.indexOf(a)});0<c.length&&!WALK.EDIT_MODE?
WALK.loadFontFamilies(c,a):a()},_getFonts:function(a){return this.extensionTypes[a.type].definition.properties.map(function(b){return"trigger"===b.type&&a[b.id]&&a[b.id].icon&&WALK.ICONS[a[b.id].icon].fontFamily}).filter(function(a){return a})},stopExtensions:function(){for(var a=0;a<this.extensions.length;a+=1)this.extensions[a].stop()},getEditableExtensionDefinitions:function(){for(var a=[],b=$jscomp.makeIterator(Object.entries(this.extensionTypes||{})),c=b.next();!c.done;c=b.next()){var d=$jscomp.makeIterator(c.value);
c=d.next().value;d=d.next().value;d.definition.hideFromEditor||a.push({type:c,definition:d.definition})}return a},getEditableExtensions:function(){for(var a=[],b=$jscomp.makeIterator(this.extensions),c=b.next();!c.done;c=b.next())c=c.value,c.definition.hideFromEditor||a.push(c);return a},addExtension:function(a){a=this._createExtensionFromConfig(a);a.start();return a},removeExtension:function(a){a.stop();for(var b=0;b<this.extensions.length;b+=1)if(this.extensions[b]===a){this.extensions.splice(b,
1);break}},getConfig:function(){return this.extensions.map(function(a){return a.config})}}})();(function(){function a(){}function b(a,b){var c=new THREE.Vector3,d=new THREE.Vector3;if("node"!==b.type){c.fromArray(b.position);var e=b.radius}else e=WALK.Extensions.MaterialPicker.VR_RADIUS;this.getPosition=function(f){"node"===b.type&&(d.copy(a.getCameraPosition()),d.sub(f),d.normalize().multiplyScalar(e),c.copy(f).add(d));return c};this.getRadius=function(){return e}}var c={"\uf2b9":"address-book","\uf2bb":"address-card","\uf1fe":"area-chart","\uf047":"arrows","\uf062":"arrow-up","\uf063":"arrow-down",
"\uf2a2":"assistive-listening-systems","\uf069":"asterisk","\uf29e":"audio-description","\uf1fa":"at","\uf0c9":"bars","\uf0f3":"bell","\uf02d":"book","\uf02e":"bookmark","\uf0a1":"bullhorn","\uf1ec":"calculator","\uf030":"camera","\uf080":"chart-bar","\uf200":"chart-pie","\uf0c2":"cloud","\uf013":"cog","\uf075":"comment","\uf14e":"compass","\uf09d":"credit-card","\uf05b":"crosshairs","\uf019":"download","\uf0e0":"envelope","\uf08e":"external-link","\uf06e":"eye","\uf1fb":"eye-dropper","\uf008":"film",
"\uf024":"flag","\uf07b":"folder","\uf06b":"gift","\uf025":"headphones","\uf015":"home","\uf03e":"image","\uf090":"sign-in","\uf129":"info","\uf0eb":"lightbulb","\uf0d0":"magic","\uf076":"magnet","\uf041":"map-marker","\uf276":"map-pin","\uf277":"map-signs","\uf1fc":"paint-brush","\uf040":"pencil","\uf095":"phone","\uf128":"question","\uf064":"share","\uf1e0":"share-alt","\uf07a":"shopping-cart","\uf1de":"sliders","\uf005":"star","\uf0e4":"tachometer","\uf02b":"tag","\uf03d":"video","\uf0ad":"wrench",
"\uf04b":"play","\uf16a":"youtube","\uf27d":"vimeo","\uf09a":"facebook","\uf099":"twitter","\uf16d":"instagram"};WALK.Extension=function(b){function d(a){return g.definition.properties.some(function(b){return b.id===a})}var g=this;this.triggers=[];var f=[];this.definition=this.constructor.definition;this.viewerApi=WALK.getViewer();this.running=!1;var h=[];this.config=WALK.readOnlyCopy(function(a){a=WALK.cloneObject(a);if(void 0!==a.anchor&&void 0===a.trigger&&!d("anchor")&&d("trigger")){var b=a.anchor;
b.icon&&b.icon.font&&(b.icon=c[b.icon.value]);a.trigger=b;a.anchor=void 0}b=$jscomp.makeIterator(g.definition.properties);for(var e=b.next();!e.done;e=b.next())e=e.value,void 0===a[e.id]&&void 0!==e.defaultValue&&(a[e.id]=e.defaultValue);return a}(b));Object.defineProperty(this,"name",{get:function(){return this.config.name}});this.cloneConfig=function(){return WALK.cloneObject(this.config)};this.updateConfig=function(a){this.stop();this.config=WALK.readOnlyCopy(a);this.start()};this.doStop=this.doStart=
a;this.start=function(){this.running||(this.doStart(),this.running=!0)};this.stop=function(){if(this.running){this.doStop();for(var a=$jscomp.makeIterator(f),b=a.next();!b.done;b=a.next())this.viewerApi.removeAnchor(b.value);a=$jscomp.makeIterator(h);for(b=a.next();!b.done;b=a.next())b=b.value,this.viewerApi.removeOnNodeTypeClicked(b[0],b[1]);h.length=0;this.triggers.length=0;f.length=0;this.running=!1}};this._vrChanged=function(a){a&&!this.definition.vrCompatible?this.stop():a||this.definition.vrCompatible||
this.start()};this.addTrigger=function(a,b){function c(a,c,d){b(a,c,d);return!0}"node"===a.type?(a=a.nodeType,h.push([a,c]),this.viewerApi.onNodeTypeClicked(a,c),this.triggers.push.apply(this.triggers,$jscomp.arrayFromIterable(this.viewerApi.findNodesOfType(a)))):(a=this.viewerApi.addAnchor(a,b),a.extension=this,f.push(a),this.triggers.push(a))};this.viewerApi.onVrChange(this._vrChanged.bind(this))};WALK.Extensions.HtmlLabel=function(a){WALK.Extension.call(this,a);this.id=WALK.Extensions.HtmlLabel.nextId;
++WALK.Extensions.HtmlLabel.nextId;this.toggleDisplay=function(){var a=this,b=a.viewerApi,c=document.getElementById("ext-html-label");c.dataset.id!==this.id.toString()?(c.dataset.id||(c.style.display="",b.sleepAnimatedMaterials()),c.querySelector("#ext-html-label-content").innerHTML=this.config.content,c.querySelector("#ext-html-label-close").onclick=function(){a.toggleDisplay()},c.dataset.id=this.id):(c.style.display="none",c.querySelector("#ext-html-label-content").innerHTML="",c.dataset.id="",
b.wakeAnimatedMaterials())};this.doStart=function(){var a=this;a.viewerApi.onSceneReadyToDisplay(function(){a.addTrigger(a.config.trigger,function(){a.toggleDisplay()})})};this.doStop=function(){this.display&&this.toggleDisplay()}};WALK.Extensions.HtmlLabel.definition={name:"HTML label",properties:[{id:"trigger",type:"trigger",label:"Trigger"},{id:"content",type:"textArea",label:"Content",optional:"true",defaultValue:"Content to display..."}],vrCompatible:!1};WALK.Extensions.HtmlLabel.nextId=0;WALK.Extensions.Audio=
function(a){function b(){r?p.pause():p.play()}function c(){var a=d.config;a.trigger&&d.addTrigger(a.trigger,b);a.menuButton&&(l=h.addMenuButton(n.src),l.addEventListener("click",b),q=h.getMenuButtonIcon(l));a.autoplay&&b()}WALK.Extension.call(this,a);var d=this,h=this.viewerApi,k=null,n=null,p=null,l=null,q=null,r=!1;this.doStart=function(){this.config.menuButton&&!k&&(k=WALK.preloadImage(h.getViewerAssetUrl("img/audio-on.svg")),n=WALK.preloadImage(h.getViewerAssetUrl("img/audio-off.svg")));p=document.createElement("audio");
p.src=this.config.url;p.loop=this.config.loop;p.addEventListener("play",function(){r=!0;q&&(q.src=k.src)});p.addEventListener("pause",function(){r=!1;q&&(q.src=n.src)});document.body.appendChild(p);h.onSceneReadyToDisplay(c)};this.doStop=function(){r=!1;l&&(this.viewerApi.removeMenuButton(l),q=l=null);p.pause();p.remove();p=null}};WALK.Extensions.Audio.definition={name:"Audio",properties:[{id:"url",type:"text",label:"URL"},{id:"autoplay",type:"bool",label:"Autoplay",defaultValue:!1},{id:"loop",type:"bool",
label:"Loop",defaultValue:!0},{id:"menuButton",type:"bool",label:"Show menu button",defaultValue:!0},{id:"trigger",type:"trigger",label:"Trigger",optional:!0}],vrCompatible:!0};WALK.Extensions.MaterialPicker=function(a){function c(){return(n.config.toReplace?[n.config.toReplace]:[]).concat(n.config.toPick||[])}function d(a){n.viewerApi.apiUserChangeState(q,a.name)}function f(a,b){console.assert(a===q);if(a=n.viewerApi.findMaterial(b))for(b=0;b<p.length;b+=1)n.viewerApi.setMaterialForMesh(a,p[b])}
function h(a,b,e){a=c().map(function(a){return n.viewerApi.findMaterial(a)});n.viewerApi.openMaterialPicker(a,d,l.getPosition(b),l.getRadius())}function k(){n.addTrigger(n.config.trigger,h);p=n.viewerApi.findMeshesWithMaterial(n.config.toReplace||[])}WALK.Extension.call(this,a);var n=this,p=[],l=new b(n.viewerApi,n.config.trigger),q="MaterialPicker:"+this.name;this.config.materials&&(a=WALK.cloneObject(this.config),0<a.materials.length&&(a.toReplace=a.materials[0],a.toPick=a.materials.slice(1)),a.materials=
void 0,this.config=WALK.readOnlyCopy(a));n.viewerApi.isSceneReadyToDisplay()||c().map(function(a){n.viewerApi.setMaterialEditable(a)});this.doStart=function(){this.viewerApi.onSceneReadyToDisplay(k);this.viewerApi.onApiUserStateChanged(q,f)};this.doStop=function(){var a=n.viewerApi.findMaterial(n.config.toReplace);a&&d(a);this.viewerApi.removeOnApiUserStateChanged(q,f)}};WALK.Extensions.MaterialPicker.VR_RADIUS=.07;WALK.Extensions.MaterialPicker.definition={name:"Material picker",properties:[{id:"trigger",
type:"trigger",label:"Trigger"},{id:"toReplace",type:"material",label:"Material to replace"},{id:"toPick",type:"list",elementType:"material",label:"Materials to pick"}],vrCompatible:!0};WALK.Extensions.MaterialComboPicker=function(a){function c(){for(var a=new Set,b=$jscomp.makeIterator(x),c=b.next();!c.done;c=b.next()){c=$jscomp.makeIterator(c.value);for(var d=c.next();!d.done;d=c.next())d=d.value,a.add(d.toReplace),a.add(d.toUse)}return a}function d(){for(var a=[x[0][0].toReplace],b=$jscomp.makeIterator(x),
c=b.next();!c.done;c=b.next())a.push(c.value[0].toUse);return a}function f(){for(var a=0;a<x.length;++a)for(var b=0;b<x[a].length;++b)for(var c=u.findMaterial(x[a][b].toReplace),d=$jscomp.makeIterator(q[a][b]),e=d.next();!e.done;e=d.next())u.setMaterialForMesh(c,e.value)}function h(a,b){u.apiUserChangeState(m,b)}function k(a,b){console.assert(a===m);f();if(0!==b)for(a=b-1,b=0;b<x[a].length;++b){var c=u.findMaterial(x[a][b].toUse);if(c)for(var d=$jscomp.makeIterator(q[a][b]),e=d.next();!e.done;e=d.next())u.setMaterialForMesh(c,
e.value)}}function n(a,b,c){a=d().map(function(a){return u.findMaterial(a)});u.openMaterialPicker(a,h,r.getPosition(b),r.getRadius())}function p(){l.addTrigger(l.config.trigger,n);for(var a=0;a<x.length;++a){q[a]=[];for(var b=$jscomp.makeIterator(x[a]),c=b.next();!c.done;c=b.next())q[a].push(u.findMeshesWithMaterial(c.value.toReplace))}}WALK.Extension.call(this,a);var l=this,q=[],r=new b(l.viewerApi,l.config.trigger),m="MaterialComboPicker:"+this.name,u=this.viewerApi,x=l.config.options;u.isSceneReadyToDisplay()||
c().forEach(function(a){u.setMaterialEditable(a)});this.doStart=function(){this.viewerApi.onSceneReadyToDisplay(p);this.viewerApi.onApiUserStateChanged(m,k)};this.doStop=function(){f();this.viewerApi.removeOnApiUserStateChanged(m,k)}};WALK.Extensions.MaterialComboPicker.definition={name:"Material combo picker",hideFromEditor:!0,properties:[{id:"trigger",type:"trigger",label:"Trigger"},{id:"options",type:"list",label:"Options",elementType:{type:"list",label:"option",elementType:[{id:"toReplace",type:"material",
label:"Material to replace"},{id:"toUse",type:"material",label:"Material to use"}]}}],vrCompatible:!0};WALK.Extensions.VideoTextureControl=function(a){function b(){h.isPlaying?h.pause():h.play()}function c(){var a=d.config;if((h=d.viewerApi.findMaterial(a.material))&&h.baseColorTexture&&h.baseColorTexture.video){var c=h.baseColorTexture;c.loop=a.loop;if(!a.autoplay)c.pause(),c.muted=a.muted;else if(!a.muted)d.viewerApi.onPageFirstInteraction(function(){c.muted=!1});a.trigger&&d.addTrigger(a.trigger,
b)}else console.error("Video texture control configured for a material without a video texture"),h=null}WALK.Extension.call(this,a);var d=this,h=null;this.viewerApi.isSceneReadyToDisplay()||this.viewerApi.setMaterialEditable(this.config.material);this.doStart=function(){this.viewerApi.onSceneReadyToDisplay(c)};this.doStop=function(){h&&(h.baseColorTexture.muted=!0,h.pause(),h=null)}};WALK.Extensions.VideoTextureControl.definition={name:"Video texture control",properties:[{id:"material",type:"material",
label:"Material with video"},{id:"trigger",type:"trigger",label:"Trigger",optional:!0},{id:"autoplay",type:"bool",label:"Autoplay",defaultValue:!0},{id:"loop",type:"bool",label:"Loop",defaultValue:!0},{id:"muted",type:"bool",label:"Muted",defaultValue:!0}],vrCompatible:!0};WALK.Extensions.OpenWebsite=function(a){function b(){c.viewerApi.openUrl(c.config.url,c.config.newWindow)}WALK.Extension.call(this,a);var c=this;this.doStart=function(){this.viewerApi.onSceneReadyToDisplay(function(){c.addTrigger(c.config.trigger,
b)})}};WALK.Extensions.OpenWebsite.definition={name:"Open URL",properties:[{id:"trigger",type:"trigger",label:"Trigger"},{id:"url",type:"text",label:"URL"},{id:"newWindow",type:"bool",label:"New window",defaultValue:!0}],vrCompatible:!0};WALK.Extensions.ChangeView=function(a){function b(){c.viewerApi.switchToView(c.config.views[d],void 0,c.config.doNotMoveCamera);d=(d+1)%c.config.views.length}WALK.Extension.call(this,a);var c=this,d=0;this.doStart=function(){var a=this.viewerApi;d=0;a.onSceneReadyToDisplay(function(){c.addTrigger(c.config.trigger,
b)})}};WALK.Extensions.ChangeView.definition={name:"Change view",properties:[{id:"trigger",type:"trigger",label:"Trigger"},{id:"views",type:"list",elementType:"view",label:"Views to toggle"},{id:"doNotMoveCamera",type:"bool",label:"Do not move camera",defaultValue:!1}],vrCompatible:!0};WALK.Extensions.HideAnchors=function(a){function b(){h.anchorsVisible=!h.anchorsVisible}function c(a){l.src=a?k.src:n.src}WALK.Extension.call(this,a);var d=this,h=d.viewerApi,k=WALK.preloadImage(h.getViewerAssetUrl("img/anchors-on.svg")),
n=WALK.preloadImage(h.getViewerAssetUrl("img/anchors-off.svg")),p=null,l=null;this.doStart=function(){h=d.viewerApi;h.onAnchorsVisibilityChanged(c);p=h.addMenuButton(k.src);l=h.getMenuButtonIcon(p);p.addEventListener("click",b);var a=d.config;h.onSceneReadyToDisplay(function(){return h.anchorsVisible=a.visibleOnStart})};this.doStop=function(){h.removeAnchorsVisibilityChangedListener(c);h.removeMenuButton(p);l=p=null;h.anchorsVisible=!0}};WALK.Extensions.HideAnchors.definition={name:"Hide triggers",
properties:[{id:"visibleOnStart",type:"bool",label:"Visible on start",defaultValue:!0}],vrCompatible:!0};WALK.Extensions.Script=function(a){function b(){try{(new Function('"use strict"; '+c.config.code))()}catch(f){console.error("Script extension error: "+f)}}WALK.Extension.call(this,a);var c=this;this.doStart=function(){var a=this;if(this.config.trigger)this.viewerApi.onSceneReadyToDisplay(function(){return a.addTrigger(a.config.trigger,b)});else b()}};WALK.Extensions.Script.definition={name:"Script",
properties:[{id:"code",type:"textArea",label:"Code",defaultValue:"\x3c!-- Put your JavaScript code here. If a trigger is set, the code is executed when the trigger is clicked. Otherwise the code is executed when a page is loaded --\x3e"},{id:"trigger",type:"trigger",label:"Trigger",optional:!0}],vrCompatible:!0};WALK.Extensions.ProjectionScreen=function(a){function b(){var a=u.getVideoTexture1()||u.getVideoTexture0();r.baseColorTexture=a?a:m}function c(){WALK.log("Presentation stop");u&&(u.uuid===
q.myUuid&&q.stopShareScreen(),u.removeEventListener("dispose",c),u.removeEventListener("avatarUpdated",b));u=null;r.baseColorTexture=m;p.triggers[0].material.highlightMix=0}function d(){var a=q.myUuid;u&&(u.getVideoTexture1()||u.getVideoTexture0())?u.uuid===a&&(WALK.log("Requesting presentation stop"),p.viewerApi.apiUserChangeState(l,null)):(WALK.log("Requesting scren share "+a),q.startShareScreen(function(){p.viewerApi.apiUserChangeState(l,a)},function(){p.viewerApi.apiUserChangeState(l,null)},function(){}))}
function h(a,d){console.assert(a===l);d?(u&&u.uuid!==d&&(WALK.log("Changing presenting user"),c()),u||(WALK.log("New presenting user "+d),(u=p.viewerApi.findAvatar(d)||null)?(u.addEventListener("dispose",c),u.addEventListener("avatarUpdated",b),a=p.triggers[0].material,a.highlight=u.getMainMaterial().baseColor,a.setUniforms(),a.highlightMix=.7,b()):console.log("Cannot attach presentation stream of a user "+d+" The user was not found."))):c()}function k(){h(l,p.viewerApi.getApiUserState(l))}function n(a){var b=
p.config;(r=p.viewerApi.findMaterial(b.material))?(q=a,m=r.baseColorTexture,p.addTrigger(b.trigger,d),p.viewerApi.onApiUserStateChanged(l,h),p.viewerApi._onAvatarListChanged(k)):(console.error("Material for a projection screen is missing"),r=null)}WALK.Extension.call(this,a);var p=this,l="ProjectionScreen:"+this.name,q=null,r=null,m=null,u=null;this.viewerApi.isSceneReadyToDisplay()||this.viewerApi.setMaterialEditable(this.config.material);this.doStart=function(){this.viewerApi._onMeetingJoined(n)};
this.doStop=function(){this.viewerApi._removeOnMeetingJoined(n);q&&(this.viewerApi.removeOnApiUserStateChanged(l,h),this.viewerApi._removeOnAvatarListChanged(k));r=q=null}};WALK.Extensions.ProjectionScreen.definition={name:"Meeting projection screen",hideFromEditor:WALK.HIDE_MEETING_EXTENSIONS_FROM_EDITOR,properties:[{id:"material",type:"material",label:"Material to project on"},{id:"trigger",type:"trigger",label:"Trigger"}],vrCompatible:!0}})();(function(){function a(){if(WALK.isLocalhost())return"http://cloud.localhost:5001";var a=window.location.hostname;return a.endsWith(".shapespark.com")?"https://cloud"+a.substr(a.indexOf(".")):a.endsWith(".shapespark.com.cn")?"https://cloud.shapespark.com.cn":"https://cloud.shapespark.com"}function b(a){a=new Date(a);var b=new Date;return b.getDate()===a.getDate()&&b.getMonth()===a.getMonth()&&b.getFullYear()===a.getFullYear()?a.toLocaleTimeString():a.toLocaleDateString()+" "+a.toLocaleTimeString()}
function c(a,b){document.getElementById(a).onclick=b}function d(a,b){a.style.display=b?"":"none"}function e(a,b){b?a.classList.add("ext-meeting-button-highlight"):a.classList.remove("ext-meeting-button-highlight")}function g(a){a.classList.add("ext-meeting-input-missing");window.setTimeout(function(){a.classList.remove("ext-meeting-input-missing")},200)}function f(a,b,c,d){var e=document.createElement("li");e.classList.add("ext-meeting-list-entry");var f=e.appendChild(document.createElement("span"));
f.classList.add("ext-meeting-list-name");f.innerText=a;f.style.color=c;d&&(e.onclick=d,e.style.cursor="pointer");b&&(e.appendChild(document.createElement("br")),a=e.appendChild(document.createElement("small")),a.innerText=b,a.style.color="white");return e}function h(a,b,c){return{color:"#0775e8",icon:"edit",opacity:1,position:[a,b,c],radius:.07,type:"sphere"}}function k(a){var b=null;this.showDismiss=!0;this.onDismiss=this.onClose=null;this.foremost=this.top=!1;this.open=function(){var c=this;null===
b&&(b=document.createElement("div"),document.body.appendChild(b),b.innerHTML='\n       <div class="ext-popup '+(this.top?"ui-top ui-center":"ui-all-center")+" "+(this.foremost?"ui-foremost":"")+'">\n         <div class="ext-popup-content">\n           '+a+"\n         </div>"+(this.showDismiss?'<div class="ext-popup-close-button-panel ui-close-hoverable">\n           <div class="ext-popup-close-button"></div>\n         </div>':"")+"\n       </div>",this.showDismiss&&(b.getElementsByClassName("ext-popup-close-button")[0].onclick=
function(){return c.dismiss()}))};this.dismiss=function(){if(null!==b&&(this.close(),this.onDismiss))this.onDismiss()};this.close=function(){if(null!==b&&(document.body.removeChild(b),b=null,this.onClose))this.onClose()}}function n(a,b){b=b.attach();a=a.createTextureFromHtmlVideo(b);a.play();return a}function p(a){a.detach().forEach(function(a){return a.remove()})}function l(a){return a&&a.isStarted&&a.isEnabled&&!a.isStopped}function q(a,b){this._viewer=a;this._uuid=b;a=parseInt(b.substring(2));
this._color=Y[a%Y.length];this._twilioParticipant=this._avatar=this._displayName=null}function r(a,b,c){q.call(this,a,b);this._displayName=c;this._setUpAvatar();this._avatar.hideBody();this._dataTrack=new Twilio.Video.LocalDataTrack({maxPacketLifeTime:1E3});this._isCreatingVideoTrack=this._isCreatingAudioTrack=!1;this._lastPosition=this._screenTrack=this._videoTrack=this._audioTrack=null;this._positionMessage=[b,c,null];this._onVideoTrackStateChanged=this._onAudioTrackStateChanged=this._resendInterval=
null}function m(a,b,c){q.call(this,a,b);this._onUiRefreshNeeded=c;this._videoTrack0DisabledBound=this._videoTrack0EnabledBound=this._audioTrackStateChangedBound=this._videoTrack1=this._videoTrack0=this._audioTrack=null;this._trackSubscribedBound=this._trackSubscribed.bind(this);this._trackUnsubscribedBound=this._trackUnsubscribed.bind(this);this._disposed=!1}function u(a,b,c,d,e,f){var g=new PubNub({publishKey:b.publishKey,subscribeKey:b.subscribeKey,authKey:b.authKey,uuid:a.uuid,ssl:!0}),h=b.channel,
k;g.subscribe({channels:[h],withPresence:!0});g.addListener({message:function(b){b.publisher!==a.uuid&&(WALK.log("listener received message",b),"SceneState"===b.message.type&&(k=b.message.state,e(k)))},presence:function(b){b.uuid!==a.uuid&&(WALK.log("listener presence event",b),"join"===b.action?c(b.uuid):"leave"===b.action&&d(b.uuid))},status:function(a){"PNAccessDeniedCategory"!==a.category&&"PNNetworkIssuesCategory"!==a.category&&"PNNetworkDownCategory"!==a.category&&"PNTimeoutCategory"!==a.category||
f(a.category)}});g.hereNow({channels:[h],includeUUIDs:!0,includeState:!0},function(b,d){WALK.log("herenow",b,d);d.channels[h].occupants.forEach(function(b){b.uuid!==a.uuid&&c(b.uuid)})});this.updateSceneState=function(a){WALK.deepEqual(a,k)||(g.publish({message:{type:"SceneState",state:a},channel:h,storeInHistory:!1}),k=a)};this.dispose=function(){g.unsubscribeAll()}}function x(a,b,c,d,e){function f(a){WALK.log('Participant "%s" connected',a.identity);var b=(b=a.identity.match(/^u-\d+/))&&b[0];b||
(WALK.warn("Unknown participant",a.identity),b=null);b&&c(b,a)}function g(a){WALK.log('Participant "%s" disconnected',a.identity)}var h=b.avToken,k=b.channel,l=["NotAllowedError","NotFoundError","NotReadableError","OverconstrainedError","TypeError"],m=null,n=!1;this.isConnected=function(){return n};this.disconnect=function(){n=!1;m.disconnect();a.disconnectedFromTwilio()};this.dispose=function(){this.disconnect()};this.connect=function(){console.assert(!n);n=!0;WALK.log('Connecting to room "%s"',
k);Twilio.Video.connect(h,{name:k,tracks:a.getAllTracks()}).then(function(b){m=b;WALK.log("Connected to room");m.participants.forEach(f);m.on("participantConnected",f);m.on("participantDisconnected",g);m.once("disconnected",function(b){n&&(m.participants.forEach(g),a.disconnectedFromTwilio(),e("TDisconnected"+b.code))});a.connectedToTwilio(m.localParticipant)}).catch(function(a){l.includes(a.name)?d(a):e("T"+a.code)})}}function t(a,b){function c(a,b){var c=document.createElement("span");c.classList.add("ext-meeting-list-name");
c.innerText=a;c.style.color=b;return c}function d(a){var b=document.createElement("span");b.classList.add("ext-meeting-list-audio-indicator");a?b.classList.add("fa-microphone"):b.classList.add("fa-microphone-slash");return b}function e(){var b=document.createElement("li");b.classList.add("ext-meeting-list-entry");b.appendChild(c(a.displayName+" (me)",a.color));var e=l(a.audioTrack);b.appendChild(d(e));return b}function f(a){var b=document.createElement("li");b.classList.add("ext-meeting-list-entry");
var e=c(a.displayName,a.color);e.onclick=a.seeAvatar.bind(a);e.style.cursor="pointer";b.appendChild(e);b.appendChild(d(a.audioTrack&&a.audioTrack.isEnabled));return b}var g=document.getElementById("ext-meeting-status"),h=document.getElementById("ext-meeting-who-list");this.update=function(a){for(;h.firstChild;)h.removeChild(h.firstChild);h.appendChild(e());a=$jscomp.makeIterator(Object.values(a));for(var b=a.next();!b.done;b=a.next())b=b.value,b.hasDisplayName&&h.appendChild(f(b))};this.show=function(){g.style.display=
""};this.hide=function(){g.style.display="none"};this.update([]);this.show()}function v(a){return'\n      <div>\n        <textarea id="ext-meeting-note-text"\n          class="ext-meeeting-note-edit"\n          placeholder="'+a+'"></textarea>\n      </div>\n      <button id="ext-meeting-note-publish"\n        class="ext-meeting-button ext-meeting-right">\n        Publish\n      </button>\n    '}function w(a,b){var c="extMtg:"+a+":";this.getTimeStampOfLastReadEntry=function(a){return localStorage.getItem(c+
":"+a.id)||-1};this.isNoteRead=function(a){return a.entries[a.entries.length-1].ts<=this.getTimeStampOfLastReadEntry(a)};this.markNoteAsRead=function(a){localStorage.setItem(c+":"+a.id,a.entries[a.entries.length-1].ts)}}function z(a,d,e,l,m){function n(a){if(a===d.displayName)return d.color;for(var b=$jscomp.makeIterator(Object.values(e)),c=b.next();!c.done;c=b.next())if(c=c.value,c.displayName===a)return c.color;return"#ffffff"}function p(){t=!1;l.show();T.style.cursor="default";u.dismiss();w.close()}
function q(e,l){function p(f,h){if(!t){y&&y.close();z.classList.remove("ext-meeting-note-list-unread");z.classList.add("ext-meeting-note-list-selected");h&&z.scrollIntoView();f.material.highlightMix=.7;a.requestFrame();h="";for(var l=new Map,q=m.getTimeStampOfLastReadEntry(e),r=0;r<e.entries.length;++r){var u=e.entries[r],w="ext-meeting-note-text"+r,C="ext-meeting-note-author"+r,B="ext-meeting-note-entry";u.ts>q&&(B+=" ext-meeting-note-unread");h+='<div class="'+B+'">\n            <strong id="'+C+
'"\n                style="color: '+n(u.author)+'">\n            </strong> <span>'+b(u.ts)+'</span>\n            <div id="'+w+'">\n            </div>\n          </div>';l.set(w,u.text);l.set(C,u.author)}y=new k(h+v("Type your response"));y.top=!0;y.onClose=function(){m.markNoteAsRead(e);z.classList.remove("ext-meeting-note-list-selected");f.material.highlightMix=0;a.requestFrame();y=null};y.open();l.forEach(function(a,b){document.getElementById(b).innerText=a});c("ext-meeting-note-publish",function(){var b=
document.getElementById("ext-meeting-note-text"),c=b.value.trim();c?(e.entries.push({author:d.displayName,text:c,ts:Date.now()}),a.apiUserChangeState("MeetingNotes",x),p(f,!0)):g(b)})}}var q=a.addAnchor(h(e.x,e.y,e.z,"#0775e8"),function(a){return p(a,!0)});q.material.highlight=K;q.material.setUniforms();r.push(q);var u=e.entries[e.entries.length-1],w=u.author;var z=f(w,b(u.ts),n(w),function(){a.seeItem(q);p(q,!1)});m.isNoteRead(e)||z.classList.add("ext-meeting-note-list-unread");l.appendChild(z)}
var r=[],t=!1,u=new k("\n      <h2>\n        Click a place to leave a note there.\n      </h2>");u.top=!0;var w=new k(v("Type your note"));w.top=!0;var x=a.getApiUserState().MeetingNotes||[],y=null;c("ext-meeting-add-note",function(){t=!0;l.hide();T.style.cursor="pointer";y&&y.close();a.onNodeTypeClicked(C);u.onDismiss=function(){a.removeOnNodeTypeClicked(C);p()};u.open()});var z=new THREE.Vector3;var C=function(b,e,f){T.style.cursor="default";z.copy(e);WALK.movePointTowards(z,a.getCameraPosition(),
.1);a.removeOnNodeTypeClicked(C);var k=a.addAnchor(h(z.x,z.y,z.z));k.material.highlight=K;k.material.setUniforms();k.material.highlightMix=.7;u.close();w.onClose=function(){a.removeAnchor(k);p()};w.open();c("ext-meeting-note-publish",function(){var b=document.getElementById("ext-meeting-note-text"),c=b.value.trim();c?(b=Date.now(),c={id:d.displayName+":"+b,entries:[{author:d.displayName,text:c,ts:Date.now()}],x:z.x,y:z.y,z:z.z},x.push(c),m.markNoteAsRead(c),a.apiUserChangeState("MeetingNotes",x)):
g(b)});return!0};a.onApiUserStateChanged("MeetingNotes",function(b,c){console.assert("MeetingNotes"===b);x=c.sort(function(a,b){var c=m.isNoteRead(a),d=m.isNoteRead(b);return c!==d?c?-1:1:a.entries[a.entries.length-1].ts-b.entries[b.entries.length-1].ts});p();b=$jscomp.makeIterator(r);for(c=b.next();!c.done;c=b.next())a.removeAnchor(c.value);r.length=0;for(b=document.getElementById("ext-meeting-note-list");b.firstChild;)b.removeChild(b.firstChild);y&&y.close();c=$jscomp.makeIterator(x);for(var d=
c.next();!d.done;d=c.next())q(d.value,b),b.lastChild.scrollIntoView()})}function A(a,b){function d(){l=h=null;g.pointerX=null;g.pointerY=null;g.pointerZ=null;a._enableControls()}function e(){g.isEnabled()?(T.style.cursor="default",d(),n.disable(),m.close(),b.show()):(T.style.cursor="pointer",m.open(),n.enable(),m.onDismiss=e,b.hide())}var f=this,g=this,h=null,l=null,m=new k("\n      <h2>\n        Point a place by clicking.\n      </h2>");m.top=!0;var n=a._createPointerEventHelper(0);n.disable();this.pointerZ=
this.pointerY=this.pointerX=null;this.isEnabled=function(){return n.isEnabled()};this.showPointer=function(){return null!==this.pointerX};a.onBeforeRender(function(){if(null!==h){var b=a._findIntersectionAtPosition(h,l);Infinity!==b.distance&&(f.pointerX=b.point.x,f.pointerY=b.point.y,f.pointerZ=b.point.z)}});n.callbacks.onPointerDown=function(b,c){h=b;l=c;a._disableControls();a.requestFrame();return!0};n.callbacks.onPointerMove=function(b,c){if(null===h)return!1;h=b;l=c;a.requestFrame();return!0};
n.callbacks.onPointerUp=function(){d();a.requestFrame();return!0};c("ext-meeting-pointer",function(){e()})}function y(){var a=[0,0,0,0,0],b=[0,0,0,0,0,0,0,0],c=null,d=!1;this.newUpdateWithPointer=function(){d=!1;c!==b&&(d=!0,c=b)};this.newUpdateNoPointer=function(){d=!1;c!==a&&(d=!0,c=a)};this.set=function(a,b){c[a]!==b&&(c[a]=b,d=!0)};this.getFilledArray=function(){return d?c:null}}function E(){var a=document.getElementById("ext-meeting-audio-toggle"),b=document.getElementById("ext-meeting-video-toggle"),
c=document.getElementById("ext-meeting-self-video"),f=null;this.refreshAudioControls=function(b){l(b)?(e(a,!1),d(a.children[0],!0),d(a.children[1],!1)):(e(a,!0),d(a.children[0],!1),d(a.children[1],!0))};this.refreshVideoControls=function(a){l(a)?(f||(f=a.attach(),c.appendChild(f)),c.style.display="",e(b,!1),d(b.children[0],!0),d(b.children[1],!1)):(f&&(a.detach(),f.remove(),f=null),c.style.display="none",e(b,!0),d(b.children[0],!1),d(b.children[1],!0))};this.setToggleButtonHandlers=function(c,d){a.onclick=
c;b.onclick=d}}function I(b,c,d,e){function f(a){WALK.USER_MSG.error("Connection lost. Reload the page to rejoin the meeting.<br/>(Code:"+a+")")}function g(a){WALK.USER_MSG.info("Failed to acquire media.<br/>"+a.message,6E3)}function h(){N.toggleAudio(g)}function k(){N.toggleVideo(g)}function l(a){I.update(H)}function n(a){var b=H[a];b||(b=new m(C,a,l),H[a]=b);return b}function p(a){for(var b=$jscomp.makeIterator(Object.keys(a)),c=b.next();!c.done;c=b.next())c=c.value,C.apiUserChangeState(c,a[c])}
function q(a){T.showPointer()?(B.newUpdateWithPointer(),B.set(5,WALK.round(T.pointerX,3)),B.set(6,WALK.round(T.pointerY,3)),B.set(7,WALK.round(T.pointerZ,3))):B.newUpdateNoPointer();a=C.getCameraPosition();var b=C.getCameraRotation();B.set(0,WALK.round(a.x,3));B.set(1,WALK.round(a.y,3));B.set(2,WALK.round(a.z,3));B.set(3,WALK.round(b.yaw,1));B.set(4,WALK.round(b.pitch,1));(a=B.getFilledArray())&&N.updatePosition(a)}function v(){WALK.USER_MSG.error("The meeting has ended. Maximum duration of meeting reached.)");
ha.dispose();Y.dispose();for(var a in H)H.hasOwnProperty(a)&&H[a].dispose();I.update({})}var C=WALK.getViewer(),B=new y;this.myUuid=e.uuid;var N=new r(C,this.myUuid,b),H={},I=new t(N,C),K=new E,O=e.id,Q=e.meetingKey;K.setToggleButtonHandlers(h,k);N.setAvTracksStateHandlers(function(a){K.refreshAudioControls(a);I.update(H)},function(a){K.refreshVideoControls(a)});c&&h();d&&k();var T=new A(C,I);WALK.urlHashContains("meeting-notes")&&(document.getElementById("ext-meeting-notes-preview").style.display=
"",z(C,N,H,I,new w(O,b)));null!==e.sceneState&&p(e.sceneState);var Y=new u(N,e,function(a){n(a);ha.isConnected()||ha.connect()},function(a){a in H&&(H[a].dispose(),delete H[a],I.update(H),ha.isConnected()&&0===Object.keys(H).length&&ha.disconnect())},p,f);var ha=new x(N,e,function(a,b){n(a).connectedToTwilio(b)},g,f);C.onBeforeRender(q);q();C.onApiUserStateChanged(function(b,c){b=C.getApiUserState();c={meetingKey:Q,sceneState:b};WALK.ajaxPost(a()+"/meetings/"+O+"/scene-state","application/json",JSON.stringify(c),
function(){return WALK.log("State updated.")},function(){return WALK.log("Failed to update state.")});Y.updateSceneState(b)});this.startShareScreen=function(a,b,c){WALK.log("Screen share start requested");N.startShareScreen(a,b,c)};this.stopShareScreen=function(){WALK.log("Screen share stop requested");N.stopShareScreen()};null!==e.remainingTimeSeconds&&setTimeout(v,1E3*(e.remainingTimeSeconds+5))}function O(a){var b=WALK.getViewer();b.onSceneReadyToDisplay(function(){var d=document.getElementById("help-and-primary-progress");
d.classList.add("ui-blur");var e=new k('\n        <div class="ext-meeting-join-row">\n          <div class="ext-meeting-join-label">Name:</div>\n          <input type="text" id="ext-meeting-join-name">\n        </div>\n        <div class="ext-meeting-join-row">\n          <div class="ext-meeting-join-label">Join with:</div>\n          <label>\n            <input type="checkbox" id="ext-meeting-join-audio" checked>\n            Audio\n          </label>\n          <label>\n            <input type="checkbox" id="ext-meeting-join-video" checked>\n            Video\n          </label>\n        </div>\n        <div class="ext-meeting-join-row ext-meeting-join-center">\n          <button id="ext-meeting-join-button" class="ext-meeting-button">\n            Join virtual meeting\n          </button>\n        </div>\n        <div class="ext-meeting-join-footer">\n          By joining, you agree to the\n          <a href="https://www.shapespark.com/terms" target="_blank">\n           Terms of Service\n         </a> and <a href="https://www.shapespark.com/privacy" target="_blank">\n           Privacy Policy\n         </a>.\n        </div>\n        ');
e.showDismiss=!1;e.foremost=!0;e.open();var f=document.getElementById("ext-meeting-join-name"),h=document.getElementById("ext-meeting-join-audio"),l=document.getElementById("ext-meeting-join-video"),m=localStorage.getItem("extMtgDisplayName");m&&(f.value=m);c("ext-meeting-join-button",function(){if(m=f.value.trim()){localStorage.setItem("extMtgDisplayName",m);e.close();d.classList.remove("ui-blur");d.classList.add("ui-unblur");var c=new I(m,h.checked,l.checked,a);b._meetingJoined(c)}else g(f)})})}
if(WALK.urlHashContains("meeting-key")||WALK.urlHashContains("meeting")){WALK.FONT_FAMILIES_TO_LOAD.push("FontAwesomeSolid");WALK.FONT_FAMILIES_TO_LOAD.push("FontAwesomeRegular");var K=new THREE.Color(0,1,0),T=document.getElementById("walk-canvas"),Y="#65ffcc #dfe592 #99dd92 #cc96b1 #94c4d3 #93d8b9 #65c4ff #ff6565 #cca499 #b394cc #e29191 #ff65f4 #656bff #ffa560 #6bff63 #949ace #ad65ff #ff6584".split(" ");q.prototype={constructor:q,_setUpAvatar:function(){console.assert(this._displayName,"Display name must be known to set up the avatar");
WALK.log("Setting up avatar for %s:%s",this._uuid,this._displayName);this._avatar=this._viewer.addAvatar(this._uuid,{displayName:this._displayName,color:this._color})},get uuid(){return this._uuid},get color(){return this._color},get displayName(){return this._displayName},get hasDisplayName(){return null!==this._displayName},updatePosition:function(a){if(this.hasDisplayName){var b=this._avatar;b.position.fromArray(a);b.rotate(a[3],a[4]);6<=a.length?b.placePointer(a[5],a[6],a[7]):b.hidePointer();
b.visible&&(b.updateMatrixWorld(!0),this._viewer.requestFrame())}},dispose:function(){this._avatar&&(this._viewer.removeAvatar(this._avatar),this._avatar=null,this._viewer.requestFrame())}};r.prototype=Object.create(q.prototype);r.prototype.constructor=r;Object.defineProperty(r.prototype,"dataTrack",{get:function(){return this._dataTrack}});Object.defineProperty(r.prototype,"audioTrack",{get:function(){return this._audioTrack}});Object.defineProperty(r.prototype,"videoTrack",{get:function(){return this._videoTrack}});
Object.defineProperty(r.prototype,"screenTrack",{get:function(){return this._screenTrack}});r.prototype.getAllTracks=function(){var a=[this._dataTrack];this._audioTrack&&a.push(this._audioTrack);this._videoTrack&&a.push(this._videoTrack);this._screenTrack&&a.push(this._screenTrack);return a};r.prototype._sendPosition=function(a){this._positionMessage[2]=a;this._dataTrack.send(JSON.stringify(this._positionMessage))};r.prototype._resendLastPosition=function(){null!==this._lastPosition&&this._sendPosition(this._lastPosition)};
r.prototype.connectedToTwilio=function(a){var b=this;this._twilioParticipant=a;this._twilioParticipant.publishTracks(this.getAllTracks());this._resendLastPosition();this._resendInterval=setInterval(function(){return b._resendLastPosition()},1E3)};r.prototype.disconnectedFromTwilio=function(){this._twilioParticipant=null;clearInterval(this._resendInterval);this._resendInterval=null};Object.defineProperty(r.prototype,"isConnectedToTwilio",{get:function(){return null!==this._twilioParticipant}});r.prototype.updatePosition=
function(a){WALK.log("Update local position",a);q.prototype.updatePosition.call(this,a);this._lastPosition=a;this.isConnectedToTwilio&&this._sendPosition(a)};r.prototype.setAvTracksStateHandlers=function(a,b){this._onAudioTrackStateChanged=a;this._onVideoTrackStateChanged=b};r.prototype._removeStoppedAudioTrack=function(){console.assert(this._audioTrack&&this._audioTrack.isStopped);WALK.log("Removing stopped local audio track");this._twilioParticipant&&(WALK.log("Unpublishing stopped local audio track"),
this._twilioParticipant.unpublishTrack(this._audioTrack));this._audioTrack=null};r.prototype._createAudioTrack=function(a){var b=this;WALK.log("Creating local audio track");if(this._isCreatingAudioTrack)WALK.log("Local audio track is already being created");else{this._isCreatingAudioTrack=!0;var c=null;Twilio.Video.createLocalAudioTrack().then(function(a){c=a;if(b.isConnectedToTwilio)return WALK.log("Publishing local audio track"),b._twilioParticipant.publishTrack(c)}).then(function(){WALK.log("Local audio track published");
b._audioTrack=c;var a=function(){b._onAudioTrackStateChanged&&b._onAudioTrackStateChanged(b._audioTrack)};b._audioTrack.on("started",a);b._audioTrack.on("enabled",a);b._audioTrack.on("disabled",a);b._audioTrack.on("stopped",function(){a();b._removeStoppedAudioTrack()});a();b._isCreatingAudioTrack=!1}).catch(function(d){c&&c.stop();a(d);b._isCreatingAudioTrack=!1})}};r.prototype.toggleAudio=function(a){this._audioTrack?this._audioTrack.isEnabled?(WALK.log("Disabling local audio track"),this._audioTrack.disable()):
(WALK.log("Enabling local audio track"),this._audioTrack.enable()):this._createAudioTrack(a)};r.prototype._removeStoppedVideoTrack=function(){console.assert(this._videoTrack&&this._videoTrack.isStopped);WALK.log("Removing stopped local video track");this._twilioParticipant&&(WALK.log("Unpublishing stopped local video track"),this._twilioParticipant.unpublishTrack(this._videoTrack));this._videoTrack=null};r.prototype._createVideoTrack=function(a){var b=this;WALK.log("Creating local video track");if(this._isCreatingVideoTrack)WALK.log("Local video track is already being created");
else{this._isCreatingVideoTrack=!0;var c=null;Twilio.Video.createLocalVideoTrack().then(function(a){c=a;if(b.isConnectedToTwilio)return b._twilioParticipant.publishTrack(c)}).then(function(){WALK.log("Local video track published");b._videoTrack=c;var a=function(){b._onVideoTrackStateChanged&&b._onVideoTrackStateChanged(b._videoTrack)};b._videoTrack.on("started",a);b._videoTrack.on("enabled",a);b._videoTrack.on("disabled",a);b._videoTrack.on("stopped",function(){a();b._removeStoppedVideoTrack()});
a();b._isCreatingVideoTrack=!1}).catch(function(d){c&&c.stop();a(d);b._isCreatingVideoTrack=!1})}};r.prototype.toggleVideo=function(a){this._videoTrack?this._videoTrack.stop():this._createVideoTrack(a)};r.prototype.startShareScreen=function(a,b,c){var d=this;null!==this._screenTrack?a():(WALK.log("Share screen start"),navigator.mediaDevices.getDisplayMedia().then(function(c){WALK.log("share screen - stream:",c);var e=new Twilio.Video.LocalVideoTrack(c.getTracks()[0]);d._screenTrack=e;c=n(d._viewer,
e);d._avatar.setVideoTexture0(c);d._viewer.requestFrame();d.isConnectedToTwilio&&d._twilioParticipant.publishTrack(e);a();e.once("stopped",function(){WALK.log("Screen track stopped");d.isConnectedToTwilio&&d._twilioParticipant.unpublishTrack(e);d._avatar.setVideoTexture0(null);p(e);d._screenTrack=null;d._viewer.requestFrame();b()})}).catch(function(a){c()}))};r.prototype.stopShareScreen=function(){null!==this._screenTrack&&(WALK.log("Share screen stop"),this._screenTrack.stop())};r.prototype.dispose=
function(){this._screenTrack&&this.stopShareScreen();q.prototype.dispose.call(this)};m.prototype=Object.create(q.prototype);m.prototype.constructor=m;Object.defineProperty(m.prototype,"audioTrack",{get:function(){return this._audioTrack}});Object.defineProperty(m.prototype,"videoTrack0",{get:function(){return this._videoTrack0}});m.prototype._refreshUi=function(){this._onUiRefreshNeeded&&this._onUiRefreshNeeded(this)};m.prototype._setUpAudioTrack=function(){var a=this;WALK.log("Setting up remote audio track for %s:%s",
this._uuid,this._displayName);this._audioTrackStateChangedBound=function(){a._refreshUi()};this._audioTrack.on("enabled",this._audioTrackStateChangedBound);this._audioTrack.on("disabled",this._audioTrackStateChangedBound);this._audioTrack.attach()};m.prototype._tearDownAudioTrack=function(){WALK.log("Tearing down remote audio track for %s:%s",this._uuid,this._displayName);p(this._audioTrack);this._audioTrack.removeListener("enabled",this._audioTrackStateChangedBound);this._audioTrack.removeListener("disabled",
this._audioTrackStateChangedBound);this._audioTrackStateChangedBound=null};m.prototype._setUpVideoTrack0=function(){var a=this;WALK.log("Setting up remote video track 0 for %s:%s",this._uuid,this._displayName);var b=n(this._viewer,this._videoTrack0);this._videoTrack0EnabledBound=function(){a._avatar.setVideoTexture0(b)};this._videoTrack0DisabledBound=function(){a._avatar.setVideoTexture0(null)};this._videoTrack0.on("enabled",this._videoTrack0EnabledBound);this._videoTrack0.on("disabled",this._videoTrack0DisabledBound);
this._avatar.setVideoTexture0(b)};m.prototype._tearDownVideoTrack0=function(){WALK.log("Tearing down remote video track 0 for %s:%s",this._uuid,this._displayName);this._avatar.setVideoTexture0(null);p(this._videoTrack0);this._videoTrack0.removeListener("enabled",this._videoTrack0EnabledBound);this._videoTrack0.removeListener("disabled",this._videoTrack0DisabledBound);this._videoTrack0DisabledBound=this._videoTrack0EnabledBound=null};m.prototype._setUpVideoTrack1=function(){WALK.log("Setting up remote video track 1 for %s:%s",
this._uuid,this._displayName);var a=n(this._viewer,this._videoTrack1);this._avatar.setVideoTexture1(a)};m.prototype._tearDownVideoTrack1=function(){WALK.log("Tearing down remote video track 1 for %s:%s",this._uuid,this._displayName);this._avatar.setVideoTexture1(null);p(this._videoTrack1)};m.prototype._setDisplayName=function(a){WALK.log("Remote display name known for %s:%s",this._uuid,a);this._displayName=a;this._setUpAvatar();this._audioTrack&&this._setUpAudioTrack();this._videoTrack0&&this._setUpVideoTrack0();
this._videoTrack1&&this._setUpVideoTrack1();this._refreshUi()};m.prototype._trackSubscribed=function(a){var b=this;WALK.log("Remote %s track subscribed for %s:%s",a.kind,this._uuid,this._displayName);if(!this._disposed)if("data"===a.kind)a.on("message",function(a){a=JSON.parse(a);var c=a[1];a=a[2];b.hasDisplayName||b._setDisplayName(c);b.updatePosition(a)});else"audio"===a.kind?this._audioTrack||(this._audioTrack=a,this.hasDisplayName&&(this._setUpAudioTrack(),this._refreshUi())):"video"===a.kind&&
(this._videoTrack0?(this._videoTrack1=a,this._setUpVideoTrack1(),this._viewer.requestFrame()):(this._videoTrack0=a,this._avatar&&(this._setUpVideoTrack0(),this._viewer.requestFrame())))};m.prototype._trackUnsubscribed=function(a){WALK.log("Remote %s track unsubscribed for %s:%s",a.kind,this._uuid,this._displayName);this._disposed||(a===this._audioTrack?(this.hasDisplayName&&this._tearDownAudioTrack(),this._audioTrack=null,this._refreshUi()):a===this._videoTrack0?(this._avatar&&(this._tearDownVideoTrack0(),
this._viewer.requestFrame()),this._videoTrack0=null):a===this._videoTrack1&&(this._tearDownVideoTrack1(),this._videoTrack1=null,this._viewer.requestFrame()))};m.prototype.connectedToTwilio=function(a){var b=this;this._twilioParticipant=a;a.on("trackSubscribed",this._trackSubscribedBound);a.on("trackUnsubscribed",this._trackUnsubscribedBound);a.tracks.forEach(function(a){a.isSubscribed&&b._trackSubscribed(a.track)})};m.prototype.seeAvatar=function(){this._avatar&&this._viewer.seeItem(this._avatar)};
m.prototype.dispose=function(){this._onUiRefreshNeeded=null;this._audioTrack&&this._trackUnsubscribed(this._audioTrack);this._videoTrack0&&this._trackUnsubscribed(this._videoTrack0);this._videoTrack1&&this._trackUnsubscribed(this._videoTrack1);this.isConnectedToTwilio&&(this._twilioParticipant.removeListener("trackSubscribed",this._trackSubscribedBound),this._twilioParticipant.removeListener("trackUnsubscribed",this._trackUnsubscribedBound),this._twilioParticipant=null);q.prototype.dispose.call(this);
this._disposed=!0};var Q=document.createElement("script");Q.onload=function(){var b=WALK.urlHashGetArgument("meeting"),c=WALK.urlHashGetArgument("meeting-key"),d=WALK.urlHashGetArgument("av-mode");var e=WALK.isLocalhost()?"http://friend.localhost:5001"+window.location.pathname:window.location.href;e={url:e};b&&(e.meetingName=b);c&&(e.meetingKey=c);d&&(e.avMode=d);WALK.ajaxPost(a()+"/meetings/join","application/json",JSON.stringify(e),function(a){return O(a)},function(a,b){void 0!==b?WALK.USER_MSG.error(b):
WALK.USER_MSG.error("Failed to join the meeting. Is your link valid?")})};Q.src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.21.7.min.js";Q.type="text/javascript";document.body.appendChild(Q);Q=document.createElement("script");Q.src="https://media.twiliocdn.com/sdk/js/video/releases/2.7.0/twilio-video.min.js";Q.type="text/javascript";document.body.appendChild(Q)}})();
